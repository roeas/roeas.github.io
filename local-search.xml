<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>åšå®¢ä¼ é€é—¨</title>
    <link href="/2024/10/06/Blog/"/>
    <url>/2024/10/06/Blog/</url>
    
    <content type="html"><![CDATA[<h1 id="åšå®¢"><a href="#åšå®¢" class="headerlink" title="åšå®¢"></a>åšå®¢</h1><p><a href="https://t-rvw.github.io/blog/">CatDogEngine</a><br><a href="https://technology.riotgames.com/tags/rendering">RiotGames</a><br><a href="https://sebh.github.io/publications/">SÃ©bastien Hillaireâ€™s website</a><br><a href="http://evasion.inrialpes.fr/~Eric.Bruneton/">Eric Bruneton</a><br><a href="https://www.scratchapixel.com/index.php?redirect">Scratchapixel</a><br><a href="http://walkingfat.com/">WalkingFat</a><br><a href="https://www.qiujiawei.com/">Wyman çš„åŸåˆ›æŠ€æœ¯åšå®¢</a><br><a href="https://iquilezles.org/">Inigo Quilez</a><br><a href="http://kevinbeason.com/">Kevin Beason</a><br><a href="http://candycat1992.github.io/">Candycat Blog</a><br><a href="https://wickedengine.net/">Wicked Engine Net</a><br><a href="https://www.cnblogs.com/miloyip/">Milo çš„æ¸¸æˆå¼€å‘</a><br><a href="http://blog.hakugyokurou.net/">ç™½ç‰æ¥¼ä¹‹æ¢¦ - szszssâ€™ blog</a><br><a href="https://blog.selfshadow.com/">Self Shadow</a><br><a href="https://www.cnblogs.com/ghl_carmack/">é£æ‹æ®‹é›ª</a><br><a href="https://qiankanglai.me/">Loading &amp; Learning</a><br><a href="https://baddogzz.github.io/">æ¶æ¯’çš„ç‹—</a><br><a href="https://www.cnblogs.com/X-Jun/">X_Jun</a><br><a href="http://www.cppblog.com/Leaf/">éº’éºŸå­</a><br><a href="http://www.klayge.org/">KlayGE æ¸¸æˆå¼•æ“</a><br><a href="https://imgeself.github.io/">Dear World,</a><br><a href="https://zhuanlan.zhihu.com/p/36675543">è™šå¹» 4 æ¸²æŸ“ç¼–ç¨‹ä¸“é¢˜æ¦‚è¿°åŠç›®å½•</a><br><a href="https://blog.codingnow.com/">äº‘é£çš„ BLOG</a><br><a href="https://placeholderart.wordpress.com/">Placeholder Art</a><br><a href="https://knarkowicz.wordpress.com/">Krzysztof Narkowicz</a><br><a href="https://technology.riotgames.com/">RIOT GAMMES TECHBLOG</a><br><a href="https://agraphicsguynotes.com/">A GRAPHICS GUYâ€™S NOTE</a><br><a href="https://kesen.realtimerendering.com/">Ke-Sen Huangâ€™s Home Page</a><br><a href="https://www.o3de.org/community/">O3DE Community</a><br><a href="https://www.cnblogs.com/KillerAery/">KillerAery</a><br><a href="https://neil3d.gitee.io/reading/index.html">æ¸¸æˆç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ç°ä»£ C++ éšè®°</title>
    <link href="/2024/05/02/CPP/"/>
    <url>/2024/05/02/CPP/</url>
    
    <content type="html"><![CDATA[<h2 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h2><p>ç°ä»£ C++ ç›¸å…³çš„ç¬”è®°ã€‚</p><h2 id="inline-å’Œ-static"><a href="#inline-å’Œ-static" class="headerlink" title="inline å’Œ static"></a>inline å’Œ static</h2><h3 id="å”¯ä¸€å®šä¹‰åŸåˆ™"><a href="#å”¯ä¸€å®šä¹‰åŸåˆ™" class="headerlink" title="å”¯ä¸€å®šä¹‰åŸåˆ™"></a>å”¯ä¸€å®šä¹‰åŸåˆ™</h3><p><a href="https://en.cppreference.com/w/cpp/language/definition">https://en.cppreference.com/w/cpp/language/definition</a></p><p><code>extern int a;</code> æ˜¯å£°æ˜ã€‚<br><code>int a;</code>, <code>int a = 1;</code>, <code>extern int a = 1;</code> éƒ½æ˜¯å®šä¹‰ã€‚</p><p><code>void foo();</code> æ˜¯å£°æ˜ã€‚<br><code>void foo() &#123;&#125;</code> æ˜¯å®šä¹‰ã€‚</p><h3 id="static"><a href="#static" class="headerlink" title="static"></a>static</h3><ul><li>å°†å®šä¹‰çš„å¯è§æ€§é™åˆ¶åˆ°å½“å‰ç¿»è¯‘å•å…ƒï¼Œä½¿å¾—ä¸åŒç¿»è¯‘å•å…ƒä¹‹é—´åŒåå®šä¹‰ä¸å†²çªã€‚</li><li>å®é™…ä¸Šæ ¹æ®ä¸åŒçš„ç”¨æ³• static å¯ä»¥æ§åˆ¶å¯è§æ€§ï¼Œä¹Ÿå¯ä»¥æ§åˆ¶ç”Ÿå‘½å‘¨æœŸï¼Œè¿™é‡Œæˆ‘ä»¬åªè®¨è®ºå¯è§æ€§ç›¸å…³çš„åŠŸèƒ½ã€‚</li></ul><h3 id="inline"><a href="#inline" class="headerlink" title="inline"></a>inline</h3><ul><li>å¯ä»¥åœ¨å¤šä¸ªç¿»è¯‘å•å…ƒå†…å­˜åœ¨åŒå inline å®šä¹‰ï¼Œç¼–è¯‘å™¨é€‰æ‹©å…¶ä¸­ä¸€ä»½ä½œä¸ºå”¯ä¸€çš„å®šä¹‰ï¼Œå…·ä½“é€‰æ‹©å“ªä»½å®šä¹‰åˆ™æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚</li><li>æ—¢æœ‰ static çš„ä¼˜ç‚¹ï¼Œå¯ä»¥å†™åœ¨å¤´æ–‡ä»¶å†…è¢«ä¸åŒç¿»è¯‘å•å…ƒåŒ…å«ï¼Œåˆæœ‰ extern çš„ä¼˜ç‚¹ï¼Œå¯ä»¥å…¨å±€å…±äº«ã€‚</li></ul><h3 id="å¯¹äºæˆå‘˜å˜é‡"><a href="#å¯¹äºæˆå‘˜å˜é‡" class="headerlink" title="å¯¹äºæˆå‘˜å˜é‡"></a>å¯¹äºæˆå‘˜å˜é‡</h3><p><code>inline static</code> çš„æˆå‘˜å˜é‡å¯ä»¥ç›´æ¥åœ¨å¤´æ–‡ä»¶å†…å£°æ˜ä¸å®šä¹‰ï¼Œå…å»äº†å†åœ¨ cpp æ–‡ä»¶é‡Œå†™ä¸€ä»½æˆå‘˜å˜é‡å®šä¹‰çš„ç¹çã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Class</span><br>&#123;<br>    <span class="hljs-keyword">inline</span> <span class="hljs-type">static</span> <span class="hljs-type">int</span> member = <span class="hljs-number">42</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="å¯¹äºå‡½æ•°"><a href="#å¯¹äºå‡½æ•°" class="headerlink" title="å¯¹äºå‡½æ•°"></a>å¯¹äºå‡½æ•°</h3><ul><li>å†™åœ¨å¤´æ–‡ä»¶é‡Œçš„ static å‡½æ•°å®šä¹‰è‡ªç„¶ä¸ä¼šäº§ç”Ÿå†²çªï¼Œä½†æ˜¯ static ä¹Ÿå¯¼è‡´ä¸åŒç¿»è¯‘å•å…ƒä¹‹é—´å„åŒ…å«ä¸€ä»½å‡½æ•°å®šä¹‰ï¼Œå¯¼è‡´æœ€ç»ˆç”Ÿæˆçš„ç›®æ ‡ä½“ç§¯å¢å¤§ã€‚inline å¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºè¿æ¥å™¨æœ€ç»ˆåªä¼šå°† inline å‡½æ•°é“¾æ¥åˆ°åŒä¸€ä»½å®šä¹‰ï¼ŒæŒ‡å‘åŒä¸€ä¸ªå‡½æ•°åœ°å€ã€‚</li><li>include åŒä¸€ä»½å¤´æ–‡ä»¶æ›´ä¸ä¼šäº§ç”Ÿè¿æ¥å™¨é“¾æ¥åˆ°ä¸åŒçš„å®šä¹‰ï¼ˆå‡½æ•°ä½“ï¼‰çš„é—®é¢˜ã€‚</li><li>åŒæ—¶ï¼Œæ•´ä¸ªå®šä¹‰éƒ½åœ¨ class &#x2F; struct &#x2F; union å†…çš„å‡½æ•°ï¼Œéšå¼çš„æ˜¯ inline çš„ã€‚</li><li>é¡ºä¾¿ï¼Œç›´æ¥å†™å®šä¹‰çš„æ¨¡æ¿å‡½æ•°æ˜¯ä¹Ÿé»˜è®¤ inline çš„ã€‚</li></ul><h3 id="å¯¹äºç±»"><a href="#å¯¹äºç±»" class="headerlink" title="å¯¹äºç±»"></a>å¯¹äºç±»</h3><ul><li>å¯æƒœä¸èƒ½å°† class å£°æ˜ä¸º staticï¼Œä½†æ˜¯è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆç®€å•ï¼Œå°†ç±»çš„å®šä¹‰æ”¾åœ¨ä¸€ä¸ªåŒ¿åå‘½åç©ºé—´å³å¯å°†è¯¥ç±»çš„å¯è§èŒƒå›´é™åˆ¶åœ¨å½“å‰ç¿»è¯‘å•å…ƒã€‚</li><li>åŒ¿åå‘½åç©ºé—´ä¸‹çš„å‡½æ•°å®šä¹‰å’Œ static çš„å‡½æ•°å®šä¹‰æ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</li></ul><h3 id="è‡³äºå†…è”"><a href="#è‡³äºå†…è”" class="headerlink" title="è‡³äºå†…è”"></a>è‡³äºå†…è”</h3><ul><li>è‡ª C++17 ä¹‹å inline çš„æ„ä¹‰äº§ç”Ÿäº†å·¨å¤§çš„å˜åŒ–ï¼Œå¯¹äºå‡½æ•°çš„å«ä¹‰å·²ç»å˜ä¸ºâ€œå®¹è®¸é‡å®šä¹‰â€è€Œä¸æ˜¯â€œå»ºè®®å†…è”â€ã€‚</li><li>æ¯”å¦‚å¯¹äº MSVCï¼Œå¯ä»¥ä½¿ç”¨ <code>__forceinline</code> æ”¾å®½ç¼–è¯‘å™¨å¯¹å†…è”å‡½æ•°çš„åˆ¤æ–­ï¼Œä¸è¿‡ç¼–è¯‘å™¨ä¾æ—§ä¸ä¸€å®šä¼šå¬ä½ çš„ã€‚</li></ul><h2 id="å‰å‘å£°æ˜ä¸-std-unique-ptr"><a href="#å‰å‘å£°æ˜ä¸-std-unique-ptr" class="headerlink" title="å‰å‘å£°æ˜ä¸ std::unique_ptr"></a>å‰å‘å£°æ˜ä¸ std::unique_ptr</h2><p>å‡è®¾æˆ‘ä»¬å‰å‘å£°æ˜äº†ä¸€ä¸ª <code>T</code>ã€‚<br>å½“ä¸€ä¸ªç±»æŒæœ‰ <code>std::unique_ptr&lt;T&gt;</code> ç±»å‹çš„æˆå‘˜å˜é‡æ—¶ï¼Œè¯¥ç±»çš„ææ„å‡½æ•°å¿…é¡»ä¹Ÿåªèƒ½åœ¨ cpp å†…æœ‰å®šä¹‰ï¼ˆå½“ç„¶ä¸€èˆ¬æ¥è¯´è¿™æ—¶ cpp å†…æ˜¯æœ‰ T çš„å®Œæ•´å®šä¹‰çš„ï¼‰ã€‚<br>ç†ç”±å¾ˆç®€å•ï¼Œè¯¥ç±»ææ„æ—¶éœ€è¦è°ƒç”¨ unique_ptr æ‰€åŒ…è£¹å¯¹è±¡çš„ææ„å‡½æ•°ï¼Œä½†æ˜¯é»˜è®¤ç”Ÿæˆçš„ææ„å‡½æ•°æ˜¯å¤´æ–‡ä»¶ä¸­çš„å†…è”å‡½æ•°ï¼Œè€Œåœ¨å¤´æ–‡ä»¶å†…è‡ªç„¶æ˜¯ä¸çŸ¥é“ T è¯¥å¦‚ä½•ææ„çš„ã€‚<br>å°†ç±»çš„ææ„å‡½æ•°çš„å®šä¹‰ç§»è‡³ cpp ç›¸å½“äºå‘å…¶å‘ŠçŸ¥äº† T çš„ææ„æ–¹å¼ã€‚</p><h3 id="static-std-unique-ptr"><a href="#static-std-unique-ptr" class="headerlink" title="static std::unique_ptr"></a>static std::unique_ptr</h3><p>å‰å‘å£°æ˜ä¸å¯ç”¨äº <code>inline static std::unique_ptr&lt;T&gt;</code> ç±»å‹çš„æˆå‘˜å˜é‡ã€‚<br>é™æ€æˆå‘˜å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå·²ç»è„±ç¦»äº†ç±»å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ­¤æ—¶ unique_ptr éœ€è¦åœ¨è¯¥é™æ€æˆå‘˜å˜é‡çš„å®šä¹‰å¤„å¾—çŸ¥ T çš„å®Œæ•´å®šä¹‰ã€‚<br><code>inline static</code> æˆå‘˜å˜é‡çš„å®šä¹‰å¤„è‡ªç„¶æ˜¯å¤´æ–‡ä»¶ï¼Œæ•…æ­¤æ—¶ä¼šç¼–è¯‘å¤±è´¥ã€‚å°†é™æ€æˆå‘˜å˜é‡çš„å®šä¹‰åˆ†ç¦»è‡³ cppï¼ˆæ€»ä¹‹æ˜¯æœ‰ç±»å®Œæ•´å®šä¹‰çš„åœ°æ–¹ï¼‰å†…æ‰èƒ½ç¼–è¯‘ã€‚</p><h2 id="decltype-auto"><a href="#decltype-auto" class="headerlink" title="decltype(auto)"></a>decltype(auto)</h2><p>åœ¨å®Œç¾è½¬å‘è¿”å›å€¼æ—¶å°¤ä¸ºæœ‰ç”¨</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> F, <span class="hljs-keyword">class</span>... Args&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">decltype</span>(<span class="hljs-keyword">auto</span>) <span class="hljs-title">PerfectForward</span><span class="hljs-params">(F fun, Args&amp;&amp;... args)</span></span><br><span class="hljs-function"></span>&#123; <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">fun</span>(std::forward&lt;Args&gt;(args)...);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp">    <span class="hljs-keyword">auto</span> c0 = a;             <span class="hljs-comment">// c0 çš„ç±»å‹æ˜¯ intï¼Œä¿æœ‰ a çš„å‰¯æœ¬</span><br>    <span class="hljs-keyword">decltype</span>(<span class="hljs-keyword">auto</span>) c1 = a;   <span class="hljs-comment">// c1 çš„ç±»å‹æ˜¯ intï¼Œä¿æœ‰ a çš„å‰¯æœ¬</span><br>    <span class="hljs-keyword">auto</span> c2 = (a);           <span class="hljs-comment">// c2 çš„ç±»å‹æ˜¯ intï¼Œä¿æœ‰ a çš„å‰¯æœ¬</span><br>    <span class="hljs-keyword">decltype</span>(<span class="hljs-keyword">auto</span>) c3 = (a); <span class="hljs-comment">// c3 çš„ç±»å‹æ˜¯ int&amp;ï¼Œå®ƒæ˜¯ a çš„åˆ«å</span><br>    <br>    <span class="hljs-keyword">auto</span> d = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;; <span class="hljs-comment">// OKï¼šd çš„ç±»å‹æ˜¯ std::initializer_list&lt;int&gt;</span><br>    <span class="hljs-keyword">auto</span> n = &#123;<span class="hljs-number">5</span>&#125;;    <span class="hljs-comment">// OKï¼šn çš„ç±»å‹æ˜¯ std::initializer_list&lt;int&gt;</span><br><span class="hljs-comment">//  auto e&#123;1, 2&#125;;    // C++17 èµ·é”™è¯¯ï¼Œä¹‹å‰æ˜¯ std::initializer_list&lt;int&gt;</span><br>    <span class="hljs-keyword">auto</span> m&#123;<span class="hljs-number">5</span>&#125;;       <span class="hljs-comment">// OKï¼šDR N3922 èµ· m çš„ç±»å‹æ˜¯ intï¼Œä¹‹å‰æ˜¯ initializer_list&lt;int&gt;</span><br><span class="hljs-comment">//  decltype(auto) z = &#123; 1, 2 &#125; // é”™è¯¯ï¼š&#123;1, 2&#125; ä¸æ˜¯è¡¨è¾¾å¼</span><br></code></pre></td></tr></table></figure><h2 id="ç®€å†™å‡½æ•°æ¨¡æ¿"><a href="#ç®€å†™å‡½æ•°æ¨¡æ¿" class="headerlink" title="ç®€å†™å‡½æ•°æ¨¡æ¿"></a>ç®€å†™å‡½æ•°æ¨¡æ¿</h2><p>åœ¨ C++20 ä¸­ï¼Œauto èƒ½æ¨å¯¼å‡ºä½œä¸ºå‚æ•°çš„å‡½æ•°å¯¹è±¡ï¼Œä¹Ÿèƒ½æ¨å¯¼å‡ºå¯å˜é•¿å‚æ•°<br>ä¸Šé¢çš„ <code>PerfectForward</code> ä¹Ÿå¯ä»¥å†™æˆ:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">decltype</span>(<span class="hljs-keyword">auto</span>) <span class="hljs-title">PerfectForward</span><span class="hljs-params">(<span class="hljs-keyword">auto</span> fun, <span class="hljs-keyword">auto</span> &amp;&amp;...args)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">fun</span>(std::forward&lt;<span class="hljs-keyword">decltype</span>(args)&gt;(args)...);<br>&#125;<br></code></pre></td></tr></table></figure><p><em>C++ çš„æœ€ç»ˆå½¢æ€ä¸€å®šæ˜¯ auto auto &#x3D; auto(auto); ç½¢</em></p><h2 id="æ¦‚å¿µä¸çº¦æŸï¼ˆconcept-requiresï¼‰"><a href="#æ¦‚å¿µä¸çº¦æŸï¼ˆconcept-requiresï¼‰" class="headerlink" title="æ¦‚å¿µä¸çº¦æŸï¼ˆconcept &amp; requiresï¼‰"></a>æ¦‚å¿µä¸çº¦æŸï¼ˆconcept &amp; requiresï¼‰</h2><p>æ¨¡æ¿çš„æŠ¥é”™å¾€å¾€æåº¦ç¼ºä¹å¯è¯»æ€§ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ç¼–å†™æ¨¡æ¿æ—¶å°±å¯¹å¯èƒ½å‘ç”Ÿçš„æƒ…å†µåšå‡ºä¸€å®šçš„çº¦æŸï¼Œä½¿å¾—è¿åçº¦æŸçš„è°ƒç”¨ä¸è¦å®ä¾‹åŒ–ï¼Œä»¥é¿å…äº§ç”Ÿéš¾ä»¥é˜…è¯»çš„æŠ¥é”™ä¿¡æ¯ã€‚<br>è¿™é¡¹æŠ€å·§å«åš SFINEï¼ˆSubstitution Failure Is Not An Errorï¼‰ï¼Œè‡ª C++20 èµ· concept ä¸ requires åŠ å…¥äº†æ ‡å‡†ï¼Œå¤§å¤§ç®€åŒ–äº† SFINE çš„ç¼–å†™ä¸ç†è§£éš¾åº¦ã€‚</p><h3 id="concept"><a href="#concept" class="headerlink" title="concept"></a>concept</h3><p>è¿™æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;æ¨¡æ¿å½¢å‚åˆ—è¡¨&gt;<br><span class="hljs-keyword">concept</span> æ¦‚å¿µå = ç¼–è¯‘æœŸå¸ƒå°”è¡¨è¾¾å¼;<br></code></pre></td></tr></table></figure><p>ex:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ— æ¡ä»¶æˆç«‹</span><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C0 = <span class="hljs-literal">true</span>;<br><br><span class="hljs-comment">// è¦æ±‚ T ä¸ºæ•´æ•°</span><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C1 = std::is_integral_v&lt;T&gt;;<br><br><span class="hljs-comment">// è¦æ±‚ T ä¸ºæµ®ç‚¹æˆ–è€…æœ‰ç¬¦å·</span><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C2 = std::is_floating_point_v&lt;T&gt; || std::is_signed_v&lt;T&gt;;<br><br><span class="hljs-comment">// è¦æ±‚ T ä¸ºæ— ç¬¦å·æ•´æ•°</span><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C3 = C1&lt;T&gt; &amp;&amp; !std::is_signed_v&lt;T&gt;;<br><br>C0&lt;<span class="hljs-type">int</span>&gt;   <span class="hljs-comment">// ç¼–è¯‘æœŸè¿”å› true</span><br>C1&lt;<span class="hljs-type">int</span>&gt;   <span class="hljs-comment">// ç¼–è¯‘æœŸè¿”å› true</span><br>C2&lt;<span class="hljs-type">int</span>&gt;   <span class="hljs-comment">// ç¼–è¯‘æœŸè¿”å› true</span><br>C2&lt;<span class="hljs-type">float</span>&gt; <span class="hljs-comment">// ç¼–è¯‘æœŸè¿”å› true</span><br>C3&lt;uint&gt;  <span class="hljs-comment">// ç¼–è¯‘æœŸè¿”å› true</span><br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå— concept çº¦æŸçš„å‡½æ•°æ¨¡æ¿ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è¦æ±‚ T ä¸ºæ— ç¬¦å·æ•´æ•°</span><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C = std::is_integral_v&lt;T&gt; &amp;&amp; !std::is_signed_v&lt;T&gt;;<br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;C T&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Foo</span><span class="hljs-params">(T t)</span></span>&#123;&#125;<br><br><span class="hljs-built_in">Foo</span>(<span class="hljs-number">42U</span>); <span class="hljs-comment">// OK</span><br><span class="hljs-built_in">Foo</span>(<span class="hljs-number">42.0</span>); <span class="hljs-comment">// é”™è¯¯</span><br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå— concept çº¦æŸçš„ç®€å†™å‡½æ•°æ¨¡æ¿ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è¦æ±‚ T ä¸ºæ— ç¬¦å·æ•´æ•°</span><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C = std::is_integral_v&lt;T&gt; &amp;&amp; !std::is_signed_v&lt;T&gt;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Foo</span><span class="hljs-params">(C <span class="hljs-keyword">auto</span> t)</span></span>&#123;&#125;<br><br><span class="hljs-built_in">Foo</span>(<span class="hljs-number">42U</span>); <span class="hljs-comment">// OK</span><br><span class="hljs-built_in">Foo</span>(<span class="hljs-number">42.0</span>); <span class="hljs-comment">// é”™è¯¯</span><br></code></pre></td></tr></table></figure><p>æ ‡å‡†åº“å·²ç»æä¾›äº†å¾ˆå¤šç®€å•ä¸”å¸¸ç”¨çš„æ¦‚å¿µï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;concepts&gt;</span></span><br><br><span class="hljs-comment">// è¦æ±‚ t ä¸ºæ— ç¬¦å·æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Foo</span><span class="hljs-params">(std::unsigned_integral <span class="hljs-keyword">auto</span> t)</span></span>&#123;&#125;<br><br><span class="hljs-built_in">Foo</span>(<span class="hljs-number">42U</span>); <span class="hljs-comment">// OK</span><br><span class="hljs-built_in">Foo</span>(<span class="hljs-number">42.0</span>); <span class="hljs-comment">// é”™è¯¯</span><br></code></pre></td></tr></table></figure><h3 id="requires-è¡¨è¾¾å¼"><a href="#requires-è¡¨è¾¾å¼" class="headerlink" title="requires è¡¨è¾¾å¼"></a>requires è¡¨è¾¾å¼</h3><p>è¿™æ˜¯ä¸€ä¸ª requires è¡¨è¾¾å¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">requires</span>&#123; è¦æ±‚åºåˆ— &#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºä»–åœ¨ç¼–è¯‘æœŸè¿”å›ä¸€ä¸ªå¸ƒå°”ï¼Œæ‰€ä»¥å¯ä»¥æ¥åœ¨ concept åé¢ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C = <span class="hljs-keyword">requires</span>&#123; è¦æ±‚åºåˆ— &#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªç®€å•è¦æ±‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Test</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">StaticFoo</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Foo</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C0 = <span class="hljs-keyword">requires</span>&#123; T::<span class="hljs-built_in">StaticFoo</span>(); &#125;<br><br><span class="hljs-comment">// å¯ä»¥æœ‰å½¢å‚</span><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C1 = <span class="hljs-built_in">requires</span>(T t)&#123; t.<span class="hljs-built_in">Foo</span>(); &#125;<br></code></pre></td></tr></table></figure><p>requires è¡¨è¾¾å¼ä¸å®é™…è¿è¡Œå¤§æ‹¬å·å†…çš„ä»£ç ï¼Œåªæ£€æµ‹ä»£ç çš„æœ‰æ•ˆæ€§ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªç±»å‹è¦æ±‚ï¼Œä»¥å…³é”®å­— typename å¼€å¤´ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Test</span><br>&#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Type0</span>&#123;&#125;;<br>    <span class="hljs-keyword">using</span> Type1 = <span class="hljs-type">int</span>;<br>&#125;;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">S</span>&#123;&#125;;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">using</span> Ref = T&amp;;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">concept</span> C = <span class="hljs-keyword">requires</span><br>&#123;<br>    <span class="hljs-keyword">typename</span> T::Type0; <span class="hljs-comment">// è¦æ±‚åµŒå¥—ç±»å‹</span><br>    <span class="hljs-keyword">typename</span> T::type1; <span class="hljs-comment">// è¦æ±‚åµŒå¥—ç±»å‹</span><br>    <span class="hljs-keyword">typename</span> S&lt;T&gt;;     <span class="hljs-comment">// è¦æ±‚ç±»æ¨¡æ¿ç‰¹åŒ–</span><br>    <span class="hljs-keyword">typename</span> Ref&lt;T&gt;;   <span class="hljs-comment">// è¦æ±‚åˆ«åæ¨¡æ¿ä»£æ¢</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå¤åˆè¦æ±‚ï¼Œä¸ä½†æ£€æŸ¥ä»£ç çš„æœ‰æ•ˆæ€§ï¼Œè¿˜å¯ä»¥æ£€æŸ¥è¿”å›å€¼ç±»å‹å’Œ noexceptï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C = <span class="hljs-built_in">requires</span>(T t)<br>&#123;<br>    <span class="hljs-comment">// è¦æ±‚ T é‡è½½äº† operator+ï¼Œå¹¶ä¸”è¦æ±‚å…¶è¿”å›å€¼å¯ä»¥è¢«è½¬æ¢ä¸º bool</span><br>    &#123; t + t &#125; -&gt; std::convertible_to&lt;<span class="hljs-type">bool</span>&gt;;<br>    <span class="hljs-comment">// è¦æ±‚ T é‡è½½äº† operator-ï¼Œå¹¶ä¸”è¦æ±‚å…¶è¿”å›å€¼ä¸º int</span><br>    &#123; t - t &#125; -&gt; std::same_as&lt;<span class="hljs-type">int</span>&gt;;<br>    <span class="hljs-comment">// è¦æ±‚ `x.~T()` æ˜¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸çš„åˆæ³•è¡¨è¾¾å¼</span><br>    &#123; t.~<span class="hljs-built_in">T</span>() &#125; <span class="hljs-keyword">noexcept</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªåµŒå¥—è¦æ±‚ï¼Œç”±å…³é”®å­— requires å¼€å¤´ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">requires</span><br>&#123;<br>    <span class="hljs-keyword">requires</span> ç¼–è¯‘æœŸå¸ƒå°”è¡¨è¾¾å¼;<br>&#125;;<br></code></pre></td></tr></table></figure><p>ex:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C = <span class="hljs-built_in">requires</span>(T t)<br>&#123;<br>    <span class="hljs-keyword">requires</span> std::is_same_v&lt;T, <span class="hljs-type">int</span>&gt;;<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•å®Œå…¨ç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C = std::is_same_v&lt;T, <span class="hljs-type">int</span>&gt;;<br></code></pre></td></tr></table></figure><p>æ„ä¹‰åœ¨äºå…è®¸æˆ‘ä»¬åœ¨è¦æ±‚åºåˆ—ä¸­åŠ å…¥ç¼–è¯‘æœŸå¸ƒå°”è¡¨è¾¾å¼ï¼Œå¹¶ä»¥æ­¤å½±å“æ•´ä¸ª requires è¡¨è¾¾å¼çš„ç»“æœï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C = <span class="hljs-built_in">requires</span>(T t)<br>&#123;<br>    &#123; t + t &#125; -&gt; std::convertible_to&lt;<span class="hljs-type">bool</span>&gt;;<br>    <span class="hljs-keyword">requires</span> std::is_same_v&lt;T, <span class="hljs-type">int</span>&gt;;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å…¶å®è¿™ç§å†™æ³•ä¹Ÿç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C = std::is_same_v&lt;T, <span class="hljs-type">int</span>&gt; &amp;&amp; <span class="hljs-built_in">requires</span>(T t)<br>&#123;<br>    &#123; t + t &#125; -&gt; std::convertible_to&lt;<span class="hljs-type">bool</span>&gt;;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="requires-å­å¥"><a href="#requires-å­å¥" class="headerlink" title="requires å­å¥"></a>requires å­å¥</h3><p>è¿™æ˜¯ä¸€ä¸ª requires å­å¥ï¼Œå¯ä»¥åœ¨å£°æ˜æ¨¡æ¿æ—¶ç›´æ¥å†™åœ¨ template&lt;æ¨¡æ¿å½¢å‚åˆ—è¡¨&gt; åé¢ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">requires</span> ç¼–è¯‘æœŸå¸ƒå°”è¡¨è¾¾å¼<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªè¢« requires å­å¥çº¦æŸçš„å‡½æ•°æ¨¡æ¿ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">requires</span> std::is_same_v&lt;T, <span class="hljs-type">int</span>&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Foo0</span><span class="hljs-params">(T t)</span></span>&#123;&#125;<br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;<br><span class="hljs-keyword">concept</span> C = std::is_same_v&lt;T, <span class="hljs-type">int</span>&gt;;<br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">requires</span> C&lt;T&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Foo1</span><span class="hljs-params">(T t)</span></span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">requires</span> <span class="hljs-title">requires</span><span class="hljs-params">(T t)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">requires</span> std::is_same_v&lt;T, <span class="hljs-type">int</span>&gt;;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Foo2</span><span class="hljs-params">(T t)</span></span>&#123;&#125;<br><span class="hljs-comment">// ç¬¬ä¸€ä¸ª requires ä»£è¡¨â€œrequires å­å¥â€</span><br><span class="hljs-comment">// ç¬¬ä¸€ä¸ª requires ä»£è¡¨â€œrequires è¡¨è¾¾å¼â€</span><br><span class="hljs-comment">// ç¬¬ä¸€ä¸ª requires ä»£è¡¨â€œåµŒå¥—è¦æ±‚â€</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šå†™æ³•å…¨éƒ¨ç­‰ä»·ï¼Œä½ ç”šè‡³å¯ä»¥ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">requires</span> <span class="hljs-title">requires</span><span class="hljs-params">(T t)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">requires</span> <span class="hljs-keyword">requires</span>&#123; std::is_same_v&lt;T, <span class="hljs-type">int</span>&gt; &#125;;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Foo2</span><span class="hljs-params">(T t)</span></span>&#123;&#125;<br></code></pre></td></tr></table></figure><h2 id="Râ€-â€"><a href="#Râ€-â€" class="headerlink" title="Râ€()â€"></a>Râ€()â€</h2><p>ä¸ä½¿ç”¨è½¬ä¹‰å­—ç¬¦æ‰“å°ç‰¹æ®Šå­—ç¬¦</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *str =<br><span class="hljs-string">R&quot;(</span><br><span class="hljs-string">    &quot;test&quot;&#x27;test&#x27;</span><br><span class="hljs-string">    `~!@#$%^&amp;*()-_=+[&#123;]&#125;\|;:&#x27;&quot;,&lt;.&gt;/?</span><br><span class="hljs-string">)&quot;</span>;<br>std::cout &lt;&lt; str &lt;&lt; std::endl;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    output :</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    &quot;test&quot;&#x27;test&#x27;</span><br><span class="hljs-comment">    `~!@#$%^&amp;*()-_=+[&#123;]&#125;\|;:&#x27;&quot;,&lt;.&gt;/?</span><br><span class="hljs-comment">    </span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p><code>R&quot;()&quot;</code> ä¼šå¿ å®çš„å­˜å‚¨ä¸¤ä¸ªå°æ‹¬å·ä¹‹é—´çš„æ‰€æœ‰ç¬¦å·ï¼ŒåŒ…æ‹¬æ¯ä¸€ä¸ªæ¢è¡Œå’Œç¼©è¿›ã€‚</p><h2 id="offsetof"><a href="#offsetof" class="headerlink" title="offsetof"></a>offsetof</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Vertext</span><br>&#123;<br>    <span class="hljs-type">int</span> a, b;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> c = <span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    Vertext vert;<br>    *(<span class="hljs-type">int</span> *)((<span class="hljs-type">char</span> *)(&amp;vert) + <span class="hljs-built_in">offsetof</span>(Vertext, c)) = <span class="hljs-number">42</span>;<br>    std::cout &lt;&lt; vert.c &lt;&lt; std::endl;<br>    <span class="hljs-comment">// output : 42</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="pragma-warning"><a href="#pragma-warning" class="headerlink" title="pragma warning"></a>pragma warning</h2><ul><li>å®Œå…¨å¿½ç•¥æŒ‡å®šè­¦å‘Š<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> <span class="hljs-keyword">warning</span>(disable: XXXX)</span><br></code></pre></td></tr></table></figure></li><li>æŒ‡å®šè­¦å‘Šåªæ˜¾ç¤ºä¸€æ¬¡<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> <span class="hljs-keyword">warning</span>(once: XXXX)</span><br></code></pre></td></tr></table></figure></li><li>æŒ‡å®šè­¦å‘Šä¸ºé”™è¯¯<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> <span class="hljs-keyword">warning</span>(<span class="hljs-keyword">error</span>: XXXX)</span><br></code></pre></td></tr></table></figure></li><li>é‡ç½®è­¦å‘Šï¼Œå¯èƒ½ä¼šå½±å“æ›´æ—©çš„è­¦å‘Šè®¾ç½®<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> <span class="hljs-keyword">warning</span>(default: XXXX)</span><br></code></pre></td></tr></table></figure></li><li>push, pop ä¹‹é—´æ‰€æœ‰çš„æ›´æ”¹éƒ½ä¼šåœ¨ pop ä¹‹åè¢«æ”¾å¼ƒ<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> <span class="hljs-keyword">warning</span>(push)</span><br><span class="hljs-comment">// ...</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> <span class="hljs-keyword">warning</span>(pop)</span><br></code></pre></td></tr></table></figure></li><li>suppress ä»…å¿½ç•¥ä¸‹ä¸€è¡Œçš„è­¦å‘Šï¼Œç„¶åæ¢å¤åˆ° suppress ä¹‹å‰çš„çŠ¶æ€ï¼Œæ— æ³•å½±å“å¤šè¡Œ<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> <span class="hljs-keyword">warning</span>(suppress: XXXX)</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="nodiscard"><a href="#nodiscard" class="headerlink" title="nodiscard"></a>nodiscard</h2><ul><li><p>è‹¥æ²¡æœ‰ä½¿ç”¨å‡½æ•°çš„è¿”å›å€¼ï¼Œç¼–è¯‘å™¨å¯ä»¥å‘å‡ºè­¦å‘Šã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// nodiscard( å­—ç¬¦ä¸²å­—é¢é‡ ) (C++20 èµ·):</span><br>[[<span class="hljs-built_in">nodiscard</span>(<span class="hljs-string">&quot;PURE FUN&quot;</span>)]] <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">strategic_value</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> </span>&#123; <span class="hljs-keyword">return</span> x ^ y; &#125;<br></code></pre></td></tr></table></figure></li><li><p>è‹¥è¯¥ç±»å‹ä½œä¸ºè¿”å›å€¼æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œç¼–è¯‘å™¨å¯ä»¥å‘å‡ºè­¦å‘Šã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> [[nodiscard]] error_info &#123; <span class="hljs-comment">/*...*/</span> &#125;;<br></code></pre></td></tr></table></figure></li></ul><h2 id="VA-OPT"><a href="#VA-OPT" class="headerlink" title="VA_OPT"></a><strong>VA_OPT</strong></h2><p>å½“å¯å˜å‚æ•°å®ä¸ä¸ºç©ºæ—¶æ‰å±•å¼€ <code>__VA_OPT__</code> å†…çš„å†…å®¹ï¼Œåä¹‹åˆ™å¿½ç•¥ <code>__VA_OPT__</code> å†…çš„å†…å®¹ã€‚<br>ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> ASSERT(x, ...) &#123; <span class="hljs-keyword">if</span>(!(x)) &#123; __VA_OPT__(LOG_FATAL(__VA_ARGS__);) DEBUGBREAK(); &#125; &#125;</span><br></code></pre></td></tr></table></figure><p>ä¼šå°† <code>ASSERT(false, &quot;Hello&quot;)</code> å±•å¼€ä¸º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp">&#123;<br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-literal">false</span>))<br>    &#123;<br>        <span class="hljs-built_in">LOG_FATAL</span>(<span class="hljs-string">&quot;Hello&quot;</span>);<br>        <span class="hljs-built_in">DEBUGBREAK</span>();<br>    &#125;    <br>&#125;<br></code></pre></td></tr></table></figure><p>è€Œä¼šå°† <code>ASSERT(false)</code> å±•å¼€ä¸º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp">&#123;<br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-literal">false</span>))<br>    &#123;<br>        <span class="hljs-built_in">DEBUGBREAK</span>();<br>    &#125;    <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="VS"><a href="#VS" class="headerlink" title="VS"></a>VS</h3><p>åœ¨ VS2022 ä¸­å¯ç”¨ <code>__VA_OPT__</code> ç­‰è¾ƒæ–°çš„é¢„å¤„ç†å™¨éœ€è¦å¼€å¯ç¼–è¯‘å™¨å¼€å…³ <code>/Zc:preprocessor</code><br><a href="https://learn.microsoft.com/en-us/cpp/preprocessor/preprocessor-experimental-overview?view=msvc-170">https://learn.microsoft.com/en-us/cpp/preprocessor/preprocessor-experimental-overview?view=msvc-170</a></p><h3 id="Premake"><a href="#Premake" class="headerlink" title="Premake"></a>Premake</h3><p>æŒ‰ç†æ¥è¯´åœ¨ Premake ä¸­å¯ç”¨è¯¥ VS å¼€å…³å¯¹åº”çš„æ˜¯ <code>usestandardpreprocessor</code><br><a href="https://premake.github.io/docs/usestandardpreprocessor/">https://premake.github.io/docs/usestandardpreprocessor/</a><br>ä½†æ˜¯å®æµ‹ä¸ç”Ÿæ•ˆï¼Œå¯èƒ½æ˜¯ä¸€ä¸ª bug<br>ç°åœ¨è€Œè¨€çš„è¯å¯ä»¥å†™ï¼š</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-keyword">filter</span> &#123; <span class="hljs-string">&quot;action:vs*&quot;</span> &#125;<br><span class="hljs-keyword">buildoptions</span> &#123; <span class="hljs-string">&quot;/Zc:preprocessor&quot;</span> &#125;<br><span class="hljs-keyword">filter</span> &#123;&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>CPP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GGX+Smith å¾®è¡¨é¢ PBR æ¼«åå°„å…‰ç…§</title>
    <link href="/2024/03/26/GDCGGXSmith/"/>
    <url>/2024/03/26/GDCGGXSmith/</url>
    
    <content type="html"><![CDATA[<h2 id="åŸæ ‡é¢˜"><a href="#åŸæ ‡é¢˜" class="headerlink" title="åŸæ ‡é¢˜"></a>åŸæ ‡é¢˜</h2><p><em>PBR Diffuse Lighting for GGX+Smith Microsurfaces</em></p><h2 id="é€šç”¨çš„å¾®è¡¨é¢-BRDF"><a href="#é€šç”¨çš„å¾®è¡¨é¢-BRDF" class="headerlink" title="é€šç”¨çš„å¾®è¡¨é¢ BRDF"></a>é€šç”¨çš„å¾®è¡¨é¢ BRDF</h2><h3 id="é€šç”¨å½¢å¼"><a href="#é€šç”¨å½¢å¼" class="headerlink" title="é€šç”¨å½¢å¼"></a>é€šç”¨å½¢å¼</h3><p>å®è§‚è¡¨é¢çš„ BRDF åªæ˜¯è®¸å¤šå¾®è¡¨é¢çš„å¹³å‡ã€‚</p><ul><li><p><strong>é€šç”¨å½¢å¼</strong><br>$\int_\Omega\rho_m(L,V,m)D(m)G_2(L,V,m)\frac{m\cdot L}{|N\cdot L|}\frac{m\cdot V}{|N\cdot V|}dm$</p></li><li><p>$\int_\Omega dm$<br>å¯¹åŠçƒé¢ä¸Šæ‰€æœ‰å¾®è¡¨é¢æ³•çº¿ç§¯åˆ†ã€‚</p></li><li><p>$\rho_m(L,V,m)$<br>å•ä¸ªå¾®è¡¨é¢å¦‚ä½•å“åº”ï¼Œå³æ³•çº¿æ–¹å‘çš„ BRDFï¼Œé€šå¸¸ä¸ºç†æƒ³é•œé¢æˆ–ç†æƒ³æ¼«åå°„ã€‚</p></li><li><p>$D(m)$<br>æ³•çº¿åˆ†å¸ƒæ¦‚ç‡å¯†åº¦å‡½æ•°ã€‚</p></li><li><p>$G_2(L,V,m)$<br>å¾®è¡¨é¢ m åŒæ—¶çœ‹åˆ°å…‰æºå’Œè§‚å¯Ÿè€…çš„æ¦‚ç‡ã€‚</p></li><li><p>$D(m)G_2(L,V,m)$<br>åŒæ—¶è¢«å…‰æºå’Œè§‚å¯Ÿè€…å¯è§çš„è¡¨é¢çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ã€‚<br>$G_2$ ç”±ä¸¤ä¸ªæ–¹å‘ï¼ˆå…‰æºã€è§‚å¯Ÿè€…ï¼‰çš„å¯è§†æ€§ $G_1$ æ¨å‡ºã€‚</p></li><li><p>$\frac{\lang m\cdot L\rang}{|N\cdot L|}\frac{\lang m\cdot V\rang}{|N\cdot V|}$<br>è¡¨é¢å¯¹å…‰æºæ¥è¯´æœ‰å¤šå¤§ï¼Œè¡¨é¢å¯¹è§‚å¯Ÿè€…æ¥è¯´æœ‰å¤šå¤§ã€‚</p></li><li><p>$D(m)G_2(L,V,m)\frac{\lang m\cdot L\rang}{|N\cdot L|}\frac{\lang m\cdot V\rang}{|N\cdot V|}$<br>ä» L å‡ºå‘ï¼Œç»è¿‡å•æ¬¡åå°„ï¼Œåˆ°è¾¾ V çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ã€‚<br>$\int_\Omega D(m)G_2(L,V,m)\frac{\lang m\cdot L\rang}{|N\cdot L|}\frac{\lang m\cdot V\rang}{|N\cdot V|}dm\leq 1$</p></li></ul><h3 id="å¦‚ä½•è·å¾—-specular"><a href="#å¦‚ä½•è·å¾—-specular" class="headerlink" title="å¦‚ä½•è·å¾— specular"></a>å¦‚ä½•è·å¾— specular</h3><ul><li><p>å¾®è¡¨é¢ BRDF æ˜¯å®Œç¾é•œé¢</p></li><li><p>å…‰çº¿åªåœ¨ m &#x3D; Hï¼Œçš„æƒ…å†µä¸‹åå°„</p></li><li><p>åœ¨æ•°å­¦ä¸Šï¼ŒBRDF æ˜¯ç»è¿‡ç¼©æ”¾çš„ç‹„æ‹‰å…‹å‡½æ•°$\delta_m(H,m)$</p></li><li><p>ä¸€èˆ¬æƒ…å†µï¼š<br>$\int_\Omega\rho(L,V,N)cos\Theta_VdV&#x3D;1$</p></li><li><p><strong>æ›´æ”¹ç§¯åˆ†åŸŸä»¥è®¡ç®— $\delta$ï¼š</strong><br>$\int_\Omega k\delta_m(H,m)cos\Theta_V\frac{dV}{dm}dm&#x3D;1$</p></li><li><p>$k\delta_m(H,m)$ æ˜¯çº¯é•œé¢ BRDF</p></li><li><p>k æ˜¯ç¼©æ”¾å‚æ•°</p></li><li><p>$\frac{dV}{dm}$ æ˜¯ V ç›¸å¯¹äº m çš„å˜åŒ–é€Ÿåº¦</p></li></ul><p><strong>å°±ç»“è®ºè€Œè¨€ï¼Œ$\frac{dV}{dm}&#x3D;4H\cdot V$</strong><br>è¿™æ˜¯é€šè¿‡å°† dv ä»å•ä½çƒæŠ•å½±è‡³åŠå¾„ä¸º |L + V| çš„çƒé¢ä¸Šå¾—åˆ°çš„ã€‚<br><img src="/img/GDCGGXSmith/dVdm.png" alt="dVdm"></p><p>ç”±äº m &#x3D; H ä»¥åŠ $H\cdot V&#x3D;H\cdot L$</p><ul><li>$\int_\Omega k\delta_m(H,m)cos\Theta_V\frac{dV}{dm}dm&#x3D;1$</li><li>$\int_\Omega k\delta_m(H,m)(m\cdot V)(4H\cdot V)dm&#x3D;1$</li><li>$k&#x3D;\frac{1}{4(H\cdot L)(H\cdot V)}$</li></ul><p><em>ç‹„æ‹‰å…‹å‡½æ•°åœ¨å…¶å®šä¹‰åŸŸä¸Šçš„ç§¯åˆ†ä¸º 1</em><br><em>ä¸ºä»€ä¹ˆ $(m\cdot V)(H\cdot V)$ è¦ä»¥ $(H\cdot L)(H\cdot V)$ çš„å½¢å¼ä¿ç•™ä¸‹æ¥ï¼Ÿ</em></p><ul><li><p><strong>æ•…ï¼Œå®Œç¾é•œé¢ BRDFï¼š</strong><br>$\frac{\delta_m(H,m)}{4(H\cdot L)(H\cdot V)}$</p></li><li><p>åŠ ä¸Šè²æ¶…å°”é¡¹<br>$\rho_m(L,Vm)&#x3D;F(L,m)\frac{\delta_H(m)}{4|H\cdot L||H\cdot V|}$</p></li><li><p>æ•´åˆ<br>$\int_\Omega\rho_m(L,V,m)D(m)G_2(L,V,m)\frac{\lang m\cdot L\rang}{|N\cdot L|}\frac{\lang m\cdot V\rang}{|N\cdot V|}dm$</p></li><li><p>ä»£å…¥å¾—ï¼š<br>$\int_\Omega\frac{F(L,m)\delta_m(H,m)}{4|H\cdot L||H\cdot V|}D(m)G_2(L,V,m)\frac{\lang m\cdot L\rang}{|N\cdot L|}\frac{\lang m\cdot V\rang}{|N\cdot V|}dm$</p></li><li><p>ç”±äºç‹„æ‹‰å…‹å‡½æ•°åœ¨ç§¯åˆ†ä¸­è¢«æ¶ˆæ‰ï¼Œä»¥åŠ m &#x3D; H å¾—ï¼š<br>Specular BRDF &#x3D; $\frac{F(L,H)D(H)G_2(L,V,H)}{4|H\cdot L||H\cdot V|}$</p></li></ul><h3 id="æ‰©å±•è‡³-diffuse"><a href="#æ‰©å±•è‡³-diffuse" class="headerlink" title="æ‰©å±•è‡³ diffuse"></a>æ‰©å±•è‡³ diffuse</h3><ul><li>å…°ä¼¯ç‰¹æ¼«åå°„ï¼š<br>$\rho_m(L,V,m)&#x3D;\frac{1}{\pi}$</li><li>æ— é—­åˆè§£ã€‚<br><em>é—­åˆæŒ‡çš„æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼åŒ…å«æœ‰é™ä¸ªæ ‡å‡†è¿ç®—ï¼Œæé™ã€å·®åˆ†ã€ç§¯åˆ†éƒ½ä¸ç®—æ ‡å‡†è¿ç®—ã€‚</em></li></ul><h2 id="GGX-Smith-å¾®è¡¨é¢æ¨¡å‹çš„æ¼«åå°„æ¨¡æ‹Ÿ"><a href="#GGX-Smith-å¾®è¡¨é¢æ¨¡å‹çš„æ¼«åå°„æ¨¡æ‹Ÿ" class="headerlink" title="GGX+Smith å¾®è¡¨é¢æ¨¡å‹çš„æ¼«åå°„æ¨¡æ‹Ÿ"></a>GGX+Smith å¾®è¡¨é¢æ¨¡å‹çš„æ¼«åå°„æ¨¡æ‹Ÿ</h2><h3 id="Shadowing-masking-å‡½æ•°"><a href="#Shadowing-masking-å‡½æ•°" class="headerlink" title="Shadowing &#x2F; masking å‡½æ•°"></a>Shadowing &#x2F; masking å‡½æ•°</h3><h4 id="ä¸ç›¸å…³-vs-é«˜åº¦ç›¸å…³çš„-G"><a href="#ä¸ç›¸å…³-vs-é«˜åº¦ç›¸å…³çš„-G" class="headerlink" title="ä¸ç›¸å…³ vs é«˜åº¦ç›¸å…³çš„ G"></a>ä¸ç›¸å…³ vs é«˜åº¦ç›¸å…³çš„ G</h4><p>$G_2(L,V,m)&#x3D;G_1(L,m)G_1(V,m)$<br>ä¸å¤ªç°å®ï¼Œä½†æ˜¯åœ¨å®è·µä¸­çš„æ•ˆæœå¾ˆå¥½ã€‚</p><blockquote><p> Higher points more likely visible to both ğ¿ and ğ‘‰ (and lower points less likely)</p></blockquote><ul><li><p>é«˜åº¦ä¸ç›¸å…³çš„ G ä¼šä½¿é•œé¢åå°„å˜æš—</p><ul><li>è¶Šç²—ç³™è¯¯å·®è¶Šå¤§</li><li>è¶Šæ¥è¿‘æ å°„è§’è¯¯å·®è¶Šå¤§</li><li><img src="/img/GDCGGXSmith/vs.png"></li></ul></li><li><p>è§’åº¦ç›¸å…³æ€§</p><ul><li>å½“ L &#x3D; Vï¼Œåº”æœ‰ $G_2(V,V,m)&#x3D;G_1(V,m)$</li><li>ä¸ç›¸å…³ï¼š$G_2(V,V,m)&#x3D;G_1(V,m)^2$</li><li>ç›¸å…³ï¼š$G_2$ ä»‹äºä¸¤è€…ä¹‹é—´</li></ul></li></ul><h4 id="Smith-shadowing-masking"><a href="#Smith-shadowing-masking" class="headerlink" title="Smith shadowing &#x2F; masking"></a>Smith shadowing &#x2F; masking</h4><ul><li><p>å‰é¢æ²¡çœ‹æ‡‚ï¼Œä¸­é—´æ²¡çœ‹æ‡‚ï¼Œä½†æ˜¯ï¼š</p></li><li><p>$\Lambda(V)&#x3D;\frac{1}{2}(\frac{\sqrt{\alpha^2+(1-\alpha^2)(N\cdot V)^2}}{N\cdot V}-1)$</p></li><li><p>$G_1(V)&#x3D;\frac{1}{1+\Lambda(V)}$</p></li><li><p>$G_2(L,V)&#x3D;\frac{1}{1+\Lambda(L)+\Lambda(V)}$</p></li><li><p>$G_1(L)G_1(V)&#x3D;\frac{1}{1+\Lambda(L)+\Lambda(V)+\Lambda(L)\Lambda(V)}$</p></li><li><p>$G_1(V)&#x3D;$<br>$\frac{2N\cdot V}{\sqrt{\alpha^2+(1-\alpha^2)(N\cdot V)^2}+N\cdot V}$</p></li><li><p>$G_2(L,V)&#x3D;$<br>$\frac{2(N\cdot L)(N\cdot V)}{N\cdot V\sqrt{\alpha^2+(1-\alpha^2)(N\cdot L)^2}+N\cdot L\sqrt{\alpha^2+(1-\alpha^2)(N\cdot V)^2}}$</p></li></ul><h4 id="æ–°çš„-Smith-GGX-G-2-è¿‘ä¼¼"><a href="#æ–°çš„-Smith-GGX-G-2-è¿‘ä¼¼" class="headerlink" title="æ–°çš„ Smith + GGX $G_2$ è¿‘ä¼¼"></a>æ–°çš„ Smith + GGX $G_2$ è¿‘ä¼¼</h4><ul><li>$G_1$ çš„åˆ†æ¯<ul><li>$\sqrt{\alpha^2+(1-\alpha^2)(N\cdot V)^2}+N\cdot V$</li><li>$\sqrt{lerp((N\cdot V)^2,1,\alpha^2)}+N\cdot V$</li><li><strong>è¿‘ä¼¼ï¼š</strong></li><li>$\sqrt{lerp((N\cdot V)^2,1,\alpha^2)}\approx lerp(N\cdot V,1,\alpha)$</li></ul></li><li>æ•…ï¼Œ$G_1(V)\approx\frac{2N\cdot V}{N\cdot V(2-\alpha)+\alpha}$<ul><li>å’Œ Unreal ä¸€è‡´ï¼š</li><li>$G_1(V)\approx\frac{N\cdot V}{N\cdot V(1-k)+k}$, $k&#x3D;\frac{\alpha}{2}$</li></ul></li><li>é€šè¿‡è¿‘ä¼¼çš„ $G_1$ è¿‘ä¼¼æ¥æ±‚å¾— $G_2$<ul><li>$G_2(L,V)&#x3D;\frac{2|N\cdot L||N\cdot V|}{lerp(2|N\cdot L||N\cdot V|,|N\cdot L|+|N\cdot V|,\alpha)}$</li><li>ä»£å…¥ BRDFï¼Œçº¦åˆ†ï¼š</li><li>$BRDF&#x3D;\frac{F(L,H)D(H)}{2lerp(2|N\cdot L||N\cdot V|,|N\cdot L|+|N\cdot V|,\alpha)}$</li></ul></li><li>å¼€é”€ï¼š<ul><li>$G_1(L)G_1(V)$ï¼š$\frac{F(L,H)D(H)}{(|N\cdot L|(2-\alpha)+\alpha)(|N\cdot V|(2-\alpha)+\alpha)}$ï¼ˆ**~4 cycles**ï¼‰</li><li>$G_2(L,V)$ï¼š**~6 cycles**</li><li>é«˜åº¦ç›¸å…³äº§ç”Ÿçš„é¢å¤–æˆæœ¬å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</li></ul></li><li>è´¨é‡ï¼š<ul><li>åœ¨ç²—ç³™æè´¨çš„æ å°„è§’ä¸Šæ•ˆæœæ›´å¥½ã€‚</li><li><img src="/img/GDCGGXSmith/quality.png"></li><li><img src="/img/GDCGGXSmith/diff1.png" alt="é«˜åº¦ç›¸å…³è¿‘ä¼¼ VS ä¸ç›¸å…³è¿‘ä¼¼"></li><li><img src="/img/GDCGGXSmith/diff1.png" alt="é«˜åº¦ç›¸å…³å‡†ç¡® VS é«˜åº¦ç›¸å…³è¿‘ä¼¼"></li><li>æ„Ÿè§‰æ˜¯å¦ç›¸å…³å¸¦æ¥çš„å·®å¼‚æ¯”æ˜¯å¦å‡†ç¡®è¦å¤§ä¸€äº›ã€‚</li></ul></li></ul><h3 id="è·¯å¾„è¿½è¸ª"><a href="#è·¯å¾„è¿½è¸ª" class="headerlink" title="è·¯å¾„è¿½è¸ª"></a>è·¯å¾„è¿½è¸ª</h3><p>è®¨è®ºäº†ä¸€äº›å…‰è¿½ä¸­ï¼ŒBRDF ä¸­è²æ¶…å°”é¡¹å¯¹æ¼«åå°„ä»¥åŠé«˜å…‰éƒ¨åˆ†çš„æƒé‡é—®é¢˜ï¼Œå…ˆç•¥è¿‡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>GDC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Math</tag>
      
      <tag>Rendering</tag>
      
      <tag>PBR</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®ˆæœ›å…ˆé”‹ä¸­çš„ ECS ç³»ç»Ÿ</title>
    <link href="/2024/01/18/GDCOverwatchECS/"/>
    <url>/2024/01/18/GDCOverwatchECS/</url>
    
    <content type="html"><![CDATA[<h2 id="åŸæ ‡é¢˜"><a href="#åŸæ ‡é¢˜" class="headerlink" title="åŸæ ‡é¢˜"></a>åŸæ ‡é¢˜</h2><p><em>Overwatch Gameplay Architecture and Netcode</em></p><ul><li>Componentï¼šåªä¿å­˜çŠ¶æ€ï¼Œä¸å«é€»è¾‘</li><li>Systemï¼šåªæœ‰é€»è¾‘ï¼Œæ²¡æœ‰æ•°æ®</li></ul><p>ç³»ç»ŸæŒ‰é¡ºåºæ›´æ–°ï¼ˆTickï¼‰ï¼Œæ¯ä¸ªç³»ç»Ÿè®¿é—®å¤šä¸ªä¸åŒçš„ç»„ä»¶ï¼Œç§°ä¹‹ä¸ºå…ƒç»„ï¼ˆTupleï¼‰<br>å…ƒç»„ä¹‹åè¢« Sibling å–ä»£äº†ã€‚<br>ç³»ç»Ÿä¸å…³å¿ƒå®ä½“ï¼Œåªå…³å¿ƒå…·ä½“çš„ç»„ä»¶ã€‚</p><h2 id="World"><a href="#World" class="headerlink" title="World"></a>World</h2><ul><li>array&lt;System *&gt;</li><li>hash_map&lt;EntityID, Entity *&gt;</li><li>object_pool&lt; Component &gt;*</li><li>array&lt;Component <em>&gt;</em></li></ul><h2 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h2><ul><li>EntityID</li><li>array&lt;Component *&gt;</li><li>resourceHandle</li></ul><h2 id="Component"><a href="#Component" class="headerlink" title="Component"></a>Component</h2><ul><li>void Create(resource *)</li><li>~Component()</li></ul><p>åŸºç±»ï¼Œå…¶å­ç±»å¯ä»¥é‡è½½æ„é€  &#x2F; ææ„å‡½æ•°ç”¨äºç®¡ç†èµ„æºã€‚<br>æœ‰ä¸€äº›å·¥å…·å‡½æ•°ï¼Œä¸»è¦ä¸ºæ•°æ®çš„è®¿é—®æ¥å£ã€‚</p><h2 id="System"><a href="#System" class="headerlink" title="System"></a>System</h2><ul><li>void Update(float)</li><li>void NotifyComponentâ€¦(Component *)</li></ul><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>ä¸€ä¸ªæ£€æµ‹ç©å®¶æŒ‚æœºè¡Œä¸ºçš„ Systemï¼Œè¿™ä¸ª System å¿…é¡»åŒæ—¶å–å¾— ConnectionComponentï¼ŒInputStreamComponent å’Œ StatsComponentã€‚<br>è€Œå¯¹äºæ²¡æœ‰ ConnectionComponent å’Œ InputStreamComponent çš„ AI ç©å®¶åˆ™ä¸å—è¿™ä¸ªç³»ç»Ÿçš„çº¦æŸã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PlayerConnectionSystem::Update</span><span class="hljs-params">(<span class="hljs-type">float</span> timeStep)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span>(ConnectionComponent *c : <span class="hljs-built_in">ComponentItr</span>&lt;ConnectionComponent&gt;(m_admin))<br>    &#123;<br>        <span class="hljs-comment">// ä»ä¸€ä¸ªå…·ä½“çš„ Component æ‰€åœ¨çš„ Entity ä¸Šè·å¾—æŒ‡å®šç±»å‹çš„ Componentã€‚</span><br>        InputStreamComponent *is = c-&gt;<span class="hljs-built_in">Sibling</span>&lt;InputStreamComponent&gt;();<br>        StatsComponent *stats = c-&gt;<span class="hljs-built_in">Sibling</span>&lt;StatsComponent&gt;();<br>        <span class="hljs-keyword">if</span> (is-&gt;m_inputThisFrame || stats-&gt;m_didSomethingCoolLately)<br>        &#123;<br>            c-&gt;m_afkTimer = <span class="hljs-number">0.0f</span>;<br>            C-&gt;m_sentAFKMessage = <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            C-&gt;m_afkTimer += timeStep;<br>            <span class="hljs-keyword">if</span> (!c-&gt;m_sentAFKMessage &amp;&amp; c-&gt;m_afkTimer &gt; AFK_MESSAGE_SECONDS)<br>            &#123;<br>                c-&gt;m_sentAFKMessage = <span class="hljs-literal">true</span>;<br>                <span class="hljs-comment">// è¾…åŠ©å‡½æ•°ï¼Œä¹‹åä¼šè®²åˆ°</span><br>                ConnectionUtil::<span class="hljs-built_in">SendMessage</span>(c-&gt;m_connectionHandle, <span class="hljs-string">&quot;Move scrub!&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="WHY-NOT-OOP-IT"><a href="#WHY-NOT-OOP-IT" class="headerlink" title="WHY NOT OOP IT"></a>WHY NOT OOP IT</h2><p>è§‚ç‚¹ï¼šåŒä¸€ä»½æ•°æ®åœ¨ä¸åŒè§†è§’ä¸‹çš„æ„ä¹‰æ˜¯ä¸åŒçš„ã€‚</p><h2 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h2><p>ä¸ºäº†é¿å…å¥‡æ€ªçš„è®¿é—®æ–¹å¼ï¼ˆæ¯”å¦‚ä¸€ä¸ªç³»ç»Ÿé€šè¿‡å…¨å±€å˜é‡æ‹¿åˆ°å¦ä¸€ä¸ªç³»ç»Ÿçš„æŒ‡é’ˆï¼Œè€Œæ­»äº¡å›æ”¾æ—¶å­˜åœ¨ä¸¤ä¸ª Worldï¼Œä¾¿å­˜åœ¨äº†ä¸¤ä¸ªâ€œå…¨å±€å˜é‡â€ï¼‰<br>å¯ä»¥å®šä¹‰ä¸€äº›ä»…å­˜åœ¨ä¸€ä¸ªå®ä¾‹çš„ Componentï¼Œç§°ä¹‹ä¸ºå•ä¾‹ç»„ä»¶ã€‚å­˜åœ¨äºä¸€åŒ¿å Entity ä¸Šï¼Œé€šå¸¸ç›´æ¥é€šè¿‡ World è®¿é—®ã€‚<br>å•ä¾‹ç»„ä»¶æå°‘åªè¢«å•ä¸ª System è®¿é—®ï¼Œå¹¶ä¸”äº‹å®ä¸Š OW æœ‰ç™¾åˆ†ä¹‹å››åçš„ Component éƒ½æ˜¯å•ä¾‹ç»„ä»¶ã€‚</p><h2 id="å…¨å±€è¡Œä¸ºï¼ˆShare-behaviorï¼‰"><a href="#å…¨å±€è¡Œä¸ºï¼ˆShare-behaviorï¼‰" class="headerlink" title="å…¨å±€è¡Œä¸ºï¼ˆShare behaviorï¼‰"></a>å…¨å±€è¡Œä¸ºï¼ˆShare behaviorï¼‰</h2><p>ä¸ºäº†é¿å…ç³»ç»Ÿä¹‹é—´çš„è€¦åˆï¼ˆæ¯”å¦‚åœ¨ä¸€ä¸ªç³»ç»Ÿå†…è°ƒç”¨å¦ä¸€ç³»ç»Ÿçš„å‡½æ•°ï¼‰<br>æœ‰ä¸€äº›é€»è¾‘æ˜¯è®¸å¤šç³»ç»Ÿéƒ½å…³å¿ƒçš„ï¼Œæ¯”å¦‚åˆ¤æ–­ä¸¤ä¸ªå®ä½“æ˜¯å¦æ•Œå¯¹ï¼Œå¯ä»¥å°†å…¶æŠ½è±¡ä¸ºè¾…åŠ©å‡½æ•°ã€‚<br>è¿™é‡Œæœ‰ä¸€äº›è®¾è®¡è§„åˆ™ï¼š</p><ol><li>å°½é‡å°‘è¯»å– Componentï¼Œå°½é‡å°‘äº§ç”Ÿå‰¯ä½œç”¨ã€‚</li><li>å¦‚æœåšä¸åˆ°ï¼Œå°±å°½é‡å°‘è°ƒç”¨å®ƒã€‚</li></ol><h3 id="å‡å°å‰¯ä½œç”¨çš„æ–¹æ³•"><a href="#å‡å°å‰¯ä½œç”¨çš„æ–¹æ³•" class="headerlink" title="å‡å°å‰¯ä½œç”¨çš„æ–¹æ³•"></a>å‡å°å‰¯ä½œç”¨çš„æ–¹æ³•</h3><p>å‡è®¾æœ‰ä¸€ä¸ªä¼šå½±å“å¾ˆå¤š Component çš„å‡½æ•°ï¼Œå¹¶ä¸”å…è®¸å…¶åœ¨å¤šä¸ªåœ°æ–¹è°ƒç”¨ã€‚é¦–å…ˆå¯¹å…¶æœ¬èº«çš„ä»»ä½•ä¿®æ”¹å°±éœ€è¦è¿›è¡Œå¤§é‡çš„æµ‹è¯•ï¼Œå…¶æ¬¡è°ƒç”¨è€…å®¹æ˜“å¯¹å…¶çœŸæ­£çš„å¤æ‚åº¦äº§ç”Ÿè¯¯è§£è¿›è€Œæ— é™åˆ¶çš„è¿›è¡Œè°ƒç”¨ã€‚ä¸¤è€…æ”¾åœ¨ä¸€èµ·æ›´æ˜¯è®©ä»£ç å¾ˆéš¾ç†è§£ã€‚<br><img src="/img/GDCOverwatchECS/Nightmare.png" alt="Nightmare"><br>è§£å†³æ–¹æ¡ˆï¼šå»¶è¿Ÿè°ƒç”¨<br>åœ¨åŸæœ¬çš„è°ƒç”¨ä½ç½®åªæ·»åŠ ä¸€ä¸ªåŒ…å«è¶³å¤Ÿå¤šä¿¡æ¯çš„ç”¨äºç¨åè¿›è¡ŒçœŸæ­£çš„è°ƒç”¨çš„è®°å½•åˆ° arrayï¼Œæœ€åç»Ÿä¸€è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·ä¸€æ¥æ¯ä¸€å¸§å°±åªæœ‰ä¸€å¤„è°ƒç”¨ä¼šäº§ç”Ÿæ˜æ˜¾çš„å‰¯ä½œç”¨äº†ã€‚<br>æˆ‘çš„ç†è§£æ˜¯ï¼šå¤æ‚åº¦æ˜¯æ— æ³•å‡å°çš„ï¼Œä½†æ˜¯æ˜¯å¯ä»¥è¢«é”™è¯¯çš„è®¾è®¡æ”¾å¤§çš„ï¼Œè€Œæˆ‘ä»¬çš„è®¾è®¡åº”å½“å°½é‡é€¼è¿‘æœ€å°çš„å¤æ‚åº¦ã€‚<br>æ›´å¤šå¥½å¤„ï¼š</p><ol><li>æ•°æ®ä¸æŒ‡ä»¤å†…å­˜å¸ƒå±€è¿ç»­ï¼Œè®¿å­˜å‹å¥½ã€‚</li><li>ä½ ç”šè‡³å¯ä»¥å°†çœŸæ­£çš„è°ƒç”¨å»¶è¿Ÿåˆ°ä¹‹åå‡ å¸§æ¥åˆ†æ‘Šæ€§èƒ½ã€‚</li></ol><p>PSï¼šå®ä½“çš„åˆ›å»ºæ˜¯ç«‹å³çš„ï¼Œå…·ä½“æƒ…å†µå…·ä½“åˆ†æã€‚</p>]]></content>
    
    
    <categories>
      
      <category>GDC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Engineering</tag>
      
      <tag>ECS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½å¤æ‚ï¼Œé«˜ä¿çœŸï¼šINSIDE ä¸­çš„æ¸²æŸ“</title>
    <link href="/2023/12/23/GDCTheRenderingofInside/"/>
    <url>/2023/12/23/GDCTheRenderingofInside/</url>
    
    <content type="html"><![CDATA[<h2 id="åŸæ ‡é¢˜"><a href="#åŸæ ‡é¢˜" class="headerlink" title="åŸæ ‡é¢˜"></a>åŸæ ‡é¢˜</h2><p><em>Low Complexity, High Fidelity: The Rendering of INSIDE</em><br>é¡¹ç›®ä¸­çš„å„ç§ Trick ä¸æ€§èƒ½ä¼˜åŒ–ï¼Œå…¶ä¸­é¢œè‰²æŠ–åŠ¨åœ¨æ¸²æŸ“ä¸­çš„åº”ç”¨æ¯”è¾ƒæœ‰æ„æ€ã€‚</p><h2 id="Dithering"><a href="#Dithering" class="headerlink" title="Dithering"></a>Dithering</h2><p><img src="/img/GDCTheRenderingofInside/ColorBanding.png" alt="Color Banding"><br>è¿™ä¸ªé—®é¢˜æºäºï¼š8 bit çš„é¢œè‰²æ— æ³•å®Œç¾è¿˜åŸé«˜ç²¾åº¦çš„æ¸²æŸ“ç»“æœã€‚</p><ul><li>æ©™çº¿ï¼šç†æƒ³ä¸­çš„åŸå§‹ä¿¡å·</li><li>è“çº¿ï¼šé»˜è®¤çš„é‡‡æ ·æ–¹å¼ï¼ˆfloorï¼‰ï¼Œå¯ä»¥çœ‹åˆ°ä¸¢å¤±äº†ç²¾åº¦</li><li>å™ªç‚¹ï¼šäººä¸ºåœ¨åŸå§‹ä¿¡å·ä¸Šå åŠ çš„ [0, 1] éšæœºå€¼</li></ul><p>åŠ ä¸Šå™ªå£°ä¹‹åï¼Œä¿¡å·ä»åŸæœ¬çš„â€œä¸å¾—ä¸è¢« floor è‡³è“çº¿ä¸¢å¤±ç²¾åº¦â€å˜æˆâ€œæœ‰ a æ¦‚ç‡è¢« clamp è‡³è“çº¿ï¼Œæœ‰ b æ¦‚ç‡è¢« clamp è‡³çº¢çº¿ï¼Œa + b &#x3D;&#x3D; 1â€ï¼Œè¿™æ ·åœ¨äººçœ¼çš„æ„ŸçŸ¥ä¸Šä¹Ÿæ›´è´´åˆåŸå§‹ä¿¡å·ã€‚</p><h2 id="Noise-Modulation"><a href="#Noise-Modulation" class="headerlink" title="Noise Modulation"></a>Noise Modulation</h2><p>å™ªå£°çš„é€‰æ‹©ä¹Ÿå€¼å¾—å…³æ³¨ï¼Œè¿™é‡Œæåˆ°äº†ä¸€ä¸ª Noise Modulation çš„æ¦‚å¿µï¼Œå¤§è‡´æ„æ€å¥½åƒæ˜¯å™ªå£°ä¸åº”å½“ä¸åŸå§‹ä¿¡å·æ— å…³ï¼Œè¯¦ç»†å¯ä»¥çœ‹ _Optimal Dither and Noise Shaping in lmage Processing, 2008, Cameron Nicklaus Christou_ã€‚<br>ä»–ä»¬æœ€ç»ˆé€‰æ‹©äº†é¢„è®¡ç®— blue noiseï¼Œå¹¶ä¸” remap è‡³ä¸‰è§’æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆå³ä¸‹è§’ï¼‰ï¼Œåœ¨å®é™…çš„åº”ç”¨ä¸­åªè¿›è¡Œä¸€ä¸ªç®€å•çš„é‡‡æ ·ã€‚<br><img src="/img/GDCTheRenderingofInside/FinalNoiseTypeforDithering.png" alt="Final Noise Type for Dithering"></p>]]></content>
    
    
    <categories>
      
      <category>GDC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Rendering</tag>
      
      <tag>Dithering</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è’é‡å¤§é•–å®¢ 2 ä¸­çš„å¤©æ°”ç³»ç»Ÿ</title>
    <link href="/2023/12/19/SigRedDeadRedemption2Atmospheric/"/>
    <url>/2023/12/19/SigRedDeadRedemption2Atmospheric/</url>
    
    <content type="html"><![CDATA[<h2 id="åŸæ ‡é¢˜"><a href="#åŸæ ‡é¢˜" class="headerlink" title="åŸæ ‡é¢˜"></a>åŸæ ‡é¢˜</h2><p><em>Creating the Atmospheric World of Red Dead Redemption 2: A Complete and Integrated Solution</em><br>æ•´å¥—å¤©æ°”ç³»ç»Ÿæ¸²æŸ“çš„å®ç°ï¼ŒåŒ…æ‹¬å¤§æ°”ã€äº‘é›¾ã€äºŒåå››å°æ—¶ã€ä¸åŒå¤©æ°”ã€‚</p><h2 id="ç‰©ç†åŸºç¡€"><a href="#ç‰©ç†åŸºç¡€" class="headerlink" title="ç‰©ç†åŸºç¡€"></a>ç‰©ç†åŸºç¡€</h2><p><img src="/img/SigRedDeadRedemption2Atmospheric/Scattering1.png" alt="Scattering"></p><ul><li>è¿™é‡Œåªè€ƒè™‘å•æ¡å…‰è·¯ä¸Šçš„å•æ¬¡æ•£å°„ã€‚</li><li>ä»¥å•ä¸ªç²’å­ä¸ºè§†è§’ï¼Œå½“å…‰çº¿ä¸å…¶äº¤äº’æ—¶ï¼Œå¤§è‡´ä¼šå‘ç”Ÿå¸æ”¶ï¼ˆè½¬åŒ–ä¸ºçƒ­èƒ½ï¼‰ã€æ•£å°„å’Œåå¼¹ã€‚</li><li>æ•£å°„å‘ç›¸æœºçš„éƒ¨åˆ†è¢«ç§°ä½œ in-scatteringï¼Œå‰©ä½™çš„éƒ¨åˆ†è¢«ç§°ä½œ out-scatteringã€‚<ul><li>out-scattering ä¼šç»§ç»­ä½œç”¨äºå…¶ä»–ç²’å­å¹¶é€ æˆå¤šé‡æ•£å°„ï¼Œå¤šé‡æ•£å°„è¾ƒä¸ºå¤æ‚ï¼Œæ­¤å¤„ä¸åšè€ƒè™‘ã€‚</li><li>ä»¥ä¸€æ¡å…‰è·¯ä¸ºè§†è§’ï¼Œè¿œå¤„çš„ç²’å­å‘ç”Ÿçš„ in-scattering ä¼šç»§ç»­åœ¨è¿‘å¤„çš„ç²’å­ä¸Šå‘ç”Ÿ out-scatteringã€‚</li></ul></li><li><strong>Scattered Light</strong>ï¼šå•ä¸ªç²’å­ä¸Šå‘ç”Ÿçš„æ•£å°„ï¼ŒP ä¸ºç›¸å‡½æ•°ï¼ŒV ä¸ºå¯è§æ€§ï¼ŒL ä¸ºå…¥å°„ Radianceã€‚</li><li><strong>Extinction</strong>ï¼šæ¶ˆå…‰ç³»æ•°ï¼Œç”±å¸æ”¶ç³»æ•°ä¸æ•£å°„ç³»æ•°å®šä¹‰ï¼Œæ„ä¸ºä¸€æŸå…‰ç»è¿‡å•ä¸ªç²’å­ä¹‹åæ²¿ç€åŸå…‰è·¯ç»§ç»­ä¼ æ’­çš„å æ¯”ã€‚</li><li><strong>Transmittance</strong>ï¼šé€å°„ç‡ &#x2F; é€å…‰ç‡ï¼Œæ„ä¸ºä¸€æŸå…‰ç»è¿‡ç»™å®šè·ç¦»ä¹‹é—´æ‰€æœ‰ç²’å­ä¹‹åæ²¿ç€åŸå…‰è·¯ç»§ç»­ä¼ æ’­çš„å æ¯”ã€‚</li><li>æ€»ç»“ï¼šå•å…‰è·¯ä¸Šå•æ¬¡æ•£å°„ä¾¿å¯è¡¨ç¤ºä¸ºï¼Œâ€œç€è‰²ç‚¹åˆ°è¾¾ç›¸æœºå‰©ä½™çš„å…‰â€ä¸â€œå…‰è·¯ä¸Šæ‰€æœ‰ç²’å­æä¾›ç»™ç›¸æœºçš„æ•£å°„â€ä¹‹å’Œã€‚</li></ul><h2 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h2><h3 id="äº‘"><a href="#äº‘" class="headerlink" title="äº‘"></a>äº‘</h3><p>è´´å›¾ + å‚æ•°ç”Ÿæˆä¸¤ä¸ªé€šé“ç”¨äºè¡¨ç¤ºä¸¤å±‚äº‘åœ¨å¹³é¢ä¸Šè¯¥å¦‚ä½•æ”¾ç½®ï¼Œè¦†ç›–æ•´å¼ åœ°å›¾ã€‚<br><img src="/img/SigRedDeadRedemption2Atmospheric/CloudMap.png" alt="Cloud Map"></p><p>é«˜åº¦ä¸Šçš„å®šä¹‰ã€‚<br><img src="/img/SigRedDeadRedemption2Atmospheric/CloudHeightLUT.png" alt="Cloud Height LUT"></p><p>ç»†èŠ‚ï¼Œä¸¤å¼  2D çš„ä½ç§»è´´å›¾ + ä¸€å¼  3D çš„å™ªå£°è´´å›¾ç»“åˆé£é€Ÿå‚æ•°ã€‚<br><img src="/img/SigRedDeadRedemption2Atmospheric/CloudDetail.png" alt="Cloud Detail"></p><p>åœ¨é«˜ç©ºè¿˜æœ‰ä¸€å±‚ç®€åŒ–è¿‡çš„å·äº‘ï¼Œä¸è¿‡å…‰ç…§æ¨¡å‹æ˜¯ä¸€è‡´çš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">float2 c = SampleCloudMap(ray.p);<br>float3 cloudLut = SampleCloudLUT(altitude);<br><span class="hljs-type">float</span> density = smoothstep(g_CloudShape.xz + cloudLut.xy, g_CloudShape.yw + cloudLut.xy, c.xy);<br><span class="hljs-type">float</span> <span class="hljs-title function_">rescale</span><span class="hljs-params">(vMin, vMax, v)</span><br>&#123;<br>  <span class="hljs-keyword">return</span> saturate((v â€“ vMin) / (vMax - vMin));<br>&#125;<br>density = rescale(noise, CloudLut.z, density);<br></code></pre></td></tr></table></figure><h3 id="é›¾"><a href="#é›¾" class="headerlink" title="é›¾"></a>é›¾</h3><p>å…¨å±€é›¾ + å±€éƒ¨é›¾ã€‚ä¸€å¼ å›¾è¦†ç›–æ‰€æœ‰å¯ç©åŒºåŸŸï¼Œå­˜å‚¨èµ·å§‹é«˜åº¦ï¼Œè¡°å‡è·ç¦»å’Œå¯†åº¦ã€‚<br><img src="/img/SigRedDeadRedemption2Atmospheric/FogMap.png" alt="Fog Map"><br>åŒæ—¶ä¹Ÿæ”¯æŒå¯ä»¥è‡ªç”±æ‘†æ”¾çš„ Fog Volumesï¼Œçƒå‹æˆ–ç›’å‹ï¼Œè‡ªå®šä¹‰é¢œè‰²ï¼Œalpha blending æˆ–è€… additiveã€‚</p><h2 id="æ¸²æŸ“"><a href="#æ¸²æŸ“" class="headerlink" title="æ¸²æŸ“"></a>æ¸²æŸ“</h2><p>è¿‘å¤„ frustum aligned volumeï¼Œè¿œå¤„ raymarchingã€‚</p><h3 id="ç›¸å‡½æ•°"><a href="#ç›¸å‡½æ•°" class="headerlink" title="ç›¸å‡½æ•°"></a>ç›¸å‡½æ•°</h3><p>å•æ¬¡æ•£å°„ï¼Œæ³¢é•¿æ— å…³ï¼Œtrick è¿‘ä¼¼å¤šé‡æ•£å°„ã€‚<br><img src="/img/SigRedDeadRedemption2Atmospheric/PhaseFunction.png" alt="Phase Function"></p><ul><li>å åŠ å¤šçº§çš„ Henyey-Greenstein å‡½æ•°ï¼Œæ¯æ¬¡è¿­ä»£ å„å‘å¼‚æ€§ g å‡å°ã€‚</li><li>ä½¿ç”¨è‰ºæœ¯å¯¼å‘çš„æƒé‡ $\omega_0$ å’Œ $\omega_1$ ä»¥åŠ æ¶ˆå…‰ç³»æ•° $\sigma_{ext}$ æ¥æ··åˆã€‚</li><li>ä¸¤æ¬¡è¿­ä»£ã€‚</li></ul><p>ä¾æ—§ç¼ºä¹å‘åçš„æ•£å°„ï¼Œclamp è‡³ç”±æ¶ˆå…‰ç³»æ•°å’Œæ„ŸçŸ¥è°ƒæ•´å‚æ•°å½±å“çš„ Lambertian BRDF 1&#x2F;PIã€‚<br><em>ä¸çŸ¥é“è¿™ä¸ªæ„ŸçŸ¥è°ƒæ•´å‚æ•°å…·ä½“æ˜¯ä»€ä¹ˆç©æ„å„¿</em></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">float</span> <span class="hljs-title function_">ApplyBackScattering</span><span class="hljs-params">(<span class="hljs-type">float</span> phase, <span class="hljs-type">float</span> extinction)</span><br>&#123;<br>  <span class="hljs-type">float</span> v = <span class="hljs-number">1</span>/PI * rescale(BACK_SCATTER_MIN, BACK_SCATTER_MAX, extinction);<br>  <span class="hljs-keyword">return</span> max(phase, v);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h3><p>ä¸»è¦æ˜¯ Shadow Mapã€‚<br>å¯¹äºäº‘ï¼Œåˆ™è¿›è¡Œå¯¹å¤ªé˜³&#x2F;æœˆäº®çš„æ¶ˆå…‰é‡‡æ ·ï¼Œé€šè¿‡å¤©æ°”å‚æ•°æ§åˆ¶é‡‡æ ·é•¿åº¦ã€‚</p><p>å¯¹åœ°å½¢çš„ Height Map åš Raymarchï¼Œè®°å½•ç›¸äº¤çš„é«˜åº¦ï¼ŒRay length ç”¨äºè°ƒæ•´ thresholdã€‚<br><img src="/img/SigRedDeadRedemption2Atmospheric/TerrainShadowMap.png" alt="Terrain Shadow Map"></p><p>äº‘çš„ Shadw Map å­˜å‚¨ä¸º ESMï¼ˆExponential Shadow Mapï¼‰ï¼Œé€å°„ç‡åŠ æƒå°„çº¿é•¿åº¦ï¼Œæ»¤æ³¢å­˜ä¸º Mip Mapã€‚<br><img src="/img/SigRedDeadRedemption2Atmospheric/CloudShadowMap.png" alt="Cloud Shadow Map"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">float</span> transmittance = <span class="hljs-number">1</span>;<br><span class="hljs-type">float</span> depth = maxDepth;<br><span class="hljs-keyword">while</span> (ray.t &lt; maxDepth &amp;&amp; transmittance &gt; <span class="hljs-number">0.001</span>)<br>&#123;<br>  <span class="hljs-type">float</span> density = SampleCloudDensity(ray.p + ray.d * ray.t);<br>  transmittance *= <span class="hljs-built_in">exp</span>(-density * stepLength);<br>  depth = lerp(depth, ray.t, <span class="hljs-built_in">pow</span>(transmittance, <span class="hljs-number">4</span>));<br>  ray.t += stepLength;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç¯å¢ƒå…‰"><a href="#ç¯å¢ƒå…‰" class="headerlink" title="ç¯å¢ƒå…‰"></a>ç¯å¢ƒå…‰</h3><p>å¤ç”¨ä¸Šé¢ Cloud Shadow Map çš„å¯è§æ€§ã€‚</p><p>å¯¹äº Raymarchingï¼š</p><ul><li>å°†æ— äº‘çš„ Rayleigh å’Œ Mie æ•£å°„åŠ æƒå¹³å‡</li><li>æ¸²æŸ“è‡³ä½åˆ†è¾¨ç‡çš„æŠ›ç‰©é¢è´´å›¾ä¸Š</li><li>Parallel Reduction</li><li>å¤ªé˜³&#x2F;æœˆäº®æ–¹å‘åŠ æƒ</li></ul><p>å¯¹äº Frustum Volumeï¼š</p><ul><li>é‡‡æ · Irradiance Probeï¼Œå­˜å‚¨äº† sky light + indirect bounce light * AO</li></ul><h3 id="Local-Lights"><a href="#Local-Lights" class="headerlink" title="Local Lights"></a>Local Lights</h3><ul><li>é‡‡æ · light cluster volume</li><li>Shadow Map åšå¯è§æ€§</li><li>å•çº§ HG ç›¸å‡½æ•°</li></ul><h3 id="é—ªç”µ"><a href="#é—ªç”µ" class="headerlink" title="é—ªç”µ"></a>é—ªç”µ</h3><p>æ²¡æœ‰ç»†è®²ï¼Œæ¯”è¾ƒæš´åŠ›çš„å®ç°ã€‚</p><ul><li>æ¯ä¸€å‡»é—ªç”µæ·»åŠ ä¸€ä¸ªç‚¹å…‰æº</li><li>æŒ‡æ•°è¡°å‡ + ç›¸å‡½æ•°</li><li>ç®€åŒ–çš„å±€éƒ¨æ¶ˆå…‰ï¼ˆç”¨äºè¿‘ä¼¼é˜´å½±ï¼‰</li></ul><h3 id="æ•£å°„æ³¢ç“£å¯è§†åŒ–"><a href="#æ•£å°„æ³¢ç“£å¯è§†åŒ–" class="headerlink" title="æ•£å°„æ³¢ç“£å¯è§†åŒ–"></a>æ•£å°„æ³¢ç“£å¯è§†åŒ–</h3><p><img src="/img/SigRedDeadRedemption2Atmospheric/ScatteredLightOverview.png" alt="Scattered Light Overview"></p><h3 id="Frustum-Voxel-Grid"><a href="#Frustum-Voxel-Grid" class="headerlink" title="Frustum Voxel Grid"></a>Frustum Voxel Grid</h3><p><img src="/img/SigRedDeadRedemption2Atmospheric/FrustumVoxelGrid.png" alt="Frustum Voxel Grid"></p><ul><li>åŠ¨æ€å¯è°ƒæ·±åº¦ï¼ˆ&lt;160mï¼‰</li></ul><p>ä¸‰ä¸ª volume</p><ul><li>Shadow Volume</li><li>Material Volume</li><li>Scattered Light and Extinction Volume</li><li>åˆ†è¾¨ç‡ 160 x 88 x 64</li></ul><h4 id="Shadow-Volume"><a href="#Shadow-Volume" class="headerlink" title="Shadow Volume"></a>Shadow Volume</h4><ul><li>æ ¼å¼ï¼šR16F</li><li>å­˜å‚¨ä» Shadow Mapï¼ŒCloud Shadow Map å’Œ Terrain Shadow Map é‡‡æ ·åˆ°çš„ç›´æ¥å…‰é˜´å½±é¡¹</li><li>Temporal Filtering</li></ul><h4 id="Material-Volume"><a href="#Material-Volume" class="headerlink" title="Material Volume"></a>Material Volume</h4><p>åˆ†ä¸ºä¸¤ä¸ªå­ Volume å­˜å‚¨ä¸åŒå‚æ•°ã€‚<br><img src="/img/SigRedDeadRedemption2Atmospheric/MaterialVolume.png" alt="Material Volume"></p><ul><li>æ··åˆé¡ºåºï¼šAdditive -&gt; Alpha -&gt; Particles<br>è¿™æ ·å¯ä»¥ç”¨ä¸€ä¸ªå¤§å·çš„ Additive åŒ…å›´æ•´ä¸ªå»ºç­‘ï¼Œç„¶åç”¨ Alpha é•‚ç©ºå®¤å†…ï¼Œç„¶åè¿˜æ”¯æŒç”¨ Particles è¡¨ç¤ºçš„çˆ†ç‚¸&#x2F;ç«ç¾ã€‚</li><li>å¯¹æ•£å°„å’Œå¸æ”¶ç³»æ•°åš Temporal Filtering</li><li>ä¸é£é€Ÿäº¤äº’</li></ul><h4 id="Scattered-Light-Volume"><a href="#Scattered-Light-Volume" class="headerlink" title="Scattered Light Volume"></a>Scattered Light Volume</h4><ul><li><p>é‡‡æ · Material å’Œ Shadow Volume</p></li><li><p>ç´¯è®¡ç›´æ¥å…‰ï¼ˆå¤ªé˜³&#x2F;æœˆäº®&#x2F;å±€éƒ¨å…‰ï¼‰å’Œç¯å¢ƒå…‰ï¼ˆæ¥è‡ª irradiance probeï¼‰çš„ Radiance</p></li><li><p>æ ¼å¼ï¼šRGBA16Fï¼ŒRGB: Scattered lightï¼ŒA: Extinction</p></li><li><p>ä¸€ä¸ª slice marching pass è®¡ç®—æ¯ä¸ª slice çš„ in-scattering å’Œ transmittance </p></li><li><p>æ— æ—¶é—´æ€§çš„æ··åˆï¼ŒåŠ¨æ€å…‰æºæ‹–å½±æ˜æ˜¾</p></li><li><p>ä½¿ç”¨æŠ–åŠ¨æŸ¥æ‰¾å’Œ TAA</p></li></ul><h3 id="Raymarch"><a href="#Raymarch" class="headerlink" title="Raymarch"></a>Raymarch</h3><p>Frustum Volumes åˆ†è¾¨ç‡æœ‰é™ï¼Œæ— é«˜é¢‘ä¿¡æ¯ï¼Œä½¿ç”¨æ—¶é—´æ€§çš„æ··åˆä¾æ—§ä¸ç¨³å®šã€‚<br>Raymarch å†…å­˜æ›´å°ä½†æ˜¯è¿è¡Œå¼€é”€æ›´å¤§ï¼Œå‰”é™¤äº†é›¾, irradiance probe å’Œå±€éƒ¨å…‰ã€‚</p><ul><li><p>å°„çº¿é•¿åº¦ç”±å±å¹•æ·±åº¦ï¼Œä¸åœ°å¹³é¢&#x2F;ç©¹é¡¶çš„è§£æè§£å†³å®š</p></li><li><p>å‡»ä¸­äº‘çš„åŸºæœ¬å½¢çŠ¶ä¹‹åæ­¥é•¿å‡åŠå¹¶å›é€€ä¸€æ­¥ï¼Œç›´åˆ°è¾¾åˆ°è¿­ä»£æœ€å¤§æ¬¡æ•°</p></li><li><p>ä»¥æ­¤åšä¸ºç§¯åˆ†çš„å¼€å§‹ä½ç½®</p></li><li><p>ç¦»å¼€äº‘ä¹‹åæ¢å¤åˆå§‹æ­¥é•¿</p></li><li><p>å°„çº¿èµ·å§‹ä½ç½® &#x3D; frustum volume çš„æœ€åä¸€ä¸ª slice ä¹‹å + offset(blue noise)</p></li><li><p>ç›®æ ‡æ˜¯åŠå±å¹•åˆ†è¾¨ç‡</p></li><li><p>è¿˜æ˜¯å¤ªæ…¢äº†ï¼Œæ•…ä¸å¯¹æ‰€æœ‰åƒç´ æŠ•å°„å…‰çº¿ï¼Œå§è®¡ç®—åˆ†å¸ƒåˆ° 4 å¸§</p></li></ul><h4 id="Reconstruction"><a href="#Reconstruction" class="headerlink" title="Reconstruction"></a>Reconstruction</h4><ul><li>æ¯æ¬¡åªæŠ•å°„ 2 x 2 tile ä¸­çš„ä¸€æ¡å…‰çº¿ï¼Œå¹¶é‡æŠ•å½±ä¸Šä¸€å¸§ä¸­è·³è¿‡çš„åƒç´ </li><li>é‡‡æ ·ä¹‹å‰çš„ buffer æ—¶å°†ç»“æœ clamp è‡³ 3 x 3 çš„ä¸´è¿‘åƒç´ å†…</li><li>æ”¾å¼ƒä¸å½“å‰åƒç´ æ·±åº¦å·®å¼‚è¿‡å¤§çš„æ ·æœ¬</li><li>æ— å†å²ä¿¡æ¯æ—¶ä½¿ç”¨æœ€è¿‘çš„ Raymarch ç»“æœ</li></ul><p><img src="/img/SigRedDeadRedemption2Atmospheric/RaymarchReconstruction.png" alt="Raymarch Reconstruction"></p><h4 id="Ray-Placement"><a href="#Ray-Placement" class="headerlink" title="Ray Placement"></a>Ray Placement</h4><p>å…ˆå¯¹æ·±åº¦è¿›è¡Œæ£‹ç›˜ä¸‹é‡‡æ ·ï¼Œè¿™æ˜¯ä¸€ç§äº¤æ›¿å­˜å‚¨ tile å†…æœ€å¤§å€¼ä¸æœ€å°å€¼çš„ä¸‹é‡‡æ ·æ–¹æ³•ï¼Œæœ‰åŠ©äºä¿å­˜ç»†èŠ‚ã€‚</p><ol><li><p>å‡è®¾ä»¥ï¼šâ€œå·¦ä¸Šã€å³ä¸Šã€å³ä¸‹ã€å·¦ä¸‹â€çš„é¡ºåºæŠ•å°„å…‰çº¿ï¼Œåœ¨ç‰¹å®šçš„æƒ…å†µä¸‹ä¼šé‡åˆ°é—®é¢˜ã€‚ä¾‹å¦‚åœ¨ Frame 2 æˆ‘ä»¬è¯•å›¾é‡å»ºå·¦ä¸‹çš„åƒç´ ï¼Œä¼šå‘ç°ä¹ä¸ªå¯ä¿¡çš„ Raymarch ç»“æœå…¨éƒ¨ä¸å…¶æ·±åº¦ç›¸å·®è¿‡å¤§ï¼Œå³éƒ½åº”å½“è¢«ä¸¢å¼ƒã€‚è¿™æ—¶è¿™ä¸ªåƒç´ ä¾¿ä¼šå¤±å»åœ¨æ—¶é—´ä¸Šçš„å¯ä¿¡åº¦ã€‚åœ¨è¿™é‡Œå…¶å®å¯ä»¥åæ¨å‡ºä¸€ä¸ªç†æƒ³ä¸­å…‰çº¿åˆ†å¸ƒæ–¹å¼åº”å½“æ˜¯è¦†ç›–äº†å°½å¯èƒ½å¤§çš„æ·±åº¦èŒƒå›´çš„ã€‚<br><img src="/img/SigRedDeadRedemption2Atmospheric/RayPlacement.png" alt="Ray Placement"></p></li><li><p>åˆæå‡ºäº†ä¸€ç§ä¸ç»Ÿä¸€ä»å·¦ä¸Šè§’å¼€å§‹çš„åˆ†å¸ƒæ–¹å¼ï¼Œä¾æ—§ä¸èƒ½é€‚é…æ‰€æœ‰æƒ…å†µã€‚<br><img src="/img/SigRedDeadRedemption2Atmospheric/RayPlacement2.png" alt="Ray Placement 2"></p></li><li><p>åœ¨ 2 çš„åŸºç¡€ä¸Šå¾®è°ƒã€‚æ¯”è¾ƒä¸­å¿ƒ Ray å’Œå‘¨å›´å…«ä¸ª Ray çš„æ·±åº¦ï¼Œå¦‚æœç›¸å·®æ— å‡ ï¼Œå°±å°† min ä¸Šçš„ Ray ç§»åˆ° max ä¸Šå»ï¼Œåä¹‹äº¦ç„¶ã€‚<br><em>ç§»åŠ¨æ—¶æ¯ä¸ª tile å†…åº”è¯¥éƒ½æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼Œå…·ä½“æ€ä¹ˆç§»åŠ¨å¥½åƒæ²¡æœ‰ç»†è¯´</em></p></li></ol><h4 id="Full-Resolution-Upscale"><a href="#Full-Resolution-Upscale" class="headerlink" title="Full Resolution Upscale"></a>Full Resolution Upscale</h4><h5 id="Dithered-Upscale"><a href="#Dithered-Upscale" class="headerlink" title="Dithered Upscale"></a>Dithered Upscale</h5><ul><li>4 ä¸ªé‡‡æ ·ç‚¹ + blue noise</li><li>æ·±åº¦åŠ æƒ</li></ul><h5 id="TAA"><a href="#TAA" class="headerlink" title="TAA"></a>TAA</h5><ul><li>å·ç§¯æ ¸å®½åº¦ç”±é€å°„ç‡å’Œæ·±åº¦å†³å®šï¼Œè®©è¿œå¤„äº‘ä¸ä¼šè¢«å¤„ç†çš„å¤ªç³Šã€‚<br><em>åŸæ–‡æ˜¯ï¼šâ€¦ width â€¦ is chosen by the transmittance weighted depth of the ray of this pixel.</em></li><li>æŸ¥æ‰¾ in-scattering &#x2F; transmittance accumulation volume åº”ç”¨åŒæ ·çš„åŸåˆ™ã€‚</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p>æœ‰ä¸€ç¯‡ç»“åˆäº†é€†å‘çš„æ–‡ç« ï¼Œè¿˜åœ¨ UE é‡Œå¤ç°äº†ä¸€éï¼š<br><a href="https://zhuanlan.zhihu.com/p/127435500">è’é‡å¤§é•–å®¢2å¤©æ°”ç³»ç»Ÿäº‘é›¾åˆ†å¸§å¤„ç†ç»†èŠ‚</a></p><h2 id="é›†æˆ"><a href="#é›†æˆ" class="headerlink" title="é›†æˆ"></a>é›†æˆ</h2><h3 id="Sky-Scattering"><a href="#Sky-Scattering" class="headerlink" title="Sky Scattering"></a>Sky Scattering</h3><ul><li>åŸºäº Precomputed Atmospheric Scattering [Bruneton07]</li><li>æ”¹è¿›è‡ª Physically Based Sky, Atmosphere and Cloud Rendering in Frostbite [Hillaire16]</li><li>æ”¯æŒ earth shadow <em>è¿™å•¥ï¼Ÿ</em></li><li>éšæ—¶é—´æ®µæ›´æ–°</li><li>Raymarch ä¹‹åé‡‡æ ·ä¸€æ¬¡ï¼Œè€Œéæ¯ä¸ªé‡‡æ ·ç‚¹éƒ½é‡‡æ · Sky Scattering</li></ul><h4 id="Light-Shaft-God-Ray"><a href="#Light-Shaft-God-Ray" class="headerlink" title="Light Shaft &#x2F; God Ray"></a>Light Shaft &#x2F; God Ray</h4><ul><li>åˆ†ç¦» Sky Scattering çš„å¯è§æ€§é¡¹</li><li>æ¯æ¬¡ Raymarch ç´¯è®¡å¯è§æ€§ï¼Œé€šè¿‡æ ·æœ¬è¦†ç›–é¢ç§¯å’Œé€å°„ç‡åŠ æƒ</li><li>Raymarch ä¹‹åé€šè¿‡ å…‰çº¿é•¿åº¦è¿›è¡Œå½’ä¸€åŒ–ã€‚</li><li>ç‰©ç†ä¸æ­£ç¡®ï¼Œä½†æ˜¯å¼€é”€å°æ•ˆæœå¥½</li></ul><h3 id="Sky-Irradiance-Probes"><a href="#Sky-Irradiance-Probes" class="headerlink" title="Sky Irradiance Probes"></a>Sky Irradiance Probes</h3><p><img src="/img/SigRedDeadRedemption2Atmospheric/SkyIrradianceProbes.png" alt="Sky Irradiance Probes"></p><ul><li>äº‘é›¾å¯¹å¤§æ°”æä¾›çš„ç¯å¢ƒå…‰çš„é®æŒ¡</li><li>ç»´æŠ¤ 32 x 32 ä¸ª probeï¼Œæ¯ 256 x 256 å¹³æ–¹ç±³ä¸€ä¸ª</li><li>é«˜åº¦å’Œæ–¹å‘ç”± height map å’Œ bent normal map å†³å®š</li><li>ç¼–ç ä¸ºä¸‰é˜¶çƒè°å‡½æ•°</li></ul><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/SigRedDeadRedemption2Atmospheric/SkyIrradianceProbes1.png" alt="Sky Irradiance"></div><div class="group-image-wrap"><img src="/img/SigRedDeadRedemption2Atmospheric/SkyIrradianceProbes2.png" alt="With Scattering / Transmittance"></div><div class="group-image-wrap"><img src="/img/SigRedDeadRedemption2Atmospheric/SkyIrradianceProbes3.png" alt="With Direct Light"></div></div></div><p>ä¼˜åŒ–ï¼š</p><ul><li>å¯è§†çš„ Probe æŠ•å°„ 32 æ¡å…‰çº¿ï¼Œä¸å¯è§æŠ•å°„ 16 æ¡</li><li>æ¯ä¸ªçº¿ç¨‹ä¸€æ¡å°„çº¿</li><li>ä¸è€ƒè™‘äº‘çš„é«˜é¢‘å™ªå£°ä¾µèš€</li><li>ä¸è€ƒè™‘å½©è™¹ &#x2F; é—ªç”µ</li><li>é•¿æ­¥é•¿ï¼Œæ— éœ€ç»†åŒ–</li><li>Shared memory parallel reduction</li></ul><h3 id="Reflection-Probes"><a href="#Reflection-Probes" class="headerlink" title="Reflection Probes"></a>Reflection Probes</h3><ul><li>åœ¨ç›¸æœºä½ç½®ç”Ÿæˆä½åˆ†è¾¨ç‡çš„ Cube Map</li><li>å­˜å‚¨ scattering å’Œ transmittance</li><li>å’Œ Sky Irradiance Probe ä¸€æ ·ç®€åŒ–çš„ Raymarch</li></ul><h3 id="Water-Reflections"><a href="#Water-Reflections" class="headerlink" title="Water Reflections"></a>Water Reflections</h3><ul><li>SSR ä¸åŒ…å«åŠé€æ˜ &#x2F; ä½“ç§¯æ•ˆæœ</li><li>å–è€Œä»£ä¹‹ä½¿ç”¨ç®€åŒ–çš„ Raymarch + temporal blend</li></ul>]]></content>
    
    
    <categories>
      
      <category>Siggraph</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AtmosphericScattering</tag>
      
      <tag>Rendering</tag>
      
      <tag>VolumeRendering</tag>
      
      <tag>Cloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¼«å¨èœ˜è››ä¾ ä¸­çš„ç¨‹åºåŒ–å…‰ç…§</title>
    <link href="/2023/11/21/GDCSpiderManLighting/"/>
    <url>/2023/11/21/GDCSpiderManLighting/</url>
    
    <content type="html"><![CDATA[<h2 id="åŸæ ‡é¢˜"><a href="#åŸæ ‡é¢˜" class="headerlink" title="åŸæ ‡é¢˜"></a>åŸæ ‡é¢˜</h2><p><em>Marvelâ€™s Spider-Man: Procedural Lighting Tools</em><br>ç¨‹åºåŒ–å¸ƒå…‰ä»¥åŠ Probe &#x2F; Light Grid åˆ†å¸ƒã€‚</p><h2 id="Open-World-Tiles"><a href="#Open-World-Tiles" class="headerlink" title="Open World Tiles"></a>Open World Tiles</h2><p><img src="/img/GDCSpiderManLighting/Tile.png" alt="Tile"></p><ul><li>å°†æ•´ä¸ªä¸–ç•Œåˆ†æˆæ•°ä¸ª 128 x 128 ç±³çš„ Tileï¼Œå¯¹äºæ¯ä¸ª Tileï¼Œç”±æ•°ä¸ª JSON æ–‡ä»¶æè¿°è¯¥ Tile æ‰€å¼•ç”¨çš„èµ„æºã€‚</li><li>åªæœ‰ç©å®¶å½“å‰æ‰€åœ¨çš„å’Œå‘¨å›´çš„ Tile ä¼šæµå…¥å†…å­˜ï¼Œå…¶ä½™çš„ Tile å¸è½½ã€‚</li><li>æè¿œå¤„çš„æ¸²æŸ“ç”±ä¸‹æ–‡ä¼šè®²åˆ°çš„ Impostor ç³»ç»Ÿè´Ÿè´£ã€‚</li></ul><h2 id="Procedural-Placement"><a href="#Procedural-Placement" class="headerlink" title="Procedural Placement"></a>Procedural Placement</h2><p><img src="/img/GDCSpiderManLighting/ProceduralPlacement.png" alt="ProceduralPlacement"></p><ul><li>ç¨‹åºåŒ–æ²¿ç€è¡—é“æ”¾ç½®è·¯ç¯ã€‚</li><li>å¯è§†åŒ–æ‰€æœ‰å…‰æºçš„ä½ç½®åŠå…¶å…‰ç…§èŒƒå›´ï¼ˆRayCastï¼‰ï¼Œä»¥æ‰¾åˆ°æ‰“å…‰ä¸è¶³çš„åŒºåŸŸã€‚</li></ul><h2 id="Light-Probesï¼ˆSpecularï¼‰"><a href="#Light-Probesï¼ˆSpecularï¼‰" class="headerlink" title="Light Probesï¼ˆSpecularï¼‰"></a>Light Probesï¼ˆSpecularï¼‰</h2><ul><li>åœ¨æ¯ä¸ª Tile ä¸­å‡åŒ€åˆ’åˆ†å››ä¸ªåŒºåŸŸï¼Œåœ¨æ¯ä¸ªåŒºåŸŸä¸­å¿ƒç”Ÿæˆä¸€ä¸ª Probeã€‚</li><li>å°† Probe ç§»åŠ¨åˆ°è·ç¦»æœ€è¿‘çš„è¡—é“ä¸Šï¼Œä¼˜å…ˆä¸»å¹²é“ï¼Œç„¶åæ¬¡å¹²é“ã€‚</li><li>å¦‚æœ Probe ä½äºå»ºç­‘ç‰©å†…ï¼Œç”¨ SDF å°†å…¶ç§»å‡ºã€‚</li><li>Probes æ‰€æ•è·çš„ä¿¡æ¯æ¥è‡ª Impostor ç³»ç»Ÿã€‚</li></ul><p><img src="/img/GDCSpiderManLighting/LightProbes.png" alt="LightProbes"></p><ul><li>åœ¨ç£ç›˜ä¸Šå­˜å‚¨ Light Probe ä¿¡æ¯æ•°æ®é‡è¿‡å¤§ï¼Œæ•…ä½¿ç”¨å®æ—¶çš„ Light Probe ç”Ÿæˆã€‚</li><li>æ¯ä¸ª Probe çš„æ¯ä¸ªé¢åˆ†è¾¨ç‡ä¸º 512 x 512ï¼Œç„¶åå‘ä¸‹è¿›è¡Œ 5 å±‚å·ç§¯å­˜å‚¨ä¸º MipMapã€‚</li></ul><h2 id="IG-Impostors"><a href="#IG-Impostors" class="headerlink" title="IG-Impostors"></a>IG-Impostors</h2><p><img src="/img/GDCSpiderManLighting/IG.png" alt="IG"></p><ul><li>ç›¸å…³çš„ Mesh å’Œ Texture å¸¸é©»äºå…¨å±€å†…å­˜ä¸­ï¼Œä»£è¡¨æœ€ä½çº§åˆ«çš„ LODã€‚</li><li>æ‰€æœ‰ Mesh å…±å  100 MBï¼ŒTexture å…±å  90 MBï¼Œè¿˜æœ‰ä¸€äº›é«˜è´¨é‡çš„ç”¨äºè‡ªå‘å…‰ä»¥åŠåå°„çš„ Mesh å…±å  30 MBã€‚</li><li>ä¸€å…± 220 MB çš„æ•°æ®æ¥è¡¨ç¤ºæ•´ä¸ªåŸå¸‚çš„æœ€ä½çº§åˆ« LODï¼Œå¯ä»¥è¢«ä»»ä½•ç³»ç»Ÿè®¿é—®ã€‚<br><img src="/img/GDCSpiderManLighting/Texture.png" alt="Texture"></li><li>ä¸€å¼ è´´å›¾å­˜å‚¨ albedoï¼Œä¸€å¼ ä¸€åŠåˆ†è¾¨ç‡çš„è´´å›¾å­˜å‚¨ specularï¼Œglossï¼Œemissionã€‚</li></ul><h2 id="Light-Grids"><a href="#Light-Grids" class="headerlink" title="Light Grids"></a>Light Grids</h2><p><img src="/img/GDCSpiderManLighting/Grid.png" alt="Grid"></p><ul><li>æ¯ä¸ª 128 x 128 ç±³çš„ Tile è¢«åˆ’åˆ†ä¸ºæ•°ä¸ª 16 x 16 x 16 çš„ capture volumeã€‚</li><li>ç”±å»ºç­‘ç‰©é«˜åº¦å†³å®šç«‹æ–¹ä½“çš„åˆ†å¸ƒã€‚</li><li>ç§»é™¤å»ºç­‘ç‰©å†…éƒ¨çš„ç«‹æ–¹ä½“ã€‚</li><li>Light Grids ä¿¡æ¯ç”Ÿæˆä¸º JSONï¼Œå¼•æ“è¯»å–åè¿›è¡Œé‡‡æ ·å¹¶å­˜å‚¨ä¸º Cache Fileã€‚</li></ul><p><img src="/img/GDCSpiderManLighting/LightGrids.png" alt="LightGrids"></p><ul><li>æ¯ä¸ª capture volume å†… 4096 ä¸ªæ ·æœ¬ï¼Œä¸€ç«‹æ–¹ç±³ä¸€ä¸ªã€‚</li><li>æ¯ä¸ªæ ·æœ¬ç”Ÿæˆæ¯ä¸ªé¢ 256 x 256 åƒç´ çš„ç«‹æ–¹ä½“è´´å›¾ã€‚</li><li>ç„¶åæ¯ä¸ªé¢è¢«å·ç§¯è‡³å•ä¸ª HDR åƒç´ ï¼Œç”¨ä»¥è¡¨ç¤º diffuse å’Œæ–¹å‘ï¼ˆé«˜åº¦å¯å‹ç¼©çš„ï¼‰ã€‚</li></ul><h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><ul><li>è¿˜å­˜åœ¨ä¸€ä¸ª Hibernation ç³»ç»Ÿï¼Œç®€å•æ¥è¯´åªæ˜¯æ‹¥æœ‰ä¸€ä¸ªæ›´è¿œçš„å‰”é™¤å¹³é¢ï¼Œç”¨äºå¤„ç†ä¸€äº›è¢« Impostors ç³»ç»Ÿè®¤ä¸ºè¿‡äºå¤æ‚è€Œè¢«å‰”é™¤çš„ç‰©ä½“ï¼Œæ¯”å¦‚å…¬å›­é‡Œçš„é•¿æ¤…ï¼Œæ¥¼é¡¶çš„ç©ºè°ƒå¤–æœºç­‰ã€‚</li><li>Light Probe çš„æ›´æ–°å¤§çº¦ä¸ºæ¯ç§’ä¸¤æ¬¡ï¼Œå…·ä½“åˆ™ç”±å¼•æ“çš„ä»»åŠ¡ç³»ç»Ÿè°ƒåº¦ã€‚</li><li>ä¸€å…±æœ‰ 4 ä»½ Light Grid æ•°æ®æ¥æè¿°ä¸€æ•´å¤©ä¸­çš„æ¼«åå°„ä¿¡æ¯ï¼Œåˆ†åˆ«ä¸ºæ­£åˆï¼Œé˜´å¤©ï¼Œé»æ˜&#x2F;é»„æ˜ï¼Œå¤œæ™šï¼Œ</li><li>æ¯ä¸ª Probe å­˜å‚¨ä¸€ä»½å¯è§çš„å»ºç­‘åˆ—è¡¨ã€‚</li><li>é€šè¿‡è§†é”¥ä½“ï¼Œç§»åŠ¨æ–¹å‘ï¼Œç§»åŠ¨é€Ÿåº¦æ¥å†³å®šå¦‚ä½•ä¼˜åŒ–åŠ è½½å“ªäº› Tileã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>GDC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GlobalIllumination</tag>
      
      <tag>Rendering</tag>
      
      <tag>Procedural</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½•ä¸ºä¸€ä¸ª C++ é¡¹ç›®</title>
    <link href="/2023/11/09/CppProject/"/>
    <url>/2023/11/09/CppProject/</url>
    
    <content type="html"><![CDATA[<h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><p>å¾…æ•´ç†ï¼Œä½†æ˜¯æœ€è¿‘å‘ç°äº†ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ï¼Œå…ˆè®°ä¸€ä¸‹</p><h2 id="CMAKE-MSVC-RUNTIME-LIBRARY"><a href="#CMAKE-MSVC-RUNTIME-LIBRARY" class="headerlink" title="CMAKE_MSVC_RUNTIME_LIBRARY"></a>CMAKE_MSVC_RUNTIME_LIBRARY</h2><p>ç”¨äºåœ¨ CMakeLists é‡ŒæŒ‡å®š MSVC ä½¿ç”¨çš„è¿è¡Œæ—¶åº“ã€‚</p><ul><li><code>MultiThreaded</code> å¯¹åº” <code>MT</code></li><li><code>MultiThreadedDebug</code> å¯¹åº” <code>MTd</code></li><li><code>MultiThreadedDLL</code> å¯¹åº” <code>MD</code></li><li><code>MultiThreadedDebugDLL</code> å¯¹åº” <code>MDd</code></li></ul><p>æ³¨æ„è¿™é¡¹åŠŸèƒ½ä»…åœ¨ CMake 3.15 ä¹‹åè¢«æ”¯æŒï¼Œè‡³å°‘éœ€è¦ <code>cmake_minimum_required(VERSION 3.15)</code>ã€‚</p><h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">set</span>(CMAKE_MSVC_RUNTIME_LIBRARY <span class="hljs-string">&quot;MultiThreaded$&lt;$&lt;CONFIG:Debug&gt;:Debug&gt;&quot;</span>)<br></code></pre></td></tr></table></figure><p><code>$&lt;$&lt;CONFIG:Debug&gt;:Debug&gt;</code> ä¸ºç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Œæ„ä¸ºâ€œå¦‚æœå½“å‰ä¸º Debugï¼Œè¿”å› Debugï¼Œå¦åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²â€ã€‚<br>è¦æ”¾åœ¨ <code>project</code> ä¹‹å‰æ‰ä¼šç”Ÿæ•ˆã€‚</p><p>åœ¨ 3.15 ä»¥ä¸‹çš„ç‰ˆæœ¬ä¸­è¦å®ç°ç›¸åŒçš„åŠŸèƒ½éœ€è¦ç±»ä¼¼äºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">set</span>(CompilerFlags<br>        CMAKE_CXX_FLAGS<br>        CMAKE_CXX_FLAGS_DEBUG<br>        CMAKE_CXX_FLAGS_RELEASE<br>        CMAKE_C_FLAGS<br>        CMAKE_C_FLAGS_DEBUG<br>        CMAKE_C_FLAGS_RELEASE<br>        )<br>foreach(CompilerFlag $&#123;CompilerFlags&#125;)<br>  <span class="hljs-built_in">string</span>(REPLACE <span class="hljs-string">&quot;/MD&quot;</span> <span class="hljs-string">&quot;/MT&quot;</span> $&#123;CompilerFlag&#125; <span class="hljs-string">&quot;$&#123;$&#123;CompilerFlag&#125;&#125;&quot;</span>)<br>endforeach()<br></code></pre></td></tr></table></figure><p>è¯¦è§ï¼š<br><a href="https://stackoverflow.com/questions/14172856/compile-with-mt-instead-of-md-using-cmake">Compile with &#x2F;MT instead of &#x2F;MD using CMake</a></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_MSVC_RUNTIME_LIBRARY.html">CMAKE_MSVC_RUNTIME_LIBRARY</a><br><a href="https://zhuanlan.zhihu.com/p/429849408">åœ¨ CMake ä¸­è®¾ç½® MSVC è¿è¡Œåº“</a></p><h2 id="ä½¿ç”¨-dumpbin-æŸ¥çœ‹é™æ€åº“çš„ä¾èµ–"><a href="#ä½¿ç”¨-dumpbin-æŸ¥çœ‹é™æ€åº“çš„ä¾èµ–" class="headerlink" title="ä½¿ç”¨ dumpbin æŸ¥çœ‹é™æ€åº“çš„ä¾èµ–"></a>ä½¿ç”¨ dumpbin æŸ¥çœ‹é™æ€åº“çš„ä¾èµ–</h2><p>åœ¨å®‰è£… VS2017 æˆ–ä»¥ä¸Šçš„ç‰ˆæœ¬æ—¶ä¼šè‡ªåŠ¨å®‰è£… dumpbin.exeï¼Œæˆ‘çš„è·¯å¾„åœ¨ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-string">&quot;C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Tools\MSVC\14.37.32822\bin\Hostx64\x64\dumpbin.exe&quot;</span><br></code></pre></td></tr></table></figure><p>å°†å…¶åŠ å…¥ç¯å¢ƒå˜é‡å³å¯åœ¨ä»»æ„ä½ç½®è°ƒç”¨ <code>dumpbin</code>ã€‚</p><h3 id="ç”¨æ³•-1"><a href="#ç”¨æ³•-1" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bat">dumpbin /directives &lt;<span class="hljs-built_in">path</span>&gt;<br></code></pre></td></tr></table></figure><p><img src="/img/CppProject/directives.png" alt="directives"><br>å…¶ä¸­ <code>MT_StaticReleasd</code> å’Œ <code>LIBCMT</code> éƒ½ä»£è¡¨è¯¥æ–‡ä»¶ä½¿ç”¨çš„è¿è¡Œæ—¶åº“ä¸º <code>MT</code>ã€‚<br>å‰©ä½™å¯¹åº”è¯¦è§ <a href="https://learn.microsoft.com/en-us/cpp/c-runtime-library/crt-library-features?view=msvc-170#c-runtime-lib-files">C è¿è¡Œæ—¶ .lib æ–‡ä»¶</a><br><img src="/img/CppProject/CRT.png" alt="directives"></p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>dumpbin çœ‹èµ·æ¥è¿˜æœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œå¯æƒœå®˜æ–¹æ–‡æ¡£å†™çš„ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šï¼š<br><a href="https://learn.microsoft.com/en-us/cpp/build/reference/dumpbin-options?view=msvc-170">DUMPBIN é€‰é¡¹</a></p><h2 id="ä½¿ç”¨-depends-æŸ¥çœ‹åŠ¨æ€åº“çš„ä¾èµ–"><a href="#ä½¿ç”¨-depends-æŸ¥çœ‹åŠ¨æ€åº“çš„ä¾èµ–" class="headerlink" title="ä½¿ç”¨ depends æŸ¥çœ‹åŠ¨æ€åº“çš„ä¾èµ–"></a>ä½¿ç”¨ depends æŸ¥çœ‹åŠ¨æ€åº“çš„ä¾èµ–</h2><p>ä¸€ä¸ªå¼€æºçš„ dll ä¾èµ–åˆ†æè½¯ä»¶ï¼š<br><a href="https://github.com/lucasg/Dependencies">https://github.com/lucasg/Dependencies</a><br>æ‰“å¼€ GUI å°†å¯¹åº” dll æ‹–å…¥ï¼š</p><ul><li><code>msvcp&lt;version&gt;.dll</code> å¯¹åº” <code>/MD</code></li><li><code>msvcp&lt;version&gt;d.dll</code> å¯¹åº” <code>/MDd</code><br>è‡ª VS2017 ä»¥åè¿™ä¸ª version åº”è¯¥æ˜¯ 140ã€‚</li></ul><p>MDï¼š<br><img src="/img/CppProject/MD.png" alt="MD"><br>MTï¼š<br><img src="/img/CppProject/MT.png" alt="MT"></p><h2 id="ABI"><a href="#ABI" class="headerlink" title="ABI"></a>ABI</h2><p><a href="https://zhuanlan.zhihu.com/p/577996608">C++ ABIæ€»ç»“</a></p><ul><li>ä½“ç°åœ¨è·¨ç¼–è¯‘å™¨çš„ link å¤§æ¦‚ç‡æ˜¯å¤±è´¥çš„ï¼Œå› ä¸º C++ ç¼–è¯‘å™¨ä¼šå¯¹ç¬¦å·è¿›è¡Œä¸€ä¸ªâ€œåç§°é‡æ•´â€çš„è¡Œä¸ºä»¥æ»¡è¶³ C++ ä¸­çš„å¤šæ€ï¼Œè€Œä¸åŒç¼–è¯‘å™¨åç§°é‡æ•´çš„é€»è¾‘å®Œå…¨ä¸åŒã€‚ä¸è¿‡å¥½åƒ clang ä¹‹ç±»çš„æ˜¯èƒ½å¤Ÿæä¾›å¯¹å…¶ä»–ç¼–è¯‘å™¨çš„å…¼å®¹çš„ã€‚</li><li>å¦ä¸€ä¸ªæ–¹é¢æ˜¯æ··åˆäº†åŒä¸€ä¸ªç¼–è¯‘å™¨ä¸åŒç‰ˆæœ¬çš„ç¼–è¯‘æµç¨‹ï¼Œæ¯”å¦‚ MSVC è‡ª VS2015 ä¹‹åè¯´ï¼Œæ–°çš„è¿æ¥å™¨å¯ä»¥æ··åˆé“¾æ¥æ—§ç‰ˆ MSVC ç¼–è¯‘å‡ºæ¥çš„åº“æ–‡ä»¶ã€‚<a href="https://learn.microsoft.com/en-us/cpp/porting/binary-compat-2015-2017?view=msvc-170">C++ binary compatibility between Visual Studio versions</a></li><li>è¿˜æœ‰å°±æ˜¯ç¬¬ä¸‰æ–¹åº“åªè¦èƒ½ä¿æŒ ABI å…¼å®¹ï¼Œå³å¯åªæ›´æ–° dll æ–‡ä»¶è€Œä¸ç”¨é‡æ–°ç¼–è¯‘æœ€ç»ˆçš„è¿è¡Œæ–‡ä»¶ã€‚</li><li>å¯¹è™šå‡½æ•°è¡¨çš„é‡æ’åºï¼Œæ·»åŠ åˆ é™¤æˆå‘˜å˜é‡ç­‰éƒ½ä¼šä½¿ ABI å…¼å®¹å¤±æ•ˆï¼Œå› ä¸ºå†…å­˜æ’å¸ƒä¸ä¸€æ ·äº†ï¼Œç„¶åæœ‰ä¸ªä¿æŒ ABI å…¼å®¹çš„æŠ€å·§å«åš Pointer to implementationã€‚<a href="https://en.cppreference.com/w/cpp/language/pimpl">PImpl</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>CPP</tag>
      
      <tag>Engineering</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‘½ä»¤è¡Œè°ƒç”¨ CMake ä¸ MSBuild</title>
    <link href="/2023/10/30/CMakeAndMSBuild/"/>
    <url>/2023/10/30/CMakeAndMSBuild/</url>
    
    <content type="html"><![CDATA[<h2 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a>CMake</h2><p>ä¸€ä¸ª OpenCV çš„ä¾‹å­</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br><br><span class="hljs-built_in">set</span> &quot;ROOT_PATH=%~dp0&quot;<br><span class="hljs-built_in">set</span> &quot;OPENCV_PATH=<span class="hljs-variable">%ROOT_PATH%</span>\Frame\Source\ThirdParty\opencv&quot;<br><span class="hljs-built_in">echo</span> [ opencv ] <span class="hljs-built_in">path</span>: <span class="hljs-variable">%OPENCV_PATH%</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">%OPENCV_PATH%</span><br><br>cmake -B build -D CMAKE_CONFIGURATION_TYPES=&quot;Release;Debug&quot; -D OPENCV_DOWNLOAD_MIRROR_ID=gitcode -D BUILD_TESTS=OFF -D BUILD_PERF_TESTS=OFF -D BUILD_EXAMPLES=OFF -D BUILD_opencv_apps=OFF -D BUILD_opencv_world=ON<br><br>cmake --build build --target opencv_world --config Release<br>cmake --build build --target opencv_world --config Debug<br><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">pause</span><br></code></pre></td></tr></table></figure><h3 id="dp0"><a href="#dp0" class="headerlink" title="%~dp0"></a>%~dp0</h3><p>å½“å‰ batch æ–‡ä»¶çš„è·¯å¾„ã€‚</p><h3 id="cmake-B-build"><a href="#cmake-B-build" class="headerlink" title="cmake -B build"></a>cmake -B build</h3><p>é…ç½®é˜¶æ®µï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ <code>build</code> æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­ç”Ÿæˆä¸€ç³»åˆ— cmake ç¼“å­˜ã€‚<code>-D</code> ä¹‹ç±»çš„é…ç½®æ­£æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µè¿›è¡Œçš„ï¼Œä¸è¿‡ç”±äºç¼“å­˜çš„æœºåˆ¶ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡ <code>-B</code> çš„æ—¶å€™ <code>-D</code> ç­‰é…ç½®æ‰ä¼šç”Ÿæ•ˆã€‚<br>ä»»ä½•æ—¶å€™éƒ½å¯ä»¥é€šè¿‡åˆ é™¤ <code>build/CMakeCache.txt</code> æˆ–æ•´ä¸ª <code>build</code> æ–‡ä»¶å¤¹æ¥åˆ é™¤ç¼“å­˜ï¼Œä»¥ä¾¿é‡æ–°è¿è¡Œ <code>-B</code>ã€‚</p><h3 id="CMAKE-CONFIGURATION-TYPES"><a href="#CMAKE-CONFIGURATION-TYPES" class="headerlink" title="CMAKE_CONFIGURATION_TYPES"></a>CMAKE_CONFIGURATION_TYPES</h3><p>æŒ‡å®šå¤šé…ç½®ç”Ÿæˆå™¨ï¼ˆå¦‚ VSï¼ŒXCodeï¼ŒNinjaï¼‰ä¸Šå¯ç”¨çš„æ„å»ºç±»å‹ï¼Œå¸¸è§æœ‰ <code>Debug</code>, <code>Release</code>, <code>RelWithDebInfo</code> å’Œ <code>MinSizeRel</code>ã€‚<br>ç›¸å¯¹äºç”¨äºæŒ‡å®šå•é…ç½®ç”Ÿæˆå™¨çš„æ„å»ºç±»å‹çš„ <code>CMAKE_BUILD_TYPE</code>ã€‚</p><h3 id="cmake-â€“build-build"><a href="#cmake-â€“build-build" class="headerlink" title="cmake â€“build build"></a>cmake â€“build build</h3><p>ä¼šä½¿ç”¨ build ç›®å½•ä¸‹çš„ CMake ç¼“å­˜ç¼–è¯‘ç›®æ ‡æ–‡ä»¶ã€‚</p><h3 id="â€“target"><a href="#â€“target" class="headerlink" title="â€“target"></a>â€“target</h3><p>ç”¨äºæŒ‡å®šè¦ç¼–è¯‘çš„ç›®æ ‡ï¼Œé»˜è®¤åˆ™ç¼–è¯‘æ‰€æœ‰ç›®æ ‡ã€‚</p><h3 id="â€“config"><a href="#â€“config" class="headerlink" title="â€“config"></a>â€“config</h3><p>ç”¨äºæŒ‡å®šå¤šé…ç½®ç”Ÿæˆå™¨è¦ç¼–è¯‘çš„æ„å»ºç±»å‹ï¼Œå¯¹äºå•é…ç½®ç”Ÿæˆå™¨ä¼šå¿½ç•¥è¯¥é€‰é¡¹ã€‚</p><h2 id="MSBuild"><a href="#MSBuild" class="headerlink" title="MSBuild"></a>MSBuild</h2><p><a href="https://learn.microsoft.com/zh-cn/visualstudio/msbuild/msbuild-command-line-reference?view=vs-2022">MSBuild å‘½ä»¤è¡Œå‚è€ƒ</a><br><a href="https://learn.microsoft.com/zh-cn/visualstudio/msbuild/common-msbuild-project-properties?view=vs-2022">å¸¸ç”¨çš„ MSBuild é¡¹ç›®å±æ€§</a></p><p>åœ¨ windows ä¸­è°ƒç”¨ MSBuild ç¼–è¯‘ç°æˆçš„ .slnã€‚</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-comment">rem Find MSBuild by vswhere</span><br><span class="hljs-built_in">set</span> &quot;VSWHERE_PATH=<span class="hljs-variable">%ProgramFiles(x86)%</span>\Microsoft Visual Studio\Installer\vswhere.exe&quot;<br><span class="hljs-keyword">for</span> /f &quot;usebackq tokens=*&quot; <span class="hljs-variable">%%i</span> <span class="hljs-keyword">in</span> (`&quot;<span class="hljs-variable">%VSWHERE_PATH%</span>&quot; -latest -requires Microsoft.Component.MSBuild -<span class="hljs-built_in">find</span> MSBuild\**\Bin\MSBuild.exe`) <span class="hljs-keyword">do</span> (<br>  <span class="hljs-built_in">set</span> &quot;MSBUILD_PATH=<span class="hljs-variable">%%i</span>&quot;<br>  <span class="hljs-keyword">goto</span> :exitLoop<br>)<br>:exitLoop<br><span class="hljs-built_in">echo</span> Found MSBuild <span class="hljs-built_in">at</span>: <span class="hljs-variable">%MSBUILD_PATH%</span><br><br>&quot;<span class="hljs-variable">%MSBUILD_PATH%</span>&quot; &quot;<span class="hljs-variable">%OPENCV_PATH%</span>\build\OpenCV.sln&quot; -p:Configuration=Debug;Platform=x64<br>&quot;<span class="hljs-variable">%MSBUILD_PATH%</span>&quot; &quot;<span class="hljs-variable">%OPENCV_PATH%</span>\build\OpenCV.sln&quot; -p:Configuration=Release;Platform=x64<br></code></pre></td></tr></table></figure><h3 id="vswhere"><a href="#vswhere" class="headerlink" title="vswhere"></a>vswhere</h3><p><a href="https://github.com/microsoft/vswhere/wiki/Find-MSBuild">vswhere Find MSBuild</a><br>ä¸€ä¸ªç”¨äºæŸ¥æ‰¾ Visual Studio ç›¸å…³è·¯å¾„çš„è½¯ä»¶ï¼Œå½“å®‰è£… 2017 æˆ–æ›´é«˜çš„ VS ç‰ˆæœ¬æ—¶ï¼Œvswhere ä¼šè¢«å®‰è£…åˆ° <code>%ProgramFiles(x86)%\Microsoft Visual Studio\Installer\vswhere.exe</code>ã€‚</p><h3 id="p"><a href="#p" class="headerlink" title="-p"></a>-p</h3><p>p:<code>name</code>&#x3D;<code>value</code>ï¼Œè®¾ç½®æˆ–é‡å†™æŒ‡å®šé¡¹ç›®çº§å±æ€§ï¼Œå¤šä¸ªå±æ€§ä¹‹é—´ç”¨åˆ†å·æˆ–é€—å·åˆ†éš”ã€‚</p><p>PS: æˆ‘å°è¯•è¿‡é€šè¿‡ <code>-p:RuntimeLibrary=MultiThreaded</code> é‡å†™ &#x2F;MT é€‰é¡¹ï¼Œæ²¡æœ‰ç”Ÿæ•ˆï¼Œç½‘ä¸Šä¿¡æ¯ä¹Ÿæ¯”è¾ƒå°‘ã€‚<br><a href="https://stackoverflow.com/questions/38109726/how-to-set-runtime-library-mt-md-configuration-in-msbuild">https://stackoverflow.com/questions/38109726/how-to-set-runtime-library-mt-md-configuration-in-msbuild</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>CPP</tag>
      
      <tag>Engineering</tag>
      
      <tag>CMake</tag>
      
      <tag>MSBuild</tag>
      
      <tag>MSVC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€äº›ç¬¬ä¸‰æ–¹åº“çš„æ„å»ºä¸é›†æˆè®°å½•</title>
    <link href="/2023/10/14/ThirdParty/"/>
    <url>/2023/10/14/ThirdParty/</url>
    
    <content type="html"><![CDATA[<h2 id="Eigen"><a href="#Eigen" class="headerlink" title="Eigen"></a>Eigen</h2><p>çº¯å¤´æ–‡ä»¶åº“ï¼ŒåŒ…å«è·¯å¾„å³å¯ã€‚<br><a href="https://eigen.tuxfamily.org/index.php?title=Main_Page">https://eigen.tuxfamily.org/index.php?title=Main_Page</a><br>GitLabï¼š<br><a href="https://gitlab.com/libeigen/eigen">https://gitlab.com/libeigen/eigen</a><br>GitHub:<br><a href="https://github.com/PX4/eigen">https://github.com/PX4/eigen</a></p><h3 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h3><p>3.4.0 release çš„ .gitignore ç›¸æ¯” GitLab æœ€æ–°çš„ä¸»åˆ†æ”¯å°‘ä¸¤è¡Œï¼š</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-addition">!Eigen/Core</span><br><span class="hljs-addition">!Eigen/src/Core</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥é›†æˆçš„è¯ Core æ–‡ä»¶ä¼šé”™è¯¯åœ°è¢«å¿½ç•¥ã€‚</p><h2 id="OpenCV"><a href="#OpenCV" class="headerlink" title="OpenCV"></a>OpenCV</h2><p><a href="https://github.com/opencv/opencv">https://github.com/opencv/opencv</a></p><h3 id="ä¸‹è½½ä¾èµ–"><a href="#ä¸‹è½½ä¾èµ–" class="headerlink" title="ä¸‹è½½ä¾èµ–"></a>ä¸‹è½½ä¾èµ–</h3><p><em>ä¸‡æ¶çš„ GFW</em></p><ol><li><p>æœ€æ— è„‘çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡é…ç½®<br><code>-DOPENCV_DOWNLOAD_MIRROR_ID=gitcode</code><br>å°†ä¸‹è½½æºæ”¹ä¸º GitCodeï¼Œä¸€ä¸ªå›½å†…ä»£ç æ‰˜ç®¡ç½‘ç«™ã€‚æ¯”è¾ƒä¾èµ–äº OpenCV ä¸­å›½å›¢é˜Ÿå’Œ GitCode å¯¹é•œåƒä»“åº“çš„ç»´æŠ¤ã€‚<a href="https://mp.weixin.qq.com/s/QhtEjXn126bitN9AQ3_s6w">ä¸‹è½½ä¸å†å¡é¡¿ï¼ŒOpenCV ä¸­å›½é•œåƒå¯ç”¨</a><br>ps:<br>ä»–ä»¬è¯´ä» <a href="https://gitcode.net/opencv/opencv">https://gitcode.net/opencv/opencv</a> ä¸‹è½½çš„ä»£ç æ˜¯ä¸ç”¨è¿™æ¡é…ç½®çš„ï¼Œä½†æ˜¯æˆ‘å°è¯• clone ä¸‹æ¥åçœ‹åˆ°äº† <code>Package ADE from mirror gitcode.net is outdated and will be downloaded from github.com instead.</code> çš„è­¦å‘Šã€‚æäº† Issue ä¹Ÿæ²¡ååº”ã€‚<br>ç„¶å GitCode ä¸Šçš„ Release å®é™…ä¸Šåˆæ˜¯éœ€è¦è¿™æ¡é…ç½®çš„ï¼ˆæ„æ€æ˜¯ GitCode Release å’Œ GitHub Release æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œè€Œä¸”ä¸‹è½½æºéƒ½æ˜¯å¤–ç½‘ã€‚ï¼‰<br>æ€»ä¹‹æœ‰ç‚¹æŠ½è±¡ï¼Œå¥½åœ¨ GitHub Latest Release + -DOPENCV_DOWNLOAD_MIRROR_ID&#x3D;gitcode çš„ç»„åˆæ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ã€‚</p></li><li><p>å¼€å¯ä»£ç†å¹¶é…ç½®ç¯å¢ƒå˜é‡<br><a href="https://docs.opencv.org/4.x/db/d05/tutorial_config_reference.html#tutorial_config_reference_general_download">Downloaded dependencies</a></p></li><li><p>æ‰‹åŠ¨ä¸‹è½½ä¾èµ–<br><a href="https://zhuanlan.zhihu.com/p/344036896">Visual Studio + OpenCV + OpenCV_contrib æºä»£ç ç¼–è¯‘æµç¨‹</a></p></li></ol><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p><a href="https://docs.opencv.org/4.x/db/d05/tutorial_config_reference.html">DOC</a></p><ul><li><p>é™æ€ &#x2F; åŠ¨æ€ï¼š<code>BUILD_SHARED_LIBS</code></p></li><li><p>è¿è¡Œæ—¶åº“ï¼š<code>BUILD_WITH_STATIC_CRT</code></p></li><li><p>åªç”Ÿå•ä¸ªåº“æ–‡ä»¶ï¼š<code>BUILD_opencv_world</code></p></li></ul><h2 id="fswatch"><a href="#fswatch" class="headerlink" title="fswatch"></a>fswatch</h2><p><a href="https://github.com/emcrisostomo/fswatch">https://github.com/emcrisostomo/fswatch</a><br>ä¸€ä¸ªä½¿ç”¨ GCC ç¼–è¯‘çš„è·¨å¹³å°æ–‡ä»¶ç›‘è§†å™¨ï¼Œå¼€å‘è€…ä¸å¤ªå…³å¿ƒ Windows ä¸Šçš„ç¼–è¯‘ä½“éªŒï¼Œæ·±æ„Ÿéº»çƒ¦ã€‚</p><h3 id="å®‰è£…-MinGW"><a href="#å®‰è£…-MinGW" class="headerlink" title="å®‰è£… MinGW"></a>å®‰è£… MinGW</h3><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ª Windows GCCï¼Œè‡ªç„¶æ˜¯å…ˆè£… MinGW-W64ã€‚<br>æ¯”èµ·ç›´æ¥è§£å‹ MinGW å†é…ç½®ç¯å¢ƒå˜é‡ï¼Œæ›´æ–¹ä¾¿çš„æ˜¯å…ˆå®‰è£…ä¸€ä¸ª MSYS2ã€‚MSYS2 è‡ªå¸¦ä¸€ä¸ªåŒ…ç®¡ç†å™¨ packmanï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸‹è½½ MinGW ä»¥åŠæ›´å¤šä¹±ä¸ƒå…«ç³Ÿçš„ä¾èµ–ã€‚ä»¥ <code>Windows</code> <code>MSYS2</code> <code>MinGW</code>  <code>GCC</code> ä¸ºå…³é”®è¯æœç´¢åº”è¯¥å°±èƒ½æ‰¾åˆ°ä¸é”™çš„æ•™ç¨‹ã€‚</p><h3 id="é…ç½®-CMake-ç”Ÿæˆå™¨"><a href="#é…ç½®-CMake-ç”Ÿæˆå™¨" class="headerlink" title="é…ç½® CMake ç”Ÿæˆå™¨"></a>é…ç½® CMake ç”Ÿæˆå™¨</h3><p>åœ¨æŒ‡å®šç”Ÿæˆå™¨çš„é˜¶æ®µæˆ‘ä»¬éœ€è¦é€‰æ‹© <code>MinGW Makefiles</code> + <code>Specify native compilers</code>ï¼Œç„¶åå°† C ä¸ C++ çš„ç¼–è¯‘å™¨é…ç½®ä¸º MSYS2 å®‰è£…çš„ gcc.exe ä¸ g++.exe è·¯å¾„ã€‚</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/ThirdParty/generator.png" alt="æŒ‡å®šç”Ÿæˆå™¨"></div><div class="group-image-wrap"><img src="/img/ThirdParty/compiler.png" alt="æŒ‡å®šæœ¬åœ°ç¼–è¯‘å™¨"></div></div></div><p>è·¯å¾„å¤§æ¦‚æ˜¯ <code>C:/msys64/mingw64/bin</code> ä¹‹ç±»çš„ã€‚</p><h3 id="é…ç½®-CMake-ä¾èµ–"><a href="#é…ç½®-CMake-ä¾èµ–" class="headerlink" title="é…ç½® CMake ä¾èµ–"></a>é…ç½® CMake ä¾èµ–</h3><p>Makefile ç”Ÿæˆä¾èµ–äº MSGFMTï¼ŒMSGMERGE ä¸ PTHREADï¼Œå‰ä¸¤ä¸ªéƒ½å±äº Gettextã€‚<br>å¦‚æœçœ‹åˆ°ä»»ä½• <code>NOTFOUND</code> å­—çœ¼ï¼Œç”¨ MSYS2 æœç´¢å¹¶å®‰è£…å¯¹åº”çš„åº“ï¼Œç„¶åé…ç½®å¯¹åº”è·¯å¾„ã€‚</p><h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><p>å›åˆ°æ ¹ç›®å½•æ‰§è¡Œ <code>cmake --build build</code>ï¼Œå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š<br><code>error: &#39;realpath&#39; was not declared in this scope</code><br><code>error: &#39;lstat&#39; was not declared in this scope; did you mean &#39;wstat&#39;?</code><br>ç»“æœè¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªé—ç•™ bugï¼Œä¸ƒå¹´æ²¡ä¿®ï¼š<br><a href="https://github.com/emcrisostomo/fswatch/issues/121">https://github.com/emcrisostomo/fswatch/issues/121</a><br>æœ€ç»ˆæ˜¯æ”¾å¼ƒäº†è¿™ä¸ªåº“çš„é›†æˆè½¬è€Œä½¿ç”¨äº† <a href="https://github.com/septag/dmon">dmon</a>ã€‚</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://zhuanlan.zhihu.com/p/401188789">ç»™èŒæ–°çš„ C&#x2F;C++ ç¯å¢ƒæ­å»ºæ”»ç•¥ï¼ˆVSCode å’Œ MSYS2ï¼‰</a><br><a href="https://zhuanlan.zhihu.com/p/448884264">æ‹ä¸€æ‹ gcc &#x2F; g++ &#x2F; MingW &#x2F; MSVC ä¸ make &#x2F; CMake çš„å…³ç³»</a><br><a href="https://github.com/FrankHB/pl-docs/blob/master/zh-CN/mingw-vs-mingw-v64.md">[ç§‘æ™®][FAQ] MinGW vs MinGW-W64 åŠå…¶å®ƒ</a></p><h2 id="GLEW"><a href="#GLEW" class="headerlink" title="GLEW"></a>GLEW</h2><p><a href="https://glew.sourceforge.net/index.html">https://glew.sourceforge.net/index.html</a><br>OpenGL æ‰©å±•åº“ã€‚</p><h3 id="é™æ€-åŠ¨æ€"><a href="#é™æ€-åŠ¨æ€" class="headerlink" title="é™æ€ &#x2F; åŠ¨æ€"></a>é™æ€ &#x2F; åŠ¨æ€</h3><p>CMake ä¼šç”Ÿæˆ <code>glew</code> å’Œ <code>glew_s</code> ä¸¤ä¸ªé¡¹ç›®ï¼Œåˆ†åˆ«å¯¹åº”äº†åŠ¨æ€ä¸é™æ€çš„ç”Ÿæˆç›®æ ‡ã€‚<br>ç„¶åä½¿ç”¨é™æ€åº“æ—¶ï¼Œè¦åœ¨åŒ…å« GLEW å¤´æ–‡ä»¶ä¹‹å‰å®šä¹‰ <code>GLEW_STATIC</code> è¿™ä¸ªå®ï¼Œå†™åœ¨é¡¹ç›®é…ç½®é‡Œæ¯”è¾ƒå¥½ã€‚</p><h3 id="gitignore-1"><a href="#gitignore-1" class="headerlink" title=".gitignore"></a>.gitignore</h3><p>è¦æ³¨æ„ä¸€ä¸‹ glew ä»“åº“é‡Œå°±æœ‰ä¸€ä¸ª <code>build</code> æ–‡ä»¶å¤¹ï¼ŒCMakeLists ä¹Ÿåœ¨é‡Œé¢ï¼Œæ€»è§‰å¾—ä¸å¤ªåˆç†ï¼Œä½ å«ä¸ªä»€ä¹ˆ <code>builds</code> éƒ½æ¯”è¿™å¥½ã€‚<br>å¦‚æœä½ çš„ä»“åº“å¿½ç•¥äº†æ‰€æœ‰å«åš <code>build</code> çš„æ–‡ä»¶å¤¹çš„ï¼Œå°å¿ƒè¿™ä¸ªæ–‡ä»¶å¤¹ä¹Ÿè¢«å¿½ç•¥æ‰ã€‚</p><h2 id="spdlog"><a href="#spdlog" class="headerlink" title="spdlog"></a>spdlog</h2><p><a href="https://github.com/gabime/spdlog">https://github.com/gabime/spdlog</a><br>æ”¯æŒçº¯å¤´æ–‡ä»¶ &#x2F; ç¼–è¯‘ä¸¤ç§æ–¹å¼ã€‚</p><h3 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h3><p>æœ€è¿‘ MSVC å°† <code>stdext::checked_array_iterator</code> æ ‡è®°ä¸ºäº†å·²å¼ƒç”¨ï¼Œfmt ç”¨åˆ°äº†è¿™ä¸ªå‡½æ•°ï¼Œè€Œ spdlog é»˜è®¤ç”¨åˆ°äº† fmtã€‚è¿™é‡Œæœ‰å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p><h4 id="1-å±è”½è¿™ä¸ªè­¦å‘Š"><a href="#1-å±è”½è¿™ä¸ªè­¦å‘Š" class="headerlink" title="1. å±è”½è¿™ä¸ªè­¦å‘Š"></a>1. å±è”½è¿™ä¸ªè­¦å‘Š</h4><p>ä¸ºé¡¹ç›®è®¾ç½® <code>_SILENCE_STDEXT_ARR_ITERS_DEPRECATION_WARNING</code> å®ã€‚</p><h4 id="2-å°†-spdlog-æ›´æ–°è‡³-v2-x"><a href="#2-å°†-spdlog-æ›´æ–°è‡³-v2-x" class="headerlink" title="2. å°† spdlog æ›´æ–°è‡³ v2.x"></a>2. å°† spdlog æ›´æ–°è‡³ v2.x</h4><p>fmt å·²ç»ä¿®å¤äº†è¿™ä¸ª bugï¼Œä½† spdlog ä½œè€…è¯´ä¸ºäº†å‘åå…¼å®¹ï¼Œspdlog v1.x æ— æ³•æ›´æ–° fmtã€‚<br>v2.x ä¼¼ä¹ä»åœ¨å¼€å‘ä¸­ã€‚</p><h4 id="3-ä¸º-spdlog-æŒ‡å®šå¤–éƒ¨çš„-fmt"><a href="#3-ä¸º-spdlog-æŒ‡å®šå¤–éƒ¨çš„-fmt" class="headerlink" title="3. ä¸º spdlog æŒ‡å®šå¤–éƒ¨çš„ fmt"></a>3. ä¸º spdlog æŒ‡å®šå¤–éƒ¨çš„ fmt</h4><p>å¼€å¯ <code>SPDLOG_FMT_EXTERNAL</code> æˆ– <code>SPDLOG_FMT_EXTERNAL_HO</code> å®ï¼Œæ‰‹åŠ¨æ›´æ–° fmtã€‚<br>spdlog ä½¿ç”¨ <code>find_package</code> æŸ¥æ‰¾ fmtï¼Œæˆ‘ä»¬éœ€è¦å…ˆç”Ÿæˆ fmtï¼Œå¾—åˆ° <code>fmt-config.cmake</code> æ–‡ä»¶ï¼Œç„¶åå°†å…¶æ‰€åœ¨è·¯å¾„æ·»åŠ è‡³ <code>CMAKE_PREFIX_PATH</code> æˆ– <code>fmt_DIR</code>ï¼Œä¸¤è€…éƒ½å¯ä»¥ç”¨ -D æŒ‡ä»¤æ·»åŠ ã€‚<br>é¡¹ç›®ä¸­è¦åŒ…å« fmt çš„å¤´æ–‡ä»¶ï¼Œè®°å¾—ä¸è¦æŠŠ spdlog bundled çš„ fmt æ–‡ä»¶åŒ…å«è¿›é¡¹ç›®ã€‚<br>åœ¨é¡¹ç›®å†…è¿˜è¦æ‰‹åŠ¨å®šä¹‰ <code>SPDLOG_FMT_EXTERNAL</code> å’Œ <code>SPDLOG_COMPILED_LIB</code> ä¸¤ä¸ªå®ã€‚<br>å¦‚æœç¼–è¯‘ spdlog æ—¶ç”¨çš„æ˜¯ <code>SPDLOG_FMT_EXTERNAL_HO</code>ï¼Œé¡¹ç›®ä¸­è¦å®šä¹‰ <code>FMT_HEADER_ONLY</code> å®ã€‚</p><h4 id="4-ä½¿ç”¨-std-format-ä»£æ›¿-fmt"><a href="#4-ä½¿ç”¨-std-format-ä»£æ›¿-fmt" class="headerlink" title="4. ä½¿ç”¨ std::format ä»£æ›¿ fmt"></a>4. ä½¿ç”¨ <code>std::format</code> ä»£æ›¿ fmt</h4><p>å¼€å¯ <code>SPDLOG_USE_STD_FORMAT</code> å®å³å¯ã€‚</p><h3 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p><code>SPDLOG_NO_EXCEPTIONS</code></p><h2 id="yaml-cpp"><a href="#yaml-cpp" class="headerlink" title="yaml-cpp"></a>yaml-cpp</h2><p><a href="https://github.com/jbeder/yaml-cpp">https://github.com/jbeder/yaml-cpp</a><br>YAML è§£æåº“</p><h3 id="é…ç½®-2"><a href="#é…ç½®-2" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><ul><li>è¿è¡Œæ—¶åº“ï¼š<code>YAML_MSVC_SHARED_RT</code></li><li>é™æ€åº“éœ€è¦çš„å®å®šä¹‰ <code>YAML_CPP_STATIC_DEFINE</code></li></ul><h2 id="shaderc"><a href="#shaderc" class="headerlink" title="shaderc"></a>shaderc</h2><p>é›†æˆäº† glslang, SPIRV-Tools å’Œä¸€äº›å…¶ä»–å°åŠŸèƒ½ã€‚<br><a href="https://github.com/google/shaderc">https://github.com/google/shaderc</a></p><h3 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h3><p>æ²¡æœ‰ Releaseï¼Œä½†æ˜¯æœ‰ Tagï¼Œcommit message ä¹Ÿæœ‰å†™ <code>Finalize Shaderc v2024.2</code> ä¹‹ç±»çš„ã€‚</p><h3 id="ä¸‹è½½ä¾èµ–-1"><a href="#ä¸‹è½½ä¾èµ–-1" class="headerlink" title="ä¸‹è½½ä¾èµ–"></a>ä¸‹è½½ä¾èµ–</h3><p>æ‰§è¡Œ python è„šæœ¬ä¸‹è½½ä¾èµ– <code>/utils/git-sync-deps</code></p><h3 id="é…ç½®-3"><a href="#é…ç½®-3" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><ul><li>é™æ€ &#x2F; åŠ¨æ€ï¼š<code>BUILD_SHARED_LIBS</code></li><li>è¿è¡Œæ—¶åº“ï¼š<code>SHADERC_ENABLE_SHARED_CRT</code></li></ul><h3 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h3><p>åŒ…å«äº†æ‰€æœ‰åŠŸèƒ½çš„é™æ€åº“ build&#x2F;libshaderc&#x2F;libshaderc_combined.lib</p><h2 id="SPIRV-Cross"><a href="#SPIRV-Cross" class="headerlink" title="SPIRV-Cross"></a>SPIRV-Cross</h2><p>SPIRV åç¼–è¯‘åº“<br><a href="https://github.com/KhronosGroup/SPIRV-Cross">https://github.com/KhronosGroup/SPIRV-Cross</a></p><h3 id="ç‰ˆæœ¬-1"><a href="#ç‰ˆæœ¬-1" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h3><p>æ²¡æœ‰ Releaseï¼Œåªæœ‰ Tag</p><h3 id="é…ç½®-4"><a href="#é…ç½®-4" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><ul><li>é™æ€ &#x2F; åŠ¨æ€ï¼š<code>SPIRV_CROSS_SHARED</code>, <code>SPIRV_CROSS_STATIC</code></li><li>è¿è¡Œæ—¶åº“ï¼šæ²¡æœ‰ Cmake é…ç½®ï¼Œåªèƒ½æ”¹ CMakeLists</li></ul><h3 id="é“¾æ¥-1"><a href="#é“¾æ¥-1" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h3><p><code>spirv-cross-core</code>, <code>spirv-cross-glsl</code>, <code>spirv-cross-hlsl</code>, <code>spirv-cross-msl</code></p><h2 id="SDL"><a href="#SDL" class="headerlink" title="SDL"></a>SDL</h2><h3 id="åŠ¨æ€åº“"><a href="#åŠ¨æ€åº“" class="headerlink" title="åŠ¨æ€åº“"></a>åŠ¨æ€åº“</h3><p>å®˜æ–¹æ¨èç¼–è¯‘ä¸ºåŠ¨æ€åº“ï¼Œå®é™…ä¸Šç¼–è¯‘ä¸ºé™æ€åº“æ—¶éœ€è¦æ‰‹åŠ¨é“¾æ¥å‡ ä¸ªä¾èµ–åº“ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ CMake logã€‚</p><h3 id="SDL-config-h"><a href="#SDL-config-h" class="headerlink" title="SDL_config.h"></a>SDL_config.h</h3><p>SDL ä¼šåœ¨ build ç›®å½•ä¸‹ç”Ÿæˆä¸åŒé…ç½®çš„ SDL_config.hï¼Œæˆ‘ä»¬éœ€è¦åœ¨å·¥ç¨‹é‡ŒåŒ…å«è¿™ä¸ªè·¯å¾„ï¼š<code>\build\include-config-release\SDL2\SDL_config.h</code></p><h2 id="Assimp"><a href="#Assimp" class="headerlink" title="Assimp"></a>Assimp</h2><h3 id="é…ç½®-5"><a href="#é…ç½®-5" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><ul><li>é™æ€ &#x2F; åŠ¨æ€ï¼š<code>BUILD_SHARED_LIBS</code></li><li>è¿è¡Œæ—¶åº“ï¼š<code> USE_STATIC_CRT</code></li></ul><h3 id="config-h"><a href="#config-h" class="headerlink" title="config.h"></a>config.h</h3><p>assimp ä¼šåœ¨ build ç›®å½•ä¸‹ç”Ÿæˆ config.hï¼Œæˆ‘ä»¬éœ€è¦åœ¨å·¥ç¨‹é‡ŒåŒ…å«è¿™ä¸ªè·¯å¾„ï¼š<code>\build\include\assimp\config.h</code></p><h3 id="zlib"><a href="#zlib" class="headerlink" title="zlib"></a>zlib</h3><p>è¿˜éœ€è¦æ‰‹åŠ¨é“¾æ¥ zlibï¼Œè¿™ä¸ªåº“ä¼šè¢«é»˜è®¤ç¼–è¯‘è‡³ <code>\build\contrib\zlib</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>Engineering</tag>
      
      <tag>CMake</tag>
      
      <tag>Eigen</tag>
      
      <tag>fswatch</tag>
      
      <tag>GLEW</tag>
      
      <tag>OpenCV</tag>
      
      <tag>Premake</tag>
      
      <tag>shaderc</tag>
      
      <tag>spdlog</tag>
      
      <tag>SPIRV-Cross</tag>
      
      <tag>yaml-cpp</tag>
      
      <tag>SDL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GAMES101 æ‹¾é—</title>
    <link href="/2023/10/13/GAMES101Review/"/>
    <url>/2023/10/13/GAMES101Review/</url>
    
    <content type="html"><![CDATA[<h2 id="Lecture-02-Review-of-Linear-Algebra"><a href="#Lecture-02-Review-of-Linear-Algebra" class="headerlink" title="Lecture 02 Review of Linear Algebra"></a>Lecture 02 Review of Linear Algebra</h2><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES101Review/dot.png" alt="ç‚¹ä¹˜"></div><div class="group-image-wrap"><img src="/img/GAMES101Review/cross.png" alt="å‰ä¹˜"></div></div></div><p>å¯¹äºä¸€ä¸ª vec4ï¼Œä¸€èˆ¬è®¤ä¸º w åˆ†é‡ä¸º 1 æ—¶è¡¨ç¤ºç‚¹ï¼Œw åˆ†é‡ ä¸º 0 æ—¶è¡¨ç¤ºå‘é‡ã€‚<br>ä¹Ÿç¬¦åˆâ€œç‚¹ - ç‚¹ &#x3D; å‘é‡â€</p><h2 id="Lecture-04-Transformation-Cont"><a href="#Lecture-04-Transformation-Cont" class="headerlink" title="Lecture 04 Transformation Cont."></a>Lecture 04 Transformation Cont.</h2><h3 id="æ—‹è½¬"><a href="#æ—‹è½¬" class="headerlink" title="æ—‹è½¬"></a>æ—‹è½¬</h3><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES101Review/rotation.png" alt="ç»•è½´æ—‹è½¬"></div><div class="group-image-wrap"><img src="/img/GAMES101Review/rotationn.png" alt="ç»•ä»»æ„è½´æ—‹è½¬"></div></div></div><h3 id="ç›¸æœºå®šä¹‰"><a href="#ç›¸æœºå®šä¹‰" class="headerlink" title="ç›¸æœºå®šä¹‰"></a>ç›¸æœºå®šä¹‰</h3><ul><li>ä½ç½®ï¼še</li><li>çœ‹å‘ï¼šg</li><li>å¤´é¡¶ï¼št</li></ul><h3 id="Frustum-å®šä¹‰"><a href="#Frustum-å®šä¹‰" class="headerlink" title="Frustum å®šä¹‰"></a>Frustum å®šä¹‰</h3><ul><li>$tan\frac{fovY}{2} &#x3D; \frac{t}{|n|}$</li><li>$aspect &#x3D; \frac{r}{t}$</li></ul><h3 id="View-çŸ©é˜µ"><a href="#View-çŸ©é˜µ" class="headerlink" title="View çŸ©é˜µ"></a>View çŸ©é˜µ</h3><p>å°†ç›¸æœºå˜æ¢è‡³â€œä½äºåŸç‚¹ï¼Œçœ‹å‘ -Zï¼Œå¤´é¡¶ä¸º +Yâ€<br>å…ˆç§»åŠ¨è‡³åŸç‚¹ï¼Œå†æ—‹è½¬<br>$M_{view}&#x3D;R_{view}T_{view}$</p><p>$T_{view}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  1 &amp; 0 &amp; 0 &amp; -x_e \<br>  0 &amp; 1 &amp; 0 &amp; -y_e \<br>  0 &amp; 0 &amp; 1 &amp; -z_e \<br>  0 &amp; 0 &amp; 0 &amp; 1 \<br>  \end{pmatrix}<br>$$</p><p>ç”± $R_{view}^{-1}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  x_{g \times t} &amp; x_t &amp; x_{-g} &amp; 0 \<br>  y_{g \times t} &amp; y_t &amp; y_{-g} &amp; 0 \<br>  z_{g \times t} &amp; z_t &amp; z_{-g} &amp; 0 \<br>  0 &amp; 0 &amp; 0 &amp; 1 \<br>  \end{pmatrix}<br>$$<br>å¾— $R_{view}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  x_{g \times t} &amp; y_{g \times t} &amp; z_{g \times t} &amp; 0 \<br>  x_t &amp; y_t &amp; z_t &amp; 0 \<br>  x_{-g} &amp; y_{-g} &amp; z_{-g} &amp; 0 \<br>  0 &amp; 0 &amp; 0 &amp; 1 \<br>  \end{pmatrix}<br>$$</p><h3 id="Projection-çŸ©é˜µ"><a href="#Projection-çŸ©é˜µ" class="headerlink" title="Projection çŸ©é˜µ"></a>Projection çŸ©é˜µ</h3><p>å…ˆé€è§†ï¼Œå†æ­£äº¤ï¼ˆFrustum -&gt; é•¿æ–¹ä½“ -&gt; æ­£æ–¹ä½“ï¼‰<br>$M_{Projection}&#x3D;M_{Orthographic}M_{PersprctiveToOrthographic}$</p><p>$M_{p2o}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  n &amp; 0 &amp; 0 &amp; 0 \<br>  0 &amp; n &amp; 0 &amp; 0 \<br>  0 &amp; 0 &amp; n+f &amp; -nf \<br>  0 &amp; 0 &amp; 1 &amp; 0 \<br>  \end{pmatrix}<br>$$</p><p>$M_{Orthographic}&#x3D;M_{rotate}M_{trans}$</p><p>$M_{trans}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  1 &amp; 0 &amp; 0 &amp; -\frac{r+l}{2} \<br>  0 &amp; 1 &amp; 0 &amp; -\frac{t+b}{2} \<br>  0 &amp; 0 &amp; 1 &amp; -\frac{n+f}{2} \<br>  0 &amp; 0 &amp; 0 &amp; 1 \<br>  \end{pmatrix}<br>$$</p><p>$M_{rotate}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  \frac{2}{r-l} &amp; 0 &amp; 0 &amp; 0 \<br>  0 &amp; \frac{2}{t-b} &amp; 0 &amp; 0 \<br>  0 &amp; 0 &amp; \frac{2}{n-f} &amp; 0 \<br>  0 &amp; 0 &amp; 0 &amp; 1 \<br>  \end{pmatrix}<br>$$</p><h3 id="Viewport-è§†å£å˜æ¢"><a href="#Viewport-è§†å£å˜æ¢" class="headerlink" title="Viewport è§†å£å˜æ¢"></a>Viewport è§†å£å˜æ¢</h3><p>$M_{viewport}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  \frac{width}{2} &amp; 0 &amp; 0 &amp; \frac{width}{2} \<br>  0 &amp; \frac{height}{2} &amp; 0 &amp; \frac{height}{2} \<br>  0 &amp; 0 &amp; 1 &amp; 0 \<br>  0 &amp; 0 &amp; 0 &amp; 1 \<br>  \end{pmatrix}<br>$$</p><h2 id="Lecture-09-Shading-3-Texture-Mapping-Cont"><a href="#Lecture-09-Shading-3-Texture-Mapping-Cont" class="headerlink" title="Lecture 09 Shading 3(Texture Mapping Cont.)"></a>Lecture 09 Shading 3(Texture Mapping Cont.)</h2><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES101Review/bc.png" alt="é‡å¿ƒåæ ‡"></div><div class="group-image-wrap"><img src="/img/GAMES101Review/bc2.png" alt="é‡å¿ƒåæ ‡"></div><div class="group-image-wrap"><img src="/img/GAMES101Review/bi.png" alt="åŒçº¿æ€§æ’å€¼"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES101Review/mm.png" alt="Mipmap"></div><div class="group-image-wrap"><img src="/img/GAMES101Review/ti.png" alt="ä¸‰çº¿æ€§æ’å€¼"></div><div class="group-image-wrap"><img src="/img/GAMES101Review/bm.png" alt="Bump"></div></div></div><p>å½“é‡å¿ƒåæ ‡ç›¸åŠ ä¸º 1 ä¸”å…¨éƒ¨åœ¨ [0, 1] çš„èŒƒå›´å†…ï¼Œå³ä»£è¡¨ç‚¹åœ¨ä¸‰è§’å½¢å†…ã€‚</p><h2 id="Lecture-13-Ray-Tracing-1"><a href="#Lecture-13-Ray-Tracing-1" class="headerlink" title="Lecture 13 Ray Tracing 1"></a>Lecture 13 Ray Tracing 1</h2><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES101Review/rayplane.png" alt="å°„çº¿å¹³é¢ç›¸äº¤"></div><div class="group-image-wrap"><img src="/img/GAMES101Review/aa.png" alt="è½´å¯¹é½çš„ç®€åŒ–"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES101Review/moller.png" alt="Moller Trumbore ç®—æ³•"></div></div></div><h3 id="æ±‚å°„çº¿ä¸-AABB-æ±‚äº¤"><a href="#æ±‚å°„çº¿ä¸-AABB-æ±‚äº¤" class="headerlink" title="æ±‚å°„çº¿ä¸ AABB æ±‚äº¤"></a>æ±‚å°„çº¿ä¸ AABB æ±‚äº¤</h3><ul><li>å¯¹ä¸‰ä¸ªè½´æ¯ä¸€å¯¹å¹³é¢ï¼Œè®¡ç®— $t_{min}$ ä¸ $t_{max}$ï¼Œè´Ÿå€¼ä¹Ÿ OKã€‚</li><li>å¯¹äº AABBï¼Œ$t_{enter} &#x3D; max(t_{min})$ï¼Œ$t_{exit} &#x3D; min(t_{max})$ã€‚</li><li>å½“ä¸”ä»…å½“ $t_{enter} &lt; t_{exit}$ &amp;&amp; $t_{exit} &gt;&#x3D; 0$ æ—¶å°„çº¿ä¸ AABB ç›¸äº¤ã€‚</li></ul><h2 id="Lecture-15-Ray-Tracing-3"><a href="#Lecture-15-Ray-Tracing-3" class="headerlink" title="Lecture 15 Ray Tracing 3"></a>Lecture 15 Ray Tracing 3</h2><p><a href="https://roeas.github.io/2021/09/14/Radiometry/">è¾å°„åº¦é‡å­¦åŸºç¡€</a></p><h2 id="Lecture-16-Ray-Tracing-4"><a href="#Lecture-16-Ray-Tracing-4" class="headerlink" title="Lecture 16 Ray Tracing 4"></a>Lecture 16 Ray Tracing 4</h2><h3 id="è’™ç‰¹å¡æ´›ç§¯åˆ†"><a href="#è’™ç‰¹å¡æ´›ç§¯åˆ†" class="headerlink" title="è’™ç‰¹å¡æ´›ç§¯åˆ†"></a>è’™ç‰¹å¡æ´›ç§¯åˆ†</h3><p>$L_o(p,\omega_o)$</p><p>$&#x3D;\int_{H^2}L_i(p, \omega_i)f_r(p, \omega_i, \omega_o)(n\cdot \omega_i)d\omega_i$</p><p>$\approx\frac{1}{N}\sum^N_{i&#x3D;1}\frac{L_i(p, \omega_i)f_r(p, \omega_i, \omega_o)(n\cdot \omega_i)}{p(\omega_i)}$</p><h3 id="Light-Sampling"><a href="#Light-Sampling" class="headerlink" title="Light Sampling"></a>Light Sampling</h3><p><img src="/img/GAMES101Review/LightSampling.png" alt="LightSampling"></p><h3 id="Path-Tracing"><a href="#Path-Tracing" class="headerlink" title="Path Tracing"></a>Path Tracing</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs 1c">shade<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> wo<span class="hljs-punctuation">)</span><br>  <span class="hljs-comment">// æ¥è‡ªå…‰æºçš„è´¡çŒ®</span><br>  å‡åŒ€åœ°é‡‡æ · x&#x27; å¤„çš„å…‰æºï¼ˆpdf_light = 1 / Aï¼‰<br>  å¦‚æœ p ç‚¹å’Œ x&#x27; ç‚¹ä¹‹é—´æ²¡æœ‰é®æŒ¡<br>    L_dir <span class="hljs-punctuation">=</span> L_i * f_r * <span class="hljs-built_in">cos</span>Î¸ * <span class="hljs-built_in">cos</span>Î¸&#x27; / |x&#x27; <span class="hljs-punctuation">-</span> p<span class="hljs-string">|^2 / pdf_light</span><br><br>  <span class="hljs-comment">// æ¥è‡ªå…¶ä»–è¡¨é¢çš„è´¡çŒ®</span><br>  å¦‚æœé€šè¿‡ä»¥æ¦‚ç‡ P_RR è¿›è¡Œçš„è½®ç›˜èµŒæµ‹è¯•<br>    å‡åŒ€åœ°é‡‡æ ·åŠçƒï¼ˆpdf_hemi <span class="hljs-punctuation">=</span> <span class="hljs-number">1</span> / <span class="hljs-number">2</span>piï¼‰<br>    è¿½è¸ªå…‰çº¿ r<span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">,</span> wi<span class="hljs-punctuation">)</span><br>    å¦‚æœåœ¨ q ç‚¹å‡»ä¸­éå…‰æºè¡¨é¢<br>      L_indir <span class="hljs-punctuation">=</span> shade<span class="hljs-punctuation">(</span>q<span class="hljs-punctuation">,</span> <span class="hljs-punctuation">-</span>wi<span class="hljs-punctuation">)</span> * f_r * <span class="hljs-built_in">cos</span>Î¸ / pdf_hemi / P_RR<br><br>  return L_dir <span class="hljs-punctuation">+</span> L_indir<br></code></pre></td></tr></table></figure><h3 id="Lambertian-è¡¨é¢çš„çš„-BRDF"><a href="#Lambertian-è¡¨é¢çš„çš„-BRDF" class="headerlink" title="Lambertian è¡¨é¢çš„çš„ BRDF"></a>Lambertian è¡¨é¢çš„çš„ BRDF</h3><p><img src="/img/GAMES101Review/Lambertian.png" alt="Lambertian"></p><h2 id="Lecture-19-Cameras-Lenses-and-Light-Fields"><a href="#Lecture-19-Cameras-Lenses-and-Light-Fields" class="headerlink" title="Lecture 19 Cameras, Lenses and Light Fields"></a>Lecture 19 Cameras, Lenses and Light Fields</h2><p><img src="/img/GAMES101Review/gaussian.png" alt="Gaussian"></p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES101Review/CoC.png" alt="Coc"></div><div class="group-image-wrap"><img src="/img/GAMES101Review/CoC2.png" alt="Coc2"></div></div></div><p><img src="/img/GAMES101Review/DoF.png" alt="DoF"></p>]]></content>
    
    
    
    <tags>
      
      <tag>Math</tag>
      
      <tag>Rendering</tag>
      
      <tag>RayTracing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GitHub å·¥ä½œæµ</title>
    <link href="/2023/07/22/GitHub/"/>
    <url>/2023/07/22/GitHub/</url>
    
    <content type="html"><![CDATA[<h2 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h2><p>&emsp;&emsp;ä¸€äº›å·¥ä½œä¸­å¸¸ç”¨çš„ git &#x2F; GitHub æ¦‚å¿µæ•´ç†ã€‚</p><h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p><a href="https://zhuanlan.zhihu.com/p/51331026">å¦‚ä½•ä¸ºè‡ªå·±çš„ Github é¡¹ç›®é€‰æ‹©å¼€æºè®¸å¯è¯ï¼Ÿ</a></p><h2 id="åˆ†æ”¯ä¸å¼€å‘"><a href="#åˆ†æ”¯ä¸å¼€å‘" class="headerlink" title="åˆ†æ”¯ä¸å¼€å‘"></a>åˆ†æ”¯ä¸å¼€å‘</h2><p>å¯¹äºæ­£è§„ä¸€ç‚¹çš„ä»“åº“ï¼Œmain branch é€šå¸¸æ˜¯å—ä¿æŠ¤çš„ï¼Œè€Œæˆ‘ä»¬çš„æäº¤ä¸æ¨é€éƒ½åœ¨å•ç‹¬çš„ branch ä¸Šè¿›è¡Œã€‚</p><h3 id="æŸ¥çœ‹åˆ†æ”¯"><a href="#æŸ¥çœ‹åˆ†æ”¯" class="headerlink" title="æŸ¥çœ‹åˆ†æ”¯"></a>æŸ¥çœ‹åˆ†æ”¯</h3><ul><li><code>git branch</code> æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯</li><li><code>git branch -r</code> æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</li><li><code>git branch -a</code> æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯</li></ul><p>æ³¨æ„ï¼šå¦‚æœè¿œç¨‹æ–°å»ºäº† branchï¼Œåœ¨æœ¬åœ°è¿è¡Œ <code>git remote update origin</code> ä¹‹å‰ï¼Œæ–°çš„ branch æ˜¯ä¸ä¼šæ˜¾ç¤ºåœ¨ <code>git branch -r</code> ä¸Šçš„ã€‚é¡ºä¾¿åœ¨ä»»æ„ branch ä¸Šçš„ <code>git pull</code> ä¹Ÿèƒ½å®ç°è¿™ä¸€æ•ˆæœã€‚</p><h3 id="æ“ä½œåˆ†æ”¯"><a href="#æ“ä½œåˆ†æ”¯" class="headerlink" title="æ“ä½œåˆ†æ”¯"></a>æ“ä½œåˆ†æ”¯</h3><ul><li><code>git branch &lt;Name&gt;</code> åˆ›å»ºæ–°çš„æœ¬åœ°åˆ†æ”¯ï¼Œä¸ä¼š checkout</li><li><code>git branch -m &lt;OldName&gt; &lt;NewName&gt;</code> é‡å‘½åæœ¬åœ°åˆ†æ”¯</li><li><code>git branch -d &lt;Name&gt;</code> åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼Œä¸èƒ½åˆ é™¤å½“å‰åˆ†æ”¯</li><li><code>git branch -d -r &lt;Name&gt;</code> åˆ é™¤è¿œç¨‹åˆ†æ”¯</li></ul><h3 id="å…³è”åˆ†æ”¯"><a href="#å…³è”åˆ†æ”¯" class="headerlink" title="å…³è”åˆ†æ”¯"></a>å…³è”åˆ†æ”¯</h3><ul><li><code>git branch --set-upstream-to=origin/&lt;RemoteName&gt; &lt;LocalName&gt;</code> å°†æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯å…³è”èµ·æ¥</li><li><code>git push --set-upstream origin &lt;RemoteName&gt;</code> åœ¨è¿œç¨‹æ–°å»ºåˆ†æ”¯ï¼Œå¹¶å°†å½“å‰åˆ†æ”¯ä¸è¿œç¨‹æ–°åˆ†æ”¯å…³è”å¹¶æ¨é€ã€‚</li></ul><p>å½“ç„¶æœ€ç®€å•çš„å‘½ä»¤æ˜¯æœ¬åœ°è¯†åˆ«åˆ°è¿œç¨‹æ–°åˆ†æ”¯åç›´æ¥ï¼š<br><code>git checkout &lt;RemoteName&gt;</code><br>è¿™ä¸ªå‘½ä»¤ç›¸å½“äº<br><code>git checkout -b &lt;LocalName&gt; origin/&lt;RemoteName&gt;</code><br>å³åœ¨æœ¬åœ°æ–°å»ºåˆ†æ”¯ï¼Œå¹¶ä¸”åˆ‡æ¢è¿‡å»ï¼Œå¹¶ä¸”ä¸è¿œç¨‹åˆ†æ”¯å»ºç«‹è”ç³»ã€‚</p><ul><li><code>git branch -vv</code> æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯æ ¸è¿œç¨‹çš„å¯¹åº”å…³ç³»</li></ul><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><ul><li>å½“ä½ çš„ branch å‡†å¤‡å¥½ä¹‹åï¼Œå°±å¯ä»¥åœ¨ github ä¸Šå‘èµ· Pull Requestï¼Œé€šçŸ¥ä»“åº“ç›¸å…³çš„å¼€å‘è€…æ£€æŸ¥ä»£ç ä»¥åŠå¸®å¿™åˆå¹¶ã€‚<br><img src="/img/GitHub/pr.png" alt="Pull Request"></li><li>add, rm, commit, push ä¹‹ç±»çš„æ“ä½œç›´æ¥ç”¨ VS çš„ <code>Git æ›´æ”¹</code> è§†å›¾ï¼Œæˆ–è€… <code>Git GUI</code> å°±å¥½ï¼Œæ¯”å‘½ä»¤æ–¹ä¾¿å¾—å¤šã€‚</li><li>ä¸€èˆ¬æ¥è¯´ï¼Œé™¤éå¾ˆç´§æ€¥çš„æƒ…å†µï¼Œè¯·åœ¨è·å¾— approve å’Œ review ä¹‹åå†è¿›è¡Œåˆå¹¶ã€‚</li><li>é€‰æ‹© Sauash Merge çš„æ–¹å¼å°† pr å†…å¤šä¸ª commit åˆå¹¶ä¸ºä¸€ä¸ª commit æäº¤åˆ° main åˆ†æ”¯ä¸Šã€‚</li></ul><h2 id="å†²çªä¸åˆå¹¶"><a href="#å†²çªä¸åˆå¹¶" class="headerlink" title="å†²çªä¸åˆå¹¶"></a>å†²çªä¸åˆå¹¶</h2><h3 id="å†²çª"><a href="#å†²çª" class="headerlink" title="å†²çª"></a>å†²çª</h3><p>åœ¨å‘èµ· pr åï¼Œgithub ä¼šè‡ªåŠ¨å¸®ä½ æ£€æŸ¥è¯¥åˆ†æ”¯æ˜¯å¦ä¸ä¸»åˆ†æ”¯æœ‰å†²çªã€‚ç®€å•çš„å†²çªå¯ä»¥ç›´æ¥åœ¨ç½‘é¡µç«¯è§£å†³ï¼Œä¹Ÿå¯ä»¥å›åˆ°æœ¬åœ°è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ul><li><code>git checkout main</code> åˆ‡æ¢å›ä¸»åˆ†æ”¯</li><li><code>git pull</code> æ‹‰å–æœ€æ–°çš„ä¸»åˆ†æ”¯</li><li>å¯ä»¥é¡ºä¾¿ç¡®è®¤ä¸€ä¸‹ä¸»åˆ†æ”¯çš„ç¼–è¯‘ä¸è¿è¡Œæ˜¯å¦æ­£å¸¸</li><li><code>git checkout &lt;Name&gt;</code> åˆ‡æ¢å›å†²çªåˆ†æ”¯</li><li><code>git merge main</code> åˆå¹¶ä¸»åˆ†æ”¯ä¸å†²çªåˆ†æ”¯</li><li>è¿›å…¥ <code>Git æ›´æ”¹</code> è§†å›¾è§£å†³å†²çª</li><li>æäº¤ä¸æ¨é€ï¼ŒæŸ¥çœ‹ github</li></ul><p>VS æä¾›äº†éå¸¸ç›´è§‚çš„å›¾å½¢ç•Œé¢æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³å†²çªï¼Œåœ¨ä¸ç¡®å®šå¦‚ä½•è§£å†³çš„æƒ…å†µä¸‹å¯ä»¥è”ç³»å†²çªæ–‡ä»¶çš„ä¸Šä¸€ä¸ªå¼€å‘è€…å¸®å¿™åˆå¹¶ã€‚</p><h3 id="åˆå¹¶"><a href="#åˆå¹¶" class="headerlink" title="åˆå¹¶"></a>åˆå¹¶</h3><ul><li>æƒ³åœ¨å½“å‰ branch åº”ç”¨æŸä¸ªåˆ«çš„ branch çš„ä¿®æ”¹ï¼ŸåŒæ ·æ˜¯å°†å¯¹åº”çš„ branch pull ä¸‹æ¥ï¼Œmerge å³å¯ã€‚</li><li>ä¸æƒ³ merge æ•´ä¸ª branchï¼Œæˆ–è€… å¯¹æ–¹çš„ branch è¿˜åœ¨å¼€å‘ä¸­ï¼Ÿä½¿ç”¨ <code>git cherry-pick &lt;CommitHash&gt;</code> ä»¥ commit ä¸ºç²’åº¦è¿›è¡Œåˆå¹¶ã€‚</li></ul><h2 id="æ’¤é”€"><a href="#æ’¤é”€" class="headerlink" title="æ’¤é”€"></a>æ’¤é”€</h2><h3 id="å·¥ä½œåŒº"><a href="#å·¥ä½œåŒº" class="headerlink" title="å·¥ä½œåŒº"></a>å·¥ä½œåŒº</h3><p>æœ¬åœ°æ‰€æœ‰æœª add çš„æ”¹åŠ¨æˆ‘éƒ½ä¸æƒ³è¦ï¼Œæ€ä¹ˆæ’¤é”€ï¼Ÿ</p><ul><li><code>git checkout .</code> æ¸…é™¤æœª add çš„æ‰€æœ‰æ”¹åŠ¨ï¼Œæ— æ³•åˆ é™¤æ–°å¢çš„æ–‡ä»¶ã€‚</li></ul><h3 id="æš‚å­˜åŒº"><a href="#æš‚å­˜åŒº" class="headerlink" title="æš‚å­˜åŒº"></a>æš‚å­˜åŒº</h3><p>æœ¬åœ° add äº†çš„æ”¹åŠ¨æˆ‘ä¹Ÿä¸æƒ³è¦ï¼Œæ€ä¹ˆæ’¤é”€ï¼Ÿ</p><ul><li><code>git reset [--soft | --mixed | --hard] [HEAD]</code><ul><li><code>--mixed</code> é»˜è®¤æ¨¡å¼ï¼Œä¸åˆ é™¤æ”¹åŠ¨ä»£ç ï¼Œæ’¤é”€ commitï¼Œæ’¤é”€ add</li><li><code>--soft</code> ä¸åˆ é™¤æ”¹åŠ¨ä»£ç ï¼Œæ’¤é”€ commitï¼Œä¸æ’¤é”€ add</li><li><code>--hard</code> åˆ é™¤æ”¹åŠ¨ä»£ç ï¼Œæ’¤é”€ commitï¼Œæ’¤é”€ add</li><li><code>HEAD</code> é»˜è®¤ç‰ˆæœ¬<ul><li><code>HEAD</code> å’Œ <code>HEAD~0</code> è¡¨ç¤ºå½“å‰ç‰ˆæœ¬</li><li><code>HEAD^</code> å’Œ <code>HEAD~1</code> è¡¨ç¤ºä¸Šä¸€ä¸ªç‰ˆæœ¬</li><li><code>HEAD^^</code> å’Œ <code>HEAD~2</code> è¡¨ç¤ºä¸Šä¸Šä¸ªç‰ˆæœ¬</li><li>ä¾æ­¤ç±»æ¨</li></ul></li></ul></li></ul><p>å½“æˆ‘ä»¬éœ€è¦æ’¤é”€æš‚å­˜åŒºé‡Œçš„ä»£ç æ—¶ï¼Œå¯ä»¥ <code>git reset</code> å°†æš‚å­˜åŒºå›é€€åˆ°å·¥ä½œåŒºï¼Œç„¶å <code>git checkout .</code> æ¸…é™¤å·¥ä½œåŒºã€‚<br>æˆ–è€…ç›´æ¥ <code>git reset --hard</code> æŠŠå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹å…¨æ‰¬äº†ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¹Ÿèƒ½åˆ é™¤æš‚å­˜åŒºä¸­çš„æ–°å¢æ–‡ä»¶ï¼Œåè€Œåˆ é™¤ä¸äº†å·¥ä½œåŒºä¸­çš„æ–°å¢æ–‡ä»¶ã€‚</p><h3 id="Git-æ›´æ”¹è§†å›¾"><a href="#Git-æ›´æ”¹è§†å›¾" class="headerlink" title="Git æ›´æ”¹è§†å›¾"></a>Git æ›´æ”¹è§†å›¾</h3><p>å…¶å®å¯¹å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„æ“ä½œå®Œå…¨å¯ä»¥ç”± VS æä¾›çš„å›¾å½¢ç•Œé¢å®Œæˆï¼Œéå¸¸æ–¹ä¾¿ç›´è§‚ã€‚</p><h3 id="Commit"><a href="#Commit" class="headerlink" title="Commit"></a>Commit</h3><p>ä¸Šä¸€ä¸ª commit å¤ªè ¢äº†ï¼Œæ€ä¹ˆæ’¤é”€ï¼Ÿ</p><ul><li><code>git log</code> æŸ¥çœ‹æäº¤æ—¥å¿—ï¼Œè·å–æƒ³è¦å›é€€çš„ commit å“ˆå¸Œ<br><em>ps: æŒ‰qé€€å‡º</em></li><li><code>git reset --soft &lt;CommitHash&gt;</code> å›é€€åˆ° CommitHash å¯¹åº”çš„ commitï¼Œå³å¦‚æœæˆ‘è¦æ’¤é”€ commit <code>balabala</code>ï¼Œreset çš„å‚æ•°åº”è¯¥æ˜¯ <code>balabala</code> çš„ä¸Šä¸€ä¸ª commit çš„å“ˆå¸Œã€‚<br>è¿™ç§æƒ…å†µä¸‹æˆ‘æ¯”è¾ƒä¹ æƒ¯ç”¨ <code>--soft</code> å°† commit å›é€€åˆ°æš‚å­˜åŒºè€Œéé»˜è®¤çš„å·¥ä½œåŒºï¼Œå¦‚æœæ­¤æ—¶æœ¬åœ°å·¥ä½œåŒºæœ‰ä¿®æ”¹ä¾¿èƒ½å°†ä»–ä»¬åŒºåˆ†å¼€æ¥ã€‚</li></ul><h3 id="Push"><a href="#Push" class="headerlink" title="Push"></a>Push</h3><p>commit å·²ç» push ä¸Šå»äº†ï¼Œæ€ä¹ˆæ’¤é”€ï¼Ÿ<br>åœ¨å®Œæˆä¸Šä¸€èŠ‚ä¹‹åï¼Œæœ¬åœ°å’Œè¿œç¨‹å…¶å®å¤„äºä¸€ä¸ªå†²çªçš„çŠ¶æ€ï¼Œè¿™æ—¶å€™åªéœ€è¦ç”¨<br><code>git push --force</code><br>å¼ºåˆ¶å°†è¿œç¨‹çš„ log åŒæ­¥æˆæœ¬åœ°çš„çŠ¶æ€ã€‚</p><h3 id="PR"><a href="#PR" class="headerlink" title="PR"></a>PR</h3><p>pr å·²ç» merge äº†ï¼Œæ€ä¹ˆæ’¤é”€ï¼Ÿ<br>åœ¨è¯¥ pr çš„æœ€ä¸‹æ–¹çš„ merge å³ä¾§æ‰¾åˆ° <code>Revert</code>ï¼Œè¿™ä¸ªæŒ‰é’®ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ branch ä»¥åŠ prï¼Œå¹¶ä¸”åœ¨å…¶ä¸­å°†åŸ pr å†…çš„æ‰€æœ‰ä¿®æ”¹åå‘æ“ä½œã€‚å½“ç„¶å°½é‡ä¸è¦å‡ºç°è¿™ç§ä¸å¾—ä¸ Revert çš„æƒ…å†µã€‚<br><img src="/img/GitHub/revert.png" alt="Revert"></p><h2 id="Git-Submodule"><a href="#Git-Submodule" class="headerlink" title="Git Submodule"></a>Git Submodule</h2><p>git æä¾›äº†å­æ¨¡å—åŠŸèƒ½å°†ä¸€ä¸ªä»“åº“é›†æˆä¸ºå¦ä¸€ä¸ªä»“åº“çš„å­ç›®å½•ï¼Œå¹¶ä¸”è®©ä»–ä»¬ä¿æŒç‹¬ç«‹çš„æäº¤ã€‚<br>å­æ¨¡å—æœ‰ä¸€ä¸ªéå¸¸æŠ½è±¡çš„ç‰¹æ€§ï¼šåœ¨ä¸»ä»“åº“ä¸­å¦‚æœä¸ä½¿ç”¨ <code>submodule</code> ç›¸å…³çš„æŒ‡ä»¤ï¼Œå­æ¨¡å—çš„å†…å®¹ä¸ä¼šå—åˆ°ä»»ä½• git æŒ‡ä»¤çš„å½±å“ï¼Œä¸å—ä¸»ä»“åº“åˆ‡æ¢åˆ†æ”¯çš„å½±å“ï¼Œç”šè‡³ä¸ä¼šåœ¨ä¸»ä»“åº“ clone ä¹‹åå‡ºç°åœ¨ä½ çš„ç¡¬ç›˜é‡Œã€‚</p><h3 id="æ·»åŠ å­æ¨¡å—"><a href="#æ·»åŠ å­æ¨¡å—" class="headerlink" title="æ·»åŠ å­æ¨¡å—"></a>æ·»åŠ å­æ¨¡å—</h3><p><code>git submodule add &lt;url&gt; &lt;path&gt;</code> å°† url å¯¹åº”çš„ä»“åº“ä½œä¸ºå­æ¨¡å—æ·»åŠ åˆ° path è·¯å¾„ä¸‹<br>æ·»åŠ å­æ¨¡å—åä¸»ä»“åº“ä¼šæ–°å¢ä¸€ä¸ª <code>.gitmodules</code> æ–‡ä»¶æ¥æè¿°å­æ¨¡å—çš„ä¿¡æ¯ã€‚<br><img src="/img/GitHub/sb.png" alt=".gitmodules"><br><em>ä¸æƒ³è®©ç¬¬ä¸‰æ–¹åº“çš„ä¸å—æ§çš„æ›´æ–°ç ´åè‡ªå·±çš„ä¸»ä»“åº“ï¼Ÿå°†å…¶ fork ä¸€ä»½å†é›†æˆä¸ºå­æ¨¡å—å³å¯ã€‚</em></p><h3 id="Clone-å¸¦æœ‰å­æ¨¡å—çš„ä»“åº“"><a href="#Clone-å¸¦æœ‰å­æ¨¡å—çš„ä»“åº“" class="headerlink" title="Clone å¸¦æœ‰å­æ¨¡å—çš„ä»“åº“"></a>Clone å¸¦æœ‰å­æ¨¡å—çš„ä»“åº“</h3><p><code>git clone --recursive &lt;url&gt;</code> å°†ä»“åº“å†…å®¹ä»¥åŠå­æ¨¡å—å†…å®¹ä»¥åŠå­æ¨¡å—çš„å­æ¨¡å—å†…å®¹é€’å½’åœ° clone ä¸‹æ¥ã€‚<br>å¦‚æœ clone çš„æ—¶å€™æ²¡æœ‰å¸¦ä¸Š <code>--recursive</code> å‚æ•°ï¼Œä¹Ÿå¯ä»¥åœ¨ clone ç»“æŸååœ¨ä»“åº“ç›®å½•è¿è¡Œ <code>git submodule update --init --recursive</code> è¾¾æˆä¸€æ ·çš„æ•ˆæœã€‚<br><code>--init</code> å‚æ•°ç”¨äºåœ¨ <code>.git/config</code> ä¸­æ³¨å†Œå­æ¨¡å—ä¿¡æ¯ã€‚</p><h3 id="æ›´æ–°å­æ¨¡å—"><a href="#æ›´æ–°å­æ¨¡å—" class="headerlink" title="æ›´æ–°å­æ¨¡å—"></a>æ›´æ–°å­æ¨¡å—</h3><p><code>git submodule update</code> å°†å­æ¨¡å—æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬<br><code>git submodule update --remote</code> å°†å­æ¨¡å—æ›´æ–°åˆ°è¿œç¨‹çš„æœ€æ–°ç‰ˆæœ¬<br>æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Œè¿™é‡Œè¦å¼•å‡ºå­æ¨¡å—å¦ä¸€ä¸ªéå¸¸æŠ½è±¡çš„ç‰¹æ€§ï¼šåŒºåˆ†å…­ä¸ªæ¦‚å¿µï¼š<code>è¿œç¨‹çš„ä¸»ä»“åº“</code>ã€<code>æœ¬åœ°çš„ä¸»ä»“åº“</code>ã€<code>è¿œç¨‹çš„å­ä»“åº“</code>ã€<code>æœ¬åœ°çš„å­ä»“åº“</code>ã€<code>è¿œç¨‹ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code>ã€<code>æœ¬åœ°ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code>ï¼Œè¿™å…­ä¸ªä¸œè¥¿çš„ç‰ˆæœ¬æ˜¯å¯ä»¥ä¸åŒçš„ã€‚</p><ul><li>é‡ç‚¹åœ¨äºï¼Œä¸»ä»“åº“ä¸­ä¼šå­˜å‚¨ä¸€ä¸ªå­æ¨¡å—çš„ commit ç‰ˆæœ¬ï¼Œ<code>git submodule update</code> åªèƒ½å°† <code>æœ¬åœ°çš„å­ä»“åº“</code> æ›´æ–°ä¸º <code>æœ¬åœ°ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ç‰ˆæœ¬ã€‚</li><li>æˆ–è€…å…ˆä½¿ç”¨ <code>git pull</code> å°† <code>æœ¬åœ°ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ç‰ˆæœ¬æ›´æ–°ä¸º <code>è¿œç¨‹ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ç‰ˆæœ¬ï¼Œå†ç»“åˆä½¿ç”¨ <code>git submodule update</code> å³å¯å°† <code>æœ¬åœ°çš„å­ä»“åº“</code> æ›´æ–°ä¸º <code>è¿œç¨‹ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ç‰ˆæœ¬ã€‚<br><em>è¿™ä¹Ÿæ˜¯ clone ä¹‹åï¼Œå¯¹ç€ç©ºç©ºå¦‚ä¹Ÿçš„å­æ¨¡å—æ–‡ä»¶å¤¹ä½¿ç”¨ <code>git submodule update</code> å³å¯å°†å…¶æ›´æ–°çš„åŸå› </em></li><li>è€Œ <code>git submodule update --remote</code> å®é™…ä¸Šç›¸å½“äºè¿›å…¥æ¯ä¸€ä¸ªå­æ¨¡å—æ‰§è¡Œ <code>git pull</code>ï¼Œå³å°† <code>æœ¬åœ°çš„å­ä»“åº“</code> æ›´æ–°ä¸º <code>è¿œç¨‹çš„å­ä»“åº“</code>ã€‚</li><li>æœ€åä¸€æ­¥ï¼Œå¦‚ä½•æ›´æ–° <code>è¿œç¨‹ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ç‰ˆæœ¬å‘¢ï¼Ÿåœ¨ <code>æœ¬åœ°ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ç‰ˆæœ¬ä¸ <code>æœ¬åœ°çš„å­ä»“åº“</code> ä¸åŒæ—¶ï¼Œåœ¨ä¸»ä»“åº“æ‰§è¡Œ commit å³å¯æ›´æ–° <code>æœ¬åœ°ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ç‰ˆæœ¬ã€‚åœ¨ <code>è¿œç¨‹ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ä¸ <code>æœ¬åœ°ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ç‰ˆæœ¬ä¸åŒæ—¶ï¼Œåœ¨ä¸»ä»“åº“æ‰§è¡Œ push å³å¯æ›´æ–° <code>è¿œç¨‹ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ç‰ˆæœ¬ã€‚</li></ul><h4 id="å…¶ä»–-1"><a href="#å…¶ä»–-1" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><ul><li>å¦‚æœ <code>.gitmodules</code> ä¸­çš„ url æœ‰å˜æˆ–è€…æ–°å¢ï¼Œ<code>git submodule update</code> æ˜¯æ— æ³•å°†å…¶æ›´æ–°çš„ï¼Œä¿é™©èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸€æ¬¡ update å­æ¨¡å—ä¹‹å‰æ‰§è¡Œ <code>git submodule init</code>ã€‚</li><li>åªå¸Œæœ› <code>git submodule update --remote</code> æ›´æ–°æŒ‡å®šçš„å­æ¨¡å—è€Œéæ›´æ–°æ‰€æœ‰çš„å­æ¨¡å—ï¼Ÿä½¿ç”¨ <code>git submodule update --remote &lt;Path&gt;</code> æŒ‡å®šå­æ¨¡å—çš„è·¯å¾„å³å¯ã€‚å…·ä½“è·¯å¾„å¯ä»¥åœ¨ <code>.gitmodules</code> æ–‡ä»¶ä¸­ç¡®è®¤ã€‚</li></ul><h3 id="å¼€å‘å­æ¨¡å—"><a href="#å¼€å‘å­æ¨¡å—" class="headerlink" title="å¼€å‘å­æ¨¡å—"></a>å¼€å‘å­æ¨¡å—</h3><p>å­æ¨¡å—æœ€æŠ½è±¡çš„ç‰¹æ€§ï¼šå½“æˆ‘ä»¬ä½¿ç”¨ <code>git submodule update</code> å¯¹å­æ¨¡å—è¿›è¡Œæ›´æ–°ä¹‹åï¼Œå­æ¨¡å—å®é™…ä¸Šä¼šå¤„äºä¸€ä¸ªæ¸¸ç¦»çš„ branch ä¸Šå¹¶ä¸”è¿™ä¸ª branch æ˜¯ mainï¼ˆä¸ä¸€å®šæ˜¯ mainï¼Œå¯ä»¥é…ç½®ï¼‰çš„å¤åˆ¶ã€‚</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">git <span class="hljs-keyword">branch</span><br><span class="hljs-keyword"></span>* (HEAD detached <span class="hljs-built_in">at</span> abcdefg)<br>  main<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ª branch ä¸Šçš„æ‰€æœ‰å·¥ä½œä¸ä½†æ— æ³•è¿›è¡Œ pushï¼Œç”šè‡³ä¼šåœ¨ä¸‹ä¸€æ¬¡ <code>git submodule update</code> ä¹‹åä¸¢å¤±ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å­æ¨¡å—çš„è®¾è®¡éå¸¸å¤æ‚ä¸”åç›´è§‰ï¼Œå¥½åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›é¡¹ç›®è§„èŒƒå’Œå¼€å‘ä¹ æƒ¯æ¥è§„é¿ä¸€äº›ä½¿ç”¨å­æ¨¡å—å¸¦æ¥çš„çš„å‰¯ä½œç”¨ã€‚</p><ul><li>å¯¹å­æ¨¡å—çš„ main branch è¿›è¡Œä¿æŠ¤ï¼Œæ‰€æœ‰çš„å¼€å‘éƒ½åœ¨ç‰¹å®šçš„ branch ä¸Šè¿›è¡Œï¼Œä»¥é¿å…æ¸¸ç¦»çš„ HEAD å¸¦æ¥çš„å›°æ‰°ã€‚</li><li>å¼€å‘å­æ¨¡å—æ—¶ï¼Œå°†å…¶å•ç‹¬ clone ä¸‹æ¥æˆ–è€…å¤åˆ¶å‡ºæ¥ï¼Œæ€»ä¹‹ä¸è¦ç›´æ¥åœ¨ä¸»ä»“åº“é‡Œçš„å­æ¨¡å—é‡Œè¿›è¡Œå¼€å‘ï¼Œä»¥å…ä¸»ä»“åº“æ£€æµ‹åˆ°å­æ¨¡å— commit çš„æ›´æ–°ã€‚</li><li>åœ¨ä¸»ä»“åº“ä¸­æ›´æ–°å­æ¨¡å—æ—¶ï¼Œä¸è¦åœ¨æ›´æ–° <code>ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ç‰ˆæœ¬ä¹‹å‰æ›´æ–°ä¾èµ–äºå­æ¨¡å—æ–°ç‰ˆæœ¬çš„ä»£ç ã€‚</li><li>ä¸»ä»“åº“ä¸å­æ¨¡å—åŒæ­¥æ›´æ–°ä¹‹åè§†æƒ…å†µé€šçŸ¥å…¶ä»–å¼€å‘è€…ï¼Œæ¯•ç«Ÿåœ¨ä¸»ä»“åº“ <code>git pull</code> åªä¼šæ›´æ–°ä¾èµ–äºå­æ¨¡å—æ–°ç‰ˆæœ¬çš„ä»£ç ï¼Œè€Œæ— æ³•æ›´æ–°å­æ¨¡å—ã€‚</li><li>å½“æˆ‘ä»¬åœ¨ä¸»ä»“åº“ <code>git pull</code> ä¹‹åå‘ç°æ£€æµ‹å‡ºäº†å­æ¨¡å—çš„æ›´æ–°ï¼ˆè¿™ç§æƒ…å†µå±äº <code>æœ¬åœ°çš„å­ä»“åº“</code> è½åäº <code>æœ¬åœ°ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> ç‰ˆæœ¬ï¼‰ï¼Œæ‰‹åŠ¨æ‰§è¡Œ submodule updateã€‚</li><li>é¡¹ç›®ä¿è¯ä¸»ä»“åº“åªä½¿ç”¨å­æ¨¡å—çš„ç‰¹å®šåˆ†æ”¯ï¼Œä¸”å½“ <code>ä¸»ä»“åº“ä¸­çš„å­ä»“åº“</code> äº§ç”Ÿå†²çªæ—¶ï¼Œä»¥æœ€æ–°çš„å­æ¨¡å—ç‰ˆæœ¬ä¸ºå‡†ã€‚</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://iphysresearch.github.io/blog/post/programing/git/git_submodule/">Git: submodule å­æ¨¡å—ç®€æ˜æ•™ç¨‹</a><br><a href="https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97">7.11 Git å·¥å…· - å­æ¨¡å—</a></p><h2 id="GitHub-Actions"><a href="#GitHub-Actions" class="headerlink" title="GitHub Actions"></a>GitHub Actions</h2><p>GitHub Actions æ˜¯ github æ¨å‡ºçš„æŒç»­é›†æˆå·¥å…·ï¼Œç®€å•æ¥è¯´å°±æ˜¯å¯ä»¥åœ¨æˆ‘ä»¬æ¯æ¬¡æäº¤ä»£ç ååœ¨æœåŠ¡å™¨ä¸Šè‡ªåŠ¨è¿è¡Œä¸€äº›æŒ‡ä»¤ã€‚æˆ‘ä»¬ä¸éœ€è¦å¤ªå¤æ‚çš„ actionï¼Œåœ¨ä»“åº“ build system å®Œå¤‡çš„åŸºç¡€ä¸Šï¼Œåªéœ€è¦åœ¨ä»£ç æäº¤åè®© github æœåŠ¡å™¨è‡ªåŠ¨è¿è¡Œæˆ‘ä»¬çš„æ„å»ºè„šæœ¬å¹¶ä¸”æ£€æŸ¥ä»“åº“çš„æ„å»ºä¸ç¼–è¯‘æ˜¯å¦æ­£å¸¸å³å¯ï¼Œä»¥ä¿è¯æ¯ä¸€æ¬¡ pr éƒ½ä¸ä¼šç ´åä»“åº“ã€‚</p><p><a href="https://docs.github.com/zh/actions">å®˜æ–¹æ–‡æ¡£</a><br>GitHub Actions ä½¿ç”¨ YAML æ¥å®šä¹‰å·¥ä½œæµç¨‹ã€‚ æ¯ä¸ªå·¥ä½œæµéƒ½ä½œä¸ºå•ç‹¬çš„ YAML æ–‡ä»¶å­˜å‚¨åœ¨ <code>.github/workflows/*.yml</code>ã€‚</p><p>ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">name:</span> <span class="hljs-string">build</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">&quot;main&quot;</span> ]<br>  <span class="hljs-attr">pull_request:</span><br>    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">&quot;main&quot;</span> ]<br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">Windows:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">windows-latest</span><br>    <span class="hljs-attr">steps:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">out</span> <span class="hljs-string">repository</span> <span class="hljs-string">under</span> <span class="hljs-string">$GITHUB_WORKSPACE.</span><br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span><br>    <br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Add</span> <span class="hljs-string">MSBuild</span> <span class="hljs-string">to</span> <span class="hljs-string">PATH.</span><br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">microsoft/setup-msbuild@v1.1</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">project.</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">$&#123;&#123;github.workspace&#125;&#125;/Setup.bat</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">x64</span> <span class="hljs-string">Debug.</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">msbuild</span> <span class="hljs-string">$&#123;&#123;github.workspace&#125;&#125;/HinaEngine.sln</span> <span class="hljs-string">/p:Configuration=Debug</span> <span class="hljs-string">/p:Platform=x64</span><br>      <br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">x64</span> <span class="hljs-string">Release.</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">msbuild</span> <span class="hljs-string">$&#123;&#123;github.workspace&#125;&#125;/HinaEngine.sln</span> <span class="hljs-string">/p:Configuration=Release</span> <span class="hljs-string">/p:Platform=x64</span><br></code></pre></td></tr></table></figure><h3 id="on"><a href="#on" class="headerlink" title="on"></a>on</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">&quot;main&quot;</span> ]<br>  <span class="hljs-attr">pull_request:</span><br>    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">&quot;main&quot;</span> ]<br></code></pre></td></tr></table></figure><p>ä»£è¡¨è¿™ä¸ª actions ä¼šè¢« main branch ä¸Šçš„ push å’Œ pr åŠ¨ä½œè§¦å‘ã€‚</p><h3 id="jobs"><a href="#jobs" class="headerlink" title="jobs"></a>jobs</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">Windows:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">windows-latest</span><br></code></pre></td></tr></table></figure><ul><li>job å®šä¹‰äº†æœ€ç²—ç²’åº¦çš„ä»»åŠ¡ï¼Œé»˜è®¤æ¯ä¸ª job ä¹‹é—´æ˜¯å¹¶è¡Œçš„ï¼Œ ä¹Ÿå¯ä»¥ç”¨ <code>needs:</code> æ¥æŒ‡å®š job ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä¸è¿‡æˆ‘ä»¬ä¹ æƒ¯ä½¿ç”¨å¤šä¸ª .yml æ¯ä¸ªè¿è¡Œä¸€ä¸ª jobã€‚</li><li><code>Windows:</code> æ˜¯è‡ªå®šä¹‰çš„ job åç§°ï¼Œ<code>runs-on:</code> ç”¨äºæŒ‡å®šç³»ç»Ÿçš„è¿è¡Œç¯å¢ƒï¼Œå…¶ä»–ç¯å¢ƒè¯¦è§ <a href="https://docs.github.com/zh/actions/using-workflows/workflow-syntax-for-github-actions#%E9%80%89%E6%8B%A9-github-%E6%89%98%E7%AE%A1%E7%9A%84%E8%BF%90%E8%A1%8C%E5%99%A8">é€‰æ‹© GitHub æ‰˜ç®¡çš„è¿è¡Œå™¨</a>ã€‚</li></ul><h3 id="steps"><a href="#steps" class="headerlink" title="steps"></a>steps</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">steps:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">out</span> <span class="hljs-string">repository</span> <span class="hljs-string">under</span> <span class="hljs-string">$GITHUB_WORKSPACE.</span><br>  <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Add</span> <span class="hljs-string">MSBuild</span> <span class="hljs-string">to</span> <span class="hljs-string">PATH.</span><br>  <span class="hljs-attr">uses:</span> <span class="hljs-string">microsoft/setup-msbuild@v1.1</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">project.</span><br>  <span class="hljs-attr">run:</span> <span class="hljs-string">$&#123;&#123;github.workspace&#125;&#125;/Setup.bat</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">x64</span> <span class="hljs-string">Debug.</span><br>  <span class="hljs-attr">run:</span> <span class="hljs-string">msbuild</span> <span class="hljs-string">$&#123;&#123;github.workspace&#125;&#125;/HinaEngine.sln</span> <span class="hljs-string">/p:Configuration=Debug</span> <span class="hljs-string">/p:Platform=x64</span><br>  <br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">x64</span> <span class="hljs-string">Release.</span><br>  <span class="hljs-attr">run:</span> <span class="hljs-string">msbuild</span> <span class="hljs-string">$&#123;&#123;github.workspace&#125;&#125;/HinaEngine.sln</span> <span class="hljs-string">/p:Configuration=Release</span> <span class="hljs-string">/p:Platform=x64</span><br></code></pre></td></tr></table></figure><ul><li><code>steps:</code> å®šä¹‰äº†è¯¥ job ä¸­çš„æ¯ä¸€æ­¥æŒ‡ä»¤ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬çš„æµç¨‹æ˜¯ 1. æ‹‰å–ä»“åº“ 2. å°† MSBuild æ·»åŠ è‡³ç¯å¢ƒå˜é‡ 3. æ„å»ºä¸ç¼–è¯‘é¡¹ç›®</li><li>ä¸åŒä»“åº“ä¸­çš„ä¸€äº›æ“ä½œæ˜¯ç±»ä¼¼çš„ï¼Œgithub ä¹Ÿåœ¨ <a href="https://github.com/marketplace?type=actions">Actions å¸‚åœº</a> ä¸­æä¾›äº†ä¸€ç³»åˆ—å°è£…å¥½çš„å‘½ä»¤ã€‚æ¯”å¦‚ï¼š<ul><li><code>actions/checkout@v3</code> ä»£è¡¨äº†å°†ä»“åº“æ‹‰å–åˆ° <code>$GITHUB_WORKSPACE</code>ã€‚<a href="https://github.com/marketplace/actions/checkout">Checkout</a></li><li><code>microsoft/setup-msbuild@v1.1</code> ä»£è¡¨å¯»æ‰¾ MSBuild çš„è·¯å¾„ï¼Œå¹¶ä¸”å°†å…¶æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ã€‚<a href="https://github.com/marketplace/actions/setup-msbuild">setup-msbuild</a></li><li>æ£€æŸ¥è¿™äº› action çš„å®˜æ–¹é¡µé¢ä»¥è·å–æœ€æ–°çš„ç‰ˆæœ¬å·ã€‚</li></ul></li><li><code>$&#123;&#123;github.workspace&#125;&#125;</code> ä»£è¡¨äº†åœ¨å‘½ä»¤è¡Œä¸­è¯¥ä»“åº“çš„æ ¹ç›®å½•ã€‚<code>Setup.bat</code> æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„é¡¹ç›®æ„å»ºè„šæœ¬ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šåœ¨è¿™ä¸ªè„šæœ¬ä¸­è¿è¡Œ premake å¹¶ä¸”ç”Ÿæˆé¡¹ç›®çš„ .sln æ–‡ä»¶ã€‚</li><li>æ¥ç€åœ¨å‘½ä»¤è¡Œä¸­ç¼–è¯‘é¡¹ç›®çš„ Debug å’Œ Release ç‰ˆæœ¬ã€‚msbuild å‘½ä»¤è¡Œè¯¦è§ <a href="https://learn.microsoft.com/zh-cn/visualstudio/msbuild/msbuild-command-line-reference?view=vs-2022">MSBuild å‘½ä»¤è¡Œå‚è€ƒ</a> å’Œ <a href="https://learn.microsoft.com/zh-cn/visualstudio/msbuild/common-msbuild-project-properties?view=vs-2022">å¸¸ç”¨çš„ MSBuild é¡¹ç›®å±æ€§</a>ã€‚</li></ul><h3 id="Check-Failed"><a href="#Check-Failed" class="headerlink" title="Check Failed"></a>Check Failed</h3><p>Action æ£€æŸ¥æœªé€šè¿‡æ˜¯éå¸¸å¸¸è§çš„ï¼Œè¿™æ—¶å€™åªéœ€è¦æ£€æŸ¥ä¸€ä¸‹ Details å¾€å¾€èƒ½å¸®æˆ‘ä»¬å®šä½é”™è¯¯ã€‚<br><img src="/img/GitHub/action.png" alt=".gitmodules"><br>æœ‰æ—¶å€™ä»–çš„æŠ¥é”™ä¼šéå¸¸æŠ½è±¡ï¼Œå¦‚æœä½ è®¤ä¸ºè¿™ä¸ª failed å¯èƒ½ä¸æ˜¯ä½ çš„é—®é¢˜ï¼Œå¯ä»¥å°è¯•åœ¨å¤±è´¥çš„ Actions ç•Œé¢ç‚¹å‡» <code>Re-run job</code> æŒ‰é’®ã€‚</p><h3 id="åœ¨-README-ä¸­æ·»åŠ çŠ¶æ€å¾½ç« "><a href="#åœ¨-README-ä¸­æ·»åŠ çŠ¶æ€å¾½ç« " class="headerlink" title="åœ¨ README ä¸­æ·»åŠ çŠ¶æ€å¾½ç« "></a>åœ¨ README ä¸­æ·»åŠ çŠ¶æ€å¾½ç« </h3><p>github actions ä¼šå°†è‡ªèº«è¿è¡Œçš„çŠ¶æ€ç”Ÿæˆä¸ºä¸€å¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªé“¾æ¥è®¿é—®å®ƒï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/&lt;OWNER&gt;/</span>&lt;REPOSITORY&gt;<span class="hljs-regexp">/actions/</span>workflows<span class="hljs-regexp">/&lt;WORKFLOW_FILE&gt;/</span>badge.svg<br></code></pre></td></tr></table></figure><p>ç„¶åå°†å…¶ä½œä¸ºå›¾ç‰‡å¡å…¥ markdown è¯­æ³•ä¸­å¹¶æŒ‡å‘ä»“åº“çš„ actions ç•Œé¢ï¼š</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs md">[<span class="hljs-string">![win64_vs2022_msvc</span>](<span class="hljs-link">https://github.com/CatDogEngine/CatDogEngine/actions/workflows/win64_vs2022_msvc.yml/badge.svg?branch=main</span>)](<span class="hljs-link">https://github.com/CatDogEngine/CatDogEngine/actions/workflows/win64_vs2022_msvc.yml</span>)<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š<br><a href="https://github.com/CatDogEngine/CatDogEngine/actions/workflows/win64_vs2022_msvc.yml"><img src="https://github.com/CatDogEngine/CatDogEngine/actions/workflows/win64_vs2022_msvc.yml/badge.svg?branch=main" alt="win64_vs2022_msvc"></a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Engineering</tag>
      
      <tag>Git</tag>
      
      <tag>GitHub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­Œå•</title>
    <link href="/2023/07/01/Song/"/>
    <url>/2023/07/01/Song/</url>
    
    <content type="html"><![CDATA[<h2 id="æ—¥æ–‡"><a href="#æ—¥æ–‡" class="headerlink" title="æ—¥æ–‡"></a>æ—¥æ–‡</h2><h3 id="æœ¯åŠ›å£"><a href="#æœ¯åŠ›å£" class="headerlink" title="æœ¯åŠ›å£"></a>æœ¯åŠ›å£</h3><h4 id="glow"><a href="#glow" class="headerlink" title="glow"></a>glow</h4><ul><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Ne4y1j7E7/">https://www.bilibili.com/video/BV1Ne4y1j7E7/</a> ï¼ˆé¹¿ä¹ƒï¼‰</li></ul><h4 id="ã‚ªãƒãƒãƒˆãƒš-æ‹Ÿå£°è¯"><a href="#ã‚ªãƒãƒãƒˆãƒš-æ‹Ÿå£°è¯" class="headerlink" title="ã‚ªãƒãƒãƒˆãƒš &#x2F; æ‹Ÿå£°è¯"></a>ã‚ªãƒãƒãƒˆãƒš &#x2F; æ‹Ÿå£°è¯</h4><ul><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1vN411o7Bo/">https://www.bilibili.com/video/BV1vN411o7Bo/</a> ï¼ˆé•¿æ³½é™µå·ï¼‰</li><li>å‡é™ï¼š+1</li></ul><h4 id="å¤ã«å»ã‚Šã—å›ã‚’æƒ³ãƒ•-æ€å¿µäºå¤æ—¥ç¦»å»çš„ä½ "><a href="#å¤ã«å»ã‚Šã—å›ã‚’æƒ³ãƒ•-æ€å¿µäºå¤æ—¥ç¦»å»çš„ä½ " class="headerlink" title="å¤ã«å»ã‚Šã—å›ã‚’æƒ³ãƒ• &#x2F; æ€å¿µäºå¤æ—¥ç¦»å»çš„ä½ "></a>å¤ã«å»ã‚Šã—å›ã‚’æƒ³ãƒ• &#x2F; æ€å¿µäºå¤æ—¥ç¦»å»çš„ä½ </h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Tx411w7st/">https://www.bilibili.com/video/BV1Tx411w7st/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1cx411A7tJ/">https://www.bilibili.com/video/BV1cx411A7tJ/</a> ï¼ˆãƒ€ã‚ºãƒ“ãƒ¼ï¼‰</li></ul><h4 id="ç‹¬ã‚Šã‚“ã¼ã‚¨ãƒ³ãƒ´ã‚£ãƒ¼-å­‘ç„¶å¦’ç«"><a href="#ç‹¬ã‚Šã‚“ã¼ã‚¨ãƒ³ãƒ´ã‚£ãƒ¼-å­‘ç„¶å¦’ç«" class="headerlink" title="ç‹¬ã‚Šã‚“ã¼ã‚¨ãƒ³ãƒ´ã‚£ãƒ¼ &#x2F; å­‘ç„¶å¦’ç«"></a>ç‹¬ã‚Šã‚“ã¼ã‚¨ãƒ³ãƒ´ã‚£ãƒ¼ &#x2F; å­‘ç„¶å¦’ç«</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1mx411F7Hm/">https://www.bilibili.com/video/BV1mx411F7Hm/</a> ï¼ˆåŸå”±ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1TT411x7eE/">https://www.bilibili.com/video/BV1TT411x7eE/</a> ï¼ˆå®µå´å¥, æšå±±ç‘å¸Œ, åˆéŸ³ãƒŸã‚¯ï¼‰</li></ul><h4 id="æ„›ã—ã¦æ„›ã—ã¦æ„›ã—ã¦"><a href="#æ„›ã—ã¦æ„›ã—ã¦æ„›ã—ã¦" class="headerlink" title="æ„›ã—ã¦æ„›ã—ã¦æ„›ã—ã¦"></a>æ„›ã—ã¦æ„›ã—ã¦æ„›ã—ã¦</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Qx411A7TS/">https://www.bilibili.com/video/BV1Qx411A7TS/</a> ï¼ˆåˆéŸ³ï¼‰</li></ul><h4 id="ãƒ©ãƒ´ã‚£-Lavie"><a href="#ãƒ©ãƒ´ã‚£-Lavie" class="headerlink" title="ãƒ©ãƒ´ã‚£ &#x2F; Lavie"></a>ãƒ©ãƒ´ã‚£ &#x2F; Lavie</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1g8411Y7oW/">https://www.bilibili.com/video/BV1g8411Y7oW/</a> ï¼ˆé¡éŸ³ãƒ¬ãƒ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1wH4y1r75r?p=2">https://www.bilibili.com/video/BV1wH4y1r75r?p=2</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1zG4y147Vv/">https://www.bilibili.com/video/BV1zG4y147Vv/</a> ï¼ˆéº»å©†è±†è…ï¼‰</li><li>å‡é™ï¼š+5</li></ul><h4 id="é™ã‚Šãªãç°è‰²ã¸-å‘ç€æ— é™ä¹‹ç°"><a href="#é™ã‚Šãªãç°è‰²ã¸-å‘ç€æ— é™ä¹‹ç°" class="headerlink" title="é™ã‚Šãªãç°è‰²ã¸ &#x2F; å‘ç€æ— é™ä¹‹ç°"></a>é™ã‚Šãªãç°è‰²ã¸ &#x2F; å‘ç€æ— é™ä¹‹ç°</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1gy4y177Gf/">https://www.bilibili.com/video/BV1gy4y177Gf/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV14P4y1773j/">https://www.bilibili.com/video/BV14P4y1773j/</a> ï¼ˆ25æ™‚ã€ãƒŠã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã§ã€‚ï¼‰</li></ul><h4 id="ã‚·ãƒ£ãƒ«ãƒ«-å¤éœ²éœ²"><a href="#ã‚·ãƒ£ãƒ«ãƒ«-å¤éœ²éœ²" class="headerlink" title="ã‚·ãƒ£ãƒ«ãƒ« &#x2F; å¤éœ²éœ²"></a>ã‚·ãƒ£ãƒ«ãƒ« &#x2F; å¤éœ²éœ²</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1gs41147c8/">https://www.bilibili.com/video/BV1gs41147c8/</a> ï¼ˆflowerï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV19C4y1a752/">https://www.bilibili.com/video/BV19C4y1a752/</a> ï¼ˆmegaï¼‰</li><li>å‡é™ï¼š-4</li></ul><h4 id="ãƒ´ã‚£ãƒ©ãƒ³-Villain"><a href="#ãƒ´ã‚£ãƒ©ãƒ³-Villain" class="headerlink" title="ãƒ´ã‚£ãƒ©ãƒ³ &#x2F; Villain"></a>ãƒ´ã‚£ãƒ©ãƒ³ &#x2F; Villain</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1K7411876y/">https://www.bilibili.com/video/BV1K7411876y/</a> ï¼ˆflowerï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1SX4y157n5/">https://www.bilibili.com/video/BV1SX4y157n5/</a> ï¼ˆèŠ±è°±ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1pP411z7os/">https://www.bilibili.com/video/BV1pP411z7os/</a> ï¼ˆæœæ¯”å¥ˆçœŸå†¬, æšå±±ç‘å¸Œï¼‰</li></ul><h4 id="çµ¶é ‚è®ƒæ­Œ-ç»é¡¶èµæ­Œ"><a href="#çµ¶é ‚è®ƒæ­Œ-ç»é¡¶èµæ­Œ" class="headerlink" title="çµ¶é ‚è®ƒæ­Œ &#x2F; ç»é¡¶èµæ­Œ"></a>çµ¶é ‚è®ƒæ­Œ &#x2F; ç»é¡¶èµæ­Œ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1vP41137me/">https://www.bilibili.com/video/BV1vP41137me/</a> ï¼ˆå’Œã¬ã‹ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1324y19793/">https://www.bilibili.com/video/BV1324y19793/</a> ï¼ˆKotohaï¼‰</li><li>å‡é™ï¼šPendingï¼ˆ-4 ~ -6ï¼‰</li></ul><h4 id="ãƒãƒ¥ãƒ«ãƒªãƒ©ãƒ»ãƒãƒ¥ãƒ«ãƒªãƒ©ãƒ»ãƒ€ãƒƒãƒ€ãƒƒãƒ€ï¼-Chururira-Chururira-Daddadda"><a href="#ãƒãƒ¥ãƒ«ãƒªãƒ©ãƒ»ãƒãƒ¥ãƒ«ãƒªãƒ©ãƒ»ãƒ€ãƒƒãƒ€ãƒƒãƒ€ï¼-Chururira-Chururira-Daddadda" class="headerlink" title="ãƒãƒ¥ãƒ«ãƒªãƒ©ãƒ»ãƒãƒ¥ãƒ«ãƒªãƒ©ãƒ»ãƒ€ãƒƒãƒ€ãƒƒãƒ€ï¼&#x2F; Chururira Chururira Daddadda!"></a>ãƒãƒ¥ãƒ«ãƒªãƒ©ãƒ»ãƒãƒ¥ãƒ«ãƒªãƒ©ãƒ»ãƒ€ãƒƒãƒ€ãƒƒãƒ€ï¼&#x2F; Chururira Chururira Daddadda!</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1bs41197Th/">https://www.bilibili.com/video/BV1bs41197Th/</a> ï¼ˆç»“æœˆç¼˜ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1B44y1s7qL/">https://www.bilibili.com/video/BV1B44y1s7qL/</a> ï¼ˆãƒ¯ãƒ³ãƒ€ãƒ¼ãƒ©ãƒ³ã‚ºÃ—ã‚·ãƒ§ã‚¦ã‚¿ã‚¤ãƒ ï¼‰</li></ul><h4 id="ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒ»ãƒã‚¶ãƒ¼ã‚°ãƒ¼ã‚¹-Unknown-Mother-Goose"><a href="#ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒ»ãƒã‚¶ãƒ¼ã‚°ãƒ¼ã‚¹-Unknown-Mother-Goose" class="headerlink" title="ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒ»ãƒã‚¶ãƒ¼ã‚°ãƒ¼ã‚¹ &#x2F; Unknown Mother-Goose"></a>ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒ»ãƒã‚¶ãƒ¼ã‚°ãƒ¼ã‚¹ &#x2F; Unknown Mother-Goose</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1hx411b7CZ/">https://www.bilibili.com/video/BV1hx411b7CZ/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1aG4y1C77W/">https://www.bilibili.com/video/BV1aG4y1C77W/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Dx411t7XL/">https://www.bilibili.com/video/BV1Dx411t7XL/</a> ï¼ˆã‚Œã„ï¼‰</li></ul><h4 id="è™è¦–çœˆã€…-è™è§†çœˆçœˆ"><a href="#è™è¦–çœˆã€…-è™è§†çœˆçœˆ" class="headerlink" title="è™è¦–çœˆã€… &#x2F; è™è§†çœˆçœˆ"></a>è™è¦–çœˆã€… &#x2F; è™è§†çœˆçœˆ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1ns411o7PQ/">https://www.bilibili.com/video/BV1ns411o7PQ/</a> ï¼ˆãƒ«ã‚«, ãƒŸã‚¯, ã‚°ãƒŸ, IA, ãƒªãƒ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1pd4y1f7rY/">https://www.bilibili.com/video/BV1pd4y1f7rY/</a> ï¼ˆæ˜é€ï¼‰</li></ul><h4 id="å¼·é¢¨ã‚ªãƒ¼ãƒ«ãƒãƒƒã‚¯-å¼ºé£å¤§èƒŒå¤´"><a href="#å¼·é¢¨ã‚ªãƒ¼ãƒ«ãƒãƒƒã‚¯-å¼ºé£å¤§èƒŒå¤´" class="headerlink" title="å¼·é¢¨ã‚ªãƒ¼ãƒ«ãƒãƒƒã‚¯ &#x2F; å¼ºé£å¤§èƒŒå¤´"></a>å¼·é¢¨ã‚ªãƒ¼ãƒ«ãƒãƒƒã‚¯ &#x2F; å¼ºé£å¤§èƒŒå¤´</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1yL411X7dM/">https://www.bilibili.com/video/BV1yL411X7dM/</a> ï¼ˆæ­Œæ„›ãƒ¦ã‚­ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1LL411B7RN/">https://www.bilibili.com/video/BV1LL411B7RN/</a> ï¼ˆé‡Œå¥ˆRinaï¼‰</li></ul><h4 id="ãƒ€ãƒ¼ãƒªãƒ³-Darling"><a href="#ãƒ€ãƒ¼ãƒªãƒ³-Darling" class="headerlink" title="ãƒ€ãƒ¼ãƒªãƒ³ &#x2F; Darling"></a>ãƒ€ãƒ¼ãƒªãƒ³ &#x2F; Darling</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV11P4y1z74f/">https://www.bilibili.com/video/BV11P4y1z74f/</a> ï¼ˆé ˆç”°æ™¯å‡ªï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1M24y1M7wk/">https://www.bilibili.com/video/BV1M24y1M7wk/</a> ï¼ˆLIZï¼‰</li><li>å‡é™ï¼š+6</li></ul><h4 id="ãƒ­ã‚¦ãƒ¯ãƒ¼-Lower"><a href="#ãƒ­ã‚¦ãƒ¯ãƒ¼-Lower" class="headerlink" title="ãƒ­ã‚¦ãƒ¯ãƒ¼ &#x2F; Lower"></a>ãƒ­ã‚¦ãƒ¯ãƒ¼ &#x2F; Lower</h4><ul><li>åŸå”±ï¼š<a href="https://www.youtube.com/watch?v=3sEptl-psU0">https://www.youtube.com/watch?v=3sEptl-psU0</a> ï¼ˆFLOWERï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1cP4y1v7ML/">https://www.bilibili.com/video/BV1cP4y1v7ML/</a> ï¼ˆLIZï¼‰</li><li>å‡é™ï¼š-4</li></ul><h4 id="å¤ªé™½ç³»ãƒ‡ã‚¹ã‚³-å¤ªé˜³ç³»è¿ªæ–¯ç§‘"><a href="#å¤ªé™½ç³»ãƒ‡ã‚¹ã‚³-å¤ªé˜³ç³»è¿ªæ–¯ç§‘" class="headerlink" title="å¤ªé™½ç³»ãƒ‡ã‚¹ã‚³ &#x2F; å¤ªé˜³ç³»è¿ªæ–¯ç§‘"></a>å¤ªé™½ç³»ãƒ‡ã‚¹ã‚³ &#x2F; å¤ªé˜³ç³»è¿ªæ–¯ç§‘</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Fs411a7mr/">https://www.bilibili.com/video/BV1Fs411a7mr/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‡é™ï¼š-4</li></ul><h4 id="éŠ€æ²³éŒ²-é“¶æ²³å½•"><a href="#éŠ€æ²³éŒ²-é“¶æ²³å½•" class="headerlink" title="éŠ€æ²³éŒ² &#x2F; é“¶æ²³å½•"></a>éŠ€æ²³éŒ² &#x2F; é“¶æ²³å½•</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/list/ml1371645219/">https://www.bilibili.com/list/ml1371645219/</a> ï¼ˆèŠ±ç¢³ï¼‰</li></ul><h4 id="ç™½ã„æ˜¥-ç™½æ˜¥"><a href="#ç™½ã„æ˜¥-ç™½æ˜¥" class="headerlink" title="ç™½ã„æ˜¥ &#x2F; ç™½æ˜¥"></a>ç™½ã„æ˜¥ &#x2F; ç™½æ˜¥</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Df4y1X7yq/">https://www.bilibili.com/video/BV1Df4y1X7yq/</a> ï¼ˆflowerï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1kN4y1T7KA/">https://www.bilibili.com/video/BV1kN4y1T7KA/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li></ul><h4 id="æµ´æ§½ã¨ãƒã‚ªãƒ³ãƒ†ãƒˆãƒ©-æµ´æ§½ä¸éœ“è™¹ç¯é±¼"><a href="#æµ´æ§½ã¨ãƒã‚ªãƒ³ãƒ†ãƒˆãƒ©-æµ´æ§½ä¸éœ“è™¹ç¯é±¼" class="headerlink" title="æµ´æ§½ã¨ãƒã‚ªãƒ³ãƒ†ãƒˆãƒ© &#x2F; æµ´æ§½ä¸éœ“è™¹ç¯é±¼"></a>æµ´æ§½ã¨ãƒã‚ªãƒ³ãƒ†ãƒˆãƒ© &#x2F; æµ´æ§½ä¸éœ“è™¹ç¯é±¼</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV193411Y7ZE/">https://www.bilibili.com/video/BV193411Y7ZE/</a> ï¼ˆFLOWERï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1xf4y1V7jp/">https://www.bilibili.com/video/BV1xf4y1V7jp/</a> ï¼ˆç†Šå­ï¼‰</li></ul><h4 id="ãƒ•ã‚©ãƒ‹ã‚¤-phony"><a href="#ãƒ•ã‚©ãƒ‹ã‚¤-phony" class="headerlink" title="ãƒ•ã‚©ãƒ‹ã‚¤ &#x2F; phony"></a>ãƒ•ã‚©ãƒ‹ã‚¤ &#x2F; phony</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1ih411e7gn/">https://www.bilibili.com/video/BV1ih411e7gn/</a> ï¼ˆå¯ä¸ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1A24y1o7UT/">https://www.bilibili.com/video/BV1A24y1o7UT/</a> ï¼ˆHIMEHINAï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="ã‚°ãƒƒãƒã‚¤å®£è¨€-å†è§å®£è¨€"><a href="#ã‚°ãƒƒãƒã‚¤å®£è¨€-å†è§å®£è¨€" class="headerlink" title="ã‚°ãƒƒãƒã‚¤å®£è¨€ &#x2F; å†è§å®£è¨€"></a>ã‚°ãƒƒãƒã‚¤å®£è¨€ &#x2F; å†è§å®£è¨€</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1194y197Re/">https://www.bilibili.com/video/BV1194y197Re/</a> ï¼ˆFLOWERï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Pb4y1k7PY/">https://www.bilibili.com/video/BV1Pb4y1k7PY/</a> ï¼ˆéº»å©†è±†è…ï¼‰</li><li>å‡é™ï¼š-2</li></ul><h4 id="Airhead"><a href="#Airhead" class="headerlink" title="Airhead"></a>Airhead</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1cW411F7Em/">https://www.bilibili.com/video/BV1cW411F7Em/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1yp411o7Ku/">https://www.bilibili.com/video/BV1yp411o7Ku/</a> ï¼ˆã‚Œã„ï¼‰</li><li>å‡é™ï¼š-6</li></ul><h4 id="Loveit"><a href="#Loveit" class="headerlink" title="Loveit?"></a>Loveit?</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1mg4y1M7Ee/">https://www.bilibili.com/video/BV1mg4y1M7Ee/</a> ï¼ˆLOLUETï¼‰</li></ul><h4 id="CH4NGE"><a href="#CH4NGE" class="headerlink" title="CH4NGE"></a>CH4NGE</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1YF411B7LL/%EF%BC%88%E5%8F%AF%E4%B8%8D%EF%BC%89">https://www.bilibili.com/video/BV1YF411B7LL/ï¼ˆå¯ä¸ï¼‰</a></li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1RV4y1y71q/%EF%BC%88HIMEHINA%EF%BC%89">https://www.bilibili.com/video/BV1RV4y1y71q/ï¼ˆHIMEHINAï¼‰</a></li><li>æ—¶é—´ï¼š-1</li></ul><h4 id="ã†ã£ã›ã‡ã‚-åµæ­»äº†"><a href="#ã†ã£ã›ã‡ã‚-åµæ­»äº†" class="headerlink" title="ã†ã£ã›ã‡ã‚ &#x2F; åµæ­»äº†"></a>ã†ã£ã›ã‡ã‚ &#x2F; åµæ­»äº†</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1ih411b7La/">https://www.bilibili.com/video/BV1ih411b7La/</a> ï¼ˆAdoï¼‰</li><li>å‡é™ï¼š+1</li></ul><h4 id="è¸Š-èˆ"><a href="#è¸Š-èˆ" class="headerlink" title="è¸Š &#x2F; èˆ"></a>è¸Š &#x2F; èˆ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1z44y1X74y/">https://www.bilibili.com/video/BV1z44y1X74y/</a> ï¼ˆAdoï¼‰</li></ul><h4 id="å”±-Show"><a href="#å”±-Show" class="headerlink" title="å”± &#x2F; Show"></a>å”± &#x2F; Show</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV18N4y197aG/">https://www.bilibili.com/video/BV18N4y197aG/</a> ï¼ˆAdoï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1vc41197rr/">https://www.bilibili.com/video/BV1vc41197rr/</a> ï¼ˆHIMEHINAï¼‰</li></ul><h3 id="ãƒ”ãƒã‚­ã‚ªãƒ”ãƒ¼"><a href="#ãƒ”ãƒã‚­ã‚ªãƒ”ãƒ¼" class="headerlink" title="ãƒ”ãƒã‚­ã‚ªãƒ”ãƒ¼"></a>ãƒ”ãƒã‚­ã‚ªãƒ”ãƒ¼</h3><h4 id="ç¥ã£ã½ã„ãª-åƒç¥ä¸€æ ·å‘¢"><a href="#ç¥ã£ã½ã„ãª-åƒç¥ä¸€æ ·å‘¢" class="headerlink" title="ç¥ã£ã½ã„ãª &#x2F; åƒç¥ä¸€æ ·å‘¢"></a>ç¥ã£ã½ã„ãª &#x2F; åƒç¥ä¸€æ ·å‘¢</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1iP4y1Y7NE/">https://www.bilibili.com/video/BV1iP4y1Y7NE/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1zG4y1z7RZ/">https://www.bilibili.com/video/BV1zG4y1z7RZ/</a> ï¼ˆHIMEHINAï¼‰</li></ul><h4 id="è»¢ç”Ÿæ—æª-è½¬ç”Ÿè‹¹æœ"><a href="#è»¢ç”Ÿæ—æª-è½¬ç”Ÿè‹¹æœ" class="headerlink" title="è»¢ç”Ÿæ—æª &#x2F; è½¬ç”Ÿè‹¹æœ"></a>è»¢ç”Ÿæ—æª &#x2F; è½¬ç”Ÿè‹¹æœ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1EY4y1V71F/">https://www.bilibili.com/video/BV1EY4y1V71F/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1z84y1Y7XD/">https://www.bilibili.com/video/BV1z84y1Y7XD/</a> ï¼ˆRoselia, ï¼‹Î±ï¼‰</li></ul><h4 id="é­”æ³•å°‘å¥³ã¨ãƒãƒ§ã‚³ãƒ¬ã‚ãƒˆ-é­”æ³•å°‘å¥³ä¸å·§å…‹åŠ›"><a href="#é­”æ³•å°‘å¥³ã¨ãƒãƒ§ã‚³ãƒ¬ã‚ãƒˆ-é­”æ³•å°‘å¥³ä¸å·§å…‹åŠ›" class="headerlink" title="é­”æ³•å°‘å¥³ã¨ãƒãƒ§ã‚³ãƒ¬ã‚ãƒˆ &#x2F; é­”æ³•å°‘å¥³ä¸å·§å…‹åŠ›"></a>é­”æ³•å°‘å¥³ã¨ãƒãƒ§ã‚³ãƒ¬ã‚ãƒˆ &#x2F; é­”æ³•å°‘å¥³ä¸å·§å…‹åŠ›</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV11Z4y1k7wC/">https://www.bilibili.com/video/BV11Z4y1k7wC/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV13V4y1x77w/">https://www.bilibili.com/video/BV13V4y1x77w/</a> ï¼ˆé¹¿ä¹ƒ, LONï¼‰</li></ul><h3 id="Kanaria"><a href="#Kanaria" class="headerlink" title="Kanaria"></a>Kanaria</h3><h4 id="ç™¾é¬¼ç¥­"><a href="#ç™¾é¬¼ç¥­" class="headerlink" title="ç™¾é¬¼ç¥­"></a>ç™¾é¬¼ç¥­</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Si421d783/">https://www.bilibili.com/video/BV1Si421d783/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‡é™ï¼š-4 ~ -5</li></ul><h4 id="KING"><a href="#KING" class="headerlink" title="KING"></a>KING</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Ya4y1E7pk/">https://www.bilibili.com/video/BV1Ya4y1E7pk/</a> ï¼ˆGUMIï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1re411G7MW/">https://www.bilibili.com/video/BV1re411G7MW/</a> ï¼ˆLONï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="QUEEN"><a href="#QUEEN" class="headerlink" title="QUEEN"></a>QUEEN</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1ug411y7DX/">https://www.bilibili.com/video/BV1ug411y7DX/</a> ï¼ˆGUMIï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV18D4y1r7jg/">https://www.bilibili.com/video/BV18D4y1r7jg/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="é…”ã„ã©ã‚ŒçŸ¥ã‚‰ãš-ä¸çŸ¥é†‰"><a href="#é…”ã„ã©ã‚ŒçŸ¥ã‚‰ãš-ä¸çŸ¥é†‰" class="headerlink" title="é…”ã„ã©ã‚ŒçŸ¥ã‚‰ãš &#x2F; ä¸çŸ¥é†‰"></a>é…”ã„ã©ã‚ŒçŸ¥ã‚‰ãš &#x2F; ä¸çŸ¥é†‰</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1oZ4y1C7Ta/">https://www.bilibili.com/video/BV1oZ4y1C7Ta/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1394y1x7f1/">https://www.bilibili.com/video/BV1394y1x7f1/</a> ï¼ˆHIMEHINAï¼‰</li></ul><h4 id="ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£-Identity"><a href="#ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£-Identity" class="headerlink" title="ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ &#x2F; Identity"></a>ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ &#x2F; Identity</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1nL41157aa/">https://www.bilibili.com/video/BV1nL41157aa/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1hY4y1p7q7/">https://www.bilibili.com/video/BV1hY4y1p7q7/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="ENVY-BABY"><a href="#ENVY-BABY" class="headerlink" title="ENVY BABY"></a>ENVY BABY</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Jf4y1z7hK/">https://www.bilibili.com/video/BV1Jf4y1z7hK/</a> ï¼ˆGUMIï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Wb4y197s8/">https://www.bilibili.com/video/BV1Wb4y197s8/</a> ï¼ˆç»Šçˆ±ï¼‰</li><li>å‡é™ï¼š-1</li></ul><h3 id="DECO-27"><a href="#DECO-27" class="headerlink" title="DECO*27"></a>DECO*27</h3><h4 id="å¦„æƒ³æ„Ÿå‚·ä»£å„Ÿé€£ç›Ÿ"><a href="#å¦„æƒ³æ„Ÿå‚·ä»£å„Ÿé€£ç›Ÿ" class="headerlink" title="å¦„æƒ³æ„Ÿå‚·ä»£å„Ÿé€£ç›Ÿ"></a>å¦„æƒ³æ„Ÿå‚·ä»£å„Ÿé€£ç›Ÿ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1gx411u76u/">https://www.bilibili.com/video/BV1gx411u76u/</a> ï¼ˆåˆéŸ³ï¼‰</li></ul><h4 id="ã‚µãƒ©ãƒãƒ³ãƒ€ãƒ¼-æ²™æ‹‰æ›¼è¾¾"><a href="#ã‚µãƒ©ãƒãƒ³ãƒ€ãƒ¼-æ²™æ‹‰æ›¼è¾¾" class="headerlink" title="ã‚µãƒ©ãƒãƒ³ãƒ€ãƒ¼ &#x2F; æ²™æ‹‰æ›¼è¾¾"></a>ã‚µãƒ©ãƒãƒ³ãƒ€ãƒ¼ &#x2F; æ²™æ‹‰æ›¼è¾¾</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1qu411U7qv/">https://www.bilibili.com/video/BV1qu411U7qv/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1iS4y1S7Qj/">https://www.bilibili.com/video/BV1iS4y1S7Qj/</a> ï¼ˆæ±é›²å½°äºº, æ±é›²çµµåï¼‰</li><li>å‡é™ï¼šPending (-2)</li></ul><h4 id="ãƒ´ã‚¡ãƒ³ãƒ‘ã‚¤ã‚¢-å¸è¡€é¬¼"><a href="#ãƒ´ã‚¡ãƒ³ãƒ‘ã‚¤ã‚¢-å¸è¡€é¬¼" class="headerlink" title="ãƒ´ã‚¡ãƒ³ãƒ‘ã‚¤ã‚¢ &#x2F; å¸è¡€é¬¼"></a>ãƒ´ã‚¡ãƒ³ãƒ‘ã‚¤ã‚¢ &#x2F; å¸è¡€é¬¼</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1by4y187EM/">https://www.bilibili.com/video/BV1by4y187EM/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV11e4y1276W/">https://www.bilibili.com/video/BV11e4y1276W/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li><li>å‡é™ï¼š-2</li></ul><h4 id="ã‚¢ãƒ‹ãƒãƒ«-Animal"><a href="#ã‚¢ãƒ‹ãƒãƒ«-Animal" class="headerlink" title="ã‚¢ãƒ‹ãƒãƒ« &#x2F; Animal"></a>ã‚¢ãƒ‹ãƒãƒ« &#x2F; Animal</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Ei4y1Z7uF/">https://www.bilibili.com/video/BV1Ei4y1Z7uF/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1f34y1i7GV/">https://www.bilibili.com/video/BV1f34y1i7GV/</a> ï¼ˆLIZï¼‰</li><li>å‡é™ï¼š-1</li></ul><h3 id="ã‹ã„ã‚Šããƒ™ã‚¢"><a href="#ã‹ã„ã‚Šããƒ™ã‚¢" class="headerlink" title="ã‹ã„ã‚Šããƒ™ã‚¢"></a>ã‹ã„ã‚Šããƒ™ã‚¢</h3><h4 id="å¤©ä½¿"><a href="#å¤©ä½¿" class="headerlink" title="å¤©ä½¿"></a>å¤©ä½¿</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1db411W7U1/">https://www.bilibili.com/video/BV1db411W7U1/</a> ï¼ˆé³´èŠ±ãƒŸã‚³ãƒˆï¼‰</li></ul><h4 id="Darling-Dance"><a href="#Darling-Dance" class="headerlink" title="Darling Dance"></a>Darling Dance</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Zi4y1M75s/">https://www.bilibili.com/video/BV1Zi4y1M75s/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1HT4y1r7cG/">https://www.bilibili.com/video/BV1HT4y1r7cG/</a> ï¼ˆAdoï¼‰</li></ul><h4 id="ãƒ™ãƒãƒ -çŒ›æ¯’"><a href="#ãƒ™ãƒãƒ -çŒ›æ¯’" class="headerlink" title="ãƒ™ãƒãƒ  &#x2F; çŒ›æ¯’"></a>ãƒ™ãƒãƒ  &#x2F; çŒ›æ¯’</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV17s41137mU/">https://www.bilibili.com/video/BV17s41137mU/</a> ï¼ˆFLOWERï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Qt4y117sb/">https://www.bilibili.com/video/BV1Qt4y117sb/</a> ï¼ˆMegaï¼‰</li></ul><h4 id="ãƒã‚°-Bug"><a href="#ãƒã‚°-Bug" class="headerlink" title="ãƒã‚° &#x2F; Bug"></a>ãƒã‚° &#x2F; Bug</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1n94y117jB/">https://www.bilibili.com/video/BV1n94y117jB/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1rY4y1g7qF/">https://www.bilibili.com/video/BV1rY4y1g7qF/</a> ï¼ˆ25æ™‚ã€ãƒŠã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã§ã€‚ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1bV411N7Ts/">https://www.bilibili.com/video/BV1bV411N7Ts/</a> ï¼ˆHIMEHINAï¼‰</li><li>å‡é™ï¼š-1</li></ul><h3 id="æŸŠã‚­ãƒ©ã‚¤"><a href="#æŸŠã‚­ãƒ©ã‚¤" class="headerlink" title="æŸŠã‚­ãƒ©ã‚¤"></a>æŸŠã‚­ãƒ©ã‚¤</h3><h4 id="çš±é³ƒé²¨ï¼Ÿ"><a href="#çš±é³ƒé²¨ï¼Ÿ" class="headerlink" title="çš±é³ƒé²¨ï¼Ÿ"></a>çš±é³ƒé²¨ï¼Ÿ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1VT4y1M7Ae/%EF%BC%88Ado%EF%BC%89">https://www.bilibili.com/video/BV1VT4y1M7Ae/ï¼ˆAdoï¼‰</a></li></ul><h4 id="ã‚®ãƒ£ãƒ©ãƒªã‚¢-ç”»å»Š"><a href="#ã‚®ãƒ£ãƒ©ãƒªã‚¢-ç”»å»Š" class="headerlink" title="ã‚®ãƒ£ãƒ©ãƒªã‚¢ &#x2F; ç”»å»Š"></a>ã‚®ãƒ£ãƒ©ãƒªã‚¢ &#x2F; ç”»å»Š</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1W44y1h7ib/">https://www.bilibili.com/video/BV1W44y1h7ib/</a> ï¼ˆFLOWERï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1fi4y127Rm/">https://www.bilibili.com/video/BV1fi4y127Rm/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li><li>å‡é™ï¼š-4</li></ul><h4 id="ãƒœãƒƒã‚«ãƒ‡ãƒ©ãƒ™ãƒªã‚¿-çœŸå®ä¹‹å£"><a href="#ãƒœãƒƒã‚«ãƒ‡ãƒ©ãƒ™ãƒªã‚¿-çœŸå®ä¹‹å£" class="headerlink" title="ãƒœãƒƒã‚«ãƒ‡ãƒ©ãƒ™ãƒªã‚¿ &#x2F; çœŸå®ä¹‹å£"></a>ãƒœãƒƒã‚«ãƒ‡ãƒ©ãƒ™ãƒªã‚¿ &#x2F; çœŸå®ä¹‹å£</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1m54y127fJ/">https://www.bilibili.com/video/BV1m54y127fJ/</a> ï¼ˆFLOWERï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1LM411N734/">https://www.bilibili.com/video/BV1LM411N734/</a> ï¼ˆHIMEHINAï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="ã‚¨ãƒ-eva"><a href="#ã‚¨ãƒ-eva" class="headerlink" title="ã‚¨ãƒ &#x2F; eva"></a>ã‚¨ãƒ &#x2F; eva</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV19V41127ug/">https://www.bilibili.com/video/BV19V41127ug/</a> ï¼ˆFLOWERï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1RM4y1w74D/">https://www.bilibili.com/video/BV1RM4y1w74D/</a> ï¼ˆCIELï¼‰</li><li>å‡é™ï¼š-3</li></ul><h4 id="ã‚ªãƒ¼ãƒˆãƒ•ã‚¡ã‚¸ãƒ¼-è‡ªæˆ‘åå™¬"><a href="#ã‚ªãƒ¼ãƒˆãƒ•ã‚¡ã‚¸ãƒ¼-è‡ªæˆ‘åå™¬" class="headerlink" title="ã‚ªãƒ¼ãƒˆãƒ•ã‚¡ã‚¸ãƒ¼ &#x2F; è‡ªæˆ‘åå™¬"></a>ã‚ªãƒ¼ãƒˆãƒ•ã‚¡ã‚¸ãƒ¼ &#x2F; è‡ªæˆ‘åå™¬</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Vt4y1q7e3/">https://www.bilibili.com/video/BV1Vt4y1q7e3/</a> ï¼ˆFLOWERï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1SQ4y1B7Tp/">https://www.bilibili.com/video/BV1SQ4y1B7Tp/</a> ï¼ˆå­˜æµï¼‰</li><li>å‡é™ï¼šPendingï¼ˆ-2ï¼‰</li></ul><h3 id="syudou"><a href="#syudou" class="headerlink" title="syudou"></a>syudou</h3><h4 id="ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆã‚µãƒƒãƒ‰ã‚¬ãƒ¼ãƒ«-Jackpot-Sad-Girl"><a href="#ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆã‚µãƒƒãƒ‰ã‚¬ãƒ¼ãƒ«-Jackpot-Sad-Girl" class="headerlink" title="ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆã‚µãƒƒãƒ‰ã‚¬ãƒ¼ãƒ« &#x2F; Jackpot Sad Girl"></a>ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆã‚µãƒƒãƒ‰ã‚¬ãƒ¼ãƒ« &#x2F; Jackpot Sad Girl</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1gA411j7fr/">https://www.bilibili.com/video/BV1gA411j7fr/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Rh411z7Rc/">https://www.bilibili.com/video/BV1Rh411z7Rc/</a> ï¼ˆ25æ™‚ã€ãƒŠã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã§ã€‚ï¼‰</li><li>å‡é™ï¼šPending (+4)</li></ul><h4 id="ãƒ“ã‚¿ãƒ¼ãƒãƒ§ã‚³ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³-è‹¦å·§å…‹åŠ›è£…é¥°"><a href="#ãƒ“ã‚¿ãƒ¼ãƒãƒ§ã‚³ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³-è‹¦å·§å…‹åŠ›è£…é¥°" class="headerlink" title="ãƒ“ã‚¿ãƒ¼ãƒãƒ§ã‚³ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ &#x2F; è‹¦å·§å…‹åŠ›è£…é¥°"></a>ãƒ“ã‚¿ãƒ¼ãƒãƒ§ã‚³ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ &#x2F; è‹¦å·§å…‹åŠ›è£…é¥°</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1m7411P7pL/">https://www.bilibili.com/video/BV1m7411P7pL/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1M3411X7jH/">https://www.bilibili.com/video/BV1M3411X7jH/</a> ï¼ˆ25æ™‚ã€ãƒŠã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã§ã€‚ï¼‰</li><li>å‡é™ï¼š-2</li></ul><h4 id="ã‚®ãƒ£ãƒ³ãƒ–ãƒ«-èµŒå±€"><a href="#ã‚®ãƒ£ãƒ³ãƒ–ãƒ«-èµŒå±€" class="headerlink" title="ã‚®ãƒ£ãƒ³ãƒ–ãƒ« &#x2F; èµŒå±€"></a>ã‚®ãƒ£ãƒ³ãƒ–ãƒ« &#x2F; èµŒå±€</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1By4y1K7og/">https://www.bilibili.com/video/BV1By4y1K7og/</a> ï¼ˆsyudouï¼‰</li><li>å‡é™ï¼š-2</li></ul><h4 id="ã‚­ãƒ¥ãƒ¼ãƒˆãªã‚«ãƒã‚¸ãƒ§-å¯çˆ±çš„å¥³å‹"><a href="#ã‚­ãƒ¥ãƒ¼ãƒˆãªã‚«ãƒã‚¸ãƒ§-å¯çˆ±çš„å¥³å‹" class="headerlink" title="ã‚­ãƒ¥ãƒ¼ãƒˆãªã‚«ãƒã‚¸ãƒ§ &#x2F; å¯çˆ±çš„å¥³å‹"></a>ã‚­ãƒ¥ãƒ¼ãƒˆãªã‚«ãƒã‚¸ãƒ§ &#x2F; å¯çˆ±çš„å¥³å‹</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1E5411N7nP/">https://www.bilibili.com/video/BV1E5411N7nP/</a> ï¼ˆå¯ä¸ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1864y1y7hV/">https://www.bilibili.com/video/BV1864y1y7hV/</a> ï¼ˆé¹¿ä¹ƒï¼‰</li><li>å‡é™ï¼š-3</li></ul><h4 id="çˆ†ç¬‘"><a href="#çˆ†ç¬‘" class="headerlink" title="çˆ†ç¬‘"></a>çˆ†ç¬‘</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1rB4y1u7ub/">https://www.bilibili.com/video/BV1rB4y1u7ub/</a> ï¼ˆsoydouï¼‰</li><li>å‡é™ï¼š-2</li></ul><h3 id="MARETU"><a href="#MARETU" class="headerlink" title="MARETU"></a>MARETU</h3><h4 id="è„³å†…é©å‘½ã‚«ã‚™ãƒ¼ãƒ«-è„‘å†…é©å‘½å¥³å­©"><a href="#è„³å†…é©å‘½ã‚«ã‚™ãƒ¼ãƒ«-è„‘å†…é©å‘½å¥³å­©" class="headerlink" title="è„³å†…é©å‘½ã‚«ã‚™ãƒ¼ãƒ« &#x2F; è„‘å†…é©å‘½å¥³å­©"></a>è„³å†…é©å‘½ã‚«ã‚™ãƒ¼ãƒ« &#x2F; è„‘å†…é©å‘½å¥³å­©</h4><ul><li>åŸå”±ï¼š<a href="https://www.youtube.com/watch?v=sjr-tPFADpM">https://www.youtube.com/watch?v=sjr-tPFADpM</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1v34y167XK/">https://www.bilibili.com/video/BV1v34y167XK/</a> ï¼ˆCIELï¼‰</li></ul><h4 id="ãƒŠãƒŸãƒ€-æ³ª"><a href="#ãƒŠãƒŸãƒ€-æ³ª" class="headerlink" title="ãƒŠãƒŸãƒ€ &#x2F; æ³ª"></a>ãƒŠãƒŸãƒ€ &#x2F; æ³ª</h4><ul><li>åŸå”±ï¼š<a href="https://www.youtube.com/watch?v=cDeJQZKEEQo">https://www.youtube.com/watch?v=cDeJQZKEEQo</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1gB4y1k7HL/">https://www.bilibili.com/video/BV1gB4y1k7HL/</a> ï¼ˆCIELï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Zy4y1L735/">https://www.bilibili.com/video/BV1Zy4y1L735/</a> ï¼ˆYuniï¼‰</li></ul><h3 id="ãƒ°ä¸–ç•Œæƒ…ç·’"><a href="#ãƒ°ä¸–ç•Œæƒ…ç·’" class="headerlink" title="ãƒ°ä¸–ç•Œæƒ…ç·’"></a>ãƒ°ä¸–ç•Œæƒ…ç·’</h3><h4 id="ãƒã‚¤ãƒ‰ãƒ¬ãƒ³ã‚¸ã‚¢"><a href="#ãƒã‚¤ãƒ‰ãƒ¬ãƒ³ã‚¸ã‚¢" class="headerlink" title="ãƒã‚¤ãƒ‰ãƒ¬ãƒ³ã‚¸ã‚¢"></a>ãƒã‚¤ãƒ‰ãƒ¬ãƒ³ã‚¸ã‚¢</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1ov411B7Ed/">https://www.bilibili.com/video/BV1ov411B7Ed/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="ã„ã‚ã¯ã«å’²ãã¦"><a href="#ã„ã‚ã¯ã«å’²ãã¦" class="headerlink" title="ã„ã‚ã¯ã«å’²ãã¦"></a>ã„ã‚ã¯ã«å’²ãã¦</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1V54y1D7i4/">https://www.bilibili.com/video/BV1V54y1D7i4/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li></ul><h4 id="ã¨ã‚ã©ãªãç™½æƒ…"><a href="#ã¨ã‚ã©ãªãç™½æƒ…" class="headerlink" title="ã¨ã‚ã©ãªãç™½æƒ…"></a>ã¨ã‚ã©ãªãç™½æƒ…</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Gz4y1o7wu/">https://www.bilibili.com/video/BV1Gz4y1o7wu/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li></ul><h4 id="æ–¯ãç¾ã—ãé€ èŠ±"><a href="#æ–¯ãç¾ã—ãé€ èŠ±" class="headerlink" title="æ–¯ãç¾ã—ãé€ èŠ±"></a>æ–¯ãç¾ã—ãé€ èŠ±</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1hy4y1q72c/">https://www.bilibili.com/video/BV1hy4y1q72c/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li></ul><h4 id="æ·±æ¸Š"><a href="#æ·±æ¸Š" class="headerlink" title="æ·±æ¸Š"></a>æ·±æ¸Š</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1no4y1k7Bs/">https://www.bilibili.com/video/BV1no4y1k7Bs/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼ŒèŠ±è°±ï¼‰</li></ul><h4 id="æš®ã‚Œãªãšã‚€ç´„æŸ"><a href="#æš®ã‚Œãªãšã‚€ç´„æŸ" class="headerlink" title="æš®ã‚Œãªãšã‚€ç´„æŸ"></a>æš®ã‚Œãªãšã‚€ç´„æŸ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Pg411p7Zc/">https://www.bilibili.com/video/BV1Pg411p7Zc/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li></ul><h3 id="ã‚«ãƒ³ã‚¶ã‚­ã‚¤ã‚ªãƒª"><a href="#ã‚«ãƒ³ã‚¶ã‚­ã‚¤ã‚ªãƒª" class="headerlink" title="ã‚«ãƒ³ã‚¶ã‚­ã‚¤ã‚ªãƒª"></a>ã‚«ãƒ³ã‚¶ã‚­ã‚¤ã‚ªãƒª</h3><h4 id="å‘½ã«å«Œã‚ã‚Œã¦ã„ã‚‹-è¢«ç”Ÿå‘½æ‰€åŒæ¶"><a href="#å‘½ã«å«Œã‚ã‚Œã¦ã„ã‚‹-è¢«ç”Ÿå‘½æ‰€åŒæ¶" class="headerlink" title="å‘½ã«å«Œã‚ã‚Œã¦ã„ã‚‹ &#x2F; è¢«ç”Ÿå‘½æ‰€åŒæ¶"></a>å‘½ã«å«Œã‚ã‚Œã¦ã„ã‚‹ &#x2F; è¢«ç”Ÿå‘½æ‰€åŒæ¶</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Hx411p7pH/">https://www.bilibili.com/video/BV1Hx411p7pH/</a> ï¼ˆåˆéŸ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1KN41187YQ/">https://www.bilibili.com/video/BV1KN41187YQ/</a> ï¼ˆé»‘æŸ¿å­ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1pm4y1s7NY/">https://www.bilibili.com/video/BV1pm4y1s7NY/</a> ï¼ˆå®µå´å¥ï¼‰</li><li>å‡é™ï¼š-2</li></ul><h4 id="ã‚ã®å¤ãŒé£½å’Œã™ã‚‹-é‚£ä¸ªå¤å¤©å·²ç„¶é¥±å’Œ"><a href="#ã‚ã®å¤ãŒé£½å’Œã™ã‚‹-é‚£ä¸ªå¤å¤©å·²ç„¶é¥±å’Œ" class="headerlink" title="ã‚ã®å¤ãŒé£½å’Œã™ã‚‹ &#x2F; é‚£ä¸ªå¤å¤©å·²ç„¶é¥±å’Œ"></a>ã‚ã®å¤ãŒé£½å’Œã™ã‚‹ &#x2F; é‚£ä¸ªå¤å¤©å·²ç„¶é¥±å’Œ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Ws411T7hx/">https://www.bilibili.com/video/BV1Ws411T7hx/</a> ï¼ˆé¡éŸ³ãƒ¬ãƒ³ï¼Œé¡éŸ³ãƒªãƒ³ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV19J411D7co/">https://www.bilibili.com/video/BV19J411D7co/</a> ï¼ˆEMAï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1HS4y1v7Di/">https://www.bilibili.com/video/BV1HS4y1v7Di/</a> ï¼ˆé»‘æŸ¿å­ï¼‰</li><li>å‡é™ï¼š-2</li></ul><h4 id="é’ã„å·å“­-é’è‰²çš„å·å“­"><a href="#é’ã„å·å“­-é’è‰²çš„å·å“­" class="headerlink" title="é’ã„å·å“­ &#x2F; é’è‰²çš„å·å“­"></a>é’ã„å·å“­ &#x2F; é’è‰²çš„å·å“­</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1X64y1i765/">https://www.bilibili.com/video/BV1X64y1i765/</a> ï¼ˆé»‘æŸ¿å­ï¼‰</li></ul><h4 id="å¶åƒ"><a href="#å¶åƒ" class="headerlink" title="å¶åƒ"></a>å¶åƒ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1mr4y1z7ot/">https://www.bilibili.com/video/BV1mr4y1z7ot/</a> ï¼ˆé»‘æŸ¿å­ï¼‰</li></ul><h4 id="åœ°ç„ã«è½ã¡ã‚‹-å å…¥åœ°ç‹±"><a href="#åœ°ç„ã«è½ã¡ã‚‹-å å…¥åœ°ç‹±" class="headerlink" title="åœ°ç„ã«è½ã¡ã‚‹ &#x2F; å å…¥åœ°ç‹±"></a>åœ°ç„ã«è½ã¡ã‚‹ &#x2F; å å…¥åœ°ç‹±</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1PP4y1h7EG/">https://www.bilibili.com/video/BV1PP4y1h7EG/</a> ï¼ˆé»‘æŸ¿å­ï¼‰</li><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1XY411b7Zv/">https://www.bilibili.com/video/BV1XY411b7Zv/</a> ï¼ˆå¯ä¸ï¼‰</li><li>å‡é™ï¼š-2</li></ul><h4 id="æ¡œã®å­-æ¨±ä¹‹å­"><a href="#æ¡œã®å­-æ¨±ä¹‹å­" class="headerlink" title="æ¡œã®å­ &#x2F; æ¨±ä¹‹å­"></a>æ¡œã®å­ &#x2F; æ¨±ä¹‹å­</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Tu411o7sm/">https://www.bilibili.com/video/BV1Tu411o7sm/</a> ï¼ˆé»‘æŸ¿å­ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Gd4y1L7YJ/">https://www.bilibili.com/video/BV1Gd4y1L7YJ/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ª, èŠ±è°±ï¼‰</li></ul><h4 id="ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰-é’»çŸ³"><a href="#ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰-é’»çŸ³" class="headerlink" title="ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ &#x2F; é’»çŸ³"></a>ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ &#x2F; é’»çŸ³</h4><h4 id="å¸è¡€é¬¼"><a href="#å¸è¡€é¬¼" class="headerlink" title="å¸è¡€é¬¼"></a>å¸è¡€é¬¼</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Rf4y1M7vr/">https://www.bilibili.com/video/BV1Rf4y1M7vr/</a> ï¼ˆé»‘æŸ¿å­ï¼‰</li><li>å‡é™ï¼š-2</li></ul><h3 id="ç±³æ´¥ç„å¸ˆ"><a href="#ç±³æ´¥ç„å¸ˆ" class="headerlink" title="ç±³æ´¥ç„å¸ˆ"></a>ç±³æ´¥ç„å¸ˆ</h3><h4 id="æµ·ã®å¹½éœŠ-æµ·ä¹‹å¹½çµ"><a href="#æµ·ã®å¹½éœŠ-æµ·ä¹‹å¹½çµ" class="headerlink" title="æµ·ã®å¹½éœŠ &#x2F; æµ·ä¹‹å¹½çµ"></a>æµ·ã®å¹½éœŠ &#x2F; æµ·ä¹‹å¹½çµ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1X441167MX/">https://www.bilibili.com/video/BV1X441167MX/</a> ï¼ˆå…«çˆ·ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Yi4y1R7b4/">https://www.bilibili.com/video/BV1Yi4y1R7b4/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li><li>å‡é™ï¼š+1</li></ul><h4 id="é§„è“å­å±‹å•†å£²-ç²—ç‚¹å¿ƒåº—ç”Ÿæ„"><a href="#é§„è“å­å±‹å•†å£²-ç²—ç‚¹å¿ƒåº—ç”Ÿæ„" class="headerlink" title="é§„è“å­å±‹å•†å£² &#x2F; ç²—ç‚¹å¿ƒåº—ç”Ÿæ„"></a>é§„è“å­å±‹å•†å£² &#x2F; ç²—ç‚¹å¿ƒåº—ç”Ÿæ„</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1S54y1H7dG/">https://www.bilibili.com/video/BV1S54y1H7dG/</a> ï¼ˆå…«çˆ·ï¼‰</li><li>å‡é™ï¼š-2</li></ul><h4 id="ãƒãƒˆãƒªãƒ§ã‚·ã‚«-ä¿„ç½—æ–¯å¥—å¨ƒ"><a href="#ãƒãƒˆãƒªãƒ§ã‚·ã‚«-ä¿„ç½—æ–¯å¥—å¨ƒ" class="headerlink" title="ãƒãƒˆãƒªãƒ§ã‚·ã‚« &#x2F; ä¿„ç½—æ–¯å¥—å¨ƒ"></a>ãƒãƒˆãƒªãƒ§ã‚·ã‚« &#x2F; ä¿„ç½—æ–¯å¥—å¨ƒ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Hh411t7uW/">https://www.bilibili.com/video/BV1Hh411t7uW/</a> ï¼ˆå…«çˆ·ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV153411d7Wm/">https://www.bilibili.com/video/BV153411d7Wm/</a> ï¼ˆå¼‚ä¸–ç•Œæƒ…ç»ªï¼‰</li></ul><h3 id="ãƒ¨ãƒ«ã‚·ã‚«"><a href="#ãƒ¨ãƒ«ã‚·ã‚«" class="headerlink" title="ãƒ¨ãƒ«ã‚·ã‚«"></a>ãƒ¨ãƒ«ã‚·ã‚«</h3><h4 id="ãŸã å›ã«æ™´ã‚Œ"><a href="#ãŸã å›ã«æ™´ã‚Œ" class="headerlink" title="ãŸã å›ã«æ™´ã‚Œ"></a>ãŸã å›ã«æ™´ã‚Œ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1dW41137on/">https://www.bilibili.com/video/BV1dW41137on/</a> ï¼ˆsuisï¼‰</li></ul><h4 id="ã ã‹ã‚‰åƒ•ã¯éŸ³æ¥½ã‚’è¾ã‚ãŸ"><a href="#ã ã‹ã‚‰åƒ•ã¯éŸ³æ¥½ã‚’è¾ã‚ãŸ" class="headerlink" title="ã ã‹ã‚‰åƒ•ã¯éŸ³æ¥½ã‚’è¾ã‚ãŸ"></a>ã ã‹ã‚‰åƒ•ã¯éŸ³æ¥½ã‚’è¾ã‚ãŸ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Qb411g7bY/">https://www.bilibili.com/video/BV1Qb411g7bY/</a> ï¼ˆsuisï¼‰</li></ul><h4 id="å…«æœˆã€æŸã€æœˆæ˜ã‹ã‚Š"><a href="#å…«æœˆã€æŸã€æœˆæ˜ã‹ã‚Š" class="headerlink" title="å…«æœˆã€æŸã€æœˆæ˜ã‹ã‚Š"></a>å…«æœˆã€æŸã€æœˆæ˜ã‹ã‚Š</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1mP4y1q7MZ/">https://www.bilibili.com/video/BV1mP4y1q7MZ/</a> ï¼ˆsuisï¼‰</li></ul><h4 id="æ€æƒ³çŠ¯"><a href="#æ€æƒ³çŠ¯" class="headerlink" title="æ€æƒ³çŠ¯"></a>æ€æƒ³çŠ¯</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Ap4y1Q7MD/">https://www.bilibili.com/video/BV1Ap4y1Q7MD/</a> ï¼ˆsuisï¼‰</li><li>å‡é™ï¼š+2</li></ul><h4 id="æ˜¥æ³¥æ£’"><a href="#æ˜¥æ³¥æ£’" class="headerlink" title="æ˜¥æ³¥æ£’"></a>æ˜¥æ³¥æ£’</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV17t4y1r7Jq/">https://www.bilibili.com/video/BV17t4y1r7Jq/</a> ï¼ˆsuisï¼‰</li><li>å‡é™ï¼š+2</li></ul><h3 id="ãšã£ã¨çœŸå¤œä¸­ã§ã„ã„ã®ã«ã€‚"><a href="#ãšã£ã¨çœŸå¤œä¸­ã§ã„ã„ã®ã«ã€‚" class="headerlink" title="ãšã£ã¨çœŸå¤œä¸­ã§ã„ã„ã®ã«ã€‚"></a>ãšã£ã¨çœŸå¤œä¸­ã§ã„ã„ã®ã«ã€‚</h3><h4 id="ç§’é‡ã‚’å™›ã‚€"><a href="#ç§’é‡ã‚’å™›ã‚€" class="headerlink" title="ç§’é‡ã‚’å™›ã‚€"></a>ç§’é‡ã‚’å™›ã‚€</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Es411L7Jn/">https://www.bilibili.com/video/BV1Es411L7Jn/</a> ï¼ˆACAã­ï¼‰</li></ul><h4 id="ã‚µã‚¿ãƒ¼ãƒ³"><a href="#ã‚µã‚¿ãƒ¼ãƒ³" class="headerlink" title="ã‚µã‚¿ãƒ¼ãƒ³"></a>ã‚µã‚¿ãƒ¼ãƒ³</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1LU4y1Y793/">https://www.bilibili.com/video/BV1LU4y1Y793/</a> ï¼ˆACAã­ï¼‰</li></ul><h4 id="å‹˜å†´ãˆã¦æ‚”ã—ã„ã‚"><a href="#å‹˜å†´ãˆã¦æ‚”ã—ã„ã‚" class="headerlink" title="å‹˜å†´ãˆã¦æ‚”ã—ã„ã‚"></a>å‹˜å†´ãˆã¦æ‚”ã—ã„ã‚</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1mh411S7fm/">https://www.bilibili.com/video/BV1mh411S7fm/</a> ï¼ˆACAã­ï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="ãŠå‹‰å¼·ã—ã¨ã„ã¦ã‚ˆ"><a href="#ãŠå‹‰å¼·ã—ã¨ã„ã¦ã‚ˆ" class="headerlink" title="ãŠå‹‰å¼·ã—ã¨ã„ã¦ã‚ˆ"></a>ãŠå‹‰å¼·ã—ã¨ã„ã¦ã‚ˆ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1uf4y1U7wc/">https://www.bilibili.com/video/BV1uf4y1U7wc/</a> ï¼ˆACAã­ï¼‰</li><li>å‡é™ï¼š-2</li></ul><h4 id="ãƒã‚¼é¦³ã›ã‚‹æœã¦ã‚‹ã¾ã§"><a href="#ãƒã‚¼é¦³ã›ã‚‹æœã¦ã‚‹ã¾ã§" class="headerlink" title="ãƒã‚¼é¦³ã›ã‚‹æœã¦ã‚‹ã¾ã§"></a>ãƒã‚¼é¦³ã›ã‚‹æœã¦ã‚‹ã¾ã§</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Wm4y157iK/">https://www.bilibili.com/video/BV1Wm4y157iK/</a> ï¼ˆACAã­ï¼‰</li></ul><h4 id="Dear-Mrã€ŒFã€"><a href="#Dear-Mrã€ŒFã€" class="headerlink" title="Dear Mrã€ŒFã€"></a>Dear Mrã€ŒFã€</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1ch4y1P7bV/">https://www.bilibili.com/video/BV1ch4y1P7bV/</a> ï¼ˆACAã­ï¼‰</li></ul><h4 id="MILABO"><a href="#MILABO" class="headerlink" title="MILABO"></a>MILABO</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1sD4y1S7pw/">https://www.bilibili.com/video/BV1sD4y1S7pw/</a> ï¼ˆACAã­ï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="æ­£ç¾©"><a href="#æ­£ç¾©" class="headerlink" title="æ­£ç¾©"></a>æ­£ç¾©</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1t4411v7ga/">https://www.bilibili.com/video/BV1t4411v7ga/</a> ï¼ˆACAã­ï¼‰</li></ul><h4 id="Ham"><a href="#Ham" class="headerlink" title="Ham"></a>Ham</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Pi4y1g7Ub/">https://www.bilibili.com/video/BV1Pi4y1g7Ub/</a> ï¼ˆACAã­ï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="ã‚ã„ã¤ã‚‰å…¨å“¡åŒçª“ä¼š"><a href="#ã‚ã„ã¤ã‚‰å…¨å“¡åŒçª“ä¼š" class="headerlink" title="ã‚ã„ã¤ã‚‰å…¨å“¡åŒçª“ä¼š"></a>ã‚ã„ã¤ã‚‰å…¨å“¡åŒçª“ä¼š</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1oq4y1M7Y6/">https://www.bilibili.com/video/BV1oq4y1M7Y6/</a> ï¼ˆACAã­ï¼‰</li></ul><h4 id="ç¶ºç¾…ã‚­ãƒ©ãƒ¼"><a href="#ç¶ºç¾…ã‚­ãƒ©ãƒ¼" class="headerlink" title="ç¶ºç¾…ã‚­ãƒ©ãƒ¼"></a>ç¶ºç¾…ã‚­ãƒ©ãƒ¼</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV18K411r7f4/">https://www.bilibili.com/video/BV18K411r7f4/</a> ï¼ˆACAã­ï¼‰</li></ul><h3 id="JPOP"><a href="#JPOP" class="headerlink" title="JPOP"></a>JPOP</h3><h4 id="ä»†ãŒæ­»ã®ã†ã¨æ€ã£ãŸã®ã¯"><a href="#ä»†ãŒæ­»ã®ã†ã¨æ€ã£ãŸã®ã¯" class="headerlink" title="ä»†ãŒæ­»ã®ã†ã¨æ€ã£ãŸã®ã¯"></a>ä»†ãŒæ­»ã®ã†ã¨æ€ã£ãŸã®ã¯</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV164411c78H/">https://www.bilibili.com/video/BV164411c78H/</a> ï¼ˆä¸­å²›ç¾å˜‰ï¼‰</li></ul><h4 id="æå±±ãƒ«ãƒ»ãƒ´ã‚©ãƒ¯ãƒ¼ãƒ«"><a href="#æå±±ãƒ«ãƒ»ãƒ´ã‚©ãƒ¯ãƒ¼ãƒ«" class="headerlink" title="æå±±ãƒ«ãƒ»ãƒ´ã‚©ãƒ¯ãƒ¼ãƒ«"></a>æå±±ãƒ«ãƒ»ãƒ´ã‚©ãƒ¯ãƒ¼ãƒ«</h4><ul><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Bz4y1k7vu/">https://www.bilibili.com/video/BV1Bz4y1k7vu/</a> ï¼ˆæ¼ªæœˆçµï¼‰</li></ul><h4 id="ä¸€å¤œä¹‹æ¢¦"><a href="#ä¸€å¤œä¹‹æ¢¦" class="headerlink" title="ä¸€å¤œä¹‹æ¢¦"></a>ä¸€å¤œä¹‹æ¢¦</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Ps411f77Y/">https://www.bilibili.com/video/BV1Ps411f77Y/</a> ï¼ˆ3Lï¼‰</li></ul><h4 id="å‘½ã«ãµã•ã‚ã—ã„"><a href="#å‘½ã«ãµã•ã‚ã—ã„" class="headerlink" title="å‘½ã«ãµã•ã‚ã—ã„"></a>å‘½ã«ãµã•ã‚ã—ã„</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1jV4y1H7ga/">https://www.bilibili.com/video/BV1jV4y1H7ga/</a> ï¼ˆç§‹ç”°ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1j54y1n79U/">https://www.bilibili.com/video/BV1j54y1n79U/</a> ï¼ˆå“é‡éŸ³ï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="Wherever-you-are"><a href="#Wherever-you-are" class="headerlink" title="Wherever you are"></a>Wherever you are</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1BB4y1U7Py/">https://www.bilibili.com/video/BV1BB4y1U7Py/</a> ï¼ˆONE OK ROCKï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1ib411c7zy/">https://www.bilibili.com/video/BV1ib411c7zy/</a> ï¼ˆé“æ˜å¯ºå¯å¯äºšï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV13s411c7qi/">https://www.bilibili.com/video/BV13s411c7qi/</a> ï¼ˆé“æ˜å¯ºå¯å¯äºšï¼‰</li><li>å‡é™ï¼š+2</li></ul><h4 id="ãƒ‰ãƒ©ã‚¤ãƒ•ãƒ©ãƒ¯ãƒ¼"><a href="#ãƒ‰ãƒ©ã‚¤ãƒ•ãƒ©ãƒ¯ãƒ¼" class="headerlink" title="ãƒ‰ãƒ©ã‚¤ãƒ•ãƒ©ãƒ¯ãƒ¼"></a>ãƒ‰ãƒ©ã‚¤ãƒ•ãƒ©ãƒ¯ãƒ¼</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV13a411a72j/">https://www.bilibili.com/video/BV13a411a72j/</a> ï¼ˆä¼˜é‡Œï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1ki4y117D1/">https://www.bilibili.com/video/BV1ki4y117D1/</a> ï¼ˆå°æŸ”ï¼‰</li><li>å‡é™ï¼š+3</li></ul><h4 id="ã‚«ãƒ«ãƒ‡ãƒ©"><a href="#ã‚«ãƒ«ãƒ‡ãƒ©" class="headerlink" title="ã‚«ãƒ«ãƒ‡ãƒ©"></a>ã‚«ãƒ«ãƒ‡ãƒ©</h4><ul><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1ED4y117Qf/">https://www.bilibili.com/video/BV1ED4y117Qf/</a> ï¼ˆæ¡ƒå‡ OvOï¼‰</li></ul><h4 id="inside-you"><a href="#inside-you" class="headerlink" title="inside you"></a>inside you</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1m24y1S769/">https://www.bilibili.com/video/BV1m24y1S769/</a></li><li>å‡é™ï¼š+1</li></ul><h4 id="ã‚«ã‚¿ã‚ªãƒ¢ã‚¤"><a href="#ã‚«ã‚¿ã‚ªãƒ¢ã‚¤" class="headerlink" title="ã‚«ã‚¿ã‚ªãƒ¢ã‚¤"></a>ã‚«ã‚¿ã‚ªãƒ¢ã‚¤</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1hj411R76u/">https://www.bilibili.com/video/BV1hj411R76u/</a> ï¼ˆAimerï¼‰</li></ul><h4 id="Daisy"><a href="#Daisy" class="headerlink" title="Daisy"></a>Daisy</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1hT4y1q7mQ/">https://www.bilibili.com/video/BV1hT4y1q7mQ/</a> ï¼ˆAimerï¼‰</li></ul><h4 id="ä¸¸ãƒå†…ã‚µãƒ‡ã‚£ã‚¹ãƒ†ã‚£ãƒƒã‚¯"><a href="#ä¸¸ãƒå†…ã‚µãƒ‡ã‚£ã‚¹ãƒ†ã‚£ãƒƒã‚¯" class="headerlink" title="ä¸¸ãƒå†…ã‚µãƒ‡ã‚£ã‚¹ãƒ†ã‚£ãƒƒã‚¯"></a>ä¸¸ãƒå†…ã‚µãƒ‡ã‚£ã‚¹ãƒ†ã‚£ãƒƒã‚¯</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1V3411u7xx/">https://www.bilibili.com/video/BV1V3411u7xx/</a> ï¼ˆæ¤åæ—æªï¼‰</li></ul><h4 id="å¯„ã‚Šé…”ã„"><a href="#å¯„ã‚Šé…”ã„" class="headerlink" title="å¯„ã‚Šé…”ã„"></a>å¯„ã‚Šé…”ã„</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1yo4y1973T/">https://www.bilibili.com/video/BV1yo4y1973T/</a> ï¼ˆå’Œã¬ã‹ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV14P411G7Gi/">https://www.bilibili.com/video/BV14P411G7Gi/</a> ï¼ˆEMAï¼‰</li><li>å‡é™ï¼š-2</li></ul><h4 id="ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ€ãƒ³ã‚µãƒ¼-Native-Dancer"><a href="#ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ€ãƒ³ã‚µãƒ¼-Native-Dancer" class="headerlink" title="ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ€ãƒ³ã‚µãƒ¼ &#x2F; Native Dancer"></a>ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ€ãƒ³ã‚µãƒ¼ &#x2F; Native Dancer</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV123411k7wo/">https://www.bilibili.com/video/BV123411k7wo/</a> ï¼ˆsakanactionï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV12m4y177YL/">https://www.bilibili.com/video/BV12m4y177YL/</a> ï¼ˆæ˜é€ï¼‰</li><li>å‡é™ï¼š-4</li></ul><h4 id="å¤œã«é§†ã‘ã‚‹"><a href="#å¤œã«é§†ã‘ã‚‹" class="headerlink" title="å¤œã«é§†ã‘ã‚‹"></a>å¤œã«é§†ã‘ã‚‹</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Ph411C7S5/">https://www.bilibili.com/video/BV1Ph411C7S5/</a> ï¼ˆikuraï¼‰</li></ul><h4 id="æ„›ã‚’ä¼ãˆãŸã„ã ã¨ã‹"><a href="#æ„›ã‚’ä¼ãˆãŸã„ã ã¨ã‹" class="headerlink" title="æ„›ã‚’ä¼ãˆãŸã„ã ã¨ã‹"></a>æ„›ã‚’ä¼ãˆãŸã„ã ã¨ã‹</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1ay4y177kp/">https://www.bilibili.com/video/BV1ay4y177kp/</a> ï¼ˆã‚ã„ã¿ã‚‡ã‚“ï¼‰</li><li>å‡é™ï¼š+2</li></ul><h4 id="æ±äº¬ã‚µãƒãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³"><a href="#æ±äº¬ã‚µãƒãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³" class="headerlink" title="æ±äº¬ã‚µãƒãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³"></a>æ±äº¬ã‚µãƒãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1ps411Y7tW/">https://www.bilibili.com/video/BV1ps411Y7tW/</a> ï¼ˆé–é‚£, CHiCOï¼‰</li></ul><h4 id="ä¸–ç•Œã¯æ‹ã«è½ã¡ã¦ã„ã‚‹"><a href="#ä¸–ç•Œã¯æ‹ã«è½ã¡ã¦ã„ã‚‹" class="headerlink" title="ä¸–ç•Œã¯æ‹ã«è½ã¡ã¦ã„ã‚‹"></a>ä¸–ç•Œã¯æ‹ã«è½ã¡ã¦ã„ã‚‹</h4><ul><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1dx41187d8/">https://www.bilibili.com/video/BV1dx41187d8/</a> ï¼ˆèŠ±ç¢³ï¼‰</li></ul><h4 id="ãƒ•ãƒ­ãƒ³ãƒˆãƒ¡ãƒ¢ãƒªãƒ¼"><a href="#ãƒ•ãƒ­ãƒ³ãƒˆãƒ¡ãƒ¢ãƒªãƒ¼" class="headerlink" title="ãƒ•ãƒ­ãƒ³ãƒˆãƒ¡ãƒ¢ãƒªãƒ¼"></a>ãƒ•ãƒ­ãƒ³ãƒˆãƒ¡ãƒ¢ãƒªãƒ¼</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1YX4y1V7Uo/">https://www.bilibili.com/video/BV1YX4y1V7Uo/</a> ï¼ˆå°æ¾èœå¥ˆï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Sz4y1T7eE/">https://www.bilibili.com/video/BV1Sz4y1T7eE/</a> ï¼ˆACAã­ï¼‰</li></ul><h4 id="YELLOW"><a href="#YELLOW" class="headerlink" title="YELLOW"></a>YELLOW</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1YP4y1877f/">https://www.bilibili.com/video/BV1YP4y1877f/</a> ï¼ˆç¥å±±ç¾Šï¼‰</li></ul><h4 id="ãƒ‡ã‚¹ãºãƒ¬ãƒ¼ãƒˆ"><a href="#ãƒ‡ã‚¹ãºãƒ¬ãƒ¼ãƒˆ" class="headerlink" title="ãƒ‡ã‚¹ãºãƒ¬ãƒ¼ãƒˆ"></a>ãƒ‡ã‚¹ãºãƒ¬ãƒ¼ãƒˆ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1RW4y1i7WK/">https://www.bilibili.com/video/BV1RW4y1i7WK/</a> ï¼ˆLOLUETï¼‰</li></ul><h4 id="ç¬¬å…­æ„Ÿ"><a href="#ç¬¬å…­æ„Ÿ" class="headerlink" title="ç¬¬å…­æ„Ÿ"></a>ç¬¬å…­æ„Ÿ</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1aV411z7DF/">https://www.bilibili.com/video/BV1aV411z7DF/</a> ï¼ˆReolï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV14j411M7uQ/">https://www.bilibili.com/video/BV14j411M7uQ/</a> ï¼ˆæ˜é€ï¼‰</li></ul><h4 id="é£›è¡Œè‰‡"><a href="#é£›è¡Œè‰‡" class="headerlink" title="é£›è¡Œè‰‡"></a>é£›è¡Œè‰‡</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1C44y1p7wL/">https://www.bilibili.com/video/BV1C44y1p7wL/</a> ï¼ˆKing Gnuï¼‰</li><li>å‡é™ï¼š+2</li></ul><h3 id="AniSong"><a href="#AniSong" class="headerlink" title="AniSong"></a>AniSong</h3><h4 id="æ˜Ÿåº§ã«ãªã‚ŒãŸã‚‰"><a href="#æ˜Ÿåº§ã«ãªã‚ŒãŸã‚‰" class="headerlink" title="æ˜Ÿåº§ã«ãªã‚ŒãŸã‚‰"></a>æ˜Ÿåº§ã«ãªã‚ŒãŸã‚‰</h4><ul><li>å‡é™ï¼š+1</li></ul><h4 id="å¿˜ã‚Œã¦ã‚„ã‚‰ãªã„"><a href="#å¿˜ã‚Œã¦ã‚„ã‚‰ãªã„" class="headerlink" title="å¿˜ã‚Œã¦ã‚„ã‚‰ãªã„"></a>å¿˜ã‚Œã¦ã‚„ã‚‰ãªã„</h4><ul><li>å‡é™ï¼š+1</li></ul><h4 id="æ‰“ä¸ŠèŠ±ç«"><a href="#æ‰“ä¸ŠèŠ±ç«" class="headerlink" title="æ‰“ä¸ŠèŠ±ç«"></a>æ‰“ä¸ŠèŠ±ç«</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1F8411G7TJ/">https://www.bilibili.com/video/BV1F8411G7TJ/</a> ï¼ˆDAOKO, ç±³æ´¥ç„å¸ˆï¼‰</li></ul><h4 id="ã‚·ãƒ¥ã‚¬ãƒ¼ã‚½ãƒ³ã‚°ã¨ãƒ“ã‚¿ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—"><a href="#ã‚·ãƒ¥ã‚¬ãƒ¼ã‚½ãƒ³ã‚°ã¨ãƒ“ã‚¿ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—" class="headerlink" title="ã‚·ãƒ¥ã‚¬ãƒ¼ã‚½ãƒ³ã‚°ã¨ãƒ“ã‚¿ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—"></a>ã‚·ãƒ¥ã‚¬ãƒ¼ã‚½ãƒ³ã‚°ã¨ãƒ“ã‚¿ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1f4411Q745/">https://www.bilibili.com/video/BV1f4411Q745/</a> ï¼ˆUNISON SQUARE GARDENï¼‰</li></ul><h4 id="æ€ªç‰©"><a href="#æ€ªç‰©" class="headerlink" title="æ€ªç‰©"></a>æ€ªç‰©</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1bV411B7uK/">https://www.bilibili.com/video/BV1bV411B7uK/</a> ï¼ˆikuraï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="ãªã„ãªã„"><a href="#ãªã„ãªã„" class="headerlink" title="ãªã„ãªã„"></a>ãªã„ãªã„</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1ZQ4y1y71J/">https://www.bilibili.com/video/BV1ZQ4y1y71J/</a> ï¼ˆReoNaï¼‰</li></ul><h4 id="å¤œã¯çœ ã‚Œã‚‹ã‹ã„"><a href="#å¤œã¯çœ ã‚Œã‚‹ã‹ã„" class="headerlink" title="å¤œã¯çœ ã‚Œã‚‹ã‹ã„?"></a>å¤œã¯çœ ã‚Œã‚‹ã‹ã„?</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1CG4y1Y7AL/">https://www.bilibili.com/video/BV1CG4y1Y7AL/</a> ï¼ˆflumpoolï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Mq4y1U7Tv/">https://www.bilibili.com/video/BV1Mq4y1U7Tv/</a> ï¼ˆå¹¸ç¥œï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Py4y1171g/">https://www.bilibili.com/video/BV1Py4y1171g/</a> ï¼ˆå†…å¾·ç»´å¾·ï¼‰</li><li>å‡é™ï¼š-1</li></ul><h4 id="Again"><a href="#Again" class="headerlink" title="Again"></a>Again</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1yV4y167gk/">https://www.bilibili.com/video/BV1yV4y167gk/</a> ï¼ˆYuiï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Th4y1t7FG/">https://www.bilibili.com/video/BV1Th4y1t7FG/</a> ï¼ˆé›¾æ°§Uoï¼‰</li></ul><h4 id="unravel"><a href="#unravel" class="headerlink" title="unravel"></a>unravel</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1rb411m7gE/">https://www.bilibili.com/video/BV1rb411m7gE/</a> ï¼ˆTKï¼‰</li></ul><h4 id="ã‚«ãƒ¯ã‚­ãƒ²ã‚¢ãƒ¡ã‚¯"><a href="#ã‚«ãƒ¯ã‚­ãƒ²ã‚¢ãƒ¡ã‚¯" class="headerlink" title="ã‚«ãƒ¯ã‚­ãƒ²ã‚¢ãƒ¡ã‚¯"></a>ã‚«ãƒ¯ã‚­ãƒ²ã‚¢ãƒ¡ã‚¯</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1gJ411H7jq/">https://www.bilibili.com/video/BV1gJ411H7jq/</a> ï¼ˆç¾æ³¢ï¼‰</li></ul><h2 id="è‹±æ–‡"><a href="#è‹±æ–‡" class="headerlink" title="è‹±æ–‡"></a>è‹±æ–‡</h2><h3 id="Guns-Nâ€™-Roses"><a href="#Guns-Nâ€™-Roses" class="headerlink" title="Guns Nâ€™ Roses"></a>Guns Nâ€™ Roses</h3><h4 id="Donâ€™t-Cry"><a href="#Donâ€™t-Cry" class="headerlink" title="Donâ€™t Cry"></a>Donâ€™t Cry</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1G24y137Re/">https://www.bilibili.com/video/BV1G24y137Re/</a> ï¼ˆaxlï¼Œhoonï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV13f4y1H7gB/">https://www.bilibili.com/video/BV13f4y1H7gB/</a> ï¼ˆaxlï¼‰</li></ul><h3 id="Nirvana"><a href="#Nirvana" class="headerlink" title="Nirvana"></a>Nirvana</h3><h4 id="Smells-Like-Teen-Spirit"><a href="#Smells-Like-Teen-Spirit" class="headerlink" title="Smells Like Teen Spirit"></a>Smells Like Teen Spirit</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1rM4y1g7BE/">https://www.bilibili.com/video/BV1rM4y1g7BE/</a> ï¼ˆKurtï¼‰</li><li>å‡é™ï¼š-6</li></ul><h4 id="Lithium"><a href="#Lithium" class="headerlink" title="Lithium"></a>Lithium</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1uP4y1s7VH/">https://www.bilibili.com/video/BV1uP4y1s7VH/</a> ï¼ˆKurtï¼‰</li></ul><h3 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h3><h4 id="Never-Enough"><a href="#Never-Enough" class="headerlink" title="Never Enough"></a>Never Enough</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1sP411p7Hm/">https://www.bilibili.com/video/BV1sP411p7Hm/</a> ï¼ˆLoren Allredï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1wZ4y197jA/">https://www.bilibili.com/video/BV1wZ4y197jA/</a> ï¼ˆé»‘æ³½è¯ºäºšNOIRï¼‰</li></ul><h4 id="Almost-Lover"><a href="#Almost-Lover" class="headerlink" title="Almost Lover"></a>Almost Lover</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1TZ4y1G7QC/">https://www.bilibili.com/video/BV1TZ4y1G7QC/</a> ï¼ˆA Fine Frenzyï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1hW4y1s7Gy/">https://www.bilibili.com/video/BV1hW4y1s7Gy/</a> ï¼ˆSierï¼‰</li><li>å‡é™ï¼š-4</li></ul><h4 id="Cure-For-Me"><a href="#Cure-For-Me" class="headerlink" title="Cure For Me"></a>Cure For Me</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1HU4y137jr/">https://www.bilibili.com/video/BV1HU4y137jr/</a> ï¼ˆå°æ›¦ï¼‰</li></ul><h4 id="Cry-Baby"><a href="#Cry-Baby" class="headerlink" title="Cry Baby"></a>Cry Baby</h4><ul><li>åŸå”±ï¼šMelanie Martinez</li></ul><h4 id="Wish-you-were-gay"><a href="#Wish-you-were-gay" class="headerlink" title="Wish you were gay"></a>Wish you were gay</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Pb411q7r9/">https://www.bilibili.com/video/BV1Pb411q7r9/</a> ï¼ˆBillieï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1oW4y1u7eQ/">https://www.bilibili.com/video/BV1oW4y1u7eQ/</a> ï¼ˆç‘å¨…Rheaï¼‰</li><li>å‡é™ï¼š+2</li></ul><h4 id="You-and-I"><a href="#You-and-I" class="headerlink" title="You and I"></a>You and I</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1jt4y1z7LQ/">https://www.bilibili.com/video/BV1jt4y1z7LQ/</a> ï¼ˆLady Gagaï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1We4y1u7Nq/">https://www.bilibili.com/video/BV1We4y1u7Nq/</a> ï¼ˆå¡æ‹‰è²å¨œSerafinaï¼‰</li></ul><h4 id="Bang-Bang"><a href="#Bang-Bang" class="headerlink" title="Bang Bang"></a>Bang Bang</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Lp411o7Kd/">https://www.bilibili.com/video/BV1Lp411o7Kd/</a> ï¼ˆJessie J, Ariana Grande, Nicki Minajï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1YZ4y1U79X/">https://www.bilibili.com/video/BV1YZ4y1U79X/</a> ï¼ˆå¡”å…‹takoï¼‰</li></ul><h4 id="I-Wanna-Be-Your-Slave"><a href="#I-Wanna-Be-Your-Slave" class="headerlink" title="I Wanna Be Your Slave"></a>I Wanna Be Your Slave</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1nm4y1S7qF/">https://www.bilibili.com/video/BV1nm4y1S7qF/</a> ï¼ˆMÃ¥neskinï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV17L411T7My/">https://www.bilibili.com/video/BV17L411T7My/</a> ï¼ˆå¡”å…‹Takoï¼‰</li></ul><h4 id="Runaway-Baby"><a href="#Runaway-Baby" class="headerlink" title="Runaway Baby"></a>Runaway Baby</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV14v411k7dK/">https://www.bilibili.com/video/BV14v411k7dK/</a> ï¼ˆç«æ˜Ÿå“¥ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1dQ4y127dR/">https://www.bilibili.com/video/BV1dQ4y127dR/</a> ï¼ˆå¡”å…‹Takoï¼‰</li></ul><h4 id="dramatic"><a href="#dramatic" class="headerlink" title="dramatic"></a>dramatic</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1vr4y1h71s/">https://www.bilibili.com/video/BV1vr4y1h71s/</a> ï¼ˆCat &amp; Calmellï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1uT411o7iU/">https://www.bilibili.com/video/BV1uT411o7iU/</a> ï¼ˆå¡”å…‹Takoï¼‰</li></ul><h4 id="River"><a href="#River" class="headerlink" title="River"></a>River</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV15x411S76P/">https://www.bilibili.com/video/BV15x411S76P/</a> ï¼ˆBishop Briggsï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1zT411W7AS/">https://www.bilibili.com/video/BV1zT411W7AS/</a> ï¼ˆé»‘æ³½è¯ºäºšNOIRï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV16L411L7am/">https://www.bilibili.com/video/BV16L411L7am/</a> ï¼ˆå¡”å…‹Takoï¼‰</li></ul><h4 id="Believer"><a href="#Believer" class="headerlink" title="Believer"></a>Believer</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1b7411f7ay/">https://www.bilibili.com/video/BV1b7411f7ay/</a> ï¼ˆImagine Dragonsï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1zT411z7kt/">https://www.bilibili.com/video/BV1zT411z7kt/</a> ï¼ˆé»‘æ³½è¯ºäºšNOIRï¼‰</li></ul><h2 id="ä¸­æ–‡"><a href="#ä¸­æ–‡" class="headerlink" title="ä¸­æ–‡"></a>ä¸­æ–‡</h2><h3 id="é˜¿åˆ"><a href="#é˜¿åˆ" class="headerlink" title="é˜¿åˆ"></a>é˜¿åˆ</h3><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV147411x7TL/">https://www.bilibili.com/video/BV147411x7TL/</a> ï¼ˆå¼ éŸ¶æ¶µï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1A341147uK/">https://www.bilibili.com/video/BV1A341147uK/</a> ï¼ˆFeveræ— ç³–ï¼‰</li></ul><h3 id="èµ¤ä¼¶"><a href="#èµ¤ä¼¶" class="headerlink" title="èµ¤ä¼¶"></a>èµ¤ä¼¶</h3><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Bp4y1a7ce/">https://www.bilibili.com/video/BV1Bp4y1a7ce/</a> ï¼ˆHITAï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1gL4y1Y7oq/">https://www.bilibili.com/video/BV1gL4y1Y7oq/</a> ï¼ˆè‰¾å› Eineï¼‰</li></ul><h3 id="ä¹Œå…°å·´æ‰˜çš„å¤œ"><a href="#ä¹Œå…°å·´æ‰˜çš„å¤œ" class="headerlink" title="ä¹Œå…°å·´æ‰˜çš„å¤œ"></a>ä¹Œå…°å·´æ‰˜çš„å¤œ</h3><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV12W411e7G7/">https://www.bilibili.com/video/BV12W411e7G7/</a> ï¼ˆè°­ç»´ç»´ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1gA411p7Kv/">https://www.bilibili.com/video/BV1gA411p7Kv/</a> ï¼ˆé˜¿æ¢“ï¼‰</li></ul><h3 id="æ¯ç³»ç¤¾ä¼š"><a href="#æ¯ç³»ç¤¾ä¼š" class="headerlink" title="æ¯ç³»ç¤¾ä¼š"></a>æ¯ç³»ç¤¾ä¼š</h3><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1YE411t7Zu/">https://www.bilibili.com/video/BV1YE411t7Zu/</a> ï¼ˆå¼ æƒ å¦¹ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1og411k7gJ/">https://www.bilibili.com/video/BV1og411k7gJ/</a> ï¼ˆå¡”å…‹Takoï¼‰</li></ul><h3 id="ç›®ä¸è½¬ç›"><a href="#ç›®ä¸è½¬ç›" class="headerlink" title="ç›®ä¸è½¬ç›"></a>ç›®ä¸è½¬ç›</h3><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1is411V7dj/">https://www.bilibili.com/video/BV1is411V7dj/</a> ï¼ˆç‹ä»¥å¤ªï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1bv411576n/">https://www.bilibili.com/video/BV1bv411576n/</a> ï¼ˆå†…å¾·ç»´å¾·ï¼‰</li></ul><h3 id="å‚²å¨‡"><a href="#å‚²å¨‡" class="headerlink" title="å‚²å¨‡"></a>å‚²å¨‡</h3><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1tW411v75S/">https://www.bilibili.com/video/BV1tW411v75S/</a> ï¼ˆå¼µæƒ å¦¹ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1MK411B73F/">https://www.bilibili.com/video/BV1MK411B73F/</a> ï¼ˆè–‡Steriaï¼‰</li></ul><h3 id="æƒ…äººæµæµªè®°"><a href="#æƒ…äººæµæµªè®°" class="headerlink" title="æƒ…äººæµæµªè®°"></a>æƒ…äººæµæµªè®°</h3><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1LW411779V/">https://www.bilibili.com/video/BV1LW411779V/</a> ï¼ˆå¼ éŸ¶æ¶µï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1V44y1Z7xa/">https://www.bilibili.com/video/BV1V44y1Z7xa/</a> ï¼ˆPomeloå®‰å¦®ï¼‰</li></ul><h3 id="ç»ä¸–èˆå§¬"><a href="#ç»ä¸–èˆå§¬" class="headerlink" title="ç»ä¸–èˆå§¬"></a>ç»ä¸–èˆå§¬</h3><ul><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1WX4y1P72y/">https://www.bilibili.com/video/BV1WX4y1P72y/</a> ï¼ˆé˜¿æ¢“ï¼‰</li></ul><h3 id="Simon"><a href="#Simon" class="headerlink" title="Simon"></a>Simon</h3><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1BT411T7hs/">https://www.bilibili.com/video/BV1BT411T7hs/</a> ï¼ˆå‘¨è²æˆˆï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1gM411F78E/">https://www.bilibili.com/video/BV1gM411F78E/</a> ï¼ˆPomeloå®‰å¦®ï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1kN411w7z8/">https://www.bilibili.com/video/BV1kN411w7z8/</a> ï¼ˆå¦®è‰å®‰Lilyï¼‰</li><li>å‡é™ï¼š+5</li></ul><h3 id="è‚†æ„çš„æ²³"><a href="#è‚†æ„çš„æ²³" class="headerlink" title="è‚†æ„çš„æ²³"></a>è‚†æ„çš„æ²³</h3><ul><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV13d4y1z72k/">https://www.bilibili.com/video/BV13d4y1z72k/</a> ï¼ˆPomeloå®‰å¦®ï¼‰</li><li>å‡é™ï¼š+5</li></ul><h3 id="å¼•è·¯çš„é£ç­"><a href="#å¼•è·¯çš„é£ç­" class="headerlink" title="å¼•è·¯çš„é£ç­"></a>å¼•è·¯çš„é£ç­</h3><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Vu411v79N/">https://www.bilibili.com/video/BV1Vu411v79N/</a> ï¼ˆå¼ éŸ¶æ¶µï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV18L4y1w7q8/">https://www.bilibili.com/video/BV18L4y1w7q8/</a> ï¼ˆæ¡ƒå‡ OvOï¼‰</li></ul><h3 id="ç²¾å«"><a href="#ç²¾å«" class="headerlink" title="ç²¾å«"></a>ç²¾å«</h3><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV17y4y197dV/">https://www.bilibili.com/video/BV17y4y197dV/</a> ï¼ˆ30å¹´å‰ï¼Œ50å¹´åï¼‰</li><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1fg4y1T7qu/">https://www.bilibili.com/video/BV1fg4y1T7qu/</a> ï¼ˆéœ²ç±³Lumiï¼‰</li><li>å‡é™ï¼š+2</li></ul><h3 id="èƒ¡æ¡ƒå¤¹å­"><a href="#èƒ¡æ¡ƒå¤¹å­" class="headerlink" title="èƒ¡æ¡ƒå¤¹å­"></a>èƒ¡æ¡ƒå¤¹å­</h3><ul><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Kg411p7Wy/">https://www.bilibili.com/video/BV1Kg411p7Wy/</a> ï¼ˆé‡Œå¥ˆRinaï¼‰</li></ul><h3 id="æˆ‘ç®¡ä½ "><a href="#æˆ‘ç®¡ä½ " class="headerlink" title="æˆ‘ç®¡ä½ "></a>æˆ‘ç®¡ä½ </h3><ul><li>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1d94y117aZ/">https://www.bilibili.com/video/BV1d94y117aZ/</a> ï¼ˆå†…å¾·ç»´å¾·ï¼‰</li><li>å‡é™ï¼š-6</li></ul><h4 id="å½’é›¶"><a href="#å½’é›¶" class="headerlink" title="å½’é›¶"></a>å½’é›¶</h4><ul><li>åŸå”±ï¼š<a href="https://www.bilibili.com/video/BV1Z34y1H7dL">https://www.bilibili.com/video/BV1Z34y1H7dL</a> ï¼ˆæ—å¿†è²ï¼‰</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Assimp</title>
    <link href="/2023/03/06/Assimp/"/>
    <url>/2023/03/06/Assimp/</url>
    
    <content type="html"><![CDATA[<h2 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h2><p><a href="https://github.com/assimp/assimp">Github</a><br>ä¸€ä¸ªéå¸¸æµè¡Œçš„æ¨¡å‹å¯¼å…¥åº“ Assimp(Open Asset Import Library)ã€‚å®ƒèƒ½å¤Ÿå¯¼å…¥å¾ˆå¤šç§ä¸åŒçš„æ¨¡å‹æ–‡ä»¶æ ¼å¼ï¼ˆä¹Ÿèƒ½å¯¼å‡ºä¸€äº›ï¼‰ï¼Œå¹¶åœ¨å†…å­˜ä¸­å‘ˆç°ä¸º Assimp çš„é€šç”¨æ•°æ®ç»“æ„ã€‚ä¸€æ—¦ Assimp åŠ è½½äº†æ¨¡å‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Assimp æä¾›çš„æ¥å£æ£€ç´¢éœ€è¦çš„æ•°æ®ã€‚</p><h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><p>Assimp å®˜æ–¹æ¯”è¾ƒæ¨è vcpkg çš„é›†æˆæ–¹å¼ã€‚<br>æ‰‹åŠ¨é›†æˆçš„è¯æœ‰ä¸‰ä¸ªå‘ï¼š</p><ol><li>config.h<br>å‡è®¾ç”Ÿæˆç›®å½•æ˜¯ <code>assimp/build</code>ï¼ŒAssimp ä¼šåœ¨ <code>assimp/build/include/assimp</code> ä¸‹ç”Ÿæˆä¸€ä»½ <code>config.h</code>ï¼Œè¿™ä¸ªæ–‡ä»¶æœ€ç»ˆä¼šè¢« include è¿›æºç é‡Œã€‚<br>æ‰€ä»¥åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ä¸ä½†è¦åŒ…å« <code>assimp/include</code> è·¯å¾„ï¼Œè¿˜è¦åŒ…å« <code>assimp/build/include/assimp</code> è·¯å¾„ã€‚</li><li>zlib<br>Assimp ä¾èµ–äº zlib è¿è¡Œï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ä¸ä½†è¦é“¾æ¥ <code>assimp-vc143-mt</code> åº“è¿˜è¦åŒ…å« <code>zlibstatic</code> åº“ï¼Œè¿™ä¸ªé¡¹ç›®ç”Ÿæˆåœ¨ <code>assimp/build/contrib/zlib</code> ä¸‹ï¼Œç›®æ ‡æ–‡ä»¶ç”Ÿæˆåœ¨ <code>assimp/build/contrib/zlib/Debug(or Release)</code> ä¸‹ã€‚</li><li>stb<br>Assimp é»˜è®¤åŒ…å«ä¸€ä»½ stb_image çš„å®šä¹‰ï¼Œå¦‚æœä½ çš„é¡¹ç›®ä¸­éœ€è¦æ‰‹åŠ¨åŒ…å« stb_imageï¼Œå…¶ä¸­ä¸€ä»½å®ç°ä¼šè¢«å¿½ç•¥ã€‚<br>Assimp é»˜è®¤ä¼š define <code>STBI_ONLY_PNG</code>ï¼Œå¯¼è‡´ stb_image åªèƒ½è¯»å– .png æ ¼å¼ã€‚<br>è¿™å—çš„é€»è¾‘å¯ä»¥çœ‹ä¸‹ <a href="https://github.com/assimp/assimp/blob/497e286cfa0fd7d055f867aa5aff43e089d7a849/code/Common/Assimp.cpp">Assimp.cpp</a> æœ€åå‡ è¡Œã€‚<br>è§£å†³åŠæ³•æ˜¯åœ¨ make Assimp çš„æ—¶å€™ä½¿ç”¨ <code>-DASSIMP_NO_EXPORT=ON</code>ã€‚</li></ol><p>å®˜æ–¹æ–‡æ¡£ <a href="https://github.com/assimp/assimp/blob/master/Build.md">assimp&#x2F;Build.md</a> ä¼¼ä¹æ²¡æœ‰æåŠè¿™å‡ ä»¶äº‹ï¼Œå¾ˆå‘ã€‚</p><h2 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h2><p>è°ƒç”¨ <code>Assimp::Importer</code> ä¹‹å Assimp è§£æçš„æ¨¡å‹æ•°æ®ä¼šä»¥ä¸€ä¸ªåªè¯»çš„ <code>aiScene *</code> çš„å½¢å¼è¿”å›ï¼Œå¹¶ä¸”å½“ Importer å®ä¾‹é”€æ¯ä¹‹åå¯¹åº”çš„ aiScene ä¹Ÿä¼šé”€æ¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assimp/Importer.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assimp/scene.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assimp/postprocess.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Import</span><span class="hljs-params">( <span class="hljs-type">const</span> std::string &amp;filePath)</span> </span>&#123;<br>    Assimp::Importer importer;<br><br>    <span class="hljs-type">const</span> aiScene *pScene = importer.<span class="hljs-built_in">ReadFile</span>( filePath,<br>        aiProcess_AAA | aiProcess_BBB);<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-literal">nullptr</span> == pScene) &#123;<br>        <span class="hljs-comment">// Import failed.</span><br>    &#125;<br><br>    <span class="hljs-built_in">ProcessScene</span>(pScene);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ReadFile</code> çš„ aiProcess_XXX æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°ï¼Œæ˜¯ Assimp æä¾›çš„å¯¹æ¨¡å‹çš„åå¤„ç†ï¼Œæ¯”å¦‚ <code>aiProcess_GenNormals</code> ä»£è¡¨å¦‚æœæ¨¡å‹ä¸åŒ…å«æ³•å‘é‡çš„è¯ç”± Assimp ç”Ÿæˆæ³•å‘é‡ã€‚æ›´å¤šçš„é€‰é¡¹çœ‹ï¼š<a href="https://assimp.sourceforge.net/lib_html/postprocess_8h.html">postprocess.h File Reference</a>ã€‚</p><h2 id="è§„èŒƒ"><a href="#è§„èŒƒ" class="headerlink" title="è§„èŒƒ"></a>è§„èŒƒ</h2><p>é»˜è®¤ï¼š</p><ul><li>å³æ‰‹åæ ‡ç³»</li><li>CCW</li><li>UV åŸç‚¹ä½äºå·¦ä¸‹è§’</li></ul><p>çŸ©é˜µæœ‰ä¸€ç‚¹å¥‡æ€ªï¼Œ<strong>å·¦ä¹˜</strong>å¹¶ä¸”ä»¥<strong>è¡Œä¸»åº</strong>å­˜å‚¨ï¼Œä¾‹å¦‚ï¼š<br>$$<br>\left(<br>\begin{matrix}<br>X1 &amp; Y1 &amp; Z1 &amp; T1 \<br>X2 &amp; Y2 &amp; Z2 &amp; T2 \<br>X3 &amp; Y3 &amp; Z3 &amp; T3 \<br>0 &amp; 0 &amp; 0 &amp; 1 \<br>\end{matrix}<br>\right)<br>$$<br>åœ¨å†…å­˜ä¸­çš„æ’åˆ—æ˜¯ï¼š<code>[X1, Y1, Z1, T1, X2, Y2, Z2, T2, X3, Y3, Z3, T3, 0, 0, 0, 1]</code>ã€‚</p><p>ä»¥ä¸Šè§„èŒƒå¤§éƒ½å¯ä»¥é€šè¿‡ Post Process è¿›è¡Œä¿®æ”¹ã€‚<br>æ¯”å¦‚ <code>aiProcess_ConvertToLeftHanded</code> ä»£è¡¨ï¼š</p><blockquote><p>Supersedes the <code>aiProcess_MakeLeftHanded</code> and <code>aiProcess_FlipUVs</code> and <code>aiProcess_FlipWindingOrder</code> flags. The output data matches Direct3Dâ€™s conventions: left-handed geometry, upper-left origin for UV coordinates and finally clockwise face order, suitable for CCW culling.</p></blockquote><h2 id="aiScene"><a href="#aiScene" class="headerlink" title="aiScene"></a>aiScene</h2><p>å…ˆçœ‹ä¸€ä¸ªç®€åŒ–ç‰ˆçš„æ•°æ®ç»“æ„ï¼š<br><img src="/img/Assimp/aiScene.png" alt="LearnOpenGL"></p><h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><p>é¦–å…ˆæ•´ä¸ªåœºæ™¯æ˜¯ä»¥ node çš„å½¢å¼å±‚çº§ç»„ç»‡èµ·æ¥çš„ï¼Œæ„ä¹‰åœ¨äºå¯¹æŸä¸€èŠ‚ç‚¹è¿›è¡Œä»»æ„å½¢å¼çš„å˜æ¢æ—¶ï¼Œæˆ‘ä»¬ä¼šå¸Œæœ›å¯¹è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹åº”ç”¨ç›¸åŒçš„å˜æ¢ã€‚æ¯”å¦‚ä¸€ä¸ªæŒ–æ˜æœºçš„å¤§è‡‚ï¼ˆåŠ¨è‡‚ï¼‰æŒ¥åŠ¨æ—¶è¿æ¥ç€çš„å°è‡‚ï¼ˆæ–—æ†ï¼‰ä¼šè‡ªç„¶åœ°å‘ç”Ÿç›¸åŒçš„å˜æ¢ã€‚<br>é‚£ä¹ˆ node ä¸­å­˜å‚¨çš„ä¾¿æ˜¯ï¼š</p><ul><li>å­ node çš„ç´¢å¼•</li><li>ç›¸å¯¹äºçˆ¶ node çš„å˜æ¢çŸ©é˜µ</li><li>å¯¹åº” mesh çš„ç´¢å¼•</li></ul><p>å½“ç„¶ Assimp ä¹Ÿæä¾›äº†åå¤„ç† <code>aiProcess_PreTransformVertices</code> æ¥ç§»é™¤å±‚çº§ç»“æ„å¹¶å°†æ‰€æœ‰å˜æ¢çŸ©é˜µç›´æ¥åº”ç”¨çš„åˆ°é¡¶ç‚¹åæ ‡ä¸Šï¼Œä¸è¿‡è¿™ä¸ªé€‰é¡¹åŒæ—¶ä¼šç§»é™¤åŠ¨ç”»æ•°æ®ã€‚</p><p>æŒ‰ç…§ node é€’å½’è¯»å– scene çš„ä¼ªä»£ç å¤§è‡´æ˜¯ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ProcessNode</span><span class="hljs-params">(aiNode node, SceneObject parent, Mat4 transform)</span> </span>&#123;<br>    SceneObject nextParent;<br>    Mat4 nextTransform;<br><br>    <span class="hljs-keyword">if</span>(node.mNumMeshes &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// If node has meshes, create a new scene object for it.</span><br>        SceneObjekt newObject = <span class="hljs-keyword">new</span> SceneObject;<br>        parent.<span class="hljs-built_in">addChild</span>(newObject);<br>        <span class="hljs-built_in">ProcessMesh</span>(node, newObject);<br><br>        <span class="hljs-comment">// The new object is the parent for all child nodes.</span><br>        nextParent = newObject;<br>        nextTransform.<span class="hljs-built_in">SetUnity</span>();<br>    &#125; <br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// If no meshes, skip the node, but keep its transformation.</span><br>        nextParent = parent;<br>        nextTransform = node.mTransform * transform;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span>(all of node.mChildren) &#123;<br>        <span class="hljs-comment">// Continue for all child nodes.</span><br>        <span class="hljs-built_in">ProcessNode</span>(node.mChildren[i], nextParent, nextTransform);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Mesh"><a href="#Mesh" class="headerlink" title="Mesh"></a>Mesh</h3><p>å¯ä»¥å‘ç° mesh å¹¶ä¸æ˜¯å­˜å‚¨äº node ä¸­çš„ï¼Œnode åªæŒæœ‰ä¸€ä¸ªå¯¹äº mesh çš„å¼•ç”¨ï¼Œè€Œæ‰€æœ‰ mesh éƒ½å¹³é“ºåœ¨ <code>aiScene</code> ä¸­ã€‚åŒç† mesh ä¹ŸæŒæœ‰ä¸€ä¸ª material çš„å¼•ç”¨ï¼Œè¦æ‹¿ç€è¯¥ç´¢å¼•å›åˆ° <code>aiScene</code> æ‰èƒ½æ‹¿åˆ°å¯¹åº”çš„æè´¨ã€‚<br>è¿™æ ·ä¸€æ¥ node å¯ä»¥å¤ç”¨ meshï¼Œmesh å¯ä»¥å¤ç”¨ materialã€‚æœ‰ä¸€ç‚¹ç»•ï¼Œä½†å°±åƒ index å¤ç”¨ vertex ä¸€æ ·åˆç†ã€‚<br>ä¸åŒåœ¨äºä¸€ä¸ª node å¯ä»¥æŒæœ‰å¤šä¸ª meshï¼Œè€Œä¸€ä¸ª mesh åªèƒ½æŒæœ‰ä¸€ä¸ª materialã€‚<br>mesh ç»“æ„ä½“çš„å®šä¹‰çœ‹ï¼š<a href="https://github.com/assimp/assimp/blob/master/include/assimp/mesh.h">mesh.h</a></p><h3 id="Material"><a href="#Material" class="headerlink" title="Material"></a>Material</h3><p>material é™¤äº† <code>GetTexture</code> æ¥å£å¯ä»¥æ‹¿åˆ°æŒ‡å®š <code>aiTextureType</code> çš„è´´å›¾è·¯å¾„ä»¥å¤–ï¼Œè¿˜æœ‰ <code>Get</code> æ¥å£å¯ä»¥æ‹¿åˆ° Assimp è§£æå‡ºæ¥çš„æè´¨å®šä¹‰ã€‚ç”±äºæè´¨ç›¸å…³çš„å®šä¹‰ä¸è§„èŒƒå®å±ç™¾èŠ±é½æ”¾ï¼ŒAssimp ä¹Ÿåªæä¾›äº†æœ€ç®€å•çš„ MaterialProperty çš„æ•°æ®ã€‚<br>æ³¨æ„ <code>Get</code> æ¥å£éµå¾ªååˆ†ä¸¥æ ¼çš„è°ƒç”¨è§„èŒƒï¼Œå¹¶ä¸”éœ€è¦ç”±è°ƒç”¨è€…ä¿è¯æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼ï¼š<a href="https://assimp-docs.readthedocs.io/en/latest/usage/use_the_lib.html#constants">Material-System</a>ã€‚è™½ç„¶çº¦å®šä¿—æˆäº†ä¸åŒ property å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œä½†å¥½å¤„æ˜¯å¯ä»¥ç”¨ç®€å•çš„é”®å€¼å¯¹è·å¾—ååˆ†å¤æ‚æ··ä¹±çš„æè´¨å®šä¹‰ï¼Œä¹Ÿæ˜“äºæ‰©å±•ï¼Œæ¯•ç«Ÿæ–°å¢ä¸€ä¸ª MaterialProperty ä¹Ÿå°±æ˜¯æ–°å¢ä¸€å¯¹é”®å€¼å¯¹çš„äº‹ã€‚</p><h3 id="æ ·ä¾‹"><a href="#æ ·ä¾‹" class="headerlink" title="æ ·ä¾‹"></a>æ ·ä¾‹</h3><p><a href="https://learnopengl.com/code_viewer_gh.php?code=includes/learnopengl/model.h">LearnOpenGL</a> æ˜¯ä¸€ä¸ªç›¸å¯¹å®Œæ•´çš„ä¾‹å­ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Assimp</tag>
      
      <tag>CPP</tag>
      
      <tag>Engineering</tag>
      
      <tag>Material</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤§æ°”æ•£å°„</title>
    <link href="/2022/10/04/Atm/"/>
    <url>/2022/10/04/Atm/</url>
    
    <content type="html"><![CDATA[<h2 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æ€»è§ˆï¼š<br><a href="https://www.bilibili.com/video/BV1i3411T7QL/">06.æ¸¸æˆä¸­åœ°å½¢å¤§æ°”å’Œäº‘çš„æ¸²æŸ“(ä¸‹) | GAMES104-ç°ä»£æ¸¸æˆå¼•æ“ï¼šä»å…¥é—¨åˆ°å®è·µ</a><br>ä¸€ä¸ªç®€çŸ­çš„å…¬å¼æ¨å¯¼ï¼š<br><a href="https://zhuanlan.zhihu.com/p/36498679">[Rendering] åŸºäºç‰©ç†çš„å¤§æ°”æ¸²æŸ“</a><br>ä¸€ä¸ªè¯¦ç»†çš„æ¨å¯¼å’Œæœ€æš´åŠ›ä¸”ç›´è§‚çš„å®ç°ï¼š<br><a href="https://zhuanlan.zhihu.com/p/237502022">ã€å®æˆ˜ã€‘ä»é›¶å®ç°ä¸€å¥—å®Œæ•´å•æ¬¡å¤§æ°”æ•£å°„</a><br>$I&#x3D;I_S\beta(\lambda)\gamma(\theta)\sum_{P\in\overline{AB}}T(\overline{CP})T(\overline{PA})\rho(h)ds$<br>$T(\overline{CP})T(\overline{PA})&#x3D;exp\lbrace-\beta(\lambda)(D(\overline{CP})+D(\overline{PA}))\rbrace$<br>è¿™ç¯‡æ–‡ç« ä¹Ÿä¸é”™ï¼š<br><a href="https://zhuanlan.zhihu.com/p/559466624">åŸºäºç‰©ç†çš„å¤§æ°”ä½“æ¸²æŸ“ä»ç†è®ºåˆ°å®è·µï¼ˆä¸€ï¼‰</a><br>å¤©ç©ºä¸ºä»€ä¹ˆç™½å¤©æ˜¯è“çš„ï¼Œé»„æ˜æ˜¯çº¢çš„ï¼š<br><a href="https://zhuanlan.zhihu.com/p/210745877">æ›´é€šä¿—æ˜“æ‡‚ä¹‹å¤©ç©ºä¸ºå•¥é‚£ä¹ˆè“â€”â€”ç‘åˆ©æ•£å°„</a><br>ä¸€ä¸ªæœ‰è¶£çš„å®éªŒï¼š<br><a href="https://www.bilibili.com/video/BV1Te411A76j/">éº»çœç†å·¥æ•™æˆï¼šç­”åº”æˆ‘ï¼Œå¦‚æœä¸æ˜¯ä¸ºç‘åˆ©æ•£å°„ï¼Œæ°¸è¿œä¸è¦åŒæ—¶æŠ½å››æ ¹çƒŸï¼ï¼ï¼</a><br>ä¸€ç¯‡è¯¦å°½è¿‡å¤´çš„æ–‡ç« ï¼Œæˆ‘çš„å»ºè®®æ˜¯å½“å°è¯´çœ‹ï¼š<br><a href="https://zhuanlan.zhihu.com/p/548799663">æ¸¸æˆé­”æ³•ç¼–ç¨‹ï¼šunity å®ç°å®Œæ•´å¤§æ°”æ•£å°„</a></p><h3 id="Accurate-Atmospheric-Scattering"><a href="#Accurate-Atmospheric-Scattering" class="headerlink" title="Accurate Atmospheric Scattering"></a>Accurate Atmospheric Scattering</h3><p>åªè€ƒè™‘å•æ¬¡æ•£å°„ï¼Œé¢„è®¡ç®—å¹¶æ‹Ÿåˆäº†ä»»æ„ä¸¤ç‚¹é—´çš„å…‰å­¦è·ç¦»ï¼š<br><a href="https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering">GPU Gems 2 Chapter 16. Accurate Atmospheric Scattering</a><br>è¿™ä¹Ÿæ˜¯ Unity çš„åšæ³•ï¼š<br><a href="https://zhuanlan.zhihu.com/p/448521659">åœ¨ Unity ä¸­åˆ¶ä½œ Procedural Sky</a><br>è§£é™¤äº† Sean Oâ€™Neil å®ç°ä¸­æ ‡å‡†æµ·æ‹”ã€å¤§æ°”é«˜åº¦å’Œåœ°çƒåŠå¾„ä¹‹é—´æ¯”ä¾‹çš„é™åˆ¶ã€‚<br><a href="https://atomworld.wordpress.com/2014/12/22/flexible-physical-accurate-atmosphere-scattering-part-1/">Flexible Physical Accurate Atmosphere Scattering</a></p><h3 id="Precomputed-Atmospheric-Scattering"><a href="#Precomputed-Atmospheric-Scattering" class="headerlink" title="Precomputed Atmospheric Scattering"></a>Precomputed Atmospheric Scattering</h3><p>é¢„è®¡ç®—äº†<strong>å¤šé‡æ•£å°„</strong>ï¼Œè€ƒè™‘äº†ç›¸æœºåœ¨å¤ªç©ºçš„æƒ…å†µï¼Œè€ƒè™‘äº†è‡­æ°§å±‚å¯¹å…‰çº¿çš„å¸æ”¶ï¼Œè€ƒè™‘äº†å¤ªé˜³å¯¹ç€è‰²ç‚¹ Direct Irradiance çš„è´¡çŒ®ï¼Œè€ƒè™‘äº†å¤§æ°”å¯¹ç€è‰²ç‚¹ Indirect Irradiance çš„è´¡çŒ®ï¼Œè€ƒè™‘äº†çœ‹å‘ç€è‰²ç‚¹æ—¶è§†çº¿å…‰è·¯ä¸Šå‘ç”Ÿçš„æ•£å°„ï¼Œè€ƒè™‘äº†ä½äºé˜´å½±ä¸­çš„å¤§æ°”éƒ¨åˆ†äº§ç”Ÿçš„ LightShafts:<br><a href="https://ebruneton.github.io/precomputed_atmospheric_scattering/">Precomputed Atmospheric Scattering</a><br><a href="https://zhuanlan.zhihu.com/p/76844937">Precomputed Atmospheric Scattering</a><br><a href="https://zhuanlan.zhihu.com/p/380531599">Precomputed Atmosphere Scaterring</a><br><a href="https://zhuanlan.zhihu.com/p/410000571">ã€Unreal ä» 0 åˆ° 1ã€‘ã€ç¬¬å››ç« ï¼šå¤©æ°”ç³»ç»Ÿã€‘4.2ï¼Œä»é›¶å¼€å§‹çš„ç‰©ç†å¤§æ°”æ•£å°„</a><br><a href="https://zhuanlan.zhihu.com/p/344296264">è§£è¯» GLSL çš„å¤§æ°”æ•£å°„å‡½æ•°å­¦ä¹ ç¬”è®°</a><br><a href="https://zhuanlan.zhihu.com/p/498287539">Precomputed Atmospheric Scattering Shader ä»£ç ç¬”è®°</a><br><a href="https://ebruneton.github.io/precomputed_atmospheric_scattering/atmosphere/reference/test_report.html">CPU ç²¾ç¡®è®¡ç®—ä¸ GPU è¿‘ä¼¼çš„å¯¹æ¯”</a><br><a href="https://ebruneton.github.io/precomputed_atmospheric_scattering/atmosphere/reference/model_test.cc.html">å¯¹ä¸åŒè¿‘ä¼¼çš„å¯¹æ¯”çš„æè¿°</a> Test cases éƒ¨åˆ†</p><h4 id="å¦‚ä½•åœ¨-win-VS2022-ç¼–è¯‘è¯¥å·¥ç¨‹"><a href="#å¦‚ä½•åœ¨-win-VS2022-ç¼–è¯‘è¯¥å·¥ç¨‹" class="headerlink" title="å¦‚ä½•åœ¨ win + VS2022 ç¼–è¯‘è¯¥å·¥ç¨‹"></a>å¦‚ä½•åœ¨ win + VS2022 ç¼–è¯‘è¯¥å·¥ç¨‹</h4><p><a href="https://github.com/ebruneton/precomputed_atmospheric_scattering">ebruneton&#x2F;precomputed_atmospheric_scattering</a><br>æ–‡æ¡£ä¸­çš„ <code>make demo</code> æ˜¯ linux çš„ç¼–è¯‘æ–¹å¼ï¼Œwindows çš„ç¼–è¯‘æ–¹å¼è—åœ¨ï¼š<br> <code>precomputed_atmospheric_scattering/platform/windows/</code>ã€‚<br><code>download_build_run.bat</code> ä¼šä¾æ¬¡è¿è¡Œ <code>download_dependencies.bat</code>ï¼Œ<code>generate_project.bat</code>ï¼Œ<code>build.bat</code>ï¼Œ<code>run.bat</code>ã€‚ä¸­é—´å¦‚æœå‡ºé”™ä¼šç›´æ¥å…³é—­å‘½ä»¤æç¤ºç¬¦çª—å£ï¼Œæ‰‹åŠ¨ä¸€ä¸ªä¸ªè¯•æ‰èƒ½çŸ¥é“å…·ä½“æŠ¥é”™ã€‚<br><strong>generate_project.bat</strong><br>æŠ¥é”™ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">CMake Error at CMakeLists.txt:<span class="hljs-number">78</span> (project):<br>Failed to run MSBuild command:<br>    MSBuild.exe<br>to get the value of VCTargetsPath:<br>-- Configuring incomplete, errors occurred!<br></code></pre></td></tr></table></figure><p>å°† MSBuild.exe åŠ å…¥ç¯å¢ƒå˜é‡å³å¯ï¼Œæˆ‘çš„åœ¨ <code>C:\Program Files\Microsoft Visual Studio\2022\Community\Msbuild\Current\Bin</code>ã€‚<br>æŠ¥é”™ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">æ— æ³•æ‰¾åˆ° Visual Studio <span class="hljs-number">2017</span> çš„ç”Ÿæˆå·¥å…·(å¹³å°å·¥å…·é›† =â€œv141â€)ã€‚è‹¥è¦ä½¿ç”¨ v141 ç”Ÿæˆå·¥å…·è¿›è¡Œç”Ÿæˆï¼Œ<br>è¯·å®‰è£… Visual Studio <span class="hljs-number">2017</span> ç”Ÿæˆå·¥å…·ã€‚æˆ–è€…ï¼Œå¯ä»¥å‡çº§åˆ°å½“å‰ Visual Studio å·¥å…·ï¼Œæ–¹å¼æ˜¯é€šè¿‡é€‰æ‹©<br>â€œé¡¹ç›®â€èœå•æˆ–å³é”®å•å‡»è¯¥è§£å†³æ–¹æ¡ˆï¼Œç„¶åé€‰æ‹©â€œé‡å®šè§£å†³æ–¹æ¡ˆç›®æ ‡â€ã€‚<br></code></pre></td></tr></table></figure><p>VisualStudio Installerï¼Œä¿®æ”¹ï¼Œå•ä¸ªç»„ä»¶ï¼Œæœç´¢ 2017ï¼Œå‹¾é€‰ <code>MSVC v141 - VS2017 C++ x64/x86 ç”Ÿæˆå·¥å…·(v14.16)</code>ã€‚<br>æŠ¥é”™ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">æ— æ³•å¯åŠ¨ç¨‹åº /ALL_BUILD æ‹’ç»è®¿é—®<br></code></pre></td></tr></table></figure><p>å³é”®é¡¹ç›®è®¾ä¸ºå¯åŠ¨é¡¹ç›®ã€‚</p><h3 id="A-Scalable-and-Production-Ready-Sky-and-Atmosphere-Rendering-Technique"><a href="#A-Scalable-and-Production-Ready-Sky-and-Atmosphere-Rendering-Technique" class="headerlink" title="A Scalable and Production Ready Sky and Atmosphere Rendering Technique"></a>A Scalable and Production Ready Sky and Atmosphere Rendering Technique</h3><p>UE çš„æ–°åšæ³•ï¼Œæ›´å°‘çš„é¢„è®¡ç®—å¼€é”€ï¼Œæ›´å°‘çš„ LUT å­˜å‚¨å¼€é”€ï¼Œå¯å®æ—¶æ›´æ–°çš„å¤§æ°”å‚æ•°ã€‚<br><a href="https://sebh.github.io/publications/">A Scalable and Production Ready Sky and Atmosphere Rendering Technique</a> 2020 é‚£ä¸¤ç¯‡<br><a href="https://zhuanlan.zhihu.com/p/150963038">UE4 æ–°ç‰ˆå¤§æ°”å®æ—¶æ¸²æŸ“-è®ºæ–‡å¯¼è¯»</a><br>åŠŸèƒ½æ¼”ç¤ºè§†é¢‘ï¼š<br><a href="https://www.bilibili.com/video/BV1hv411z7c5/">[åŠŸèƒ½ä»‹ç»]æ·±åº¦æ¢ç´¢æ–°å¤©ç©ºå¤§æ°”ç³»ç»Ÿ | Exploring the depths of the new Sky&amp;Atmosphere system</a></p><h3 id="å¤§é•–å®¢ä¸­çš„å¤©æ°”"><a href="#å¤§é•–å®¢ä¸­çš„å¤©æ°”" class="headerlink" title="å¤§é•–å®¢ä¸­çš„å¤©æ°”"></a>å¤§é•–å®¢ä¸­çš„å¤©æ°”</h3><p><a href="http://advances.realtimerendering.com/s2019/index.htm">Siggraph 2019</a> æœ€ä¸‹é¢ä¸€ç¯‡<br><a href="https://zhuanlan.zhihu.com/p/91359071">[siggraph19]ã€Šè’é‡å¤§é•–å®¢2ã€‹çš„å¤§æ°”äº‘é›¾æŠ€æœ¯</a><br><a href="https://zhuanlan.zhihu.com/p/76273445">ã€SIGGRAPH2019ã€‘è’é‡å¤§é•–å®¢ æ•‘èµ 2 ä¸­çš„å¤©æ°”ç³»ç»Ÿ</a><br><a href="https://zhuanlan.zhihu.com/p/337895373">å›¾å½¢å­¦ç ”ç©¶ï¼šã€Šè’é‡å¤§é•–å®¢2ã€‹</a></p><h3 id="å…¶ä»–èµ„æ–™"><a href="#å…¶ä»–èµ„æ–™" class="headerlink" title="å…¶ä»–èµ„æ–™"></a>å…¶ä»–èµ„æ–™</h3><p>å…³äºæ¸²æŸ“æ–¹ç¨‹ï¼š<br><a href="http://mathinfo.univ-reims.fr/IMG/pdf/PreethamSig2003CourseNotes.pdf">Modeling Skylight and Aerial Perspective</a><br><a href="http://developer.amd.com/wordpress/media/2012/10/ATI-LightScattering.pdf">Rendering Outdoor Light Scattering in Real Time</a></p><p>å…³äºå‡ ç§æ–°åšæ³•çš„ç³»åˆ—æ–‡ç« ï¼š<br><a href="https://www.zhihu.com/column/c_1366713442364088320">å¤§æ°”æ•£å°„ç›¸å…³</a></p><p>è¿™ç¯‡æ˜¯ Eric Bruneton é‚£ç¯‡çš„è¿›ä¸€æ­¥æ”¹è¿›ï¼š<br><a href="http://www.cescg.org/CESCG-2009/papers/PragueCUNI-Elek-Oskar09.pdf">Rendering Parametrizable Planetary Atmospheres with Multiple Scattering in Real-Time</a><br><a href="https://zhuanlan.zhihu.com/p/345916725">ã€è¯‘ã€‘ã€å¤§æ°”æ•£å°„ã€‘[Elek09] å®æ—¶æ¸²æŸ“å‚æ•°åŒ–çš„ã€æœ‰å¤šæ¬¡æ•£å°„çš„è¡Œæ˜Ÿå¤§æ°”</a></p><p>å¯’éœœå¼•æ“çš„å®ç°ï¼ŒOskar Elek é‚£ç¯‡è¿›ä¸€æ­¥æ”¹è¿›ï¼š<br><a href="https://sebh.github.io/publications/">Physically Based Sky, Atmosphere &amp; Cloud Rendering in Frostbite</a> 2016 é‚£ç¯‡<br><a href="https://zhuanlan.zhihu.com/p/349472710">ã€è¯‘ã€‘ã€å¯’éœœå¼•æ“ã€‘ã€å¤§æ°”æ¸²æŸ“ã€‘åŸºäºç‰©ç†çš„å¤©ç©ºã€å¤§æ°”å’Œäº‘çš„æ¸²æŸ“ï¼ˆä¸Šï¼‰</a></p><p>è‹±ç‰¹å°”çš„å®ç°ï¼ŒåŒ…æ‹¬å®Œæ•´çš„å¤§æ°”+åœ°å½¢+é˜´å½±+åå¤„ç†ã€‚<br><a href="https://www.intel.com/content/dam/develop/external/us/en/documents/outdoor-light-scattering-update.pdf">Outdoor Light Scattering Update</a><br><a href="https://github.com/GameTechDev/OutdoorLightScattering">GameTechDev&#x2F;OutdoorLightScattering</a></p><p>çº¯æ‹Ÿåˆï¼š<br><a href="https://cgg.mff.cuni.cz/projects/SkylightModelling/">An Analytic Model for Full Spectral Sky-Dome Radiance</a> æœ€åä¸€ç¯‡</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="Single-Scattering"><a href="#Single-Scattering" class="headerlink" title="Single Scattering"></a>Single Scattering</h3><p>$I&#x3D;I_S\beta(\lambda)\gamma(\theta)\sum_{P\in\overline{AB}}T(\overline{CP})T(\overline{PA})\rho(h)ds$<br>$T(\overline{CP})T(\overline{PA})&#x3D;exp\lbrace-\beta(\lambda)(D(\overline{CP})+D(\overline{PA}))\rbrace$<br>å•ä¸ª Fragment Shader å³å¯å®ç°ï¼ŒLightDir å’Œ CameraPos ç”± uniform ä¼ å…¥ï¼ŒviewDir ç”± skyBox çš„åæ ‡å¾—åˆ°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><code class="hljs c">$input v_worldPos<br><br>uniform vec4 u_cameraPos[<span class="hljs-number">1</span>];<br>uniform vec4 u_LightDir[<span class="hljs-number">1</span>];<br><br><span class="hljs-comment">// å•ä½ï¼škm</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _PlanetRadius 6371.0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _AtmosphereHeight 80.0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _DensityScaleHeight vec2(7.994, 1.2)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _PlanetCenter vec3(0.0, -_PlanetRadius, 0.0)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _ExtinctionR vec3(0.0058, 0.0135, 0.0331)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _ExtinctionM vec3(0.0200, 0.0200, 0.0200)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _MieG 0.98</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IncomingLight vec3(12.0, 12.0, 12.0)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _PI 3.1415926</span><br><br><span class="hljs-type">float</span> <span class="hljs-title function_">GetAltitude</span><span class="hljs-params">(vec3 position)</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(length(position - _PlanetCenter) - _PlanetRadius);<br>&#125;<br><br><span class="hljs-comment">// å°„çº¿çƒé¢ç›¸äº¤å‡½æ•°</span><br>vec2 <span class="hljs-title function_">RaySphereIntersection</span><span class="hljs-params">(vec3 rayOrigin, vec3 rayDir,</span><br><span class="hljs-params">    vec3 sphereCenter, <span class="hljs-type">float</span> sphereRadius)</span> &#123;<br>    rayOrigin -= sphereCenter;<br>    <span class="hljs-type">float</span> a = dot(rayDir, rayDir);<br>    <span class="hljs-type">float</span> b = <span class="hljs-number">2.0</span> * dot(rayOrigin, rayDir);<br>    <span class="hljs-type">float</span> c = dot(rayOrigin, rayOrigin) - (sphereRadius * sphereRadius);<br>    <span class="hljs-type">float</span> d = b * b - <span class="hljs-number">4.0</span> * a * c;<br>    <span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">0.0</span>) &#123;<br>    <span class="hljs-keyword">return</span> vec2(<span class="hljs-number">-1.0</span>, <span class="hljs-number">-1.0</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>    d = <span class="hljs-built_in">sqrt</span>(d);<br>    <span class="hljs-keyword">return</span> vec2(-b - d, -b + d) / (<span class="hljs-number">2.0</span> * a);<br>    &#125;<br>&#125;<br><br>vec2 <span class="hljs-title function_">RayEarthIntersection</span><span class="hljs-params">(vec3 rayOrigin, vec3 rayDir)</span> &#123;<br>    <span class="hljs-keyword">return</span> RaySphereIntersection(rayOrigin, rayDir, _PlanetCenter, _PlanetRadius);<br>&#125;<br><br>vec2 <span class="hljs-title function_">RayAtmosphereIntersection</span><span class="hljs-params">(vec3 rayOrigin, vec3 rayDir)</span> &#123;<br>    <span class="hljs-keyword">return</span> RaySphereIntersection(rayOrigin, rayDir, _PlanetCenter,  <br>        _PlanetRadius + _AtmosphereHeight);<br>&#125;<br><br><span class="hljs-comment">// é‡‡æ ·å¾—åˆ°ä¸¤ç‚¹ä¹‹é—´çš„å…‰å­¦æ·±åº¦ã€‚</span><br>vec2 <span class="hljs-title function_">DensitySampling</span><span class="hljs-params">(vec3 startPos, vec3 endPos)</span> &#123;<br>vec2 opticalDepth = vec2_splat(<span class="hljs-number">0.0</span>);<br><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> stepCount = <span class="hljs-number">16</span>;<br>vec3 step = (endPos - startPos) / stepCount;<br><span class="hljs-type">float</span> stepSize = length(step);<br><br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> s = <span class="hljs-number">0</span>; s &lt;= stepCount; ++s) &#123;<br>vec3 position = startPos + step * s;<br><span class="hljs-type">float</span> height = GetAltitude(position);<br>vec2 localDensity = <span class="hljs-built_in">exp</span>(-vec2_splat(height) / _DensityScaleHeight.xy);<br><br><span class="hljs-comment">// æ¢¯å½¢æ³•åˆ™</span><br><span class="hljs-type">float</span> weight = (s == <span class="hljs-number">0</span> || s == stepCount) ? <span class="hljs-number">0.5</span> : <span class="hljs-number">1.0</span>;<br>opticalDepth += localDensity * stepSize * weight;<br>&#125;<br><br><span class="hljs-keyword">return</span> opticalDepth;<br>&#125;<br><br><span class="hljs-comment">// å°„çº¿èµ·ç‚¹åˆ°å°„çº¿ä¸å¤§æ°”é¡¶éƒ¨äº¤ç‚¹ä¹‹é—´çš„å…‰å­¦æ·±åº¦ã€‚</span><br>vec2 <span class="hljs-title function_">LightDensitySampleing</span><span class="hljs-params">(vec3 position, vec3 lightDir)</span> &#123;<br>    <span class="hljs-comment">// åœ¨è¿™é‡Œå‡è®¾å°„çº¿ä¸€å®šä¸ä¸åœ°è¡¨ç›¸äº¤ã€‚</span><br>vec2 atmIntersection = RayAtmosphereIntersection(position, lightDir);<br>vec3 rayEnd = position + lightDir * atmIntersection.y;<br><span class="hljs-keyword">return</span> DensitySampling(position, rayEnd);<br>&#125;<br><br><span class="hljs-comment">// T(PC) * T(PA) * rho(h)</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">ComputeLocalInscattering</span><span class="hljs-params">(vec2 rho, vec2 densityCP, vec2 densityPA,</span><br><span class="hljs-params">    out vec3 localInscatterR, out vec3 localInscatterM)</span> &#123;<br>vec2 densityCPA = densityCP + densityPA;<br><br>vec3 Tr = densityCPA.x * _ExtinctionR;<br>vec3 Tm = densityCPA.y * _ExtinctionM;<br><br>vec3 extinction = <span class="hljs-built_in">exp</span>(-(Tr + Tm));<br><br>localInscatterR = extinction * rho.x;<br>localInscatterM = extinction * rho.y;<br>&#125;<br><br><span class="hljs-comment">// ç›¸å‡½æ•°ã€‚</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">ApplyPhaseFunction</span><span class="hljs-params">(inout vec3 scatterR, inout vec3 scatterM, <span class="hljs-type">float</span> cosAngle)</span> &#123;<br><span class="hljs-type">float</span> cosAngle2  = cosAngle * cosAngle;<br><span class="hljs-type">float</span> g = _MieG;<br><span class="hljs-type">float</span> g2 = g * g;<br><br><span class="hljs-type">float</span> phase = (<span class="hljs-number">3.0</span> / (<span class="hljs-number">16.0</span> * _PI)) * (<span class="hljs-number">1.0</span> + cosAngle2);<br>scatterR *= phase;<br><br>phase = (<span class="hljs-number">1.0</span> / (<span class="hljs-number">4.0</span> * _PI)) *<br>        ((<span class="hljs-number">3.0</span> * (<span class="hljs-number">1.0</span> - g2)) / (<span class="hljs-number">2.0</span> * (<span class="hljs-number">2.0</span> + g2))) *<br>        ((<span class="hljs-number">1.0</span> + cosAngle2) / (<span class="hljs-built_in">pow</span>(<span class="hljs-built_in">abs</span>((<span class="hljs-number">1.0</span> + g2 - <span class="hljs-number">2.0</span> * g * cosAngle)), <span class="hljs-number">1.5</span>)));<br>scatterM *= phase;<br>&#125;<br><br>vec3 <span class="hljs-title function_">IntegrateInscattering</span><span class="hljs-params">(vec3 rayStart, vec3 rayDir, <span class="hljs-type">float</span> rayLength, vec3 lightDir)</span> &#123;<br><span class="hljs-comment">// åœ¨å¾ªç¯ä¸­ç´¯åŠ </span><br>vec3 scatterR  = vec3_splat(<span class="hljs-number">0.0</span>);<br>vec3 scatterM  = vec3_splat(<span class="hljs-number">0.0</span>);<br>vec2 densityPA = vec2_splat(<span class="hljs-number">0.0</span>);<br>vec2 densityCP = vec2_splat(<span class="hljs-number">0.0</span>);<br><br><span class="hljs-comment">// P - å½“å‰å‘ç”Ÿæ•£å°„çš„ä½ç½®</span><br><span class="hljs-comment">// A - ç›¸æœºä½ç½®</span><br><span class="hljs-comment">// C - ä¸å¤§æ°”é¡¶éƒ¨çš„äº¤ç‚¹</span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> sampleCount = <span class="hljs-number">256</span>;<br>vec3 step = rayDir * (rayLength / sampleCount);<br><span class="hljs-type">float</span> stepSize = length(step);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> s = <span class="hljs-number">0</span>; s &lt;= sampleCount; ++s) &#123;<br>vec3 samplePos = rayStart + step * s;<br><br>        <span class="hljs-comment">// è¿™é‡Œåªè€ƒè™‘å•æ¬¡æ•£å°„ï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªé‡‡æ ·ç‚¹å¯¹å¤ªé˜³ä¸å¯è§</span><br>        <span class="hljs-comment">// ä»–ä¸ä¼šæ”¶åˆ°ä»»ä½• Radiance è‡ªç„¶ä¹Ÿä¸ä¼šæ•£å°„å‡ºä»»ä½• Radianceã€‚</span><br>vec2 crtEarthIntersection = RayEarthIntersection(samplePos, lightDir);<br><span class="hljs-type">bool</span> vis = (crtEarthIntersection.x &gt; <span class="hljs-number">0.0</span> || crtEarthIntersection.y &gt; <span class="hljs-number">0.0</span>)<br>            ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;<br><br><span class="hljs-keyword">if</span>(vis) &#123;<br>densityCP = LightDensitySampleing(samplePos, lightDir);<br><br>            <span class="hljs-comment">// DensityPA å¯ä»¥åœ¨æ¯ä¸€æ¬¡é‡‡æ ·ç‚¹ P æ­¥è¿›çš„æ—¶å€™ç´¯åŠ ï¼Œè¿™æ ·å¯ä»¥çœä¸‹ PA ä¹‹é—´çš„ç§¯åˆ†ã€‚</span><br><span class="hljs-type">float</span> height = GetAltitude(samplePos);<br>vec2 localDensityPA = <span class="hljs-built_in">exp</span>(-vec2_splat(height) / _DensityScaleHeight.xy);<br>densityPA += localDensityPA * stepSize;<br><br><span class="hljs-comment">// localDensityPA ä¾¿æ˜¯ rho(h)ã€‚</span><br>vec3 localInscatterR;<br>vec3 localInscatterM;<br>ComputeLocalInscattering(localDensityPA, densityCP, densityPA,<br>            localInscatterR, localInscatterM);<br><br><span class="hljs-comment">// æ¢¯å½¢æ³•åˆ™</span><br><span class="hljs-type">float</span> weight = (s == <span class="hljs-number">0</span> || s == sampleCount) ? <span class="hljs-number">0.5</span> : <span class="hljs-number">1.0</span>;<br>scatterR += localInscatterR * stepSize * weight;<br>scatterM += localInscatterM * stepSize * weight;<br>&#125;<br>&#125;<br>ApplyPhaseFunction(scatterR, scatterM, dot(rayDir, lightDir));<br><span class="hljs-keyword">return</span> (scatterR * _ExtinctionR + scatterM * _ExtinctionM) * _IncomingLight.xyz;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>vec3 rayStart = u_cameraPos[<span class="hljs-number">0</span>].xyz;<br>vec3 rayDir = normalize(v_worldPos.xyz);<br><br>    <span class="hljs-comment">// å½“ç›¸æœºä½äºå¤ªç©ºæ—¶ï¼Œæ²¿ç€è§†çº¿æ–¹å‘å°†ç›¸æœºç§»åŠ¨è‡³å¤§æ°”é¡¶éƒ¨ã€‚</span><br>vec2 atmIntersection = RayAtmosphereIntersection(rayStart, rayDir);<br><span class="hljs-keyword">if</span>(atmIntersection.x &gt; <span class="hljs-number">0.0</span>) &#123;<br>rayStart +=  rayDir * atmIntersection.x;<br>atmIntersection = RayAtmosphereIntersection(rayStart, rayDir);<br>&#125;<br><span class="hljs-type">float</span> rayLength = atmIntersection.y;<br><br><span class="hljs-comment">// å¦‚æœå°„çº¿ä¸åœ°è¡¨ç›¸äº¤ï¼Œæ›´æ–°å°„çº¿çš„é•¿åº¦ã€‚</span><br>vec2 earthIntersection = RayEarthIntersection(rayStart, rayDir);<br><span class="hljs-keyword">if</span> (earthIntersection.x &gt; <span class="hljs-number">0.0</span> || earthIntersection.y &gt; <span class="hljs-number">0.0</span>) &#123;<br>rayLength = earthIntersection.x;<br>&#125;<br><br>vec3 lightDir = -normalize(u_LightDir[<span class="hljs-number">0</span>].xyz);<br>vec3 radiance = IntegrateInscattering(rayStart, rayDir, rayLength, lightDir);<br><br>gl_FragColor = vec4(radiance, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Accurate-Atmospheric-Scattering-1"><a href="#Accurate-Atmospheric-Scattering-1" class="headerlink" title="Accurate Atmospheric Scattering"></a>Accurate Atmospheric Scattering</h3><p><a href="https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering">GPU Gems 2 Chapter 16. Accurate Atmospheric Scattering</a><br>æå‡ºäº†é¢„è®¡ç®—å…‰å­¦æ·±åº¦çš„åšæ³•ï¼Œé«˜åº¦è§†çº¿å¤©é¡¶è§’å¤¹è§’ä½œä¸ºå‚æ•°å¾—åˆ°ä¸€å¼ äºŒç»´çš„ LUTï¼Œä»£è¡¨äº†ä»»æ„ä¸€ç‚¹åˆ°å¤§æ°”é¡¶éƒ¨çš„å…‰å­¦æ·±åº¦ã€‚å¦‚æœè¦è®¡ç®— AB ä¸¤ç‚¹ä¹‹é—´çš„å…‰å­¦æ·±åº¦ï¼Œå‡è®¾å°„çº¿ AB ä¸å¤§æ°”é¡¶éƒ¨çš„äº¤ç‚¹ä¸º Cï¼ŒDensity(AB) å³ Density(AC) - Density(BC)ã€‚å¦‚æœå°„çº¿ AB æŒ‡å‘åœ°è¡¨ï¼Œå› ä¸º Density(AB) &#x3D;&#x3D; Density(BA)ï¼Œè¿™æ—¶è®¡ç®— BA ä¸¤ç‚¹ä¹‹é—´çš„å…‰å­¦æ·±åº¦å³å¯ã€‚<br>ç„¶åä½œè€…åˆå°†è¯¥ LUT è¿›è¡Œäº†æ‹Ÿåˆï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">GetDensityFit</span><span class="hljs-params">(<span class="hljs-type">float</span> height, <span class="hljs-type">float</span> cosine)</span> </span>&#123;<br>    <span class="hljs-type">float</span> heightTerm = <span class="hljs-built_in">exp</span>(<span class="hljs-number">-4.0</span> * height);<br>    <span class="hljs-type">float</span> c = <span class="hljs-number">1.0</span> - cosine;<br>    <span class="hljs-type">float</span> cosineTerm =<br>        <span class="hljs-number">0.25</span> * <span class="hljs-built_in">exp</span>(<span class="hljs-number">-0.00287</span> + c * (<span class="hljs-number">0.459</span> + c * (<span class="hljs-number">3.38</span> + c * (<span class="hljs-number">-6.8</span> + c * <span class="hljs-number">5.25</span>))));<br>    <span class="hljs-keyword">return</span> heightTerm * cosineTerm;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Precomputed-Atmospheric-Scattering-1"><a href="#Precomputed-Atmospheric-Scattering-1" class="headerlink" title="Precomputed Atmospheric Scattering"></a>Precomputed Atmospheric Scattering</h3><p>å†…å®¹æ¯”è¾ƒå¤šï¼Œå»ºè®®ç›´æ¥çœ‹ <a href="https://ebruneton.github.io/precomputed_atmospheric_scattering/">Precomputed Atmospheric Scattering</a>ï¼Œè¿™é‡Œåªæœ‰ä¸€äº›ç¬”è®°ã€‚<br>å¦‚æœä»…ä»…è¦å®ç°å¤§æ°”æ•£å°„ï¼Œè¿™ç¯‡æ–‡æ¡£åŒ…å«äº†ä¸å°‘å†—ä½™çš„å†…å®¹ï¼š</p><ol><li>é¢å¤–æä¾›äº†å…¨å…‰è°±çš„æ¸²æŸ“æ¨¡å¼ï¼Œè€Œéåªä½¿ç”¨ RGB å¯¹åº”çš„ä¸‰ç§æ³¢é•¿ã€‚</li><li>ä¸ºé˜²æ­¢ä¸åˆç†çš„ç±»å‹è½¬æ¢ï¼Œè‡ªå®šä¹‰äº†æ‰€æœ‰ç‰©ç†é‡ï¼Œä½†æ˜¯ glsl æ²¡æœ‰é™æ€ç±»å‹æ£€æŸ¥ï¼Œæ‰€ä»¥æ‰€æœ‰ç‰©ç†é‡å®é™…ä¸Šéƒ½æ˜¯ <code>float</code> æˆ– <code>vec3</code>ã€‚</li><li>ä¸ºéªŒè¯å„ä¸ª trick çš„æ•ˆæœï¼Œé¢å¤–æä¾›äº† CPU ç‰ˆæœ¬çš„æ¸²æŸ“æ¨¡å¼ï¼Œé€šè¿‡ <code>#include &quot;atmosphere/functions.glsl&quot;</code> å’Œä¸€äº›å®å®šä¹‰ï¼Œä½¿å¾— CPUã€GPU å…±ç”¨åŒä¸€ä»½ä»£ç ã€‚</li></ol><p>æ‰€ä»¥ demo å’Œ reference ä¸‹çš„æ–‡ä»¶æ˜¯åŸºæœ¬ä¸ç”¨çœ‹çš„ã€‚<br>è¿˜æœ‰ä¸€äº›ï¼š</p><ol><li>æ²¡æœ‰å®é™…çš„ Shader æ–‡ä»¶ï¼Œæ‰€æœ‰ Shader ä»£ç æ˜¯åœ¨ model ç±»é‡Œç”¨ string æ‹¼å‡ºæ¥çš„ã€‚</li><li>model ç±»çš„åˆå§‹åŒ–åŒ…æ‹¬äº†æœ€é‡è¦çš„ <code>AtmosphereParameters</code> ç»“æ„ä½“çš„åˆå§‹åŒ–ã€‚<br><a href="https://github.com/roeas/PrecomputedAtmosphereTexture">roeas&#x2F;PrecomputedAtmosphereTexture</a> æ˜¯ä¸€ä¸ªç”¨æ¥éªŒè¯é¢„è®¡ç®—è´´å›¾å¯è¡Œæ€§çš„å°å·¥ç¨‹ï¼Œåªè®¡ç®—äº† Transmittance å¹¶å°†å…¶ä¿å­˜ä¸ºå›¾ç‰‡ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬äº†å¦‚ä½•ç”Ÿæˆå®šä¹‰ <code>AtmosphereParameters</code> å¯¹è±¡çš„ GLSL ä»£ç ã€‚</li><li>Sharer é‡ŒåŒä¸€å¼  Texture åæœ‰æ—¶ä»£è¡¨çš„æ˜¯æœ€ç»ˆå­˜å‚¨çš„ LUTï¼Œæœ‰æ—¶ä»£è¡¨çš„æ˜¯ä¸´æ—¶çš„ delta LUTï¼Œå…·ä½“è¦çœ‹ CUP ç«¯ç»‘çš„æ˜¯å“ªå¼ ã€‚ä¸ºé˜²æ­¢æ··æ·†æˆ‘åšäº†ä¸€ç‚¹æ•´ç†ï¼š</li></ol><h4 id="å­˜å‚¨å¹¶ä½¿ç”¨çš„è´´å›¾"><a href="#å­˜å‚¨å¹¶ä½¿ç”¨çš„è´´å›¾" class="headerlink" title="å­˜å‚¨å¹¶ä½¿ç”¨çš„è´´å›¾"></a>å­˜å‚¨å¹¶ä½¿ç”¨çš„è´´å›¾</h4><ol><li>transmittance_texture_</li><li>scattering_texture_</li><li>irradiance_texture_</li><li>optional_single_mie_scattering_texture_ï¼ˆå¯é€‰é¡¹ï¼‰</li></ol><h4 id="ä¸´æ—¶è´´å›¾"><a href="#ä¸´æ—¶è´´å›¾" class="headerlink" title="ä¸´æ—¶è´´å›¾"></a>ä¸´æ—¶è´´å›¾</h4><ol><li>delta_irradiance_texture</li><li>delta_rayleigh_scattering_textureï¼ˆä»…ç”¨äºè®¡ç®—äºŒé˜¶æ•£å°„ï¼‰</li><li>delta_mie_scattering_textureï¼ˆä»…ç”¨äºè®¡ç®—äºŒé˜¶æ•£å°„ï¼‰</li><li>delta_scattering_density_texture</li><li>delta_multiple_scattering_texture &#x3D; delta_rayleigh_scattering_textureï¼ˆå¤ç”¨ï¼Œä»…ç”¨äºè®¡ç®—ä¸‰é˜¶åŠä»¥ä¸Šçš„æ•£å°„ï¼‰</li></ol><h4 id="Transmittance"><a href="#Transmittance" class="headerlink" title="Transmittance"></a>Transmittance</h4><p><strong>è¾“å…¥</strong></p><ol><li>æ— </li></ol><p><strong>è¾“å‡º</strong></p><ol><li>transmittance_texture_</li></ol><h4 id="direct-Irradiance"><a href="#direct-Irradiance" class="headerlink" title="direct Irradiance"></a>direct Irradiance</h4><p><strong>è¾“å…¥</strong></p><ol><li>transmittance_texture_</li></ol><p><strong>è¾“å‡º</strong></p><ol><li>delta_irradiance_texture</li><li>irradiance_texture_ &#x3D; 0.0</li></ol><h4 id="single-Scattering"><a href="#single-Scattering" class="headerlink" title="single Scattering"></a>single Scattering</h4><p><strong>è¾“å…¥</strong></p><ol><li>transmittance_texture_</li></ol><p><strong>è¾“å‡º</strong></p><ol><li>delta_rayleigh_scattering_texture</li><li>delta_mie_scattering_texture</li><li>scattering_texture_ &#x3D; rayleigh.rgb + mie.r</li><li>optional_single_mie_scattering_texture_ &#x3D; mieï¼ˆå¯é€‰é¡¹ï¼‰</li></ol><h4 id="Scattering-Density"><a href="#Scattering-Density" class="headerlink" title="Scattering Density"></a>Scattering Density</h4><p><strong>è¾“å…¥</strong></p><ol><li>transmittance_texture_</li><li>delta_rayleigh_scattering_texture</li><li>delta_mie_scattering_texture</li><li>delta_multiple_scattering_texture</li><li>delta_irradiance_texture</li></ol><p><strong>è¾“å‡º</strong></p><ol><li>delta_scattering_density_texture</li></ol><h4 id="indirect-Irradiance"><a href="#indirect-Irradiance" class="headerlink" title="indirect Irradiance"></a>indirect Irradiance</h4><p><strong>è¾“å…¥</strong></p><ol><li>delta_rayleigh_scattering_texture</li><li>delta_mie_scattering_texture</li><li>delta_multiple_scattering_texture</li></ol><p><strong>è¾“å‡º</strong></p><ol><li>delta_irradiance_texture</li><li>irradiance_texture_</li></ol><h4 id="multiple-Scattering"><a href="#multiple-Scattering" class="headerlink" title="multiple Scattering"></a>multiple Scattering</h4><p><strong>è¾“å…¥</strong></p><ol><li>transmittance_texture_</li><li>delta_scattering_density_texture</li></ol><p><strong>è¾“å‡º</strong></p><ol><li>delta_multiple_scattering_texture</li><li>scattering_texture_</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>AtmosphericScattering</tag>
      
      <tag>GlobalIllumination</tag>
      
      <tag>Math</tag>
      
      <tag>Rendering</tag>
      
      <tag>VolumeRendering</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Archiveã€‘ç¬”è®° E æ˜Ÿè®¡åˆ’</title>
    <link href="/2022/05/01/EStar/"/>
    <url>/2022/05/01/EStar/</url>
    
    <content type="html"><![CDATA[<h2 id="E-æ˜Ÿè®¡åˆ’"><a href="#E-æ˜Ÿè®¡åˆ’" class="headerlink" title="E æ˜Ÿè®¡åˆ’"></a>E æ˜Ÿè®¡åˆ’</h2><p><a href="https://game.academy.163.com/activity/talent?page=course">E æ˜Ÿè®¡åˆ’</a><br><em>ç½‘æ˜“ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å…³é—­äº†è¿™é—¨å…¬å¼€è¯¾çš„æµè§ˆæƒé™ï¼Œç¬‘æ­»</em></p><h3 id="02-æ¸²æŸ“æµç¨‹ç®€è¿°"><a href="#02-æ¸²æŸ“æµç¨‹ç®€è¿°" class="headerlink" title="02 æ¸²æŸ“æµç¨‹ç®€è¿°"></a>02 æ¸²æŸ“æµç¨‹ç®€è¿°</h3><p>GPU Drivenã€Mesh Cluster Renderingã€Cluster whith LODï¼ˆnaniteï¼‰<br>Mesh Shader</p><h3 id="04-çº¹ç†ç»¼è¿°"><a href="#04-çº¹ç†ç»¼è¿°" class="headerlink" title="04 çº¹ç†ç»¼è¿°"></a>04 çº¹ç†ç»¼è¿°</h3><p>MRTï¼ˆMultiple Render Targetsï¼‰<br>Virtual Texture</p><h3 id="05-å…‰ç…§ç»¼è¿°"><a href="#05-å…‰ç…§ç»¼è¿°" class="headerlink" title="05 å…‰ç…§ç»¼è¿°"></a>05 å…‰ç…§ç»¼è¿°</h3><h4 id="ç›´æ¥å…‰æ¼«åå°„"><a href="#ç›´æ¥å…‰æ¼«åå°„" class="headerlink" title="ç›´æ¥å…‰æ¼«åå°„"></a>ç›´æ¥å…‰æ¼«åå°„</h4><ul><li>$\pi f_{dif}$ çš„èŒƒå›´æ˜¯ $[0, 1]$ï¼Œé‚£ä¹ˆ $f_{dif}$ çš„èŒƒå›´æ˜¯ $[0, \frac{1}{\pi}]$ éš¾ä»¥ç†è§£ã€‚ä¸å¦‚ä½¿ $f_{dif}&#x3D;\frac{albedo}{\pi}$ï¼Œè¿™æ ·ä¸€æ¥ $albedo$ çš„èŒƒå›´å°±æ˜¯ $[0, 1]$ äº†ã€‚</li><li>å¸ƒæ—å†¯çš„ Diffuse Map æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥å°†ä¸€éƒ¨åˆ†é˜´å½±å’Œé«˜å…‰ç›´æ¥ç»˜åˆ¶åœ¨è´´å›¾ä¸Šï¼Œä½†æ˜¯ PBR çš„ Albedo Map åªèƒ½ç»˜åˆ¶æ¼«åå°„çš„è´´å›¾ã€‚albedo è¦é™¤ä»¥ $\pi$ï¼Œçœ‹èµ·æ¥ä¼šæ¯” diffuse äº®ä¸€ç‚¹ã€‚</li></ul><p><a href="https://marmoset.co/posts/pbr-texture-conversion/">PBR Texture Conversion</a></p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/EStar/5.1.png"></div><div class="group-image-wrap"><img src="/img/EStar/5.2.png"></div></div></div><h4 id="ç›´æ¥å…‰é«˜å…‰"><a href="#ç›´æ¥å…‰é«˜å…‰" class="headerlink" title="ç›´æ¥å…‰é«˜å…‰"></a>ç›´æ¥å…‰é«˜å…‰</h4><ul><li>éé‡‘å±çš„ F0 æ™®ééå¸¸å°ä¸”ç›¸å·®æ— å‡ ï¼Œåœ¨å®é™…è®¡ç®—ä¸­å¯ä»¥ç”¨ä¸€ä¸ªå¸¸é‡ï¼ˆæ¯”å¦‚ 0.04ï¼‰ä»£æ›¿æ‰€æœ‰éé‡‘å±çš„æè´¨çš„ F0 å±æ€§ã€‚</li><li>è²æ¶…å°”é¡¹ä¹Ÿä¼šå½±å“æ¼«åå°„çš„å¼ºåº¦ $F_d&#x3D;1-F-s$ ç„¶å $L_o(v)&#x3D;F_d\frac{albedo}{\pi}L_i(n\cdot l)$ï¼Œä½†æ˜¯å®é™…ä¸Šä¸ä¸€å®šå¿…é¡»è¿™ä¹ˆåšã€‚</li><li>é‡‘å±æ²¡æœ‰ Diffuse åå°„ï¼Œæ‰€ä»¥ $L_o(v)&#x3D;(1-metallic)F_d^*\frac{albedo}{\pi}L_i(n\cdot l)$ ï¼ˆè¿™ä¸ª Fd åŠ ä¸åŠ éƒ½è¡Œï¼‰ã€‚</li></ul><p>Light Cullingã€Clustered Shading</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/EStar/5.3.png"></div><div class="group-image-wrap"><img src="/img/EStar/5.4.png"></div><div class="group-image-wrap"><img src="/img/EStar/5.5.png"></div></div></div><h4 id="ç¯å¢ƒå…‰"><a href="#ç¯å¢ƒå…‰" class="headerlink" title="ç¯å¢ƒå…‰"></a>ç¯å¢ƒå…‰</h4><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/EStar/5.6.png"></div><div class="group-image-wrap"><img src="/img/EStar/5.7.png"></div></div></div><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><ul><li>æ¸¸æˆä¸­çš„ HDR ä¸æ˜¾ç¤ºå™¨çš„ HDR ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œå¦‚æœæ˜¾ç¤ºå™¨å¯ç”¨äº† HDRï¼Œæ¸¸æˆ Tone Mapping çš„æ›²çº¿éœ€è¦è°ƒæ•´ã€‚<br>split sum approximate</li></ul><p><img src="/img/EStar/5.8.png"></p><h3 id="06-æ€§èƒ½ä¼˜åŒ–ç»¼è¿°"><a href="#06-æ€§èƒ½ä¼˜åŒ–ç»¼è¿°" class="headerlink" title="06 æ€§èƒ½ä¼˜åŒ–ç»¼è¿°"></a>06 æ€§èƒ½ä¼˜åŒ–ç»¼è¿°</h3><p>è§†é”¥å‰”é™¤ã€é®æŒ¡å‰”é™¤ï¼ˆç¡¬ä»¶é®æŒ¡æŸ¥è¯¢ã€è½¯ä»¶é®æŒ¡æŸ¥è¯¢ã€ä¸è®¡ç®—å¯è§é›†ï¼‰ã€Triangle Cluster Culling<br><strong>æ¸²æŸ“åˆæ‰¹</strong><br>æ¯æ¬¡æ¸²æŸ“è°ƒç”¨æ¶‰åŠå¤§é‡æ¸²æŸ“çŠ¶æ€è®¾ç½®å’Œåˆ‡æ¢ï¼Œæ˜¾å¡é©±åŠ¨éœ€è¦æ ¹æ®çŠ¶æ€ç»„è£…å‘½ä»¤é˜Ÿåˆ—ï¼ˆç¼–ç æˆ GPU èƒ½ç†è§£çš„å¾®æŒ‡ä»¤ï¼Œå¡åˆ°é˜Ÿåˆ—é‡Œï¼‰ï¼ŒCPU äº§ç”Ÿå¼€é”€ã€‚<br><strong>éª¨éª¼åŠ¨ç”»å‹ç¼©</strong><br>å¯¹åŸå§‹æ•°æ®è¿›è¡Œå»é‡æŠ½å¸§ï¼Œæ‹†åˆ†å˜æ¢çŸ©é˜µï¼ˆå¯ä»¥è¿›ä¸€æ­¥æŠ½å¸§ï¼‰ï¼Œå¯¹ç§»åŠ¨å’Œç¼©æ”¾çŸ©é˜µåšçº¿æ€§æ’å€¼ï¼Œå¯¹æ—‹è½¬çŸ©é˜µåšçƒé¢æ’å€¼ã€‚<br>ç”¨å››å…ƒæ•°è¡¨ç¤ºçš„æ—‹è½¬å¯ä»¥ç”¨åŠç²¾åº¦çš„ float16 å­˜å‚¨ã€‚<br><strong>è™šæ‹Ÿçº¹ç†</strong><br>æå¤§é™ä½ GPU å¼€é”€ï¼šç‰©ç†è´´å›¾ä¸éœ€è¦æ¯å¸§æ›´æ–°ã€‚<br>æ¶ˆè€—å¤§é‡æ˜¾å­˜ã€‚<br>Compute Shader å¯ä»¥è¿›è¡Œè¿è¡Œæ—¶çº¹ç†å‹ç¼©ï¼ˆTEC2ï¼Œæ˜¾å¡å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦è§£å‹ï¼‰<br>å¯ä»¥ç”¨å…¬å¼æ‹Ÿåˆä¸€äº›è´´å›¾ï¼ˆMatlab æ›²é¢æ‹Ÿåˆï¼‰<br><strong>TBDR</strong><br>è¿‡å»ï¼šä¸€ä¸ªä¸ª tile ç®—ï¼Œç®—å®Œä¸€æ•´å¼  G-Buffer åå°†å…¶å­˜å…¥å†…å­˜ï¼Œç®—å®Œæ‰€æœ‰ G-Buffer åå°†ä»–ä»¬ä¼ å› GPU è¿›è¡Œæœ€ç»ˆçš„ç€è‰²è®¡ç®—ã€‚<br>ç°åœ¨ï¼šåœ¨ä¸€ä¸ª tile å†…å®Œæˆå…¨éƒ¨çš„ G-Buffer ä¸ç€è‰²çš„è®¡ç®—ï¼Œè¿™ä¸€å°å— G-Buffer ç”¨å®Œå³ä¸¢ï¼Œä¸ä¼šå®é™…è¿›å…¥å†…å­˜ã€‚<br>æ–°çš„ API æ‰æ”¯æŒï¼Œçœæ˜¾å­˜åˆçœå¸¦å®½ã€‚<br>ç¼ºç‚¹æ˜¯è¿™äº›ä¸¢å¼ƒçš„ G-Buffer åœ¨ä¹‹åçš„æµç¨‹ä¸­ï¼ˆæ¯”å¦‚ä¸€äº›åå¤„ç†ï¼‰æ— æ³•å†è¢«è®¿é—®ã€‚</p><h3 id="07-å…¨å±€å…‰ç…§æŠ€æœ¯ç»¼è¿°"><a href="#07-å…¨å±€å…‰ç…§æŠ€æœ¯ç»¼è¿°" class="headerlink" title="07 å…¨å±€å…‰ç…§æŠ€æœ¯ç»¼è¿°"></a>07 å…¨å±€å…‰ç…§æŠ€æœ¯ç»¼è¿°</h3><p>LightMap<br>Point-Based Global Illumination<br><img src="/img/EStar/7.1.png"><br>Light Propagation Volumes<br><img src="/img/EStar/7.2.png"><br>SVO Cone Tracing</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/EStar/7.3.png"></div><div class="group-image-wrap"><img src="/img/EStar/7.4.png"></div></div></div><p>SVGF</p>]]></content>
    
    
    
    <tags>
      
      <tag>GlobalIllumination</tag>
      
      <tag>Rendering</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬”è®° C++ Primer</title>
    <link href="/2021/11/27/CppPrimer/"/>
    <url>/2021/11/27/CppPrimer/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬ä¸€ç« -å¼€å§‹"><a href="#ç¬¬ä¸€ç« -å¼€å§‹" class="headerlink" title="ç¬¬ä¸€ç«  å¼€å§‹"></a>ç¬¬ä¸€ç«  å¼€å§‹</h1><h2 id="1-2-åˆè¯†è¾“å…¥è¾“å‡º"><a href="#1-2-åˆè¯†è¾“å…¥è¾“å‡º" class="headerlink" title="1.2 åˆè¯†è¾“å…¥è¾“å‡º"></a>1.2 åˆè¯†è¾“å…¥è¾“å‡º</h2><p><code>#include &lt;iostream&gt;</code><br>ä½¿ç”¨äº† iostream åº“ï¼ŒåŒ…å«äº† istream ç±»å’Œ ostream ç±»ï¼Œåˆ†åˆ«è¡¨ç¤ºè¾“å…¥æµå’Œè¾“å‡ºæµã€‚</p><p><strong>å‘æµå†™å…¥æ•°æ®</strong><br>è¾“å‡ºè¿ç®—ç¬¦ï¼ˆ&lt;&lt;ï¼‰æ¥å—ä¸¤ä¸ªè¿ç®—å¯¹è±¡ï¼Œå·¦ä¾§å¿…é¡»æ˜¯ä¸€ä¸ª ostream å¯¹è±¡ï¼Œå³ä¾§æ˜¯è¦æ‰“å°çš„å€¼ï¼Œç„¶åè¿”å›å…¶å·¦ä¾§çš„å¯¹è±¡ã€‚<br><code>std::endl</code><br>è¿™æ˜¯ä¸€ä¸ªè¢«ç§°ä¸ºæ“ä½œç¬¦çš„ç‰¹æ®Šå€¼ï¼Œå†™å…¥ endl çš„æ•ˆæœæ˜¯ç»“æŸå½“å‰è¡Œï¼Œå¹¶å°†ä¸è®¾å¤‡å…³è”çš„ç¼“å†²åŒºä¸­çš„å†…å®¹åˆ·åˆ°è®¾å¤‡ä¸­ã€‚è°ƒè¯•æ—¶åº”ä¿è¯ä¸€ç›´åˆ·æ–°æµï¼Œé¿å…ç¨‹åºå´©æºƒæ—¶è¾“å‡ºè¿˜ç•™åœ¨ç¼“å†²åŒºä¸­ã€‚<br><code>std::cerr</code><br>ä¸€ä¸ª ostream å¯¹è±¡ï¼Œå†™åˆ° cerr çš„æ•°æ®æ˜¯ä¸ç¼“å†²çš„ã€‚<br><code>std::clog</code><br>ä¸€ä¸ª ostream å¯¹è±¡ï¼Œå†™åˆ° clog çš„æ•°æ®æ˜¯è¢«ç¼“å†²çš„ã€‚</p><p><strong>ä»æµè¯»å–æ•°æ®</strong><br>è¾“å…¥è¿ç®—ç¬¦ï¼ˆ&gt;&gt;ï¼‰æ¥å—ä¸¤ä¸ªè¿ç®—å¯¹è±¡ï¼Œå·¦ä¾§å¿…é¡»æ˜¯ä¸€ä¸ª istream å¯¹è±¡ï¼Œå³ä¾§æ˜¯è¦æ¥æ”¶å€¼çš„å¯¹è±¡ï¼Œç„¶åè¿”å›å…¶å·¦ä¾§çš„å¯¹è±¡ã€‚</p><h2 id="1-4-æ§åˆ¶æµ"><a href="#1-4-æ§åˆ¶æµ" class="headerlink" title="1.4 æ§åˆ¶æµ"></a>1.4 æ§åˆ¶æµ</h2><h3 id="1-4-3-è¯»å–æ•°é‡ä¸å®šçš„è¾“å…¥æ•°æ®"><a href="#1-4-3-è¯»å–æ•°é‡ä¸å®šçš„è¾“å…¥æ•°æ®" class="headerlink" title="1.4.3 è¯»å–æ•°é‡ä¸å®šçš„è¾“å…¥æ•°æ®"></a>1.4.3 è¯»å–æ•°é‡ä¸å®šçš„è¾“å…¥æ•°æ®</h3><p><code>while(std::cin &gt;&gt; value)</code><br>å½“æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª istream å¯¹è±¡ä½œä¸ºæ¡ä»¶æ—¶ï¼Œå…¶æ•ˆæœæ˜¯æ£€æµ‹æµçš„çŠ¶æ€ã€‚å½“é‡åˆ°æ–‡ä»¶ç»“æŸç¬¦ï¼Œæˆ–é‡åˆ°æ— æ•ˆè¾“å…¥æ—¶ï¼Œistream å¯¹è±¡çš„çŠ¶æ€ä¼šå˜ä¸ºæ— æ•ˆã€‚</p><h1 id="ç¬¬äºŒç« -å˜é‡å’ŒåŸºæœ¬ç±»å‹"><a href="#ç¬¬äºŒç« -å˜é‡å’ŒåŸºæœ¬ç±»å‹" class="headerlink" title="ç¬¬äºŒç«  å˜é‡å’ŒåŸºæœ¬ç±»å‹"></a>ç¬¬äºŒç«  å˜é‡å’ŒåŸºæœ¬ç±»å‹</h1><h2 id="2-1-åŸºæœ¬å†…ç½®ç±»å‹"><a href="#2-1-åŸºæœ¬å†…ç½®ç±»å‹" class="headerlink" title="2.1 åŸºæœ¬å†…ç½®ç±»å‹"></a>2.1 åŸºæœ¬å†…ç½®ç±»å‹</h2><h3 id="2-1-1-ç®—æœ¯ç±»å‹"><a href="#2-1-1-ç®—æœ¯ç±»å‹" class="headerlink" title="2.1.1 ç®—æœ¯ç±»å‹"></a>2.1.1 ç®—æœ¯ç±»å‹</h3><p><strong>å¸¦ç¬¦å·ç±»å‹å’Œæ— ç¬¦å·ç±»å‹</strong><br>å°½ç®¡å­—ç¬¦å‹æœ‰ä¸‰ç§<code>char</code>ã€<code>signed char</code>ã€<code>unsigned char</code>ï¼Œå­—ç¬¦çš„è¡¨ç°å½¢å¼å´åªæœ‰ä¸¤ç§ï¼šç±»å‹<code>char</code>å®é™…ä¸Šä¼šè¡¨ç°ä¸ºå¦ä¸¤ç§çš„ä¸€ç§ï¼Œå…·ä½“æ˜¯å¦å¸¦ç¬¦å·ç”±ç¼–è¯‘å™¨å†³å®šï¼Œæ‰€ä»¥ä½¿ç”¨å­—ç¬¦å‹è¿›è¡Œè¿ç®—ç‰¹åˆ«å®¹æ˜“å‡ºé—®é¢˜ã€‚</p><h3 id="2-1-2-ç±»å‹è½¬æ¢"><a href="#2-1-2-ç±»å‹è½¬æ¢" class="headerlink" title="2.1.2 ç±»å‹è½¬æ¢"></a>2.1.2 ç±»å‹è½¬æ¢</h3><p>æ— ç¬¦å·è¶…èŒƒå›´æ—¶å–æ¨¡ï¼Œæœ‰ç¬¦å·è¶…èŒƒå›´æ—¶ç»“æœæœªå®šä¹‰ã€‚</p><p><strong>å«æœ‰æ— ç¬¦å·ç±»å‹çš„è¡¨è¾¾å¼</strong><br>å½“ä¸€ä¸ªè¡¨è¾¾å¼é‡Œæ—¢æœ‰å¸¦ç¬¦å·æ•°åˆæœ‰æ— ç¬¦å·æ•°æ—¶ï¼Œå¸¦ç¬¦å·æ•°ä¼šè‡ªåŠ¨è½¬æ¢æˆæ— ç¬¦å·æ•°æ—¶ã€‚è¿™ä¸ªè¿‡ç¨‹ç›¸å½“äºå°†ä¸€ä¸ªå¸¦ç¬¦å·æ•°ç›´æ¥èµ‹ç»™æˆæ— ç¬¦å·å˜é‡ï¼Œé‚£ä¹ˆå½“å¸¦ç¬¦å·æ•°ä¸ºè´Ÿæ—¶å°±ä¼šå‡ºç°å¼‚å¸¸çš„ç»“æœã€‚</p><h3 id="2-1-3-å­—é¢å€¼æŸ¥å¸¸é‡"><a href="#2-1-3-å­—é¢å€¼æŸ¥å¸¸é‡" class="headerlink" title="2.1.3 å­—é¢å€¼æŸ¥å¸¸é‡"></a>2.1.3 å­—é¢å€¼æŸ¥å¸¸é‡</h3><p><strong>å­—ç¬¦å­—é¢å€¼å’Œå­—ä¸²ç¬¦å­—é¢å€¼</strong><br>å­—ç¬¦ä¸²å­—é¢å€¼çš„ç±»å‹å®é™…ä¸Šæ˜¯ç”±å¸¸é‡å­—ç¬¦æ„æˆçš„æ•°ç»„ã€‚ç¼–è¯‘å™¨åœ¨æ¯ä¸ªå­—ç¬¦ä¸²çš„ç»“å°¾å¤„æ·»åŠ ä¸€ä¸ªç©ºå­—ç¬¦(â€˜\0â€™)ï¼Œå› æ­¤ï¼Œå­—ç¬¦ä¸²å­—é¢å€¼çš„å®é™…é•¿åº¦è¦æ¯”å®ƒçš„å†…å®¹å¤š1ã€‚<br>å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²å­—é¢å€¼ä½ç½®ç´§é‚»ä¸”ä»…ç”±ç©ºæ ¼ã€ç¼©è¿›å’Œæ¢è¡Œç¬¦åˆ†éš”ï¼Œåˆ™å®ƒä»¬å®é™…ä¸Šæ˜¯ä¸€ ä¸ªæ•´ä½“ã€‚</p><h2 id="2-2-å˜é‡"><a href="#2-2-å˜é‡" class="headerlink" title="2.2 å˜é‡"></a>2.2 å˜é‡</h2><h3 id="2-2-1-å˜é‡å®šä¹‰"><a href="#2-2-1-å˜é‡å®šä¹‰" class="headerlink" title="2.2.1 å˜é‡å®šä¹‰"></a>2.2.1 å˜é‡å®šä¹‰</h3><p><strong>é»˜è®¤åˆå§‹åŒ–</strong><br>å®šä¹‰äºä»»ä½•å‡½æ•°ä½“ä¹‹å¤–çš„å˜é‡è¢«åˆå§‹åŒ–ä¸º0ï¼Œå®šä¹‰åœ¨å‡½æ•°ä½“å†…éƒ¨çš„å†…ç½®ç±»å‹å˜é‡å°†ä¸è¢«åˆå§‹åŒ–ã€‚string ç±»è§„å®šå¦‚æœæ²¡æœ‰æŒ‡å®šåˆå€¼åˆ™ç”Ÿæˆä¸€ä¸ªç©ºä¸²ã€‚</p><h3 id="2-2-2-å˜é‡å£°æ˜å’Œå®šä¹‰çš„å…³ç³»"><a href="#2-2-2-å˜é‡å£°æ˜å’Œå®šä¹‰çš„å…³ç³»" class="headerlink" title="2.2.2 å˜é‡å£°æ˜å’Œå®šä¹‰çš„å…³ç³»"></a>2.2.2 å˜é‡å£°æ˜å’Œå®šä¹‰çš„å…³ç³»</h3><p>å£°æ˜ä½¿å¾—åå­—ä¸ºç¨‹åºæ‰€çŸ¥ã€‚è€Œå®šä¹‰è´Ÿè´£åˆ›å»ºä¸åå­—å…³è”çš„å®ä½“ã€‚å˜é‡å£°æ˜è§„å®šäº†å˜é‡çš„ç±»å‹å’Œåå­—ã€‚å®šä¹‰è¿˜ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå¯èƒ½ä¼šä¸ºå˜é‡èµ‹ä¸€ä¸ªåˆå§‹å€¼ã€‚</p><p><strong>extern</strong><br>å¦‚æœæƒ³å£°æ˜ä¸€ä¸ªå˜é‡è€Œéå®šä¹‰å®ƒï¼Œå°±åœ¨å˜é‡åå‰æ·»åŠ å…³é”®å­— externï¼Œè€Œä¸”ä¸è¦æ˜¾å¼åœ°åˆå§‹åŒ–å˜é‡ã€‚extern è¯­å¥å¦‚æœåŒ…å«åˆå§‹å€¼å°±ä¸å†æ˜¯å£°æ˜ï¼Œè€Œå˜æˆå®šä¹‰äº†ã€‚å˜é‡èƒ½ä¸”åªèƒ½è¢«å®šä¹‰ä¸€æ¬¡ï¼Œä½†æ˜¯å¯ä»¥è¢«å¤šæ¬¡å£°æ˜ã€‚<br>å¦‚æœè¦åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨åŒä¸€ä¸ªå˜é‡ï¼Œå°±å¿…é¡»å°†å£°æ˜å’Œå®šä¹‰åˆ†ç¦»ã€‚æ­¤æ—¶ï¼Œå˜é‡çš„å®šä¹‰å¿…é¡»å‡ºç°åœ¨ä¸”åªèƒ½å‡ºç°åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè€Œå…¶ä»–ç”¨åˆ°è¯¥å˜é‡çš„æ–‡ä»¶å¿…é¡»å¯¹å…¶è¿›è¡Œå£°æ˜ï¼Œå´ç»å¯¹ä¸èƒ½é‡å¤å®šä¹‰ã€‚</p><h2 id="2-3-å¤åˆç±»å‹"><a href="#2-3-å¤åˆç±»å‹" class="headerlink" title="2.3 å¤åˆç±»å‹"></a>2.3 å¤åˆç±»å‹</h2><h3 id="2-3-1-å¼•ç”¨"><a href="#2-3-1-å¼•ç”¨" class="headerlink" title="2.3.1 å¼•ç”¨"></a>2.3.1 å¼•ç”¨</h3><p>å› ä¸ºæ— æ³•ä»¤å¼•ç”¨é‡æ–°ç»‘å®šåˆ°å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤å¼•ç”¨å¿…é¡»åˆå§‹åŒ–ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚å› ä¸ºå¼•ç”¨æœ¬èº«ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä¸èƒ½å®šä¹‰å¼•ç”¨çš„å¼•ç”¨ã€‚</p><h2 id="2-4-const-é™å®šç¬¦"><a href="#2-4-const-é™å®šç¬¦" class="headerlink" title="2.4 const é™å®šç¬¦"></a>2.4 const é™å®šç¬¦</h2><h3 id="2-4-1-const-çš„å¼•ç”¨"><a href="#2-4-1-const-çš„å¼•ç”¨" class="headerlink" title="2.4.1 const çš„å¼•ç”¨"></a>2.4.1 const çš„å¼•ç”¨</h3><p>æ‰€è°“å¸¸é‡å¼•ç”¨æ˜¯å¯¹å¸¸é‡çš„å¼•ç”¨ï¼Œå› ä¸ºå¼•ç”¨ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å¸¸é‡å¼•ç”¨ã€‚åœ¨åˆå§‹åŒ–å¸¸é‡å¼•ç”¨æ—¶å…è®¸ç”¨ä»»æ„è¡¨è¾¾å¼ä½œä¸ºåˆå§‹å€¼ï¼Œæ­¤æ—¶è¯¥å¼•ç”¨ä¼šç»‘å®šåˆ°ä¸€ä¸ªä¸´æ—¶é‡å¯¹è±¡ï¼ˆå¸¸é‡ï¼‰ä¸Šï¼Œè€Œä¸åŸæœ¬ç­‰å·å³ä¾§çš„è¡¨è¾¾å¼å‡ ä¹ä¸ç›¸å…³ã€‚</p><h3 id="2-4-2-æŒ‡é’ˆå’Œ-const"><a href="#2-4-2-æŒ‡é’ˆå’Œ-const" class="headerlink" title="2.4.2 æŒ‡é’ˆå’Œ const"></a>2.4.2 æŒ‡é’ˆå’Œ const</h3><p>å…è®¸ä¸€ä¸ªæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªéå¸¸é‡å¯¹è±¡ï¼Œæ‰€è°“çš„åº•å±‚ constï¼Œä¸è¿‡æ˜¯æŒ‡é’ˆæˆ–å¼•ç”¨è‡ªå·±è®¤ä¸ºè‡ªå·±æŒ‡å‘äº†å¸¸é‡ï¼Œç„¶åè‡ªè§‰åœ°ä¸å»æ”¹å˜æ‰€æŒ‡å¯¹è±¡çš„å€¼ã€‚</p><h3 id="2-4-3-é¡¶å±‚-const"><a href="#2-4-3-é¡¶å±‚-const" class="headerlink" title="2.4.3 é¡¶å±‚ const"></a>2.4.3 é¡¶å±‚ const</h3><p>ç”¨äºå£°æ˜å¼•ç”¨çš„ const éƒ½æ˜¯åº•å±‚ constã€‚å½“æ‰§è¡Œå¯¹è±¡çš„æ‹·è´æ“ä½œæ—¶ï¼Œæ‹·å…¥å’Œæ‹·å‡ºçš„å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸åŒçš„åº•å±‚ const èµ„æ ¼ï¼Œæˆ–è€…ä¸¤ä¸ªå¯¹è±¡çš„æ•°æ®ç±»å‹å¿…é¡»èƒ½å¤Ÿè½¬æ¢ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œéå¸¸é‡å¯ä»¥è½¬æ¢æˆå¸¸é‡ï¼Œåä¹‹åˆ™ä¸è¡Œã€‚</p><h3 id="2-4-4-constexpr-è¡¨è¾¾å¼"><a href="#2-4-4-constexpr-è¡¨è¾¾å¼" class="headerlink" title="2.4.4 constexpr è¡¨è¾¾å¼"></a>2.4.4 constexpr è¡¨è¾¾å¼</h3><p>å¸¸é‡è¡¨è¾¾å¼æ˜¯æŒ‡å€¼ä¸ä¼šæ”¹å˜å¹¶ä¸”åœ¨ç¼–è¯‘è¿‡ç¨‹å°±èƒ½å¾—åˆ°è®¡ç®—ç»“æœçš„è¡¨è¾¾å¼ã€‚æ˜¾ç„¶å­—é¢å€¼å±äºå¸¸é‡è¡¨è¾¾å¼ï¼Œç”¨å¸¸é‡è¡¨è¾¾å¼åˆå§‹åŒ–çš„ const å¯¹è±¡ä¹Ÿæ˜¯å¸¸é‡è¡¨è¾¾å¼ã€‚<br>å°†å˜é‡å£°æ˜ä¸º constexpr ç±»å‹ä»¥ä¾¿ç”±ç¼–è¯‘å™¨æ¥éªŒè¯å˜é‡çš„å€¼æ˜¯å¦æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ã€‚</p><p><strong>å­—é¢å€¼ç±»å‹</strong><br>ç®—æœ¯ç±»å‹ã€å¼•ç”¨å’ŒæŒ‡é’ˆéƒ½å±äºå­—é¢å€¼ç±»å‹ã€‚ä¸€ä¸ª constexpr æŒ‡é’ˆçš„åˆå§‹å€¼å¿…é¡»æ˜¯ nullptĞ³ æˆ–è€… 0ï¼Œæˆ–è€…æ˜¯å­˜å‚¨äºæŸä¸ªå›ºå®šåœ°å€ä¸­çš„å¯¹è±¡ï¼ˆå®šä¹‰äºæ‰€æœ‰å‡½æ•°ä½“ä¹‹å¤–çš„å˜é‡ï¼‰ã€‚</p><p><strong>æŒ‡é’ˆå’Œ constexpr</strong><br>åœ¨ constexpr å£°æ˜ä¸­å¦‚æœå®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œæ— è®ºé™å®šç¬¦ constexpr å‡ºç°åœ¨ä»€ä¹ˆä½ç½®ï¼Œéƒ½ä»…å¯¹æŒ‡é’ˆç”Ÿæ•ˆï¼Œä¸æŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡æ— å…³ã€‚</p><h2 id="2-5-å¤„ç†ç±»å‹"><a href="#2-5-å¤„ç†ç±»å‹" class="headerlink" title="2.5 å¤„ç†ç±»å‹"></a>2.5 å¤„ç†ç±»å‹</h2><h3 id="2-5-1-ç±»å‹åˆ«å"><a href="#2-5-1-ç±»å‹åˆ«å" class="headerlink" title="2.5.1 ç±»å‹åˆ«å"></a>2.5.1 ç±»å‹åˆ«å</h3><p>ä½¿ç”¨<code>typedef char *pstr;</code>æˆ–<code>using pstr = char *;</code><br>æ³¨æ„<code>const pstr cstr</code>ä¸ç­‰äº<code>const char *cstr</code>ï¼Œå°±åƒæ˜¯ç±»å‹åˆ«åå†³å®šäº†å£°æ˜ä¸­ç»“åˆçš„ä¼˜å…ˆçº§ä¸€æ ·ã€‚<br>å‰è€…å£°æ˜äº†ä¸€ä¸ªæŒ‡å‘ char çš„å¸¸é‡æŒ‡é’ˆï¼Œåè€…å£°æ˜äº†ä¸€ä¸ªæŒ‡å‘ const char çš„æŒ‡é’ˆã€‚</p><h3 id="2-5-2-auto-ç±»å‹è¯´æ˜ç¬¦"><a href="#2-5-2-auto-ç±»å‹è¯´æ˜ç¬¦" class="headerlink" title="2.5.2 auto ç±»å‹è¯´æ˜ç¬¦"></a>2.5.2 auto ç±»å‹è¯´æ˜ç¬¦</h3><p>auto â€”èˆ¬ä¼šå¿½ç•¥æ‰é¡¶å±‚ const å’Œå¼•ç”¨ï¼Œå¦‚æœå¸Œæœ›æ¨æ–­å‡ºçš„ auto ç±»å‹æ˜¯ä¸€ä¸ªé¡¶å±‚ constï¼Œéœ€è¦æ˜ç¡®æŒ‡å‡ºã€‚<br>auto å¼•ç”¨ä¼šä¿ç•™åˆå§‹å€¼ä¸­çš„é¡¶å±‚å¸¸é‡å±æ€§ã€‚<br><code>int i = 0;</code><br><code>cosnt int ci = i, &amp;cr = ci;</code><br><code>auto b = ci; auto c = cr</code> b å’Œ c æ˜¯ intã€‚<br><code>auto d = &amp;i; auto e = &amp;ci;</code> d æ˜¯ä¸€ä¸ª int æŒ‡é’ˆï¼Œe æ˜¯ä¸€ä¸ªæŒ‡å‘ const int çš„æŒ‡é’ˆã€‚<br><code>const auto f = ci;</code> f æ˜¯ä¸€ä¸ªæŒ‡å‘ int çš„å¸¸é‡æŒ‡é’ˆã€‚<br><code>auto &amp;g = ci; const auto &amp;j = 42;</code> g å’Œ j éƒ½æ˜¯ const int å¼•ç”¨ã€‚</p><h3 id="2-5-3-decltype-ç±»å‹æŒ‡ç¤º"><a href="#2-5-3-decltype-ç±»å‹æŒ‡ç¤º" class="headerlink" title="2.5.3 decltype ç±»å‹æŒ‡ç¤º"></a>2.5.3 decltype ç±»å‹æŒ‡ç¤º</h3><p>ç¼–è¯‘å™¨åˆ†æè¡¨è¾¾å¼å¹¶å¾—åˆ°å®ƒçš„ç±»å‹ï¼Œå´ä¸å®é™…è®¡ç®—è¡¨è¾¾å¼çš„å€¼ã€‚decltype å®Œæ•´åœ°ä¿ç•™å‚æ•°çš„ç±»å‹ï¼ŒåŒ…æ‹¬ const ä¸å¼•ç”¨ã€‚</p><p><strong>decltype å’Œå¼•ç”¨</strong><br>å¦‚æœè¡¨è¾¾å¼çš„å†…å®¹æ˜¯è§£å¼•ç”¨æ“ä½œï¼Œåˆ™decltypeå°†å¾—åˆ°å¼•ç”¨ç±»å‹ã€‚å¦‚æœç»™å˜é‡åŠ ä¸Šäº†ä¸€å±‚æˆ–å¤šå±‚æ‹¬å·ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠŠå®ƒå½“æˆæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚å¦‚æœè¡¨è¾¾å¼çš„æ±‚å€¼ç»“æœæ˜¯å·¦å€¼ï¼Œdecltype å¾—åˆ°ä¸€ä¸ªå¼•ç”¨ç±»å¼•ç”¨å‹ã€‚å› ä¸ºå˜é‡æ˜¯ä¸€ç§å¯ä»¥ä½œä¸ºèµ‹å€¼è¯­å¥å·¦å€¼çš„ç‰¹æ®Šè¡¨è¾¾å¼ï¼Œæ‰€ä»¥è¿™æ ·çš„ decltype å°±ä¼šå¾—åˆ°å¼•ç”¨ç±»å‹ã€‚<br>åˆ‡è®°ï¼š<code>decltype((variaide))</code>çš„ç»“æœæ°¸è¿œæ˜¯å¼•ç”¨ç±»å‹ã€‚</p><h3 id="2-6-3-ç¼–å†™è‡ªå·±çš„å¤´æ–‡ä»¶"><a href="#2-6-3-ç¼–å†™è‡ªå·±çš„å¤´æ–‡ä»¶" class="headerlink" title="2.6.3 ç¼–å†™è‡ªå·±çš„å¤´æ–‡ä»¶"></a>2.6.3 ç¼–å†™è‡ªå·±çš„å¤´æ–‡ä»¶</h3><p>æœ‰å¿…è¦åœ¨ä¹¦å†™ å¤´æ–‡ä»¶æ—¶åšé€‚å½“å¤„ç†ï¼Œä½¿å…¶é‡åˆ°å¤šæ¬¡åŒ…å«æƒ…å†µä¹Ÿèƒ½å®‰å…¨å’Œæ­£å¸¸åœ°å·¥ä½œã€‚</p><p><strong>é¢„å¤„ç†å™¨æ¦‚è¿°</strong><br>é¢„å¤„ç†å™¨æ˜¯åœ¨ç¼–è¯‘ä¹‹å‰æ‰§è¡Œçš„ä¸€æ®µç¨‹åºã€‚</p><p><strong>å¤´æ–‡ä»¶ä¿æŠ¤ç¬¦</strong><br>å¤´æ–‡ä»¶ä¿æŠ¤ç¬¦ä¾èµ–äºé¢„å¤„ç†å˜é‡ã€‚<br><code>#define</code>æŒ‡ä»¤æŠŠä¸€ä¸ªåå­—è®¾å®šä¸ºé¢„å¤„ç†å˜é‡ã€‚<br><code>#ifdef</code>å½“ä¸”ä»…å½“å˜é‡å·²å®šä¹‰æ—¶ä¸ºçœŸã€‚<br><code>#ifndef</code>å½“ä¸”ä»…å½“å˜é‡æœªå®šä¹‰æ—¶ä¸ºçœŸï¼Œä¸€æ—¦æ£€æŸ¥ç»“æœä¸ºçœŸï¼Œåˆ™æ‰§è¡Œåç»­æ“ä½œç›´è‡³é‡åˆ°<code>#endif</code>æŒ‡ä»¤ä¸ºæ­¢ã€‚<br>æ•´ä¸ªç¨‹åºä¸­çš„é¢„å¤„ç†å˜é‡åŒ…æ‹¬å¤´æ–‡ä»¶ä¿æŠ¤ç¬¦å¿…é¡»å”¯ä¸€ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åŸºäºå¤´æ–‡ä»¶ä¸­ç±»çš„åå­—æ¥æ„å»ºä¿æŠ¤ç¬¦çš„åå­—ï¼Œä»¥ç¡®ä¿å…¶å”¯ä¸€æ€§ã€‚ä¸ºäº†é¿å…ä¸ç¨‹åºä¸­çš„å…¶ä»–å®ä½“å‘ç”Ÿåå­—å†²çªï¼Œä¸€èˆ¬æŠŠé¢„å¤„ç†å˜é‡çš„åå­—å…¨éƒ¨å¤§å†™ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> CLASS_NAME_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CLASS_NAME_H</span><br><span class="hljs-comment">// å„ç§åŒ…å«ä¸å®šä¹‰ã€‚</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><h1 id="ç¬¬ä¸‰ç« -å­—ç¬¦ä¸²ã€å‘é‡å’Œæ•°ç»„"><a href="#ç¬¬ä¸‰ç« -å­—ç¬¦ä¸²ã€å‘é‡å’Œæ•°ç»„" class="headerlink" title="ç¬¬ä¸‰ç«  å­—ç¬¦ä¸²ã€å‘é‡å’Œæ•°ç»„"></a>ç¬¬ä¸‰ç«  å­—ç¬¦ä¸²ã€å‘é‡å’Œæ•°ç»„</h1><h2 id="3-2-æ ‡å‡†åº“ç±»å‹-string"><a href="#3-2-æ ‡å‡†åº“ç±»å‹-string" class="headerlink" title="3.2 æ ‡å‡†åº“ç±»å‹ string"></a>3.2 æ ‡å‡†åº“ç±»å‹ string</h2><h3 id="3-2-1-å®šä¹‰å’Œåˆå§‹åŒ–-string-å¯¹è±¡"><a href="#3-2-1-å®šä¹‰å’Œåˆå§‹åŒ–-string-å¯¹è±¡" class="headerlink" title="3.2.1 å®šä¹‰å’Œåˆå§‹åŒ– string å¯¹è±¡"></a>3.2.1 å®šä¹‰å’Œåˆå§‹åŒ– string å¯¹è±¡</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">string <span class="hljs-title">s1</span><span class="hljs-params">(<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;c&#x27;</span>)</span></span>; <span class="hljs-comment">// s çš„å†…å®¹æ˜¯ cccccccccc</span><br>string s2 = <span class="hljs-string">&quot;Hello&quot;</span>; <span class="hljs-comment">// æ‹·è´åˆå§‹åŒ–</span><br><span class="hljs-function">string <span class="hljs-title">s3</span><span class="hljs-params">(<span class="hljs-string">&quot;Hello&quot;</span>)</span></span>; <span class="hljs-comment">// ç›´æ¥åˆå§‹åŒ–</span><br></code></pre></td></tr></table></figure><p><strong>è¯»å†™ string å¯¹è±¡</strong><br>string å¯¹è±¡ä¼šè‡ªåŠ¨å¿½ç•¥å¼€å¤´çš„ç©ºç™½ï¼Œç›´åˆ°é‡è§ä¸‹ä¸€å¤„ç©ºç™½ä¸ºæ­¢ã€‚</p><p><strong>ä½¿ç”¨ getline è¯»å–ä¸€æ•´è¡Œ</strong><br>getline å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªè¾“å…¥æµå’Œä¸€ä¸ª string å¯¹è±¡ï¼Œå‡½æ•°ä»ç»™å®šçš„è¾“å…¥æµä¸­è¯»å…¥å†…å®¹ï¼Œç›´åˆ°é‡åˆ°æ¢è¡Œç¬¦ä¸ºæ­¢ï¼ˆæ³¨æ„æ¢è¡Œç¬¦ä¹Ÿè¢«è¯»è¿›æ¥äº†ï¼‰ï¼Œç„¶åæŠŠæ‰€è¯»çš„å†…å®¹å­˜å…¥åˆ°é‚£ä¸ª string å¯¹è±¡ä¸­å»ï¼ˆæ³¨æ„ä¸å­˜æ¢è¡Œç¬¦ï¼‰ã€‚</p><p><strong>string::size_type ç±»å‹</strong><br>size() å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª string::size_typeç±»å‹çš„å€¼ï¼Œå®ƒæ˜¯ä¸€ ä¸ªæ— ç¬¦å·ç±»å‹çš„å€¼ï¼ˆå‚è§2.1.1èŠ‚ï¼Œç¬¬30é¡µï¼‰è€Œä¸”èƒ½è¶³å¤Ÿå­˜æ”¾ä¸‹ä»»ä½•stringå¯¹è±¡çš„å¤§å°ã€‚å¦‚æœä¸€æ¡è¡¨è¾¾å¼ä¸­å·²ç»æœ‰äº† size() å‡½æ•°å°±ä¸è¦å†ä½¿ç”¨ int äº†ï¼Œè¿™æ ·å¯ä»¥é¿å…<br>æ··ç”¨ int å’Œ unsigned å¯èƒ½å¸¦æ¥çš„é—®é¢˜ã€‚</p><h2 id="3-3-æ ‡å‡†åº“ç±»å‹-vector"><a href="#3-3-æ ‡å‡†åº“ç±»å‹-vector" class="headerlink" title="3.3 æ ‡å‡†åº“ç±»å‹ vector"></a>3.3 æ ‡å‡†åº“ç±»å‹ vector</h2><p>å› ä¸ºå¼•ç”¨ä¸æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¸å­˜åœ¨åŒ…å«å¼•ç”¨çš„ vectorã€‚</p><h3 id="3-3-1-å®šä¹‰å’Œåˆå§‹åŒ–-vector-å¯¹è±¡"><a href="#3-3-1-å®šä¹‰å’Œåˆå§‹åŒ–-vector-å¯¹è±¡" class="headerlink" title="3.3.1 å®šä¹‰å’Œåˆå§‹åŒ– vector å¯¹è±¡"></a>3.3.1 å®šä¹‰å’Œåˆå§‹åŒ– vector å¯¹è±¡</h3><p><strong>å€¼åˆå§‹åŒ–</strong><br>å¯ä»¥åªæä¾› vector å¯¹è±¡å®¹çº³çš„å…ƒç´ æ•°é‡è€Œç•¥å»åˆå§‹å€¼ã€‚æ­¤æ—¶åº“ä¼šåˆ›å»ºä¸€ä¸ªå€¼åˆå§‹åŒ–çš„å…ƒç´ åˆå€¼ï¼Œå¹¶æŠŠå®ƒèµ‹ç»™å®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚è¿™ä¸ªåˆå€¼ç”± vector å¯¹è±¡ä¸­å…ƒç´ çš„ç±»å‹å†³å®šã€‚å¦‚æœ vector å¯¹è±¡çš„å…ƒç´ æ˜¯å†…ç½®ç±»å‹ï¼Œæ¯”å¦‚ intï¼Œåˆ™å…ƒç´ åˆå§‹å€¼è‡ªåŠ¨è®¾ä¸º 0ã€‚å¦‚æœå…ƒç´ æ˜¯æŸç§ç±»ç±»å‹ï¼Œæ¯”å¦‚ stringï¼Œåˆ™å…ƒç´ ç”±ç±»é»˜è®¤åˆå§‹åŒ–ã€‚<br>å¦‚æœåˆå§‹åŒ–æ—¶ä½¿ç”¨äº†èŠ±æ‹¬å·çš„å½¢å¼ä½†æ˜¯æä¾›çš„å€¼åˆä¸èƒ½ç”¨æ¥åˆ—è¡¨åˆå§‹åŒ–ï¼Œå°±è¦è€ƒè™‘ç”¨è¿™æ ·çš„å€¼æ¥æ„é€  vector å¯¹è±¡äº†ã€‚</p><h2 id="3-4-è¿­ä»£å™¨ä»‹ç»"><a href="#3-4-è¿­ä»£å™¨ä»‹ç»" class="headerlink" title="3.4 è¿­ä»£å™¨ä»‹ç»"></a>3.4 è¿­ä»£å™¨ä»‹ç»</h2><h3 id="3-4-1-ä½¿ç”¨è¿­ä»£å™¨"><a href="#3-4-1-ä½¿ç”¨è¿­ä»£å™¨" class="headerlink" title="3.4.1 ä½¿ç”¨è¿­ä»£å™¨"></a>3.4.1 ä½¿ç”¨è¿­ä»£å™¨</h3><p><code>vector&lt;Type&gt;::iterator</code>ä¸<code>vector&lt;Type&gt;::const_iterator</code>ç±»å‹</p><p><strong>ç»“åˆè§£å¼•ç”¨ä¸æˆå‘˜è®¿é—®æ“ä½œ</strong><br><code>(*it).mem();</code>æ‹¬å·å¿…ä¸å¯å°‘ã€‚ä¸ºäº†ç®€åŒ–ä¸Šè¿°è¡¨è¾¾å¼ï¼ŒC++ è¯­è¨€å®šä¹‰äº†ç®­å¤´è¿ç®—ç¬¦ï¼ˆ-&gt;ï¼‰ã€‚ç®­å¤´è¿ç®—ç¬¦æŠŠè§£å¼•ç”¨å’Œæˆå‘˜è®¿é—®ä¸¤ä¸ªæ“ä½œç»“åˆåœ¨ä¸€èµ·ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>it-&gt;mem</code>å’Œ<code>(*it) .mem</code>è¡¨è¾¾çš„æ„æ€ç›¸åŒã€‚<br>ä»»ä½•ä¸€ç§å¯èƒ½æ”¹å˜ vector å¯¹è±¡å®¹é‡çš„æ“ä½œï¼Œæ¯”å¦‚ push_backï¼Œéƒ½ä¼šä½¿è¯¥ vector å¯¹è±¡çš„è¿­ä»£å™¨å¤±æ•ˆã€‚<br>ä¸¤ä¸ªè¿­ä»£å™¨ç›¸å‡æ‰€å¾—ç»“æœçš„ç±»å‹æ˜¯åä¸º difference_type çš„å¸¦ç¬¦å·æ•´å‹æ•°ã€‚</p><h2 id="3-5-æ•°ç»„"><a href="#3-5-æ•°ç»„" class="headerlink" title="3.5 æ•°ç»„"></a>3.5 æ•°ç»„</h2><p>æ•°ç»„çš„å¤§å°ç¡®å®šä¸å˜ï¼Œç»´åº¦å¿…é¡»æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œå¿…é¡»æŒ‡å®šç±»å‹ï¼Œä¸å­˜åœ¨å¼•ç”¨çš„æ•°ç»„ï¼Œä¸å…è®¸æ‹·è´å’Œèµ‹å€¼ã€‚</p><p><strong>å¤æ‚çš„æ•°ç»„å£°æ˜</strong><br><code>int *(&amp;arry)[10] = prts; // é¦–å…ˆarryæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå¼•ç”¨å¯¹è±¡ä¸ºå¤§å°ä¸º10çš„æ•°ç»„ï¼Œæ•°ç»„ç±»å‹æ˜¯æŒ‡å‘intçš„æŒ‡é’ˆ</code></p><h3 id="3-5-3-æŒ‡é’ˆå’Œæ•°ç»„"><a href="#3-5-3-æŒ‡é’ˆå’Œæ•°ç»„" class="headerlink" title="3.5.3 æŒ‡é’ˆå’Œæ•°ç»„"></a>3.5.3 æŒ‡é’ˆå’Œæ•°ç»„</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> ia[] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;;<br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">ia2</span><span class="hljs-params">(ia)</span></span>; <span class="hljs-comment">// ia2æ˜¯æŒ‡å‘isç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ</span><br><span class="hljs-keyword">decltype</span>(ia) ia3 = &#123;<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;; <span class="hljs-comment">// ia3æ˜¯é•¿åº¦ä¸º5çš„æ•´å‹æ•°ç»„</span><br></code></pre></td></tr></table></figure><p><strong>æ ‡å‡†åº“å‡½æ•° begin å’Œ end</strong><br>begin() å‡½æ•°è¿”å›æŒ‡å‘æ•°ç»„é¦–å…ƒç´ çš„æŒ‡é’ˆï¼Œend() å‡½æ•°è¿”å›æŒ‡å‘æ•°ç»„å°¾å…ƒç´ ä¸‹ä¸€ä½ç½®çš„æŒ‡é’ˆï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å®šä¹‰åœ¨ iterator å¤´æ–‡ä»¶ä¸­ã€‚</p><p><strong>æŒ‡é’ˆè¿ç®—</strong><br>ä¸¤ä¸ªæŒ‡é’ˆç›¸å‡çš„ç»“æœçš„ç±»å‹æ˜¯ä¸€ç§åä¸º ptrdiff_t çš„æ ‡å‡†åº“ç±»å‹ï¼Œå’Œ size_t â€”æ ·ï¼Œptrdiff_t ä¹Ÿæ˜¯ä¸€ç§å®šä¹‰åœ¨ cstddef å¤´æ–‡ä»¶ä¸­çš„æœºå™¨ç›¸å…³çš„ç±»å‹ã€‚å› ä¸ºå·®å€¼å¯èƒ½ä¸ºè´Ÿå€¼ï¼Œæ‰€ä»¥ ptrdiff_t æ˜¯ä¸€ç§å¸¦ç¬¦å·ç±»å‹ã€‚</p><h3 id="3-5-4-C-é£æ ¼å­—ç¬¦ä¸²"><a href="#3-5-4-C-é£æ ¼å­—ç¬¦ä¸²" class="headerlink" title="3.5.4 C é£æ ¼å­—ç¬¦ä¸²"></a>3.5.4 C é£æ ¼å­—ç¬¦ä¸²</h3><p>string ç±»æä¾›äº† c_str() å‡½æ•°ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª C é£æ ¼å­—ç¬¦ä¸²ã€‚<br>å…è®¸ä½¿ç”¨æ•°ç»„æ¥åˆå§‹åŒ– vector å¯¹è±¡ã€‚<br><code>vectro&lt;int&gt; ivec(begin(int_arr), end(int_arr));</code></p><h2 id="3-6-å¤šç»´æ•°ç»„"><a href="#3-6-å¤šç»´æ•°ç»„" class="headerlink" title="3.6 å¤šç»´æ•°ç»„"></a>3.6 å¤šç»´æ•°ç»„</h2><p><code>int ia[3][4] = &#123;&#123;0&#125;, &#123;1&#125;, &#123;3&#125;&#125;; // æ˜¾ç¤ºåœ°åˆå§‹åŒ–æ¯è¡Œçš„é¦–å…ƒç´ </code><br>è¦ä½¿ç”¨èŒƒå›´ for è¯­å¥å¤„ç†å¤šç»´æ•°ç»„ï¼Œé™¤äº†æœ€å†…å±‚çš„å¾ªç¯å¤–ï¼Œå…¶ä»–æ‰€æœ‰å¾ªç¯çš„æ§åˆ¶å˜é‡éƒ½åº”è¯¥æ˜¯å¼•ç”¨ç±»å‹ï¼Œå¦åˆ™ auto çš„ç±»å‹ä¼šæ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚</p><h1 id="ç¬¬å››ç« -è¡¨è¾¾å¼"><a href="#ç¬¬å››ç« -è¡¨è¾¾å¼" class="headerlink" title="ç¬¬å››ç«  è¡¨è¾¾å¼"></a>ç¬¬å››ç«  è¡¨è¾¾å¼</h1><h2 id="4-1-åŸºç¡€"><a href="#4-1-åŸºç¡€" class="headerlink" title="4.1 åŸºç¡€"></a>4.1 åŸºç¡€</h2><h3 id="4-1-1-åŸºæœ¬æ¦‚å¿µ"><a href="#4-1-1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="4.1.1 åŸºæœ¬æ¦‚å¿µ"></a>4.1.1 åŸºæœ¬æ¦‚å¿µ</h3><p><strong>è¿ç®—å¯¹è±¡è½¬æ¢</strong><br>å°æ•´æ•°ç±»å‹ï¼ˆå¦‚ boolã€charã€short ç­‰ï¼‰é€šå¸¸ä¼šè¢«æå‡æˆè¾ƒå¤§çš„æ•´æ•°ç±»å‹ï¼Œä¸»è¦æ˜¯ intã€‚</p><h3 id="4-1-3-æ±‚å€¼é¡ºåº"><a href="#4-1-3-æ±‚å€¼é¡ºåº" class="headerlink" title="4.1.3 æ±‚å€¼é¡ºåº"></a>4.1.3 æ±‚å€¼é¡ºåº</h3><p>ç¼–è¯‘å™¨ä¸ä¼šæ˜ç¡®æŒ‡å®šè¡¨è¾¾å¼ä¸­è¿ç®—å¯¹è±¡çš„æ±‚å€¼é¡ºåºã€‚<code>i++ + ++i</code>è‡ªç„¶æ˜¯æœªå®šä¹‰çš„æ“ä½œã€‚</p><h2 id="4-2-ç®—æœ¯è¿ç®—ç¬¦"><a href="#4-2-ç®—æœ¯è¿ç®—ç¬¦" class="headerlink" title="4.2 ç®—æœ¯è¿ç®—ç¬¦"></a>4.2 ç®—æœ¯è¿ç®—ç¬¦</h2><p>m%(-n)&#x3D;m%n; (-m)%n&#x3D;-(m%n)</p><h2 id="4-4-èµ‹å€¼è¿ç®—ç¬¦"><a href="#4-4-èµ‹å€¼è¿ç®—ç¬¦" class="headerlink" title="4.4 èµ‹å€¼è¿ç®—ç¬¦"></a>4.4 èµ‹å€¼è¿ç®—ç¬¦</h2><p>å³ä¾§è¿ç®—å¯¹è±¡å°†è½¬æ¢æˆå·¦ä¾§è¿ç®—å¯¹è±¡çš„ç±»å‹ï¼Œèµ‹å€¼è¿ç®—è¿”å›çš„æ˜¯å…¶å·¦ä¾§è¿ç®—å¯¹è±¡ã€‚<br>å¤åˆè¿ç®—ç¬¦åªæ±‚å€¼ä¸€æ¬¡ã€‚</p><h2 id="4-5-é€’å¢å’Œé€’å‡è¿ç®—ç¬¦"><a href="#4-5-é€’å¢å’Œé€’å‡è¿ç®—ç¬¦" class="headerlink" title="4.5 é€’å¢å’Œé€’å‡è¿ç®—ç¬¦"></a>4.5 é€’å¢å’Œé€’å‡è¿ç®—ç¬¦</h2><p>å‰ç½®ç‰ˆæœ¬å°†æ›´æ–°åçš„å¯¹è±¡æœ¬èº«ä½œä¸ºå·¦å€¼è¿”å›ï¼Œåç½®ç‰ˆæœ¬åˆ™å°†å¯¹è±¡åŸå§‹å€¼çš„å‰¯æœ¬ä½œä¸ºå³å€¼è¿”å›ã€‚é™¤éå¿…é¡»ï¼Œå¦åˆ™ä¸ç”¨é€’å¢é€’å‡è¿ç®—ç¬¦çš„åç½®ç‰ˆæœ¬ã€‚</p><h2 id="4-7-æ¡ä»¶è¿ç®—ç¬¦"><a href="#4-7-æ¡ä»¶è¿ç®—ç¬¦" class="headerlink" title="4.7 æ¡ä»¶è¿ç®—ç¬¦"></a>4.7 æ¡ä»¶è¿ç®—ç¬¦</h2><p>æ¡ä»¶è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§éå¸¸ä½ï¼Œå› æ­¤å½“ä¸€æ¡é•¿è¡¨è¾¾å¼ä¸­åµŒå¥—äº†æ¡ä»¶è¿ç®—å­è¡¨è¾¾å¼æ—¶ï¼Œé€š å¸¸éœ€è¦åœ¨å®ƒä¸¤ç«¯åŠ ä¸Šæ‹¬å·ã€‚</p><h2 id="4-8-ä½è¿ç®—ç¬¦"><a href="#4-8-ä½è¿ç®—ç¬¦" class="headerlink" title="4.8 ä½è¿ç®—ç¬¦"></a>4.8 ä½è¿ç®—ç¬¦</h2><p>å¦‚æœè¿ç®—å¯¹è±¡æ˜¯å¸¦ç¬¦å·çš„ä¸”å®ƒçš„å€¼ä¸ºè´Ÿï¼Œé‚£ä¹ˆä½è¿ç®—ç¬¦å¦‚ä½•å¤„ç†è¿ç®—å¯¹è±¡çš„â€œç¬¦å·ä½â€ä¾èµ–äºæœºå™¨ã€‚è€Œä¸”, æ­¤æ—¶çš„å·¦ç§»æ“ä½œå¯èƒ½ä¼šæ”¹å˜ç¬¦å·ä½çš„å€¼ï¼Œå› æ­¤æ˜¯ä¸€ç§æœªå®šä¹‰çš„è¡Œä¸ºã€‚<br>å·¦ç§»è¿ç®—ç¬¦ï¼ˆ&lt;&lt;ï¼‰åœ¨å³ä¾§æ’å…¥å€¼ä¸º 0 çš„äºŒè¿›åˆ¶ä½ã€‚å³ç§»è¿ç®—ç¬¦ï¼ˆ&gt;&gt;ï¼‰çš„è¡Œä¸ºåˆ™ä¾èµ–äºå…¶å·¦ä¾§è¿ç®—å¯¹è±¡çš„ç±»å‹ï¼šå¦‚æœè¯¥è¿ç®—å¯¹è±¡æ˜¯æ— ç¬¦å·ç±»å‹ï¼Œåœ¨å·¦ä¾§æ’å…¥å€¼ä¸º 0 çš„äºŒè¿›åˆ¶ä½: å¦‚æœè¯¥è¿ç®—å¯¹è±¡æ˜¯å¸¦ç¬¦å·ç±»å‹ï¼Œåœ¨å·¦ä¾§æ’å…¥ç¬¦å·ä½çš„å‰¯æœ¬æˆ–å€¼ä¸º 0 çš„äºŒè¿›åˆ¶ä½ã€‚</p><h2 id="4-11-ç±»å‹è½¬æ¢"><a href="#4-11-ç±»å‹è½¬æ¢" class="headerlink" title="4.11 ç±»å‹è½¬æ¢"></a>4.11 ç±»å‹è½¬æ¢</h2><h3 id="4-11-1-ç®—æœ¯è½¬æ¢"><a href="#4-11-1-ç®—æœ¯è½¬æ¢" class="headerlink" title="4.11.1 ç®—æœ¯è½¬æ¢"></a>4.11.1 ç®—æœ¯è½¬æ¢</h3><p>ç®—æ•°è¡¨è¾¾å¼ä¸­è¿ç®—ç¬¦çš„è¿ç®—å¯¹è±¡å°†è½¬æ¢æˆæœ€å®½çš„ç±»å‹ã€‚<br>å¸¦ç¬¦å·ç±»å‹å¤§äºæ— ç¬¦å·ç±»å‹ï¼Œæ­¤æ—¶è½¬æ¢çš„ç»“æœä¾èµ–äºæœºå™¨ã€‚å¦‚æœæ— ç¬¦å·ç±»å‹çš„æ‰€æœ‰å€¼éƒ½èƒ½å­˜åœ¨è¯¥å¸¦ç¬¦å·ç±»å‹ä¸­ï¼Œåˆ™æ— ç¬¦å·ç±»å‹çš„è¿ç®—å¯¹è±¡è½¬æ¢æˆå¸¦ç¬¦å·ç±»å‹ã€‚å¦‚æœä¸èƒ½ï¼Œé‚£ä¹ˆå¸¦ç¬¦å·ç±»å‹çš„è¿ç®—å¯¹è±¡è½¬æ¢æˆæ— ç¬¦å·ç±»å‹ã€‚</p><h3 id="4-11-2-å…¶ä»–éšå¼ç±»å‹è½¬æ¢"><a href="#4-11-2-å…¶ä»–éšå¼ç±»å‹è½¬æ¢" class="headerlink" title="4.11.2 å…¶ä»–éšå¼ç±»å‹è½¬æ¢"></a>4.11.2 å…¶ä»–éšå¼ç±»å‹è½¬æ¢</h3><p>åŒ…æ‹¬å¸¸é‡æ•´æ•°å€¼ 0 æˆ–è€…å­—é¢å€¼ nullptr èƒ½è½¬æ¢æˆä»»æ„æŒ‡é’ˆç±»å‹ã€‚æŒ‡å‘ä»»æ„éå¸¸é‡çš„æŒ‡é’ˆèƒ½è½¬æ¢æˆ void<em>ã€‚æŒ‡å‘ä»»æ„å¯¹è±¡çš„æŒ‡é’ˆèƒ½è½¬æ¢æˆ const void</em>ã€‚</p><h3 id="4-11-3-æ˜¾ç¤ºè½¬æ¢"><a href="#4-11-3-æ˜¾ç¤ºè½¬æ¢" class="headerlink" title="4.11.3 æ˜¾ç¤ºè½¬æ¢"></a>4.11.3 æ˜¾ç¤ºè½¬æ¢</h3><p><strong>static_cast</strong><br>ä»»ä½•å…·æœ‰æ˜ç¡®å®šä¹‰çš„ç±»å‹è½¬æ¢ï¼Œåªè¦ä¸åŒ…å«åº•å±‚ constï¼Œéƒ½å¯ä»¥ä½¿ç”¨ static_castã€‚</p><p><strong>const_cast</strong><br>const_caståªèƒ½æ”¹å˜è¿ç®—å¯¹è±¡çš„åº•å±‚ constã€‚</p><p><strong>reinterpret_cast</strong><br>é€šå¸¸ä¸ºè¿ç®—å¯¹è±¡çš„ä½æ¨¡å¼æä¾›è¾ƒä½å±‚æ¬¡ä¸Šçš„é‡æ–°è§£é‡Šã€‚reinterpret_cast æœ¬è´¨ä¸Šä¾èµ–äºæœºå™¨ä¸”éå¸¸å±é™©ã€‚</p><p><strong>æ—§å¼çš„å¼ºåˆ¶è½¬æ¢</strong><br><code>type(exper)</code>æˆ–<code>(type)exper</code><br>å¦‚æœæ›¿æ¢ä¸º static_cast æˆ– const_cast ä¹Ÿåˆæ³•ï¼Œåˆ™æ‰§è¡Œä¸ä»–ä»¬ç›¸ä¼¼çš„è¡Œä¸ºï¼Œå¦åˆ™æ‰§è¡Œä¸ reinterpret_cast ç›¸ä¼¼çš„è¡Œä¸ºã€‚</p><h1 id="ç¬¬äº”ç« -è¯­å¥"><a href="#ç¬¬äº”ç« -è¯­å¥" class="headerlink" title="ç¬¬äº”ç«  è¯­å¥"></a>ç¬¬äº”ç«  è¯­å¥</h1><h2 id="5-6-try-è¯­å¥å’Œå¼‚å¸¸å¤„ç†"><a href="#5-6-try-è¯­å¥å’Œå¼‚å¸¸å¤„ç†" class="headerlink" title="5.6 try è¯­å¥å’Œå¼‚å¸¸å¤„ç†"></a>5.6 try è¯­å¥å’Œå¼‚å¸¸å¤„ç†</h2><p>æŠ›å‡ºå¼‚å¸¸å°†ç»ˆæ­¢å½“å‰çš„å‡½æ•°ï¼Œå¹¶æŠŠæ§åˆ¶æƒè½¬ç§»ç»™èƒ½å¤„ç†è¯¥å¼‚å¸¸çš„ä»£ç ã€‚<br>åœ¨ try ä¸­ throw å¼‚å¸¸ï¼Œç„¶åå±‚å±‚æŸ¥æ‰¾ç¬¦åˆçš„ catchã€‚å¦‚æœæœ€ç»ˆè¿˜æ˜¯æ²¡èƒ½æ‰¾åˆ°ä»»ä½•åŒ¹é…çš„catchå­å¥ï¼Œç¨‹åºè½¬åˆ°åä¸º terminate çš„æ ‡å‡†åº“å‡½æ•°ã€‚è¯¥å‡½æ•°çš„è¡Œä¸ºä¸ç³»ç»Ÿæœ‰å…³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ‰§è¡Œè¯¥å‡½æ•°å°†å¯¼è‡´ç¨‹åºéæ­£å¸¸é€€å‡ºã€‚</p><h1 id="ç¬¬å…­ç« -å‡½æ•°"><a href="#ç¬¬å…­ç« -å‡½æ•°" class="headerlink" title="ç¬¬å…­ç«  å‡½æ•°"></a>ç¬¬å…­ç«  å‡½æ•°</h1><h2 id="6-1-å‡½æ•°åŸºç¡€"><a href="#6-1-å‡½æ•°åŸºç¡€" class="headerlink" title="6.1 å‡½æ•°åŸºç¡€"></a>6.1 å‡½æ•°åŸºç¡€</h2><p><strong>å½¢å‚å’Œå®å‚</strong><br>å®å‚æ˜¯å½¢å‚çš„åˆå§‹å€¼ã€‚ç¼–è¯‘å™¨èƒ½ä»¥ä»»æ„å¯è¡Œçš„é¡ºåºå¯¹å®å‚æ±‚å€¼ã€‚</p><h3 id="6-1-1-å±€éƒ¨å¯¹è±¡"><a href="#6-1-1-å±€éƒ¨å¯¹è±¡" class="headerlink" title="6.1.1 å±€éƒ¨å¯¹è±¡"></a>6.1.1 å±€éƒ¨å¯¹è±¡</h3><p><strong>è‡ªåŠ¨å¯¹è±¡</strong><br>æˆ‘ä»¬æŠŠåªå­˜åœ¨äºå—æ‰§è¡ŒæœŸé—´çš„å¯¹è±¡ç§°ä¸ºè‡ªåŠ¨å¯¹è±¡ã€‚</p><p><strong>å±€éƒ¨é™æ€å¯¹è±¡</strong><br>å±€éƒ¨é™æ€å¯¹è±¡åœ¨ç¨‹åºçš„æ‰§è¡Œè·¯å¾„ç¬¬ä¸€æ¬¡ç»è¿‡å¯¹è±¡å®šä¹‰è¯­å¥æ—¶åˆå§‹åŒ–ï¼Œå¹¶ä¸”ç›´åˆ°ç¨‹åºç»ˆæ­¢æ‰è¢«é”€æ¯ï¼Œåœ¨æ­¤æœŸé—´å³ä½¿å¯¹è±¡æ‰€åœ¨çš„å‡½æ•°ç»“æŸæ‰§è¡Œä¹Ÿä¸ä¼šå¯¹å®ƒæœ‰å½±å“ã€‚<br>å¦‚æœå±€éƒ¨é™æ€å˜é‡æ²¡æœ‰æ˜¾å¼çš„åˆå§‹å€¼ï¼Œå®ƒå°†æ‰§è¡Œå€¼åˆå§‹åŒ–ã€‚</p><h2 id="6-2-å‚æ•°ä¼ é€’"><a href="#6-2-å‚æ•°ä¼ é€’" class="headerlink" title="6.2 å‚æ•°ä¼ é€’"></a>6.2 å‚æ•°ä¼ é€’</h2><h3 id="6-2-3-const-å½¢å‚å’Œå®å‚"><a href="#6-2-3-const-å½¢å‚å’Œå®å‚" class="headerlink" title="6.2.3 const å½¢å‚å’Œå®å‚"></a>6.2.3 const å½¢å‚å’Œå®å‚</h3><p>å½“ç”¨å®å‚åˆå§‹åŒ–å½¢å‚æ—¶ä¼šå¿½ç•¥æ‰é¡¶å±‚ constã€‚æ¢å¥è¯è¯´ï¼Œå½¢å‚çš„é¡¶å±‚ const è¢«å¿½ç•¥æ‰äº†ã€‚</p><p><strong>å°½é‡ä½¿ç”¨å¸¸é‡å¼•ç”¨</strong><br>ä¸€ä¸ªéå¸¸é‡å¼•ç”¨çš„å½¢å‚æ— æ³•æ¥å—ä¸€ä¸ªå¸¸é‡çš„å®å‚</p><h3 id="6-2-4-æ•°ç»„å½¢å‚"><a href="#6-2-4-æ•°ç»„å½¢å‚" class="headerlink" title="6.2.4 æ•°ç»„å½¢å‚"></a>6.2.4 æ•°ç»„å½¢å‚</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fun</span><span class="hljs-params">(<span class="hljs-type">int</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fun</span><span class="hljs-params">(<span class="hljs-type">int</span>[])</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fun</span><span class="hljs-params">(<span class="hljs-type">int</span>[<span class="hljs-number">10</span>])</span></span>;<br><span class="hljs-comment">// è¿™ä¸‰ä¸ªå‡½æ•°æ˜¯ç­‰ä»·çš„ã€‚</span><br></code></pre></td></tr></table></figure><p><strong>æ•°ç»„å¼•ç”¨å½¢å‚</strong><br>å½¢å‚æ˜¯æ•°ç»„çš„å¼•ç”¨ï¼Œç»´åº¦æ˜¯ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚<br><code>void fun(int (&amp;arr)[10]);</code></p><p><strong>ä¼ é€’å¤šç»´æ•°ç»„</strong><br>æ•°ç»„ç¬¬äºŒç»´ï¼ˆä»¥åŠåé¢æ‰€æœ‰ç»´åº¦ï¼‰çš„å¤§å°éƒ½æ˜¯æ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œä¸èƒ½çœç•¥ï¼š<br><code>void fun(int (*mat)[10])</code></p><h3 id="6-2-6-å«æœ‰å¯å˜å½¢å‚çš„å‡½æ•°"><a href="#6-2-6-å«æœ‰å¯å˜å½¢å‚çš„å‡½æ•°" class="headerlink" title="6.2.6 å«æœ‰å¯å˜å½¢å‚çš„å‡½æ•°"></a>6.2.6 å«æœ‰å¯å˜å½¢å‚çš„å‡½æ•°</h3><p><strong>initializer_list å½¢å‚</strong><br>å®å‚æ•°é‡æœªçŸ¥ä½†æ˜¯å…¨éƒ¨å®å‚çš„ç±»å‹éƒ½ç›¸åŒï¼Œinitializer_list ä¹Ÿæ˜¯ä¸€ç§æ¨¡æ¿ç±»å‹ï¼Œå¯¹è±¡ä¸­çš„å…ƒç´ æ°¸è¿œæ˜¯å¸¸é‡å€¼ã€‚å¦‚æœæƒ³å‘ initializer_list å½¢å‚ä¸­ä¼ é€’ä¸€ä¸ªå€¼çš„åºæ­¹ï¼Œåˆ™å¿…é¡»æŠŠåºåˆ—æ”¾åœ¨ä¸€å¯¹èŠ±æ‹¬å·å†…ï¼š<br><code>fun(&#123;a, b, c&#125;);</code></p><p><strong>çœç•¥ç¬¦å½¢å‚</strong><br>çœç•¥ç¬¦å½¢å‚åªèƒ½å‡ºç°åœ¨å½¢å‚åˆ—è¡¨çš„æœ€åä¸€ä¸ªä½ç½®ï¼Œå¤§å¤šæ•°ç±»ç±»å‹çš„å¯¹è±¡åœ¨ä¼ é€’ç»™çœç•¥ç¬¦å½¢å‚æ—¶éƒ½æ— æ³•æ­£ç¡®æ‹·è´ï¼Œçœç•¥ç¬¦å½¢å‚æ‰€å¯¹åº”çš„å®å‚æ— é¡»ç±»å‹æ£€æŸ¥ã€‚<br><code>void fun(int a, ...)</code></p><h2 id="6-3-è¿”å›ç±»å‹å’Œ-return-è¯­å¥"><a href="#6-3-è¿”å›ç±»å‹å’Œ-return-è¯­å¥" class="headerlink" title="6.3 è¿”å›ç±»å‹å’Œ return è¯­å¥"></a>6.3 è¿”å›ç±»å‹å’Œ return è¯­å¥</h2><h3 id="6-3-1-æ— è¿”å›å€¼å‡½æ•°"><a href="#6-3-1-æ— è¿”å›å€¼å‡½æ•°" class="headerlink" title="6.3.1 æ— è¿”å›å€¼å‡½æ•°"></a>6.3.1 æ— è¿”å›å€¼å‡½æ•°</h3><p>åœ¨è¿™ç±»å‡½æ•°çš„æœ€åä¸€å¥åé¢ä¼šéšå¼åœ°æ‰§è¡Œ returnã€‚ä¸€ä¸ªè¿”å†‹ç±»å‹æ˜¯ void çš„å‡½æ•°ä¹Ÿèƒ½è¿”å›å¦ä¸€ä¸ªè¿”å› void çš„å‡½æ•°ã€‚</p><h3 id="6-3-2-æœ‰è¿”å›å€¼å‡½æ•°"><a href="#6-3-2-æœ‰è¿”å›å€¼å‡½æ•°" class="headerlink" title="6.3.2 æœ‰è¿”å›å€¼å‡½æ•°"></a>6.3.2 æœ‰è¿”å›å€¼å‡½æ•°</h3><p>è¿”å†‹çš„å€¼ç”¨äºåˆå§‹åŒ–è°ƒ ç”¨ç‚¹çš„ä¸€ä¸ªä¸´æ—¶é‡ï¼Œè¯¥ä¸´æ—¶é‡å°±æ˜¯å‡½æ•°è°ƒç”¨çš„ç»“æœã€‚</p><h3 id="6-3-3-è¿”å›æ•°ç»„æŒ‡é’ˆ"><a href="#6-3-3-è¿”å›æ•°ç»„æŒ‡é’ˆ" class="headerlink" title="6.3.3 è¿”å›æ•°ç»„æŒ‡é’ˆ"></a>6.3.3 è¿”å›æ•°ç»„æŒ‡é’ˆ</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-type">int</span> arrT[<span class="hljs-number">10</span>]; <span class="hljs-comment">// arrTçš„ç±»å‹æ˜¯é•¿åº¦ä¸º10çš„intæ•°ç»„</span><br><span class="hljs-keyword">using</span> arrT = <span class="hljs-type">int</span>[<span class="hljs-number">10</span>]; <span class="hljs-comment">// ç­‰ä»·</span><br></code></pre></td></tr></table></figure><p>è¿”å›æ•°ç»„æŒ‡é’ˆçš„å‡½æ•°å½¢å¦‚ï¼š<br><code>Type(*fun(par_list))[dim]</code></p><p><strong>ä½¿ç”¨å°¾ç½®è¿”å›ç±»å‹</strong><br>å°¾ç½®è¿”å†‹ç±»å‹è·Ÿåœ¨å½¢å‚åˆ—è¡¨åé¢å¹¶ä»¥ä¸€ä¸ªï¼ˆ-&gt;ï¼‰ç¬¦å·å¼€å¤´ã€‚åœ¨æœ¬åº”è¯¥å‡ºç°è¿”å›ç±»å‹çš„åœ°æ–¹æ”¾ç½®ä¸€ä¸ª autoã€‚<br><code>auto fun(int i) -&gt; int (*) [10];</code><br>æ³¨æ„ï¼šdecltype å¹¶ä¸è´Ÿè´£æŠŠæ•°ç»„ç±»å‹è½¬æ¢æˆå¯¹åº”çš„æŒ‡é’ˆã€‚</p><h2 id="6-4-å‡½æ•°é‡è½½"><a href="#6-4-å‡½æ•°é‡è½½" class="headerlink" title="6.4 å‡½æ•°é‡è½½"></a>6.4 å‡½æ•°é‡è½½</h2><p>ä¸€ä¸ªæ‹¥æœ‰é¡¶å±‚ const çš„å½¢å‚æ— æ³•å’Œå¦ä¸€ä¸ªæ²¡æœ‰é¡¶å±‚ const çš„å½¢å‚Råˆ†å¼€æ¥ã€‚</p><h2 id="6-5-ç‰¹æ®Šç”¨é€”è¯­è¨€ç‰¹æ€§"><a href="#6-5-ç‰¹æ®Šç”¨é€”è¯­è¨€ç‰¹æ€§" class="headerlink" title="6.5 ç‰¹æ®Šç”¨é€”è¯­è¨€ç‰¹æ€§"></a>6.5 ç‰¹æ®Šç”¨é€”è¯­è¨€ç‰¹æ€§</h2><h3 id="6-5-1-é»˜è®¤å®å‚"><a href="#6-5-1-é»˜è®¤å®å‚" class="headerlink" title="6.5.1 é»˜è®¤å®å‚"></a>6.5.1 é»˜è®¤å®å‚</h3><p>ä¸ºäº†ä½¿å¾—çª—å£å‡½æ•°æ—¢èƒ½æ¥çº³é»˜è®¤å€¼ï¼Œä¹Ÿèƒ½æ¥å—ç”¨æˆ·æŒ‡å®šçš„å€¼ï¼Œæˆ‘ä»¬æŠŠå®ƒå®šä¹‰æˆå¦‚ä¸‹çš„å½¢å¼ï¼š<br><code>void fun(int a, int b = 0, int c = 1);</code><br>ä¸€æ—¦æŸä¸ªå½¢å‚è¢«èµ‹äºˆäº†é»˜è®¤å€¼ï¼Œå®ƒåé¢çš„æ‰€æœ‰å½¢å‚éƒ½å¿…é¡»æœ‰é»˜è®¤å€¼ï¼Œé»˜è®¤å®å‚è´Ÿè´£å¡«è¡¥å‡½æ•°è°ƒç”¨ç¼ºå°‘çš„å°¾éƒ¨å®å‚ã€‚<br>ç”¨ä½œé»˜è®¤å®å‚çš„åå­—åœ¨å‡½æ•°å£°æ˜æ‰€åœ¨çš„ä½œç”¨åŸŸå†…è§£æï¼Œè€Œè¿™äº›åå­—çš„æ±‚å€¼è¿‡ç¨‹å‘ç”Ÿåœ¨å‡½æ•°è°ƒç”¨æ—¶ã€‚</p><h3 id="6-5-2-å†…è”å‡½æ•°å’Œ-constexpr-å‡½æ•°"><a href="#6-5-2-å†…è”å‡½æ•°å’Œ-constexpr-å‡½æ•°" class="headerlink" title="6.5.2 å†…è”å‡½æ•°å’Œ constexpr å‡½æ•°"></a>6.5.2 å†…è”å‡½æ•°å’Œ constexpr å‡½æ•°</h3><p><strong>å†…è”å‡½æ•°å¯é¿å…å‡½æ•°è°ƒç”¨çš„å¼€é”€</strong><br>åœ¨å‡½æ•°çš„è¿”å›ç±»å‹å‰é¢åŠ ä¸Šå…³é”®å­— inlineï¼Œå†…è”è¯´æ˜åªæ˜¯å‘ç¼–è¯‘å™¨å‘å‡ºçš„ä¸€ä¸ªè¯·æ±‚ï¼Œç¼–è¯‘å™¨å¯ä»¥é€‰æ‹©å¿½ç•¥è¿™ä¸ªè¯·æ±‚ã€‚</p><p><strong>constexpr å‡½æ•°</strong><br>å‡½æ•°çš„è¿”å›ç±»å‹åŠæ‰€æœ‰å½¢å‚çš„ç±»å‹éƒ½å¾—æ˜¯å­—é¢å€¼ç±»å‹ï¼Œè€Œä¸”å‡½æ•°ä½“ä¸­å¿…é¡»æœ‰ä¸”åªæœ‰ä¸€æ¡ return è¯­å¥ã€‚<br>ç¼–è¯‘å™¨æŠŠå¯¹ constexpr å‡½æ•°çš„è°ƒç”¨æ›¿æ¢æˆå…¶ç»“æœå€¼ã€‚ä¸ºäº†èƒ½åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­éšæ—¶å±•å¼€ï¼Œconstexpr å‡½æ•°è¢«éšå¼åœ°æŒ‡å®šä¸ºå†…è”å‡½æ•°ã€‚<br>æˆ‘ä»¬å…è®¸ constexpr å‡½æ•°çš„è¿”å›å€¼å¹¶éä¸€ä¸ªå¸¸é‡ã€‚</p><h3 id="6-5-3-è°ƒè¯•å¸®åŠ©"><a href="#6-5-3-è°ƒè¯•å¸®åŠ©" class="headerlink" title="6.5.3 è°ƒè¯•å¸®åŠ©"></a>6.5.3 è°ƒè¯•å¸®åŠ©</h3><p><code>assert(expr);</code><br>å¦‚æœè¡¨è¾¾å¼ä¸ºçœŸï¼ˆå³é0ï¼‰ï¼Œassert ä»€ä¹ˆä¹Ÿä¸åšã€‚assert å®å¸¸ç”¨äºæ£€æŸ¥â€œä¸èƒ½å‘ç”Ÿâ€çš„æ¡ä»¶ã€‚</p><p><strong>NDEBUG é¢„å¤„ç†å˜é‡</strong><br><code>#define NDEBUG</code><br>å¦‚æœå®šä¹‰äº† NDEBUG, åˆ™ assert ä»€ä¹ˆä¹Ÿä¸åšã€‚å®šä¹‰ NDEBUG èƒ½é¿å…æ£€æŸ¥å„ç§æ¡ä»¶æ‰€éœ€çš„è¿è¡Œæ—¶å¼€é”€ã€‚</p><h2 id="6-6-å‡½æ•°åŒ¹é…"><a href="#6-6-å‡½æ•°åŒ¹é…" class="headerlink" title="6.6 å‡½æ•°åŒ¹é…"></a>6.6 å‡½æ•°åŒ¹é…</h2><p><strong>ç¡®å®šå€™é€‰å‡½æ•°å’Œå¯è¡Œå‡½æ•°</strong><br>å€™é€‰å‡½æ•°ï¼šä¸€æ˜¯ä¸è¢«è°ƒç”¨çš„å‡½æ•°åŒåï¼ŒäºŒæ˜¯å…¶å£°æ˜åœ¨è°ƒç”¨ç‚¹å¯è§ã€‚<br>å¯è¡Œå‡½æ•°ï¼šä¸€æ˜¯å…¶å½¢å‚æ•°é‡ä¸æœ¬æ¬¡è°ƒç”¨æä¾›çš„å®å‚æ•°é‡ç›¸ç­‰ï¼ŒäºŒæ˜¯æ¯ä¸ªå®å‚çš„ç±»å‹ä¸å¯¹åº”çš„å½¢å‚ç±»å‹ç›¸åŒï¼Œæˆ–è€…èƒ½è½¬æ¢æˆå½¢å‚çš„ç±»å‹ã€‚</p><p><strong>å¯»æ‰¾æœ€ä½³åŒ¹é…</strong><br>å¦‚æœæœ‰ä¸”åªæœ‰ä¸€ä¸ªå‡½æ•°æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼Œåˆ™åŒ¹é…æˆåŠŸï¼š</p><ul><li>è¯¥å‡½æ•°æ¯ä¸ªå®å‚çš„åŒ¹é…éƒ½ä¸åŠ£äºå…¶ä»–å¯è¡Œå‡½æ•°éœ€è¦çš„åŒ¹é…ã€‚</li><li>è‡³å°‘æœ‰ä¸€ä¸ªå®å‚çš„åŒ¹é…ä¼˜äºå…¶ä»–å¯è¡Œå‡½æ•°æä¾›çš„åŒ¹é…ã€‚</li></ul><p>å¦‚æœåœ¨æ£€æŸ¥äº†æ‰€æœ‰å®å‚ä¹‹åæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå‡½æ•°è„±é¢–è€Œå‡ºï¼Œåˆ™è¯¥è°ƒç”¨æ˜¯é”™è¯¯çš„ã€‚ç¼–è¯‘å™¨å°†æŠ¥ å‘ŠäºŒä¹‰æ€§è°ƒç”¨çš„ä¿¡æ¯ã€‚</p><h2 id="6-7-å‡½æ•°æŒ‡é’ˆ"><a href="#6-7-å‡½æ•°æŒ‡é’ˆ" class="headerlink" title="6.7 å‡½æ•°æŒ‡é’ˆ"></a>6.7 å‡½æ•°æŒ‡é’ˆ</h2><p><strong>ä½¿ç”¨å‡½æ•°æŒ‡é’ˆ</strong><br>å½“æˆ‘ä»¬æŠŠå‡½æ•°åä½œä¸ºä¸€ä¸ªå€¼ä½¿ç”¨æ—¶ï¼Œè¯¥å‡½æ•°è‡ªåŠ¨åœ°è½¬æ¢æˆæŒ‡é’ˆï¼ˆå–åœ°å€ç¬¦å¯é€‰ï¼‰<br>æˆ‘ä»¬è¿˜èƒ½ç›´æ¥ä½¿ç”¨æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆè°ƒç”¨è¯¥å‡½æ•°ï¼Œæ— é¡»æå‰è§£å¼•ç”¨æŒ‡é’ˆï¼ˆè§£å¼•ç”¨ç¬¦å¯é€‰ï¼‰<br>åœ¨æŒ‡å‘ä¸åŒå‡½æ•°ç±»å‹çš„æŒ‡é’ˆé—´ä¸å­˜åœ¨è½¬æ¢è§„åˆ™ã€‚</p><p><strong>å‡½æ•°æŒ‡é’ˆå½¢å‚</strong><br>å½¢å‚å¯ä»¥æ˜¯æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆã€‚æ­¤æ—¶ï¼Œå½¢å‚çœ‹èµ·æ¥æ˜¯å‡½æ•°ç±»å‹ï¼Œå®é™…ä¸Šå´æ˜¯å½“æˆæŒ‡é’ˆä½¿ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fun1</span><span class="hljs-params">(<span class="hljs-type">int</span> fun2())</span></span>; <span class="hljs-comment">// å½¢å‚æ˜¯å‡½æ•°ç±»å‹ï¼Œå®ƒä¼šè‡ªåŠ¨åœ°è½¬æ¢æˆæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆã€‚</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fun1</span><span class="hljs-params">(<span class="hljs-type">int</span> (*fun2)())</span></span>; <span class="hljs-comment">// æ˜¾å¼åœ°å°†å½¢å‚å®šä¹‰æˆæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆã€‚</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥æŠŠå‡½æ•°ä½œä¸ºå®å‚ä½¿ç”¨ï¼Œæ­¤æ—¶å®ƒä¼šè‡ªåŠ¨è½¬æ¢æˆæŒ‡é’ˆã€‚<br><code>fun1(fun);</code></p><p><strong>è¿”å›æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ</strong><br>ç¼–è¯‘å™¨ä¸ä¼šè‡ªåŠ¨åœ°å°†å‡½æ•°è¿”å›ç±»å‹å½“æˆå¯¹åº”çš„æŒ‡é’ˆç±»å‹å¤„ç†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">using</span> F = <span class="hljs-built_in">int</span>();<br><span class="hljs-keyword">using</span> PF = <span class="hljs-built_in">int</span>(*)();<br><br><span class="hljs-function">PF <span class="hljs-title">f1</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// PFæ˜¯æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œflè¿”å›æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆã€‚</span><br><span class="hljs-function">F *<span class="hljs-title">fi</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// æ˜¾å¼åœ°æŒ‡å®šè¿”å›ç±»å‹æ˜¯æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆã€‚</span><br></code></pre></td></tr></table></figure><h1 id="ç¬¬ä¸ƒç« -ç±»"><a href="#ç¬¬ä¸ƒç« -ç±»" class="headerlink" title="ç¬¬ä¸ƒç«  ç±»"></a>ç¬¬ä¸ƒç«  ç±»</h1><h2 id="7-1-å®šä¹‰æŠ½è±¡æ•°æ®ç±»å‹"><a href="#7-1-å®šä¹‰æŠ½è±¡æ•°æ®ç±»å‹" class="headerlink" title="7.1 å®šä¹‰æŠ½è±¡æ•°æ®ç±»å‹"></a>7.1 å®šä¹‰æŠ½è±¡æ•°æ®ç±»å‹</h2><p><strong>å¼•å…¥ this</strong><br><code>total.isbn()</code><br>å½“ isbn() è¿”å†‹ bookNo æ—¶ï¼Œå®é™…ä¸Šå®ƒéšå¼åœ°è¿”å› total.bookNoã€‚<br>ç¼–è¯‘å™¨è´Ÿè´£æŠŠ total çš„åœ°å€ä¼ é€’ç»™ isbn() çš„éšå¼å½¢å‚ thisï¼Œä»»ä½•å¯¹ç±»æˆå‘˜çš„ç›´æ¥è®¿é—®éƒ½è¢«çœ‹ä½œthisçš„éšå¼å¼•ç”¨ã€‚<br>å› ä¸º this çš„ç›®çš„æ€»æ˜¯æŒ‡å‘â€œè¿™ä¸ªâ€å¯¹è±¡ï¼Œæ‰€ä»¥ this æ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆã€‚</p><p><strong>å¼•å…¥ const æˆå‘˜å‡½æ•°</strong><br>é»˜è®¤æƒ…å†µä¸‹ï¼Œthis çš„ç±»å‹æ˜¯æŒ‡å‘ç±»ç±»å‹éå¸¸é‡ç‰ˆæœ¬çš„å¸¸é‡æŒ‡é’ˆã€‚ç”±äºåº•å±‚ const ä¸åŒ¹é…ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨ä¸€ä¸ªå¸¸é‡å¯¹è±¡ä¸Šè°ƒç”¨æ™®é€šçš„æˆå‘˜å‡½æ•°ã€‚<br>ç´§è·Ÿåœ¨å‚æ•°åˆ—è¡¨åé¢çš„ const è¡¨ç¤º this æ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆï¼Œå¸¸é‡æˆå‘˜å‡½æ•°ä¸èƒ½æ”¹å˜è°ƒç”¨å®ƒçš„å¯¹è±¡çš„å†…å®¹ã€‚å¸¸é‡å¯¹è±¡ï¼Œä»¥åŠå¸¸é‡å¯¹è±¡çš„å¼•ç”¨æˆ–æŒ‡é’ˆéƒ½åªèƒ½è°ƒç”¨å¸¸é‡æˆå‘˜å‡½æ•°ã€‚</p><h3 id="7-1-4-æ„é€ å‡½æ•°"><a href="#7-1-4-æ„é€ å‡½æ•°" class="headerlink" title="7.1.4 æ„é€ å‡½æ•°"></a>7.1.4 æ„é€ å‡½æ•°</h3><p>æ„é€ å‡½æ•°ä¸èƒ½è¢«å£°æ˜æˆ const çš„ï¼Œç›´åˆ°æ„é€ å‡½æ•°å®Œæˆåˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¯¹è±¡æ‰èƒ½çœŸæ­£å–å¾—å…¶â€œå¸¸é‡â€å±æ€§ã€‚å› æ­¤ï¼Œæ„é€ å‡½æ•°åœ¨ const å¯¹è±¡çš„æ„é€ è¿‡ç¨‹ä¸­å¯ä»¥å‘å…¶å†™å€¼ã€‚</p><h3 id="7-2-1-å‹å…ƒ"><a href="#7-2-1-å‹å…ƒ" class="headerlink" title="7.2.1 å‹å…ƒ"></a>7.2.1 å‹å…ƒ</h3><p>å‹å…ƒå£°æ˜åªèƒ½å‡ºç°åœ¨ç±»å®šä¹‰çš„å†…éƒ¨ï¼Œå‹å…ƒä¸æ˜¯ç±»çš„æˆå‘˜ä¹Ÿä¸å—å®ƒæ‰€åœ¨åŒºåŸŸè®¿é—®æ§åˆ¶çº§åˆ«çš„çº¦æŸã€‚</p><p><strong>å‹å…ƒçš„å£°æ˜</strong><br>å‹å…ƒçš„å£°æ˜ä»…ä»…æŒ‡å®šäº†è®¿é—®çš„æƒé™ï¼Œè€Œéä¸€ä¸ªé€šå¸¸æ„ä¹‰ä¸Šçš„å‡½æ•°å£°æ˜ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›ç±»çš„ç”¨æˆ·èƒ½å¤Ÿè°ƒç”¨æŸä¸ªå‹å…ƒå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¿…é¡»åœ¨å‹å…ƒå£°æ˜ä¹‹å¤–å†ä¸“é—¨å¯¹å‡½æ•°è¿›è¡Œä¸€æ¬¡å£°æ˜ã€‚</p><h2 id="7-3-ç±»çš„å…¶ä»–ç‰¹æ€§"><a href="#7-3-ç±»çš„å…¶ä»–ç‰¹æ€§" class="headerlink" title="7.3 ç±»çš„å…¶ä»–ç‰¹æ€§"></a>7.3 ç±»çš„å…¶ä»–ç‰¹æ€§</h2><h3 id="7-3-1-ç±»æˆå‘˜å†æ¢"><a href="#7-3-1-ç±»æˆå‘˜å†æ¢" class="headerlink" title="7.3.1 ç±»æˆå‘˜å†æ¢"></a>7.3.1 ç±»æˆå‘˜å†æ¢</h3><p><strong>å®šä¹‰_ä¸ªç±»å‹æˆå‘˜</strong><br>ç±»è¿˜å¯ä»¥è‡ªå®šä¹‰æŸç§ç±»å‹åœ¨ç±»ä¸­çš„åˆ«åã€‚ç”±ç±»å®šä¹‰çš„ç±»å‹åå­—å’Œå…¶ä»–æˆå‘˜ä¸€æ ·å­˜åœ¨è®¿é—®é™åˆ¶ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassName</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> pos = std::string::size_type;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å®šä¹‰åœ¨ç±»å†…éƒ¨çš„æˆå‘˜å‡½æ•°æ˜¯è‡ªåŠ¨ inline çš„ã€‚</p><p><strong>å¯å˜æ•°æ®æˆå‘˜</strong><br>åœ¨å˜é‡çš„å£°æ˜ä¸­åŠ å…¥ mutable å…³é”®å­—ï¼Œä¸€ä¸ªå¯å˜æ•°æ®æˆå‘˜æ°¸è¿œä¸ä¼šæ˜¯ constï¼Œå³ä½¿å®ƒæ˜¯ const å¯¹è±¡çš„æˆå‘˜ã€‚å› æ­¤ï¼Œä¸€ä¸ª const æˆå‘˜å‡½æ•°å¯ä»¥æ”¹å˜ä¸€ä¸ªå¯å˜æˆå‘˜çš„å€¼ã€‚</p><h3 id="7-3-2-è¿”å›-this-çš„æˆå‘˜å‡½æ•°"><a href="#7-3-2-è¿”å›-this-çš„æˆå‘˜å‡½æ•°" class="headerlink" title="7.3.2 è¿”å› *this çš„æˆå‘˜å‡½æ•°"></a>7.3.2 è¿”å› *this çš„æˆå‘˜å‡½æ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">ClassName &amp;<span class="hljs-title">fun1</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿”å›å¼•ç”¨çš„å‡½æ•°æ˜¯å·¦å€¼çš„ï¼Œæ‰€ä»¥è¿™æ ·çš„æ“ä½œå°†åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šæ‰§è¡Œï¼š<br><code>å®ä¾‹.fun1().fun2().fun3()</code><br>å¦‚æœå®šä¹‰çš„è¿”å›ç±»å‹ä¸æ˜¯å¼•ç”¨ï¼Œåˆ™å‡½æ•°çš„è¿”å›å€¼å°†æ˜¯ *this çš„å‰¯æœ¬ï¼Œå› æ­¤è°ƒç”¨å‡½æ•°åªèƒ½æ”¹å˜ä¸´æ—¶å‰¯æœ¬ï¼Œè€Œä¸èƒ½æ”¹å˜åŸå®ä¾‹çš„å€¼ã€‚</p><p>*<em>ä» const æˆå‘˜å‡½æ•°è¿”å› <em>this</em></em><br>ä¸€ä¸ª const æˆå‘˜å‡½æ•°å¦‚æœä»¥å¼•ç”¨çš„å½¢å¼è¿”å› *thisï¼Œé‚£ä¹ˆå®ƒçš„è¿”å›ç±»é‡Œå°†æ˜¯å¸¸é‡å¼•ç”¨ï¼Œå› ä¸ºéå¸¸é‡ç‰ˆæœ¬çš„å‡½æ•°å¯¹äºå¸¸é‡å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚<br>æ ¹æ®å¯¹è±¡æ˜¯å¦æ˜¯å¸¸é‡é‡è½½å‡½æ•°ï¼Œéšå¼ä¼ å…¥çš„ this å‚æ•°åŒæ ·å‚ä¸å‡½æ•°åŒ¹é…çš„è¿‡ç¨‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassName</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">ClassName &amp;<span class="hljs-title">fun</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">const</span> ClassName &amp;<span class="hljs-title">fun</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="7-3-3-ç±»ç±»å‹"><a href="#7-3-3-ç±»ç±»å‹" class="headerlink" title="7.3.3 ç±»ç±»å‹"></a>7.3.3 ç±»ç±»å‹</h3><p>åœ¨ç±»å£°æ˜ä¹‹åå®šä¹‰ä¹‹å‰æ˜¯ä¸€ä¸ªä¸å®Œå…¨ç±»å‹ï¼Œå¯ä»¥å®šä¹‰æŒ‡å‘è¿™ç§ç±»å‹çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥å£°æ˜ï¼ˆä½†æ˜¯ä¸èƒ½å®šä¹‰ï¼‰ä»¥ä¸å®Œå…¨ç±»å‹ä½œä¸ºå‚æ•°æˆ–è€…è¿”å›ç±»å‹çš„å‡½æ•°ã€‚ä¸€æ—¦ä¸€ä¸ªç±»çš„åå­—å‡ºç°åï¼Œå®ƒå°±è¢«è®¤ä¸ºæ˜¯å£°æ˜è¿‡äº†ã€‚</p><h3 id="7-3-4-å‹å…ƒå†æ¢"><a href="#7-3-4-å‹å…ƒå†æ¢" class="headerlink" title="7.3.4 å‹å…ƒå†æ¢"></a>7.3.4 å‹å…ƒå†æ¢</h3><p>å‹å…ƒå…³ç³»ä¸å­˜åœ¨ä¼ é€’æ€§ã€‚<br>å‹å…ƒç±»çš„æˆå‘˜å‡½æ•°å’Œå‹å…ƒæˆå‘˜å‡½æ•°å¯ä»¥è®¿é—®æ­¤ç±»åŒ…æ‹¬éå…¬æœ‰æˆå‘˜åœ¨å†…çš„æ‰€æœ‰æˆå‘˜ã€‚<br>å¦‚æœä¸€ä¸ªç±»æƒ³æŠŠä¸€ç»„é‡è½½å‡½æ•°å£°æ˜æˆå®ƒçš„å‹å…ƒï¼Œå®ƒéœ€è¦å¯¹è¿™ç»„å‡½æ•°ä¸­çš„æ¯ä¸€ä¸ªåˆ†åˆ«å£°æ˜ã€‚</p><p><strong>å‹å…ƒå£°æ˜å’Œä½œç”¨åŸŸ</strong><br>å½“ä¸€ä¸ªåå­—ç¬¬ä¸€æ¬¡å‡ºç°åœ¨ä¸€ä¸ªå‹å…ƒå£°æ˜ä¸­æ—¶ï¼Œæˆ‘ä»¬éšå¼åœ°å‡å®šè¯¥åå­—åœ¨å½“å‰ä½œç”¨åŸŸä¸­æ˜¯å¯è§çš„ã€‚ç„¶è€Œï¼Œå‹å…ƒæœ¬èº«ä¸ä¸€å®šçœŸçš„å£°æ˜åœ¨å½“å‰ä½œç”¨åŸŸä¸­ã€‚ç”šè‡³å°±ç®—åœ¨ç±»çš„å†…éƒ¨å®šä¹‰è¯¥å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»åœ¨ç±»çš„å¤–éƒ¨æä¾›ç›¸åº”çš„å£°æ˜ä»è€Œä½¿å¾—å‡½æ•°å¯è§ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassName</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">friend</span> <span class="hljs-type">void</span> <span class="hljs-title">fun</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>    <span class="hljs-built_in">ClassName</span>() &#123;<br>        <span class="hljs-built_in">fun</span>(); <span class="hljs-comment">// é”™è¯¯</span><br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">a</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">b</span><span class="hljs-params">()</span></span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ClassName::a</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">fun</span>(); <span class="hljs-comment">// é”™è¯¯</span><br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fun</span><span class="hljs-params">()</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ClassName::b</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">fun</span>(); <span class="hljs-comment">// æ­£ç¡®</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="7-4-ç±»çš„ä½œç”¨åŸŸ"><a href="#7-4-ç±»çš„ä½œç”¨åŸŸ" class="headerlink" title="7.4 ç±»çš„ä½œç”¨åŸŸ"></a>7.4 ç±»çš„ä½œç”¨åŸŸ</h2><p>åœ¨ç±»çš„å¤–éƒ¨å®šä¹‰å…¶æˆå‘˜å‡½æ•°æ—¶ï¼Œå› ä¸ºè¿”å›ç±»å‹å‡ºç°åœ¨ç±»åä¹‹å‰ï¼Œæ‰€ä»¥äº‹å®ä¸Šè¿”å›ç±»å‹æ˜¯ä½äºç±»çš„ä½œç”¨åŸŸä¹‹å¤–çš„ã€‚</p><p><strong>ç±»ä½œç”¨åŸŸä¹‹åï¼Œåœ¨å¤–å›´çš„ä½œç”¨åŸŸä¸­æŸ¥æ‰¾</strong><br>å¦‚æœæˆ‘ä»¬éœ€è¦çš„æ˜¯å¤–å±‚ä½œç”¨åŸŸä¸­çš„åå­—ï¼Œå¯ä»¥æ˜¾å¼åœ°é€šè¿‡ä½œç”¨åŸŸè¿ç®—ç¬¦ï¼ˆ::ï¼‰æ¥è¿›è¡Œè¯·æ±‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fun</span><span class="hljs-params">(<span class="hljs-type">int</span> tmp)</span> </span>&#123;<br>    <span class="hljs-type">int</span> a = <span class="hljs-number">2</span> * ::tmp; <span class="hljs-comment">// æ­¤æ—¶çš„inæ˜¯æœ€å¤–å±‚çš„å…¨å±€å˜é‡</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="7-5-æ„é€ å‡½æ•°å†æ¢"><a href="#7-5-æ„é€ å‡½æ•°å†æ¢" class="headerlink" title="7.5 æ„é€ å‡½æ•°å†æ¢"></a>7.5 æ„é€ å‡½æ•°å†æ¢</h2><h3 id="7-5-1-æ„é€ å‡½æ•°åˆå§¶å€¼åˆ—è¡¨"><a href="#7-5-1-æ„é€ å‡½æ•°åˆå§¶å€¼åˆ—è¡¨" class="headerlink" title="7.5.1 æ„é€ å‡½æ•°åˆå§¶å€¼åˆ—è¡¨"></a>7.5.1 æ„é€ å‡½æ•°åˆå§¶å€¼åˆ—è¡¨</h3><p>å¦‚æœæ²¡æœ‰åœ¨æ„é€ å‡½æ•°çš„åˆå§‹å€¼åˆ—è¡¨ä¸­æ˜¾å¼åœ°åˆå§‹åŒ–æˆå‘˜ï¼Œåˆ™è¯¥æˆå‘˜å°†åœ¨æ„é€ å‡½æ•°ä½“ä¹‹å‰æ‰§è¡Œé»˜è®¤åˆå§‹åŒ–ã€‚<br>å¦‚æœæˆå‘˜æ˜¯ constã€å¼•ç”¨ï¼Œæˆ–è€…å±äºæŸç§æœªæä¾›é»˜è®¤æ„é€ å‡½æ•°çš„ç±»ç±»å‹ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨ä¸ºè¿™äº›æˆå‘˜æä¾›åˆå€¼ã€‚<br>æˆå‘˜çš„åˆå§‹åŒ–é¡ºåºä¸å®ƒä»¬åœ¨ç±»å®šä¹‰ä¸­çš„å‡ºç°é¡ºåºä¸€è‡´ï¼Œæ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨ä¸­åˆå§‹å€¼çš„å‰åä½ç½®å…³ç³»ä¸ä¼šå½±å“å®é™…çš„åˆå§‹åŒ–é¡ºåºã€‚<br>å¦‚æœä¸€ä¸ªæ„é€ å‡½æ•°ä¸ºæ‰€æœ‰å‚æ•°éƒ½æä¾›äº†é»˜è®¤å®å‚ï¼Œåˆ™å®ƒå®é™…ä¸Šä¹Ÿå®šä¹‰äº†é»˜è®¤æ„é€ å‡½æ•°ã€‚</p><h3 id="7-5-4-éšå¼çš„ç±»ç±»å‹è½¬æ¢"><a href="#7-5-4-éšå¼çš„ç±»ç±»å‹è½¬æ¢" class="headerlink" title="7.5.4 éšå¼çš„ç±»ç±»å‹è½¬æ¢"></a>7.5.4 éšå¼çš„ç±»ç±»å‹è½¬æ¢</h3><p>å¦‚æœæ„é€ å‡½æ•°åªæ¥å—ä¸€ä¸ªå®å‚ï¼Œåˆ™å®ƒå®é™…ä¸Šå®šä¹‰äº†è½¬æ¢ä¸ºæ­¤ç±»ç±»å‹çš„éšå¼è½¬æ¢æœºåˆ¶ï¼ˆè½¬æ¢æ„é€ å‡½æ•°ï¼‰ã€‚åœ¨éœ€è¦ä½¿ç”¨ç±»ç±»å‹çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è½¬æ¢æ„é€ å‡½æ•°çš„å‚æ•°çš„ç±»å‹ä½œä¸ºæ›¿ä»£ã€‚<br>åªå…è®¸ä¸€æ­¥ç±»ç±»å‹è½¬æ¢ï¼Œéšå¼åœ°ä½¿ç”¨ä¸¤ç§è½¬æ¢è§„åˆ™æ˜¯é”™è¯¯çš„ã€‚æ¯”å¦‚åªå®šä¹‰äº† string çš„è½¬æ¢æ„é€ å‡½æ•°å´æä¾›äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡å®å‚ã€‚</p><p><strong>æŠ‘åˆ¶æ„é€ å‡½æ•°å®šä¹‰çš„éšå¼è½¬æ¢</strong><br>å°†æ„é€ å‡½æ•°å£°æ˜ä¸º explicit åŠ ä»¥æŠ‘åˆ¶éšå¼è½¬æ¢ã€‚<br>å…³é”®å­— explicit åªå¯¹ä¸€ä¸ªå®å‚çš„æ„é€ å‡½æ•°æœ‰æ•ˆã€‚éœ€è¦å¤šä¸ªå®å‚çš„æ„é€ å‡½æ•°ä¸èƒ½ç”¨äºæ‰§è¡Œéšå¼è½¬æ¢ã€‚åªèƒ½åœ¨ç±»å†…å£°æ˜æ„é€ å‡½æ•°æ—¶ä½¿ç”¨ explicit å…³é”®å­—ï¼Œåœ¨ç±»å¤–éƒ¨å®šä¹‰æ—¶ä¸åº”é‡å¤ã€‚<br>æ˜¾ç¤ºåœ°è¿›è¡Œå¼ºåˆ¶è½¬æ¢ä¾æ—§å¯ä»¥æ­£å¸¸åœ°å‘æŒ¥è½¬æ¢æ„é€ å‡½æ•°çš„æ•ˆæœã€‚</p><h3 id="7-5-5-èšåˆç±»"><a href="#7-5-5-èšåˆç±»" class="headerlink" title="7.5.5 èšåˆç±»"></a>7.5.5 èšåˆç±»</h3><p>å½“ä¸€ä¸ªç±»æ»¡è¶³å¦‚ä¸‹æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬è¯´å®ƒæ˜¯èšåˆçš„ï¼š</p><ul><li>æ‰€æœ‰æˆå‘˜éƒ½æ˜¯ public çš„ã€‚</li><li>æ²¡æœ‰å®šä¹‰ä»»ä½•æ„é€ å‡½æ•°ã€‚</li><li>æ²¡æœ‰ç±»å†…åˆå§‹å€¼ã€‚</li><li>æ²¡æœ‰åŸºç±»ï¼Œä¹Ÿæ²¡æœ‰ virtual å‡½æ•°ã€‚<br>å¯ä»¥æä¾›ä¸€ä¸ªèŠ±æ‹¬å·æ‹¬èµ·æ¥çš„æˆå‘˜åˆå§‹å€¼åˆ—è¡¨ï¼Œå¹¶ç”¨å®ƒåˆå§‹åŒ–èšåˆç±»çš„æ•°æ®æˆå‘˜ï¼Œåˆå§‹å€¼çš„é¡ºåºå¿…é¡»ä¸å£°æ˜çš„é¡ºåºä¸€è‡´ã€‚</li></ul><h3 id="7-5-6-å­—é¢å€¼å¸¸é‡ç±»"><a href="#7-5-6-å­—é¢å€¼å¸¸é‡ç±»" class="headerlink" title="7.5.6 å­—é¢å€¼å¸¸é‡ç±»"></a>7.5.6 å­—é¢å€¼å¸¸é‡ç±»</h3><p>æ•°æ®æˆå‘˜éƒ½æ˜¯å­—é¢å€¼ç±»å‹çš„èšåˆç±»æ˜¯å­—é¢å€¼å¸¸é‡ç±»ã€‚å¦‚æœä¸€ä¸ªç±»ä¸æ˜¯èšåˆç±»ï¼Œä½†å®ƒç¬¦åˆä¸‹è¿°è¦æ±‚ï¼Œåˆ™å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå­—é¢å€¼å¸¸é‡ç±»ï¼š</p><ul><li>æ•°æ®æˆå‘˜éƒ½å¿…é¡»æ˜¯å­—é¢å€¼ç±»å‹ã€‚</li><li>ç±»å¿…é¡»è‡³å°‘å«æœ‰ä¸€ä¸ª constexpr æ„é€ å‡½æ•°ã€‚</li><li>å¦‚æœä¸€ä¸ªæ•°æ®æˆå‘˜å«æœ‰ç±»å†…åˆå§‹å€¼ï¼Œåˆ™å†…ç½®ç±»å‹æˆå‘˜çš„åˆå§‹å€¼å¿…é¡»æ˜¯ä¸€æ¡å¸¸é‡è¡¨è¾¾å¼ï¼›æˆ–è€…å¦‚æœæˆå‘˜å±äºæŸç§ç±»ç±»å‹ï¼Œåˆ™åˆå§‹å€¼å¿…é¡»ä½¿ç”¨æˆå‘˜è‡ªå·±çš„ constexpr æ„é€ å‡½æ•°ã€‚</li><li>ç±»å¿…é¡»ä½¿ç”¨ææ„å‡½æ•°çš„é»˜è®¤å®šä¹‰ï¼Œè¯¥æˆå‘˜è´Ÿè´£é”€æ¯ç±»çš„å¯¹è±¡ã€‚</li></ul><p><strong>constexpr æ„é€ å‡½æ•°</strong><br>å°½ç®¡æ„é€ å‡½æ•°ä¸èƒ½æ˜¯ const çš„ï¼Œä½†æ˜¯å­—é¢å€¼å¸¸é‡ç±»çš„æ„é€ å‡½æ•°å¯ä»¥æ˜¯ constexpr å‡½æ•°ï¼Œconstexpr æ„é€ å‡½æ•°ä½“ä¸€èˆ¬æ¥è¯´åº”è¯¥æ˜¯ç©ºçš„ï¼Œæˆ–è€…å£°æ˜æˆ<code>= default</code>.<br>constexpr æ„é€ å‡½æ•°å¿…é¡»åˆå§‹åŒ–æ‰€æœ‰æ•°æ®æˆå‘˜.</p><h2 id="7-6-ç±»çš„é™æ€æˆå‘˜"><a href="#7-6-ç±»çš„é™æ€æˆå‘˜" class="headerlink" title="7.6 ç±»çš„é™æ€æˆå‘˜"></a>7.6 ç±»çš„é™æ€æˆå‘˜</h2><p>å¯¹è±¡ä¸­ä¸åŒ…å«ä»»ä½•ä¸é™æ€æ•°æ®æˆå‘˜æœ‰å…³çš„æ•°æ®ï¼Œé™æ€æˆå‘˜å‡½æ•°ä¸èƒ½å£°æ˜æˆ const çš„ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿä¸èƒ½åœ¨ static å‡½æ•°ä½“å†…ä½¿ç”¨ this æŒ‡é’ˆã€‚<br>ä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦ç›´æ¥è®¿é—®é™æ€æˆå‘˜ï¼Œä½¿ç”¨ç±»çš„å¯¹è±¡ã€å¼•ç”¨æˆ–è€…æŒ‡é’ˆçš„ç‚¹è¿ç®—ç¬¦æ¥è®¿é—®é™æ€æˆå‘˜ã€‚</p><p><strong>å®šä¹‰é™æ€æˆå‘˜</strong><br>å½“åœ¨ç±»çš„å¤–éƒ¨å®šä¹‰é™æ€æˆå‘˜æ—¶ï¼Œä¸èƒ½é‡å¤ static å…³é”®å­—ï¼Œè¯¥å…³é”®å­—åªå‡ºç°åœ¨ç±»å†…éƒ¨çš„å£°æ˜è¯­å¥ã€‚<br>æˆ‘ä»¬ä¸èƒ½åœ¨ç±»çš„å†…éƒ¨åˆå§‹åŒ–é™æ€æˆå‘˜ã€‚ç›¸åçš„ï¼Œå¿…é¡»åœ¨ç±»çš„å¤–éƒ¨å®šä¹‰å’Œåˆå§‹åŒ–æ¯ä¸ªé™æ€æˆå‘˜ã€‚</p><p><strong>é™æ€æˆå‘˜çš„ç±»å†…åˆå§‹åŒ–</strong><br>æˆ‘ä»¬å¯ä»¥ä¸ºé™æ€æˆå‘˜æä¾› const æ•´æ•°ç±»å‹çš„ç±»å†…åˆå§‹å€¼ï¼Œä¸è¿‡è¦æ±‚é™æ€æˆå‘˜å¿…é¡»æ˜¯å­—é¢å€¼å¸¸é‡ç±»å‹çš„ constexprã€‚å³ä½¿ä¸€ä¸ªå¸¸é‡é™æ€æ•°æ®æˆå‘˜åœ¨ç±»å†…éƒ¨è¢«åˆå§‹åŒ–äº†ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¹Ÿåº”è¯¥åœ¨ç±»çš„å¤–<br>éƒ¨å®šä¹‰ä¸€ä¸‹è¯¥æˆå‘˜ã€‚<br>é™æ€æ•°æ®æˆå‘˜å¯ä»¥æ˜¯ä¸å®Œå…¨ç±»å‹ã€‚</p><h1 id="ç¬¬å…«ç« -IO-åº“"><a href="#ç¬¬å…«ç« -IO-åº“" class="headerlink" title="ç¬¬å…«ç«  IO åº“"></a>ç¬¬å…«ç«  IO åº“</h1><h2 id="8-1-IO-ç±»"><a href="#8-1-IO-ç±»" class="headerlink" title="8.1 IO ç±»"></a>8.1 IO ç±»</h2><h3 id="8-1-1-IO-å¯¹è±¡æ— æ‹·è´æˆ–èµ‹å€¼"><a href="#8-1-1-IO-å¯¹è±¡æ— æ‹·è´æˆ–èµ‹å€¼" class="headerlink" title="8.1.1 IO å¯¹è±¡æ— æ‹·è´æˆ–èµ‹å€¼"></a>8.1.1 IO å¯¹è±¡æ— æ‹·è´æˆ–èµ‹å€¼</h3><p>è¿› IO æ“ä½œçš„å‡½æ•°é€šå¸¸ä»¥å¼•ç”¨æ–¹å¼ä¼ é€’å’Œè¿”å›æµã€‚è¯»å†™ä¸€ä¸ª IO å¯¹è±¡ä¼šæ”¹å˜å…¶çŠ¶æ€ï¼Œå› æ­¤ä¼ é€’å’Œè¿”å›çš„å¼•ç”¨ä¸èƒ½æ˜¯ const çš„ã€‚</p><h3 id="8-1-2-æ¡ä»¶çŠ¶æ€"><a href="#8-1-2-æ¡ä»¶çŠ¶æ€" class="headerlink" title="8.1.2 æ¡ä»¶çŠ¶æ€"></a>8.1.2 æ¡ä»¶çŠ¶æ€</h3><p>å¦‚æœæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªéæœŸæœ›çš„æ•°æ®ç±»å‹æˆ–ä¸€ä¸ªæ–‡ä»¶ç»“æŸæ ‡è¯†ï¼Œcin ä¼šè¿›å…¥é”™è¯¯çŠ¶æ€ã€‚<br>ä¸€ä¸ªæµä¸€æ—¦å‘ç”Ÿé”™è¯¯ï¼Œå…¶ä¸Šåç»­ IO æ“ä½œéƒ½ä¼šå¤±è´¥ã€‚åªæœ‰å½“ä¸€ä¸ªæµå¤„äºæ— é”™çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬æ‰å¯ä»¥ä»å®ƒè¯»å–æ•°æ®ï¼Œå‘å®ƒå†™å…¥æ•°æ®ã€‚</p><h3 id="8-1-3-ç®¡ç†è¾“å‡ºç¼“å†²"><a href="#8-1-3-ç®¡ç†è¾“å‡ºç¼“å†²" class="headerlink" title="8.1.3 ç®¡ç†è¾“å‡ºç¼“å†²"></a>8.1.3 ç®¡ç†è¾“å‡ºç¼“å†²</h3><p>è¯» cin æˆ–å†™ cerr éƒ½ä¼šå¯¼è‡´ cout çš„ç¼“å†²åŒºè¢«åˆ·æ–°ã€‚</p><p><strong>unitbf</strong><br>unitbuf æ“çºµç¬¦å‘Šè¯‰æµåœ¨æ¥ä¸‹æ¥çš„æ¯æ¬¡å†™æ“ä½œä¹‹åéƒ½è¿›è¡Œä¸€æ¬¡ flush æ“ä½œã€‚è€Œ nounitbuf æ“çºµç¬¦åˆ™é‡ç½®æµï¼Œä½¿å…¶æ¢å¤ä½¿ç”¨æ­£å¸¸çš„ç³»ç»Ÿç®¡ç†çš„ç¼“å†²åŒºåˆ·æ–°æœºåˆ¶ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">cout &lt;&lt; unitbuf;<br>cout &lt;&lt; nounitbuf;<br></code></pre></td></tr></table></figure><p><strong>å…³è”è¾“å…¥å’Œè¾“å‡ºæµ</strong><br>å½“ä¸€ä¸ªè¾“å…¥æµè¢«å…³è”åˆ°ä¸€ä¸ªè¾“å‡ºæµæ—¶ï¼Œä»»ä½•è¯•å›¾ä»è¾“å…¥æµè¯»å–æ•°æ®çš„æ“ä½œéƒ½ä¼šå…ˆåˆ·æ–°å…³è”çš„è¾“å‡ºæµã€‚<br>æ ‡å‡†åº“å°† cout å’Œ cin å…³è”åœ¨ä¸€èµ·ï¼Œ<br>tie æœ‰ä¸¤ä¸ªé‡è½½çš„ç‰ˆæœ¬ï¼šä¸€ä¸ªç‰ˆæœ¬ä¸å¸¦å‚æ•°ï¼Œè¿”å›æŒ‡å‘è¾“å‡ºæµçš„æŒ‡é’ˆã€‚å¦‚æœæœ¬å¯¹è±¡å½“å‰å…³è”åˆ°ä¸€ä¸ªè¾“å‡ºæµï¼Œåˆ™è¿”å›çš„å°±æ˜¯æŒ‡å‘è¿™ä¸ªæµçš„æŒ‡é’ˆï¼Œå¦‚æœå¯¹è±¡æœªå…³è”åˆ°æµï¼Œåˆ™è¿”å›ç©ºæŒ‡é’ˆã€‚tie çš„ç¬¬äºŒä¸ªç‰ˆæœ¬æ¥å—ä¸€ä¸ªæŒ‡å‘ ostream çš„æŒ‡é’ˆï¼Œå°†è‡ªå·±å…³è”åˆ°æ­¤ ostreamã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">in.<span class="hljs-built_in">tie</span>(&amp;out);<br><span class="hljs-comment">// old_tie æŒ‡å‘å½“å‰å…³è”åˆ° in çš„æµï¼Œin ä¸å†ä¸å…¶ä»–æµå…³è”ã€‚</span><br>ostream *old_out = in.<span class="hljs-built_in">tie</span>(<span class="hljs-literal">nullptr</span>);<br>in.<span class="hljs-built_in">tie</span>(&amp;new_out);<br>in.<span class="hljs-built_in">tie</span>(old_out);<br></code></pre></td></tr></table></figure><h2 id="8-2-æ–‡ä»¶è¾“å…¥è¾“å‡º"><a href="#8-2-æ–‡ä»¶è¾“å…¥è¾“å‡º" class="headerlink" title="8.2 æ–‡ä»¶è¾“å…¥è¾“å‡º"></a>8.2 æ–‡ä»¶è¾“å…¥è¾“å‡º</h2><p>ifstream ä»ä¸€ä¸ªç»™å®šæ–‡ä»¶è¯»å–æ•°æ®ï¼Œofstream å‘ä¸€ä¸ªç»™å®šæ–‡ä»¶å†™å…¥æ•°æ®ï¼Œä»¥åŠ fstream å¯ä»¥è¯»å†™ç»™å®šæ–‡ä»¶ã€‚</p><h3 id="8-2-1-ä½¿ç”¨æ–‡ä»¶æµå¯¹è±¡"><a href="#8-2-1-ä½¿ç”¨æ–‡ä»¶æµå¯¹è±¡" class="headerlink" title="8.2.1 ä½¿ç”¨æ–‡ä»¶æµå¯¹è±¡"></a>8.2.1 ä½¿ç”¨æ–‡ä»¶æµå¯¹è±¡</h3><p>åˆ›å»ºæ–‡ä»¶æµå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›æ–‡ä»¶åã€‚å¦‚æœæä¾›äº†ä¸€ä¸ªæ–‡ä»¶åï¼Œåˆ™ open ä¼šè‡ªåŠ¨è¢«è°ƒç”¨ã€‚ä¸ºäº†å°†æ–‡ä»¶æµå…³è”åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶ï¼Œå¿…é¡»é¦–å…ˆå…³é—­å·²ç»å…³è”çš„æ–‡ä»¶ã€‚å½“ä¸€ä¸ª fstream å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œclose ä¼šè‡ªåŠ¨è¢«è°ƒç”¨ã€‚</p><h3 id="8-2-2-æ–‡ä»¶æ¨¡å¼"><a href="#8-2-2-æ–‡ä»¶æ¨¡å¼" class="headerlink" title="8.2.2 æ–‡ä»¶æ¨¡å¼"></a>8.2.2 æ–‡ä»¶æ¨¡å¼</h3><p>inï¼šä»¥è¯»æ–¹å¼æ‰“å¼€ï¼›outï¼šä»¥å†™æ–¹å¼æ‰“å¼€ï¼›appï¼šæ¯æ¬¡å†™æ“ä½œå‰å‡å®šä½åˆ°æ–‡ä»¶æœ«å°¾ï¼›ateï¼šæ‰“å¼€æ–‡ä»¶åç«‹å³å®šä½åˆ°æ–‡ä»¶æœ«å°¾ï¼›truncï¼šæˆªæ–­æ–‡ä»¶ï¼›binaryï¼šä»¥äºŒè¿›åˆ¶æ–¹å¼è¿› IOï¼›<br>åœ¨ app æ¨¡å¼ä¸‹ï¼Œå³ä½¿æ²¡æœ‰æ˜¾å¼æŒ‡å®š out æ¨¡å¼ï¼Œæ–‡ä»¶ä¹Ÿæ€»æ˜¯ä»¥è¾“å‡ºæ–¹å¼è¢«æ‰“å¼€ã€‚<br>å³ä½¿æˆ‘ä»¬æ²¡æœ‰æŒ‡å®š trun ï¼Œä»¥ out æ¨¡å¼æ‰“å¹µçš„æ–‡ä»¶ä¹Ÿä¼šè¢«æˆªæ–­ã€‚<br>ä¸ ifstream å…³è”çš„æ–‡ä»¶é»˜è®¤ä»¥ in æ¨¡å¼æ‰“å¹µï¼›ä¸ ofstream å…³è”çš„æ–‡ä»¶é»˜è®¤ä»¥ out æ¨¡å¼æ‰“å¼€ï¼›ä¸ fstream å…³è”çš„æ–‡ä»¶é»˜è®¤ä»¥ in å’Œ out æ¨¡å¼æ‰“å¹µã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ª ofstream æ—¶ï¼Œæ–‡ä»¶çš„å†…å®¹ä¼šè¢«ä¸¢å¼ƒã€‚æ¯å½“æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œéƒ½å¯ä»¥æ”¹å˜å…¶æ–‡ä»¶æ¨¡å¼ã€‚</p><h2 id="8-3-string-æµ"><a href="#8-3-string-æµ" class="headerlink" title="8.3 string æµ"></a>8.3 string æµ</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">sstream <span class="hljs-title">strm</span><span class="hljs-params">(s)</span></span>; <span class="hljs-comment">// strm ä¿å­˜ string s çš„ä¸€ä¸ªæ‹·è´ã€‚</span><br>strm.<span class="hljs-built_in">str</span>(); <span class="hljs-comment">// è¿”å› strm ä¿å­˜çš„ string æ‹·è´ã€‚</span><br>strm.<span class="hljs-built_in">str</span>(s); <span class="hljs-comment">// å°† string s æ‹·è´åˆ° strm ä¸­ï¼Œè¿”å› voidã€‚</span><br></code></pre></td></tr></table></figure><h1 id="ç¬¬ä¹ç« -é¡ºåºå®¹å™¨"><a href="#ç¬¬ä¹ç« -é¡ºåºå®¹å™¨" class="headerlink" title="ç¬¬ä¹ç«  é¡ºåºå®¹å™¨"></a>ç¬¬ä¹ç«  é¡ºåºå®¹å™¨</h1><h2 id="9-1-é¡ºåºå®¹å™¨æ¦‚è¿°"><a href="#9-1-é¡ºåºå®¹å™¨æ¦‚è¿°" class="headerlink" title="9.1 é¡ºåºå®¹å™¨æ¦‚è¿°"></a>9.1 é¡ºåºå®¹å™¨æ¦‚è¿°</h2><p><strong>vector</strong>ï¼šå¯å˜å¤§å°æ•°ç»„ã€‚æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚åœ¨å°¾éƒ¨ä¹‹å¤–çš„ä½ç½®æ’å…¥æˆ–åˆ é™¤å…ƒç´ å¯èƒ½å¾ˆæ…¢ã€‚<br><strong>deque</strong>ï¼šåŒç«¯é˜Ÿåˆ—ã€‚æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚åœ¨å¤´å°¾ä½ç½®æ’å…¥&#x2F;åˆ é™¤é€Ÿåº¦å¾ˆå¿«ã€‚<br><strong>list</strong>ï¼šåŒå‘é“¾è¡¨ã€‚åªæ”¯æŒåŒå‘é¡ºåºè®¿é—®ã€‚åœ¨listä¸­ä»»ä½•ä½ç½®è¿›è¡Œæ’å…¥&#x2F;åˆ é™¤ æ“ä½œé€Ÿåº¦éƒ½å¾ˆå¿«ã€‚<br><strong>forward_list</strong>ï¼šå•å‘é“¾è¡¨ã€‚åªæ”¯æŒå•å‘é¡ºåºè®¿é—®ã€‚åœ¨é“¾è¡¨ä»»ä½•ä½ç½®è¿›è¡Œæ’å…¥&#x2F;åˆ é™¤æ“ä½œé€Ÿåº¦éƒ½å¾ˆå¿«ã€‚<br><strong>array</strong>ï¼šå›ºå®šå¤§å°æ•°ç»„ã€‚æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚ä¸èƒ½æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚<br><strong>string</strong>ï¼šä¸vectorç›¸ä¼¼çš„å®¹å™¨ï¼Œä½†ä¸“é—¨ç”¨äºä¿å­˜å­—ç¬¦ã€‚éšæœºè®¿é—®å¿«ã€‚åœ¨å°¾éƒ¨æ’å…¥&#x2F;åˆ é™¤é€Ÿåº¦å¿«ã€‚</p><p><strong>ç¡®å®šä½¿ç”¨å“ªç§é¡ºåºå®¹å™¨</strong></p><ul><li>é™¤éä½ æœ‰å¾ˆå¥½çš„ç†ç”±é€‰æ‹©å…¶ä»–å®¹å™¨ï¼Œå¦åˆ™åº”ä½¿ç”¨ vectorã€‚</li><li>å¦‚æœä½ çš„ç¨‹åºæœ‰å¾ˆå¤šå°çš„å…ƒç´ ï¼Œä¸”ç©ºé—´çš„é¢å¤–å¼€é”€å¾ˆé‡è¦ï¼Œåˆ™ä¸è€ä½¿ç”¨ list æˆ– forward_listã€‚</li><li>å¦‚æœç¨‹åºè¦æ±‚éšæœºè®¿é—®å…€ç´ ï¼Œåº”ä½¿ç”¨ vector æˆ– dequeã€‚</li><li>å¦‚æœç¨‹åºè¦æ±‚åœ¨å®¹å™¨çš„ä¸­é—´æ’å…¥æˆ–åˆ é™¤å…ƒç´ ï¼Œåº”ä½¿ç”¨ list æˆ– forward_listã€‚</li><li>å¦‚æœç¨‹åºéœ€è¦åœ¨å¤´å°¾ä½ç½®æ’å…¥æˆ–åˆªé™¤å…ƒç´ ï¼Œä½†ä¸ä¼šåœ¨ä¸­é—´ä½ç½®è¿›è¡Œæ’å…¥æˆ–åˆ é™¤æ“ä½œï¼Œåˆ™ä½¿ç”¨ dequeã€‚</li></ul><h3 id="9-2-4-å®¹å™¨å®šä¹‰å’Œåˆå§‹åŒ–"><a href="#9-2-4-å®¹å™¨å®šä¹‰å’Œåˆå§‹åŒ–" class="headerlink" title="9.2.4 å®¹å™¨å®šä¹‰å’Œåˆå§‹åŒ–"></a>9.2.4 å®¹å™¨å®šä¹‰å’Œåˆå§‹åŒ–</h3><p><strong>æ ‡å‡†åº“ array å…·æœ‰å›ºå®šå¤§å°</strong><br>å½“å®šä¹‰ä¸€ä¸ª array æ—¶ï¼Œé™¤äº†æŒ‡å®šå…ƒç´ ç±»å‹ï¼Œè¿˜è¦æŒ‡å®šå®¹å™¨å¤§å°ã€‚<br>ä¸€ä¸ªé»˜è®¤æ„é€ çš„ array æ˜¯éç©ºçš„ï¼Œå®ƒåŒ…å«äº†ä¸å…¶å¤§å°ä¸€æ ·å¤šçš„å…ƒç´ ã€‚è¿™äº›å…ƒç´ éƒ½è¢«é»˜è®¤åˆå§‹åŒ–ã€‚<br>å¦‚æœåˆå§‹å€¼åˆ—è¡¨ä¸­çš„åˆå§‹å€¼æ•°ç›®å°äº array çš„å¤§å°ï¼Œåˆ™å®ƒä»¬è¢«ç”¨æ¥åˆå§‹åŒ– array ä¸­é å‰çš„å…ƒç´ ï¼Œæ‰€æœ‰å‰©ä½™å…ƒç´ éƒ½ä¼šè¿›è¡Œå€¼åˆå§‹åŒ–ã€‚<br>æ­¤å¤–ï¼Œarray è¿˜è¦æ±‚åˆå§‹å€¼å…ƒç´ ç±»å‹å’Œå¤§å°ä¹Ÿéƒ½ä¸€æ ·ï¼Œå› ä¸ºå¤§å°æ˜¯ array ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚</p><h3 id="9-2-5-èµ‹å€¼å’Œ-swap"><a href="#9-2-5-èµ‹å€¼å’Œ-swap" class="headerlink" title="9.2.5 èµ‹å€¼å’Œ swap"></a>9.2.5 èµ‹å€¼å’Œ swap</h3><p>array ç±»å‹ä¸æ”¯æŒ assign, ä¹Ÿä¸å…è®¸ç”¨èŠ±æ‹¬å·åŒ…å›´çš„å€¼åˆ—è¡¨è¿›è¡Œèµ‹å€¼ã€‚<br>è³¦å€¼ç›¸å…³è¿ç®—ä¼šå¯¼è‡´æŒ‡å‘å·¦è¾¹å®¹å™¨å†…éƒ¨çš„è¿­ä»£å™¨ã€å¼•ç”¨å’ŒæŒ‡é’ˆå¤±æ•ˆè€Œ swap æ“ä½œå°†å®¹å™¨å†…å®¹äº¤æ¢ä¸ä¼šå¯¼è‡´æŒ‡å‘å®¹å™¨çš„è¿­ä»£å™¨ã€å¼•ç”¨å’ŒæŒ‡é’ˆå¤±æ•ˆã€‚</p><p><strong>ä½¿ç”¨ assign (ä»…é¡ºåºå®¹å™¨ï¼‰</strong><br>assign å…è®¸æˆ‘ä»¬ä»ä¸€ä¸ªä¸åŒä½†ç›¸å®¹çš„ç±»å‹èµ‹å€¼ï¼Œæˆ–è€…ä»å®¹å™¨çš„ä¸€ä¸ªå­åºåˆ—èµ‹å€¼ã€‚ç”¨å‚æ•°æ‰€æŒ‡å®šçš„å…ƒç´ ï¼ˆçš„æ‹·è´ï¼‰æ›¿æ¢å·¦è¾¹å®¹å™¨ä¸­Ğ™æ‰€æœ‰å…ƒç´ ã€‚<br>ä¼ é€’ç»™ assign çš„è¿­ä»£å™¨ä¸èƒ½æŒ‡å‘è°ƒç”¨ assign çš„å®¹å™¨ã€‚</p><p><strong>ä½¿ç”¨ swap</strong><br>swap ä¸å¯¹ä»»ä½•å…ƒç´ è¿›è¡Œæ‹·è´ã€åˆ é™¤æˆ–æ’å…¥æ“ä½œï¼Œå› æ­¤å¯ä»¥ä¿è¯åœ¨å¸¸æ•°æ—¶é—´å†…å®Œæˆã€‚<br>å…ƒç´ ä¸ä¼šè¢«ç§»åŠ¨æ„å‘³ç€ï¼Œé™¤ string å¤–ï¼ŒæŒ‡å‘å®¹å™¨çš„è¿­ä»£å™¨ã€å¼•ç”¨å’ŒæŒ‡é’ˆåœ¨ swap æ“ä½œä¹‹åéƒ½ä¸ä¼šå¤±æ•ˆã€‚å®ƒä»¬ä»æŒ‡å‘ swap æ“ä½œä¹‹å‰æ‰€æŒ‡å‘çš„é‚£äº›å…ƒç´ ã€‚ä½†æ˜¯ï¼Œåœ¨ swap ä¹‹åï¼Œè¿™äº›å…ƒç´ å·²ç»å±äºä¸åŒçš„å®¹å™¨äº†ã€‚<br>ä¸å…¶ä»–å®¹å™¨ä¸åŒï¼Œswap ä¸¤ä¸ª array ä¼šçœŸæ­£äº¤æ¢å®ƒä»¬çš„å…ƒç´ ã€‚å› æ­¤ï¼Œäº¤æ¢ä¸¤ä¸ª array æ‰€éœ€çš„æ—¶é—´ä¸ array ä¸­å…ƒç´ çš„æ•°ç›®æˆæ­£æ¯”ã€‚</p><h3 id="9-2-7-å…³ç³»è¿ç®—ç¬¦"><a href="#9-2-7-å…³ç³»è¿ç®—ç¬¦" class="headerlink" title="9.2.7 å…³ç³»è¿ç®—ç¬¦"></a>9.2.7 å…³ç³»è¿ç®—ç¬¦</h3><p>å…³ç³»è¿ç®—ç¬¦å·¦å³ä¸¤è¾¹çš„è¿ç®—å¯¹è±¡å¿…é¡»æ˜¯ç›¸åŒç±»å‹çš„å®¹å™¨ï¼Œä¸”å¿…é¡»ä¿å­˜ç›¸åŒç±»å‹çš„å…ƒç´ ã€‚æ¯”è¾ƒä¸¤ä¸ªå®¹å™¨å®é™…ä¸Šæ˜¯é€å…ƒç´ ä½¿ç”¨å…ƒç´ çš„å…³ç³»è¿ç®—ç¬¦å®Œæˆæ¯”è¾ƒã€‚<br>å¦‚æœå…ƒç´ ç±»å‹ä¸æ”¯æŒæ‰€éœ€è¿ç®—ç¬¦ï¼Œé‚£ä¹ˆä¿å­˜è¿™ç§å…ƒç´ çš„å®¹å™¨å°±ä¸èƒ½ä½¿ç”¨ç›¸åº”çš„å…³ç³»è¿ç®—ã€‚</p><h2 id="9-3-é¡ºåºå®¹å™¨æ“ä½œ"><a href="#9-3-é¡ºåºå®¹å™¨æ“ä½œ" class="headerlink" title="9.3 é¡ºåºå®¹å™¨æ“ä½œ"></a>9.3 é¡ºåºå®¹å™¨æ“ä½œ</h2><h3 id="9-3-1-å‘é¡ºåºå®¹å™¨æ·»åŠ å…ƒç´ "><a href="#9-3-1-å‘é¡ºåºå®¹å™¨æ·»åŠ å…ƒç´ " class="headerlink" title="9.3.1 å‘é¡ºåºå®¹å™¨æ·»åŠ å…ƒç´ "></a>9.3.1 å‘é¡ºåºå®¹å™¨æ·»åŠ å…ƒç´ </h3><p><strong>ä½¿ç”¨ emplace æ“ä½œ</strong><br>å½“è°ƒç”¨ push æˆ– insert æˆå‘˜å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å°†å…ƒç´ ç±»å‹çš„å¯¹è±¡ä¼ é€’ç»™å®ƒä»¬ï¼Œè¿™äº›å¯¹è±¡è¢«æ‹·è´åˆ°å®¹å™¨ä¸­ã€‚<br>è€Œå½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ª emplace æˆå‘˜å‡½æ•°æ—¶ï¼Œåˆ™æ˜¯å°†å‚æ•°ä¼ é€’ç»™å…ƒç´ ç±»å‹çš„æ„é€ å‡½æ•°ã€‚emplace æˆå‘˜ä½¿ç”¨è¿™äº›å‚æ•°åœ¨å®¹å™¨ç®¡ç†çš„å†…å­˜ç©ºé—´ä¸­ç›´æ¥æ„é€ å…ƒç´ ã€‚</p><h3 id="9-3-2-è®¿é—®å…ƒç´ "><a href="#9-3-2-è®¿é—®å…ƒç´ " class="headerlink" title="9.3.2 è®¿é—®å…ƒç´ "></a>9.3.2 è®¿é—®å…ƒç´ </h3><p>front() è¿”å›é¦–å…ƒç´ çš„å¼•ç”¨ï¼Œback() è¿”å›å°¾å…ƒç´ çš„å¼•ç”¨ã€‚c[n] ä¸ a.at(n) åœ¨ n æœªè¶Šç•Œæ—¶æ•ˆæœç›¸åŒï¼Œè¶Šç•Œæ—¶ at() æŠ›å‡º out_of_range å¼‚å¸¸ã€‚</p><h3 id="9-3-5-æ”¹å˜å®¹å™¨å¤§å°"><a href="#9-3-5-æ”¹å˜å®¹å™¨å¤§å°" class="headerlink" title="9.3.5 æ”¹å˜å®¹å™¨å¤§å°"></a>9.3.5 æ”¹å˜å®¹å™¨å¤§å°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">list&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ilist</span><span class="hljs-params">(<span class="hljs-number">10</span>, <span class="hljs-number">42</span>)</span></span>;<br>ilist.<span class="hljs-built_in">resize</span>(<span class="hljs-number">15</span>, <span class="hljs-number">-1</span>); <span class="hljs-comment">// å°† 5 ä¸ª -1 æ·»åŠ åˆ° ilist çš„æœ«å°¾ã€‚</span><br>ilist.<span class="hljs-built_in">resize</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// ä» ilist çš„æœ«å°¾åˆ é™¤ 10 ä¸ªå…ƒç´ ã€‚</span><br></code></pre></td></tr></table></figure><h3 id="9-3-6-å®¹å™¨æ“ä½œå¯èƒ½ä½¿è¿­ä»£å™¨å¤±æ•ˆ"><a href="#9-3-6-å®¹å™¨æ“ä½œå¯èƒ½ä½¿è¿­ä»£å™¨å¤±æ•ˆ" class="headerlink" title="9.3.6 å®¹å™¨æ“ä½œå¯èƒ½ä½¿è¿­ä»£å™¨å¤±æ•ˆ"></a>9.3.6 å®¹å™¨æ“ä½œå¯èƒ½ä½¿è¿­ä»£å™¨å¤±æ•ˆ</h3><p>å½“æˆ‘ä»¬åˆ é™¤å…ƒç´ æ—¶ï¼Œå°¾åè¿­ä»£å™¨æ€»æ˜¯ä¼šå¤±æ•ˆã€‚ä¿è¯æ¯æ¬¡æ”¹å˜è°·å™¨çš„æ“ä½œä¹‹åéƒ½æ­£ç¡®åœ°é‡æ–°å®šä½è¿­ä»£å™¨ã€‚<br>ä¸èƒ½åœ¨å¾ªç¯ä¹‹å‰ä¿å­˜ end è¿”å›çš„è¿­ä»£å™¨ï¼Œé€šå¸¸ end() æ“ä½œéƒ½å¾ˆå¿«ã€‚</p><h2 id="9-4-vector-å¯¹è±¡æ˜¯å¦‚ä½•å¢é•¿çš„"><a href="#9-4-vector-å¯¹è±¡æ˜¯å¦‚ä½•å¢é•¿çš„" class="headerlink" title="9.4 vector å¯¹è±¡æ˜¯å¦‚ä½•å¢é•¿çš„"></a>9.4 vector å¯¹è±¡æ˜¯å¦‚ä½•å¢é•¿çš„</h2><p>æ²¡æœ‰ç©ºé—´å®¹çº³æ–°å…ƒç´ ï¼Œå› ä¸ºå…ƒç´ å¿…é¡»è¿ç»­å­˜å‚¨ï¼Œå®¹å™¨å¿…é¡»åˆ†é…æ–°çš„å†…å­˜ç©ºé—´æ¥ä¿å­˜å·±æœ‰å…ƒç´ å’Œæ–°å…ƒç´ ï¼Œå°†å·²æœ‰å…ƒç´ ä»æ—§ä½ç½®ç§»åŠ¨åˆ°æ–°ç©ºé—´ä¸­ï¼Œç„¶åæ·»åŠ æ–°å…ƒç´ ï¼Œé‡Šæ”¾æ—§å­˜å‚¨ç©ºé—´ã€‚<br>vector å’Œ string çš„å®ç°é€šå¸¸ä¼šåˆ†é…æ¯”æ–°çš„ç©ºé—´éœ€æ±‚æ›´å¤§çš„å†…å­˜ç©ºé—´ï¼Œå®¹å™¨é¢„ç•™è¿™äº›ç©ºé—´ä½œä¸ºå¤‡ç”¨ã€‚<br>è¡¥å……ï¼š<a href="http://blog.sina.com.cn/s/blog_a2a6dd380102w73e.html">push_back çš„æ—¶é—´å¤æ‚åº¦ä¸ºä»€ä¹ˆæ˜¯ o(1)</a></p><p><strong>ç®¡ç†å®¹é‡çš„æˆå‘˜å‡½æ•°</strong><br>c.shrink_to_fit()ï¼šè¯·æ±‚å°† capacity() å‡å°‘ä¸ºä¸ size() ç›¸åŒd å¤§å°ï¼Œæ ‡å‡†åº“å¹¶ä¸ä¿è¯ä¸€å®šèƒ½é€€è¿˜å†…å­˜ã€‚<br>c.capacity()ï¼šä¸é‡æ–°åˆ†é…å†…å­˜ç©ºé—´çš„è¯ï¼Œå®¹å™¨å¯ä»¥ä¿å­˜å¤šå°‘å…€ç´ ã€‚<br>c.reserve(n)ï¼šåˆ†é…è‡³å°‘èƒ½å®¹çº³ n ä¸ªå…ƒç´ çš„å†…å­˜ç©ºé—´ã€‚<br>reserve å¹¶ä¸æ”¹å˜å®¹å™¨ä¸­å…ƒç´ çš„æ•°é‡ï¼Œå®ƒä»…å½±å“ vector é å…ˆåˆ†é…å¤šå¤§çš„å†…å­˜ç©ºé—´ã€‚åªæœ‰å½“éœ€è¦çš„å†…å­˜ç©ºé—´è¶…è¿‡å½“å‰å®¹é‡æ—¶ï¼Œreserve è°ƒç”¨æ‰ä¼šæ”¹å˜ vector çš„å®¹é‡ï¼Œå¦åˆ™ä»€ä¹ˆä¹Ÿä¸åšï¼Œæ‰€ä»¥è¯´è°ƒç”¨ reserve æ°¸è¿œä¹Ÿä¸ä¼šå‡å°‘å®¹å™¨å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p><h2 id="9-5-é¢å¤–çš„-string-æ“ä½œ"><a href="#9-5-é¢å¤–çš„-string-æ“ä½œ" class="headerlink" title="9.5 é¢å¤–çš„ string æ“ä½œ"></a>9.5 é¢å¤–çš„ string æ“ä½œ</h2><h3 id="9-5-3-string-æœç´¢æ“ä½œ"><a href="#9-5-3-string-æœç´¢æ“ä½œ" class="headerlink" title="9.5.3 string æœç´¢æ“ä½œ"></a>9.5.3 string æœç´¢æ“ä½œ</h3><p>å¦‚æœæœç´¢å¤±è´¥ï¼Œåˆ™è¿”å›ä¸€ä¸ªåä¸º stringr::npos çš„ static æˆå‘˜ã€‚<br>string æœç´¢å‡½æ•°è¿”å› string::size_type å€¼ï¼Œè¯¥ç±»å‹æ˜¯ä¸€ä¸ª unsigned ç±»å‹ã€‚å› æ­¤ï¼Œç”¨ä¸€ä¸ª int æˆ–å…¶ä»–å¸¦ç¬¦å·ç±»å‹æ¥ä¿å­˜è¿™äº›å‡½æ•°çš„è¿”å›å€¼ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚</p><h1 id="ç¬¬åç« -æ³›å‹ç®—æ³•"><a href="#ç¬¬åç« -æ³›å‹ç®—æ³•" class="headerlink" title="ç¬¬åç«  æ³›å‹ç®—æ³•"></a>ç¬¬åç«  æ³›å‹ç®—æ³•</h1><h2 id="10-2-åˆå§‹æ³›å‹ç®—æ³•"><a href="#10-2-åˆå§‹æ³›å‹ç®—æ³•" class="headerlink" title="10.2 åˆå§‹æ³›å‹ç®—æ³•"></a>10.2 åˆå§‹æ³›å‹ç®—æ³•</h2><h3 id="10-2-2-å†™å®¹å™¨å…ƒç´ çš„ç®—æ³•"><a href="#10-2-2-å†™å®¹å™¨å…ƒç´ çš„ç®—æ³•" class="headerlink" title="10.2.2 å†™å®¹å™¨å…ƒç´ çš„ç®—æ³•"></a>10.2.2 å†™å®¹å™¨å…ƒç´ çš„ç®—æ³•</h3><p><strong>ä»‹ç» back_inserter</strong><br>back_inserter æ¥å—ä¸€ä¸ªæŒ‡å‘å®¹å™¨çš„å¼•ç”¨ï¼Œå½“æˆ‘ä»¬é€šè¿‡æ­¤è¿­ä»£å™¨èµ‹å€¼æ—¶ï¼Œèµ‹å€¼è¿ç®—ç¬¦ä¼šè°ƒç”¨ push_back å°†ä¸€ä¸ªå…·æœ‰ç»™å®šå€¼çš„å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">vector&lt;<span class="hljs-type">int</span>&gt; vec; <span class="hljs-comment">// ç©ºå‘é‡</span><br><span class="hljs-keyword">auto</span> it = <span class="hljs-built_in">back_inserter</span>(vec); <span class="hljs-comment">// é€šè¿‡å®ƒè³¦å€¼ä¼šå°†å…ƒç´ æ·»åŠ åˆ° vec ä¸­</span><br>it = <span class="hljs-number">42</span>; <span class="hljs-comment">// vec ä¸­ç°åœ¨æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå€¼ä¸º 42</span><br></code></pre></td></tr></table></figure><h2 id="10-3-å®šåˆ¶æ“ä½œ"><a href="#10-3-å®šåˆ¶æ“ä½œ" class="headerlink" title="10.3 å®šåˆ¶æ“ä½œ"></a>10.3 å®šåˆ¶æ“ä½œ</h2><h3 id="å‘ç®—æ³•ä¼ é€’å‡½æ•°"><a href="#å‘ç®—æ³•ä¼ é€’å‡½æ•°" class="headerlink" title="å‘ç®—æ³•ä¼ é€’å‡½æ•°"></a>å‘ç®—æ³•ä¼ é€’å‡½æ•°</h3><p><strong>è°“è¯</strong><br>è°“è¯æ˜¯ä¸€ä¸ªå¯è°ƒç”¨çš„è¡¨è¾¾å¼ï¼Œå…¶è¿”å›ç»“æœæ˜¯ä¸€ä¸ªèƒ½ç”¨ä½œæ¡ä»¶çš„å€¼ã€‚æ ‡å‡†åº“ç®—æ³•æ‰€ä½¿ç”¨çš„è°“è¯åˆ†ä¸ºä¸€å…ƒè°“è¯å’ŒäºŒå…ƒè°“è¯ã€‚</p><h3 id="10-3-2-lambda-è¡¨è¾¾å¼"><a href="#10-3-2-lambda-è¡¨è¾¾å¼" class="headerlink" title="10.3.2 lambda è¡¨è¾¾å¼"></a>10.3.2 lambda è¡¨è¾¾å¼</h3><p><strong>ä»‹ç»lambda</strong><br>å¯ä»¥å°†å…¶ç†è§£ä¸ºä¸€ä¸ªæœªå‘½åçš„å†…è”å‡½æ•°ã€‚lambdaå¯èƒ½å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨ã€‚lambda å¿…é¡»ä½¿ç”¨å°¾ç½®è¿”å›ã€‚ä¸€ä¸ªlambdaè¡¨è¾¾å¼å…·æœ‰å¦‚ä¸‹å½¢å¼ï¼š<br>[capture list] (parameter list) -&gt; return type { function body }<br>å¦‚æœ lambda çš„å‡½æ•°ä½“åŒ…å«ä»»ä½•å•ä¸€ return è¯­å¥ä¹‹å¤–çš„å†…å®¹ï¼Œä¸”æœªæŒ‡å®šè¿”å›ç±»å‹ï¼Œåˆ™è¿”å› voidã€‚</p><p><strong>å‘lambdaä¼ é€’å‚æ•°</strong><br>lambda ä¸èƒ½æœ‰é»˜è®¤å‚æ•°ã€‚ä¸€ä¸ª lambda é€šè¿‡å°†å±€éƒ¨å˜é‡åŒ…å«åœ¨å…¶æ•è·åˆ—è¡¨ä¸­æ¥æŒ‡å‡ºå°†ä¼šä½¿ç”¨è¿™äº›å˜é‡ã€‚æ•è·åˆ—è¡¨æŒ‡å¼• lambda åœ¨å…¶å†…éƒ¨åŒ…å«è®¿é—®å±€éƒ¨å˜é‡æ‰€éœ€çš„ä¿¡æ¯ã€‚<br>æ•è·åˆ—è¡¨åªç”¨äºå±€éƒ¨é static å˜é‡ï¼Œlambda å¯ä»¥ç›´æ¥ä½¿ç”¨å±€éƒ¨ static å˜é‡å’Œåœ¨å®ƒæ‰€åœ¨å‡½æ•°ä¹‹å¤–å£°æ˜çš„åå­—ã€‚</p><h3 id="10-3-3-lambda-æ•è·çš„è¿”å›"><a href="#10-3-3-lambda-æ•è·çš„è¿”å›" class="headerlink" title="10.3.3 lambda æ•è·çš„è¿”å›"></a>10.3.3 lambda æ•è·çš„è¿”å›</h3><p>å½“å‘ä¸€ä¸ªå‡½æ•°ä¼ é€’ä¸€ä¸ª lambda æ—¶ï¼ŒåŒæ—¶å®šä¹‰äº†ä¸€ä¸ªæ–°ç±»å‹å’Œè¯¥ç±»å‹çš„ä¸€ä¸ªå¯¹è±¡ã€‚<br>å€¼æ•è·åˆ™æ˜¯åœ¨å®šä¹‰ä¹‹æ—¶è¿›è¡Œæ•è·ï¼Œè€Œå¼•ç”¨æ•è·åœ¨è°ƒç”¨æ—¶è¿›è¡Œæ•è·ã€‚</p><p><strong>å€¼æ•è·</strong><br>é‡‡ç”¨å€¼æ•è·çš„å‰ææ˜¯å˜é‡å¯ä»¥æ‹·è´ã€‚ä¸å‚æ•°ä¸åŒï¼Œè¢«æ•è·çš„å˜é‡çš„å€¼æ˜¯åœ¨ lambda åˆ›å»ºæ—¶æ‹·è´ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ—¶æ‹·è´ï¼Œéšåå¯¹å…¶ä¿®æ”¹ä¸ä¼šå½±å“åˆ° lambda å†…å¯¹åº”çš„å€¼ã€‚</p><p><strong>å¼•ç”¨æ•è·</strong><br>é‡‡ç”¨å¼•ç”¨æ–¹å¼æ•è·ä¸€ä¸ªå˜é‡ï¼Œå°±å¿…é¡»ç¡®ä¿è¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ lambda æ‰§è¡Œçš„æ—¶å€™æ˜¯å­˜åœ¨çš„ã€‚</p><p><strong>éšå¼æ•è·</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">[=](<span class="hljs-type">const</span> string &amp;s)<br>&#123; <span class="hljs-keyword">return</span> s.<span class="hljs-built_in">size</span> () &gt;= sz; &#125; <span class="hljs-comment">// sz æœªéšå¼çš„å€¼æ•è·</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›å¯¹ä¸€éƒ¨åˆ†å˜é‡é‡‡ç”¨å€¼æ•è·ï¼Œå¯¹å…¶ä»–å˜é‡é‡‡ç”¨å¼•ç”¨æ•è·ï¼Œå¯ä»¥æ··åˆä½¿ç”¨éšå¼æ•è·å’Œæ˜¾å¼æ•è·ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// oséšå¼æ•è·ï¼Œå¼•ç”¨æ•è·æ–¹å¼ï¼›c æ˜¾å¼æ•è·ï¼Œå€¼æ•è·æ–¹å¼</span><br>[&amp;, c](<span class="hljs-type">const</span> string &amp;s)&#123; os &lt;&lt; s &lt;&lt; c; &#125;<br><span class="hljs-comment">// osæ˜¾å¼æ•è·ï¼Œå¼•ç”¨æ•è·æ–¹å¼ï¼›céšå¼æ•è·ï¼Œå€¼æ•è·æ–¹å¼</span><br>[=, &amp;os](<span class="hljs-type">const</span> string &amp;s) &#123; os &lt;&lt; s &lt;&lt; c; &#125;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æ··åˆä½¿ç”¨éšå¼æ•è·å’Œæ˜¾å¼æ•è·æ—¶ï¼Œæ•è·åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ª &amp; æˆ– &#x3D;ã€‚æ­¤ç¬¦å·æŒ‡å®šäº†é»˜è®¤æ•è·æ–¹å¼ä¸ºå¼•ç”¨æˆ–å€¼ï¼Œæ˜¾å¼æ•è·çš„å˜é‡å¿…é¡»ä½¿ç”¨ä¸éšå¼æ•è·ä¸åŒçš„æ–¹å¼ã€‚</p><p><strong>å¯å˜ lambda</strong><br>å¦‚æœæˆ‘ä»¬å¸Œæœ›èƒ½æ”¹å˜ä¸€ä¸ªè¢«æ•è·çš„å˜é‡çš„å€¼ï¼Œå°±å¿…é¡»åœ¨å‚æ•°åˆ—è¡¨é¦–åŠ ä¸Šå…³é”®å­— mutableã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">void</span> fÑĞ¿() &#123;<br><span class="hljs-type">int</span> vl = <span class="hljs-number">42</span>; <span class="hljs-comment">// å±€éƒ¨å˜é‡</span><br><span class="hljs-comment">// f å¯ä»¥æ”¹å˜å®ƒæ‰€æ•è·çš„å˜é‡çš„å€¼</span><br><span class="hljs-keyword">auto</span> f = [vl] () <span class="hljs-keyword">mutable</span> &#123; <span class="hljs-keyword">return</span> ++vl; &#125;;<br>vl = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">auto</span> j = <span class="hljs-built_in">f</span>(); <span class="hljs-comment">// j ä¸º 43</span><br></code></pre></td></tr></table></figure><h3 id="10-3-4-å‚æ•°ç»‘å®š"><a href="#10-3-4-å‚æ•°ç»‘å®š" class="headerlink" title="10.3.4 å‚æ•°ç»‘å®š"></a>10.3.4 å‚æ•°ç»‘å®š</h3><p><strong>æ ‡å‡†åº“ bind å‡½æ•°</strong><br>bind æ¥å—ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å¯è°ƒç”¨å¯¹ è±¡æ¥â€œé€‚åº”â€åŸå¯¹è±¡çš„å‚æ•°åˆ—è¡¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> newCallable = <span class="hljs-built_in">bind</span> (callable, arg_list);<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬è°ƒç”¨ newCallable æ—¶ newCallable ä¼šè°ƒç”¨ callableï¼Œå¹¶ä¼ é€’ç»™å®ƒä¸­çš„å‚æ•°ã€‚<br>arg_list å‚æ•°å¯èƒ½åŒ…å«å½¢å¦‚ _n çš„åå­—ã€‚è¿™äº›å‚æ•°æ˜¯â€œå ä½ç¬¦â€ï¼Œå…¶æœ¬èº«çš„ä½ç½®ä»£è¡¨å…¶åœ¨åŸå‡½æ•°å½¢å‚åˆ—è¡¨ä¸­çš„ä½ç½®ï¼Œå…¶æ•°å­—ä»£è¡¨å…¶åœ¨æ–°å‡½æ•°å½¢å‚åˆ—è¡¨ä¸­çš„ä½ç½®ã€‚<br>åå­— _n éƒ½å®šä¹‰åœ¨ä¸€ä¸ªåä¸º placeholders çš„å‘½åç©ºé—´ä¸­ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> newFun = <span class="hljs-built_in">bind</span>(oldFun, a, b, _2, c, _1);<br></code></pre></td></tr></table></figure><p>è¿™ä¸ª bind è°ƒç”¨ä¼šå°† <code>newFun(_1, _2);</code> æ˜ å°„ä¸º <code>oldFun(a, b, _2, Ñ, _1);</code></p><p><strong>ç»‘å®šå¼•ç”¨å‚æ•°</strong><br>å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¼ é€’ç»™ bind ä¸€ä¸ªå¯¹è±¡è€Œåˆä¸æ‹·è´å®ƒï¼Œå°±å¿…é¡»ä½¿ç”¨æ ‡å‡†åº“ ref å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æˆ‘ä»¬æ— æ³•æ‹·è´ ostream</span><br>for_each(words.<span class="hljs-built_in">begin</span>(), words.<span class="hljs-built_in">end</span>(), <span class="hljs-built_in">bind</span>(print, <span class="hljs-built_in">ref</span>(os), _1, <span class="hljs-string">&#x27; &#x27;</span>));<br></code></pre></td></tr></table></figure><p>å‡½æ•° ref è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ç»™å®šçš„å¼•ç”¨ï¼Œæ­¤å¯¹è±¡æ˜¯å¯ä»¥æ‹·è´çš„ã€‚æ ‡å‡†åº“ä¸­è¿˜æœ‰ä¸€ä¸ª cref å‡½æ•°ï¼Œç”Ÿæˆä¸€ä¸ªä¿å­˜ const å¼•ç”¨çš„ç±»ã€‚</p><h1 id="ç¬¬åä¸€ç« -å…³è”å®¹å™¨"><a href="#ç¬¬åä¸€ç« -å…³è”å®¹å™¨" class="headerlink" title="ç¬¬åä¸€ç«  å…³è”å®¹å™¨"></a>ç¬¬åä¸€ç«  å…³è”å®¹å™¨</h1><p>å…è®¸é‡å¤å…³é”®å­—çš„å®¹å™¨çš„åå­—ä¸­éƒ½åŒ…å«å•è¯ multiï¼Œä¸ä¿æŒå…³é”®å­—æŒ‰é¡ºåºå­˜å‚¨çš„å®¹å™¨çš„åå­—éƒ½ä»¥å•è¯ unordered å¼€å¤´ã€‚</p><h2 id="11-1-ä½¿ç”¨å…³è”å®¹å™¨"><a href="#11-1-ä½¿ç”¨å…³è”å®¹å™¨" class="headerlink" title="11.1 ä½¿ç”¨å…³è”å®¹å™¨"></a>11.1 ä½¿ç”¨å…³è”å®¹å™¨</h2><p>å¦‚æœä¸‹æ ‡è¿˜æœªåœ¨ map ä¸­ï¼Œä¸‹æ ‡è¿ç®—ç¬¦ä¼šåˆ›å»ºä¸€ä¸ªæ–°å…ƒç´ ï¼Œå…¶å…³é”®å­—ä¸ºä¸‹æ ‡ï¼Œå€¼ä¸ºå€¼åˆå§‹åŒ–ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">if</span>(set.<span class="hljs-built_in">find</span>(target) == set.<span class="hljs-built_in">end</span>()) &#123;<br>    <span class="hljs-comment">// set ä¸­ä¸å­˜åœ¨ target</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="11-2-å…³è”å®¹å™¨æ¦‚è¿°"><a href="#11-2-å…³è”å®¹å™¨æ¦‚è¿°" class="headerlink" title="11.2 å…³è”å®¹å™¨æ¦‚è¿°"></a>11.2 å…³è”å®¹å™¨æ¦‚è¿°</h2><h3 id="11-2-2-å…³é”®å­—ç±»å‹çš„è¦æ±‚"><a href="#11-2-2-å…³é”®å­—ç±»å‹çš„è¦æ±‚" class="headerlink" title="11.2.2 å…³é”®å­—ç±»å‹çš„è¦æ±‚"></a>11.2.2 å…³é”®å­—ç±»å‹çš„è¦æ±‚</h3><p>å¯¹äºæœ‰åºå®¹å™¨ mapã€multimapã€set ä»¥åŠ multisetï¼Œå…³é”®å­—ç±»å‹å¿…é¡»å®šä¹‰å…ƒç´ æ¯”è¾ƒçš„æ–¹æ³•</p><h3 id="11-2-3-pair-ç±»å‹"><a href="#11-2-3-pair-ç±»å‹" class="headerlink" title="11.2.3 pair ç±»å‹"></a>11.2.3 pair ç±»å‹</h3><p>ä¸€ä¸ª pair ä¿å­˜ä¸¤ä¸ª public æ•°æ®æˆå‘˜ï¼Œ ä¸¤ä¸ªæˆå‘˜åˆ†åˆ«å‘½åä¸º first å’Œ secondã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">make_pair</span>(v1, v2); <span class="hljs-comment">// pair çš„ç±»å‹ç”± v1 v2 æ¨æ–­å‡ºæ¥ã€‚</span><br></code></pre></td></tr></table></figure><h2 id="11-3-å…³è”å®¹å™¨çš„æ“ä½œ"><a href="#11-3-å…³è”å®¹å™¨çš„æ“ä½œ" class="headerlink" title="11.3 å…³è”å®¹å™¨çš„æ“ä½œ"></a>11.3 å…³è”å®¹å™¨çš„æ“ä½œ</h2><p>key_typeï¼šæ­¤å®¹å™¨ç±»å‹çš„å…³é”®å­—ç±»å‹ã€‚<br>mapped_typeï¼šæ¯ä¸ªå…³é”®å­—å…³è”çš„ç±»å‹ï¼Œåªé€‚ç”¨äºmapã€‚<br>value_typeï¼šå¯¹äº setï¼Œä¸ key_type ç›¸åŒï¼›å¯¹äº mapï¼Œä¸º <code>pair&lt;const key_type, mapped_type&gt;</code><br>å…³é”®å­—æ˜¯ const çš„ã€‚</p><h3 id="11-3-2-æ·»åŠ å…ƒç´ "><a href="#11-3-2-æ·»åŠ å…ƒç´ " class="headerlink" title="11.3.2 æ·»åŠ å…ƒç´ "></a>11.3.2 æ·»åŠ å…ƒç´ </h3><p>æ’å…¥ä¸€ä¸ªå·²å­˜åœ¨çš„å…ƒç´ å¯¹å®¹å™¨æ²¡æœ‰ä»»ä½•å½±å“ã€‚</p><p><strong>æ£€æµ‹ insert çš„è¿”å›å€¼</strong><br>æ·»åŠ å•ä¸€å…ƒç´ çš„ insert å’Œ emplace ç‰ˆæœ¬è¿”å†‹ä¸€ä¸ª pairï¼Œfirst æˆå‘˜æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘å…·æœ‰ç»™å®šå…³é”®å­—çš„å…ƒç´ ï¼›second æˆå‘˜æ˜¯ä¸€ä¸ª bool å€¼ï¼ŒæŒ‡å‡ºå…ƒç´ æ˜¯æ’å…¥æˆåŠŸè¿˜æ˜¯å·²ç»å­˜åœ¨äºå®¹å™¨ä¸­ã€‚</p><h3 id="11-3-4-map-çš„ä¸‹æ ‡æ“ä½œ"><a href="#11-3-4-map-çš„ä¸‹æ ‡æ“ä½œ" class="headerlink" title="11.3.4 map çš„ä¸‹æ ‡æ“ä½œ"></a>11.3.4 map çš„ä¸‹æ ‡æ“ä½œ</h3><p>set ç±»å‹ä¸æ”¯æŒä¸‹æ ‡ï¼Œä¹Ÿä¸èƒ½å¯¹ä¸€ä¸ª multimap æˆ–ä¸€ä¸ª unordered_multimap è¿›è¡Œä¸‹æ ‡æ“ä½œã€‚<br>å¦‚æœå…³é”®å­—å¹¶ä¸åœ¨ map ä¸­ï¼Œä¼šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå…ƒç´ å¹¶æ’å…¥åˆ° map ä¸­ï¼Œå…³è”å€¼å°†è¿›è¡Œå€¼åˆå§‹åŒ–ã€‚å¦‚æœä¸å¸Œæœ›äº§ç”Ÿæ–°çš„æ’å…¥ï¼Œå¯ä»¥ä½¿ç”¨ at()ã€‚<br>å½“å¯¹ä¸€ä¸ª map è¿›è¡Œä¸‹æ ‡æ“ä½œæ—¶ï¼Œä¼šè·å¾—ä¸€ä¸ª mapped_type å¯¹è±¡ï¼›ä½†å½“è§£å¼•ç”¨ä¸€ä¸ª map è¿­ä»£å™¨æ—¶ï¼Œä¼šå¾—åˆ°ä¸€ä¸ª value_type å¯¹è±¡ã€‚</p><h3 id="11-3-5-è®¿é—®å…ƒç´ "><a href="#11-3-5-è®¿é—®å…ƒç´ " class="headerlink" title="11.3.5 è®¿é—®å…ƒç´ "></a>11.3.5 è®¿é—®å…ƒç´ </h3><p>c.lower_bound(k)ï¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªå…³é”®å­—ä¸å°äºĞºçš„å…ƒç´ ã€‚<br>Ñ.upper_bound(k)ï¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªå…³é”®å­—å¤§äºĞºçš„å…ƒç´ ã€‚<br>Ñ.equal_range(k)ï¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ pairï¼Œè¡¨ç¤ºå…³é”®å­—ç­‰äº K çš„å…ƒç´ çš„èŒƒå›´ã€‚è‹¥ä¸å­˜åœ¨ï¼Œpair çš„ä¸¤ä¸ªæˆå‘˜å‡ç­‰äº c.end()ã€‚<br>è‹¥å…³é”®å­—æœªåŒ¹é…ï¼Œä»–ä»¬éƒ½è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘ä¸å½±å“æ’åºçš„å…³é”®å­—æ’å…¥ä½ç½®ã€‚</p><p><strong>åœ¨ multimap æˆ– multiset ä¸­æŸ¥æ‰¾å…ƒç´ </strong><br>å¦‚æœä¸€ä¸ª multimap æˆ– multiset ä¸­æœ‰å¤šä¸ªå…ƒç´ å…·æœ‰ç»™å®šå…³é”®å­—ï¼Œåˆ™è¿™äº›å…ƒç´ åœ¨å®¹å™¨ä¸­ä¼šç›¸é‚»å­˜å‚¨ã€‚</p><h2 id="åœ¨å®¹å™¨ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»"><a href="#åœ¨å®¹å™¨ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»" class="headerlink" title="åœ¨å®¹å™¨ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»"></a>åœ¨å®¹å™¨ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»</h2><p>å¦‚æœè¦åœ¨ map&#x2F;set ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»ï¼Œéœ€è¦æä¾›åˆ¤æ–­ &lt; çš„æ–¹æ³•ã€‚<br>å¦‚æœè¦åœ¨ unordered_map&#x2F;unordered_set ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»ï¼Œéœ€è¦æä¾›è®¡ç®—å“ˆå¸Œå€¼çš„æ–¹æ³•ï¼Œä»¥åŠåˆ¤æ–­ &#x3D;&#x3D; çš„æ–¹æ³•ã€‚</p><ul><li>ä½¿ç”¨å‡½æ•°æŒ‡é’ˆ<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Line</span>&#123;<span class="hljs-comment">/* æˆå‘˜ä¸æ„é€ å‡½æ•° */</span>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">m_hash</span> <span class="hljs-params">(<span class="hljs-type">const</span> Line &amp;l)</span> </span>&#123;<br><span class="hljs-keyword">return</span> l.k * <span class="hljs-number">100</span> + l.b;<br>&#125;;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">m_equal</span> <span class="hljs-params">(<span class="hljs-type">const</span> Line &amp;l1, <span class="hljs-type">const</span> Line &amp;l2)</span> </span>&#123;<br><span class="hljs-keyword">return</span> l<span class="hljs-number">1.</span>k == l<span class="hljs-number">2.</span>k &amp;&amp; l<span class="hljs-number">1.</span>b == l<span class="hljs-number">2.</span>b;<br>&#125;;<br><br><span class="hljs-comment">// å‚æ•°ä»£è¡¨äº†æ¡¶çš„å¤§å°ã€å“ˆå¸Œå‡½æ•°æŒ‡é’ˆã€ç›¸ç­‰æ€§åˆ¤æ–­è¿ç®—ç¬¦å‡½æ•°æŒ‡é’ˆ</span><br><span class="hljs-function">unordered_set&lt;Line, <span class="hljs-title">decltype</span><span class="hljs-params">(m_hash)</span>*, <span class="hljs-title">decltype</span><span class="hljs-params">(m_equal)</span>*&gt; <span class="hljs-title">h_set</span><span class="hljs-params">(<span class="hljs-number">42</span>, m_hash, m_equal)</span></span>;<br></code></pre></td></tr></table></figure></li><li>å¦‚æœæˆ‘ä»¬çš„ç±»é‡è½½äº† &#x3D;&#x3D; è¿ç®—ç¬¦ï¼Œåˆ™å¯ä»¥åªé‡è½½å“ˆå¸Œå‡½æ•°ã€‚<br>å¹¶ä¸”ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡è½½å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦çš„æ–¹å¼æä¾›ä¸€ä¸ªå‡½æ•°å¯¹è±¡ã€‚<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Line</span> &#123;<br>    <span class="hljs-comment">// æˆå‘˜ä¸æ„é€ å‡½æ•°</span><br>    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span> == (<span class="hljs-type">const</span> Line &amp;l) <span class="hljs-type">const</span> &#123;<br>        <span class="hljs-keyword">return</span>  k == l.k &amp;&amp; b == l.b;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LineHash</span> &#123;<br>    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">operator</span> <span class="hljs-params">()</span> <span class="hljs-params">(<span class="hljs-type">const</span> Line &amp;l)</span> <span class="hljs-type">const</span> </span>&#123;<br>        <span class="hljs-keyword">return</span>  l.k * <span class="hljs-number">100</span> + l.b;<br>    &#125;<br>&#125;;<br><br>unordered_set &lt;Line, LineHash&gt; h_set;<br>unordered_map &lt;Line, string, LineHash&gt; h_map;<br></code></pre></td></tr></table></figure></li><li>æœ€åï¼Œåœ¨ C++20 ä¸­ä¼¼ä¹å¯ä»¥ç”¨ lambda ä»£æ›¿è¿™ä¸ªå‡½æ•°å¯¹è±¡ã€‚<blockquote><p>C++11 åˆ° C++17 é‡Œï¼Œlambda è¡¨è¾¾å¼çš„å¤åˆ¶è¿ç®—ç¬¦è¢«åˆ é™¤äº†ï¼Œè¿™å¯¼è‡´ lambda è¡¨è¾¾å¼æ— æ³•å¤åˆ¶æ„é€ ï¼Œä¸æ»¡è¶³å“ˆå¸Œå‡½æ•°æ‰€éœ€çš„æ¡ä»¶ï¼ˆæ˜¯å‡½æ•°å¯¹è±¡ï¼Œå¯å¤åˆ¶æ„é€ ï¼Œå¯ææ„ï¼Œè°ƒç”¨æ—¶å¯¹ç›¸åŒå¯¹è±¡è¿”å›ç›¸åŒå“ˆå¸Œï¼‰ã€‚<br>C++20 é‡Œæ®è¯´æ— æ•è·çš„ lambda è¡¨è¾¾å¼å¯ä»¥å¤åˆ¶æ„é€ äº†ã€‚ç†è®ºä¸Šè¿™åº”è¯¥è§£å†³äº† lambda è¡¨è¾¾å¼ä¸èƒ½åšå“ˆå¸Œçš„ç¼ºé™·ã€‚<br><a href="https://www.zhihu.com/question/469655331">çŸ¥ä¹</a></p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Line</span>&#123;<span class="hljs-comment">/* æˆå‘˜ä¸æ„é€ å‡½æ•° */</span>&#125;;<br><br><span class="hljs-keyword">auto</span> m_hash = [](<span class="hljs-type">const</span> Line &amp;l) &#123;<br><span class="hljs-built_in">return</span> (<span class="hljs-type">size_t</span>)(l.k * <span class="hljs-number">100</span> + l.b);<br>&#125;;<br><span class="hljs-keyword">auto</span> m_equal = [](<span class="hljs-type">const</span> Line &amp;l1, <span class="hljs-type">const</span> Line &amp;l2) &#123;<br><span class="hljs-keyword">return</span> l<span class="hljs-number">1.</span>k == l<span class="hljs-number">2.</span>k &amp;&amp; l<span class="hljs-number">1.</span>b == l<span class="hljs-number">2.</span>b;<br>&#125;;<br><br>unordered_set&lt;Line, <span class="hljs-keyword">decltype</span>(m_hash), <span class="hljs-keyword">decltype</span>(m_equal)&gt; h_set;<br><span class="hljs-comment">// æˆ–è€…å†™æˆ</span><br><span class="hljs-function">unordered_set&lt;Line, <span class="hljs-title">decltype</span><span class="hljs-params">(m_hash)</span>, <span class="hljs-title">decltype</span><span class="hljs-params">(m_equal)</span>&gt; <span class="hljs-title">h_set</span><span class="hljs-params">(<span class="hljs-number">42</span>, m_hash, m_equal)</span></span>;<br></code></pre></td></tr></table></figure></li></ul><h1 id="ç¬¬åäºŒç« -åŠ¨æ€å†…å­˜"><a href="#ç¬¬åäºŒç« -åŠ¨æ€å†…å­˜" class="headerlink" title="ç¬¬åäºŒç«  åŠ¨æ€å†…å­˜"></a>ç¬¬åäºŒç«  åŠ¨æ€å†…å­˜</h1><p>åˆ†é…åœ¨é™æ€æˆ–æ ˆå†…å­˜ä¸­çš„å¯¹è±¡ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ›å»ºå’Œé”€æ¯ã€‚æ¯ä¸ªç¨‹åºè¿˜æ‹¥æœ‰ä¸€ä¸ªå†…å­˜æ± ï¼Œè¿™éƒ¨åˆ†å†…å­˜è¢«ç§°ä½œè‡ªç”±ç©ºé—´æˆ–å †ã€‚ç¨‹åºç”¨å †æ¥å­˜å‚¨åŠ¨æ€åˆ†é…çš„å¯¹è±¡ã€‚</p><h2 id="12-1-åŠ¨æ€å†…å­˜ä¸æ™ºèƒ½æŒ‡é’ˆ"><a href="#12-1-åŠ¨æ€å†…å­˜ä¸æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="12.1 åŠ¨æ€å†…å­˜ä¸æ™ºèƒ½æŒ‡é’ˆ"></a>12.1 åŠ¨æ€å†…å­˜ä¸æ™ºèƒ½æŒ‡é’ˆ</h2><h3 id="12-1-1-shared-ptr-ç±»"><a href="#12-1-1-shared-ptr-ç±»" class="headerlink" title="12.1.1 shared_ptr ç±»"></a>12.1.1 shared_ptr ç±»</h3><p>æœ€å®‰å…¨çš„åˆ†é…å’Œä½¿ç”¨åŠ¨æ€å†…å­˜çš„æ–¹æ³•æ˜¯è°ƒç”¨ä¸€ä¸ªåä¸º make_shared&lt;&gt;() çš„æ ‡å‡†åº“å‡½æ•°ã€‚æ­¤å‡½æ•°åœ¨åŠ¨æ€å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªå¯¹è±¡å¹¶åˆå§‹åŒ–å®ƒï¼Œè¿”å›æŒ‡å‘æ­¤å¯¹è±¡ shared_ptrã€‚<br>æ¯ä¸ª shared_ptr éƒ½æœ‰ä¸€ä¸ªå…³è”çš„è®¡æ•°å™¨ï¼Œé€šå¸¸ç§°å…¶ä¸ºå¼•ç”¨è®¡æ•°ã€‚ä¸€æ—¦ä¸€ä¸ª shared_ptr çš„è®¡æ•°å™¨å˜ä¸º 0ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨é‡Šæ”¾è‡ªå·±æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚ä½†åªè¦æœ‰å…¶ä»– shared_ptr ä¹ŸæŒ‡å‘è¿™å—å†…å­˜ï¼Œå®ƒå°±ä¸ä¼šè¢«é‡Šæ”¾æ‰ã€‚<br>è¡¥å……ï¼š<a href="https://www.jianshu.com/p/a704fef4809c">shared_ptr å¯¼è‡´çš„å¾ªç¯å¼•ç”¨åŠå…¶è§£å†³æ–¹æ³•</a></p><h3 id="12-1-2-ç›´æ¥ç®¡ç†å†…å­˜"><a href="#12-1-2-ç›´æ¥ç®¡ç†å†…å­˜" class="headerlink" title="12.1.2 ç›´æ¥ç®¡ç†å†…å­˜"></a>12.1.2 ç›´æ¥ç®¡ç†å†…å­˜</h3><p><strong>ä½¿ç”¨ new åŠ¨æ€åˆ†é…å’Œåˆå§‹åŒ–å¯¹è±¡</strong><br>new æ— æ³•ä¸ºå…¶åˆ†é…çš„å¯¹è±¡å‘½åï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆã€‚åŠ¨æ€åˆ†é…çš„å¯¹è±¡æ˜¯é»˜è®¤åˆå§‹åŒ–çš„ï¼Œè€Œç±»ç±»å‹å¯¹è±¡å°†ç”¨é»˜è®¤æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> *p1 = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>; <span class="hljs-comment">// é»˜è®¤åˆå§‹åŒ–</span><br><span class="hljs-type">int</span> *p2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(); <span class="hljs-comment">// å€¼åˆå§‹åŒ–</span><br></code></pre></td></tr></table></figure><p>åªæœ‰å½“æ‹¬å·ä¸­ä»…æœ‰å•ä¸€åˆå§‹åŒ–å™¨æ—¶æ‰å¯ä»¥ä½¿ç”¨ auto æ¨æ–­ new çš„è¿”å›å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> *p2 = <span class="hljs-built_in">new</span> (nothrow) <span class="hljs-type">int</span>; <span class="hljs-comment">//å¦‚æœåˆ†é…å¤±è´¥ï¼Œnew è¿”å›ä¸€ä¸ªç©ºæ‰æ—¨é’ˆï¼Œä¸æŠ›å‡ºå¼‚å¸¸</span><br></code></pre></td></tr></table></figure><h3 id="12-1-3-shared-ptr-å’Œ-new-ç»“åˆä½¿ç”¨"><a href="#12-1-3-shared-ptr-å’Œ-new-ç»“åˆä½¿ç”¨" class="headerlink" title="12.1.3 shared_ptr å’Œ new ç»“åˆä½¿ç”¨"></a>12.1.3 shared_ptr å’Œ new ç»“åˆä½¿ç”¨</h3><p>ä¸èƒ½å°†ä¸€ä¸ªå†…ç½®æŒ‡é’ˆéšå¼è½¬æ¢ä¸ºä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆï¼Œå¿…é¡»ä½¿ç”¨ç›´æ¥åˆå§‹åŒ–å½¢å¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">shared_ptr&lt;<span class="hljs-type">int</span>&gt; pi = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">42</span>); <span class="hljs-comment">//é”™è¯¯ï¼šå¿…é¡»ä½¿ç”¨ç›´æ¥åˆå§‹åŒ–å½¢å¼</span><br><span class="hljs-function">shared_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">p2</span> <span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">42</span>))</span></span>; <span class="hljs-comment">// æ­£ç¡®ï¼šä½¿ç”¨äº†ç›´æ¥åˆå§‹åŒ–å½¢å¼</span><br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªä¸´æ—¶çš„ shared_ptr æŒ‡å‘çš„å†…å­˜ä¼šç«‹åˆ»è¢«é‡Šæ”¾ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> *<span class="hljs-title">x</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">42</span>))</span></span>; <span class="hljs-comment">//å±é™©ï¼šx æ˜¯ä¸€ä¸ªæ™®é€šæŒ‡é’ˆï¼Œä¸æ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆ</span><br><span class="hljs-built_in">process</span> (x); <span class="hljs-comment">// é”™è¯¯ï¼šä¸èƒ½å°† int* è½¬æ¢ä¸ºä¸€ä¸ª shared_ptr&lt;int&gt;</span><br><span class="hljs-built_in">process</span> (<span class="hljs-built_in">shared_ptr</span>&lt;<span class="hljs-type">int</span>&gt;(x)); <span class="hljs-comment">// åˆæ³•çš„ï¼Œä½†å†…å­˜ä¼šè¢«é‡Šæ”¾</span><br><span class="hljs-type">int</span> j = *x; <span class="hljs-comment">// æœªå®šä¹‰çš„ï¼šX æ˜¯ä¸€ä¸ªç©ºæ‚¬æŒ‡é’ˆ</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸€ä¸ªå†…ç½®æŒ‡é’ˆæ¥è®¿é—®ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæ‰€è´Ÿè´£çš„å¯¹è±¡æ˜¯å¾ˆå±é™©çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•çŸ¥é“å¯¹è±¡ä½•æ—¶ä¼šè¢«é”€æ¯ã€‚<br>ä¹Ÿä¸è¦ä½¿ç”¨ get åˆå§‹åŒ–å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–ä¸ºæ™ºèƒ½æŒ‡é’ˆèµ‹å€¼ï¼Œå› ä¸ºå¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆä¼šåšé¢å¤–çš„ deleteã€‚<br>è€Œä¸”ä½¿ç”¨ get è¿”å›çš„æŒ‡é’ˆçš„ä»£ç ä¸èƒ½ delete æ­¤æŒ‡é’ˆã€‚</p><h3 id="12-1-4-æ™ºèƒ½æŒ‡é’ˆçš„å¼‚å¸¸"><a href="#12-1-4-æ™ºèƒ½æŒ‡é’ˆçš„å¼‚å¸¸" class="headerlink" title="12.1.4 æ™ºèƒ½æŒ‡é’ˆçš„å¼‚å¸¸"></a>12.1.4 æ™ºèƒ½æŒ‡é’ˆçš„å¼‚å¸¸</h3><p>åœ¨ new ä¹‹ååœ¨å¯¹åº”çš„ delete ä¹‹å‰å‘ç”Ÿäº†å¼‚å¸¸ï¼Œåˆ™å†…å­˜ä¸ä¼šè¢«é‡Šæ”¾ã€‚</p><p><strong>ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„é‡Šæ”¾æ“ä½œ</strong><br>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª shared_ptr æ—¶ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªæŒ‡å‘åˆ é™¤å™¨å‡½æ•°çš„å‚æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">shared_ptr&lt;connection&gt; <span class="hljs-title">p</span><span class="hljs-params">(&amp;c, end_connection)</span></span>;<br></code></pre></td></tr></table></figure><p>å½“ p è¢«é”€æ¯æ—¶ï¼Œå®ƒä¸ä¼šå¯¹è‡ªå·±ä¿å­˜çš„æŒ‡é’ˆæ‰§è¡Œ deleteï¼Œè€Œæ˜¯è°ƒç”¨ end_connectionã€‚</p><h3 id="12-1-5-unique-ptr"><a href="#12-1-5-unique-ptr" class="headerlink" title="12.1.5 unique_ptr"></a>12.1.5 unique_ptr</h3><p>æŸä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ª unique_ptr æŒ‡å‘ä¸€ä¸ªç»™å®šå¯¹è±¡ã€‚åˆå§‹åŒ– unique_ptr å¿…é¡»é‡‡ç”¨ç›´æ¥åˆå§‹åŒ–å½¢å¼ã€‚unique_ptr ä¸æ”¯æŒæ™®é€šçš„æ‹·è´æˆ–èµ‹å€¼æ“ä½œã€‚</p><p><strong>ä¼ é€’ unique_ptr å‚æ•°å’Œè¿”å› unique_ptr</strong><br>æœ‰ä¸€ä¸ªä¾‹å¤–ï¼šæˆ‘ä»¬å¯ä»¥æ‹·è´æˆ–èµ‹å€¼ä¸€ä¸ªå°†è¦è¢«é”€æ¯çš„ unique_ptrã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">uniqueä¸€<span class="hljs-function">ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">clone</span><span class="hljs-params">(<span class="hljs-type">int</span> p)</span> </span>&#123;<br><span class="hljs-comment">// æ­£ç¡®ï¼šä» int* åˆ›å»ºä¸€ä¸ª unique_ptr&lt;int&gt;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">unique_ptr</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(p));<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥è¿”å›ä¸€ä¸ªå±€éƒ¨å¯¹è±¡çš„æ‹·è´</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">clone</span> <span class="hljs-params">(<span class="hljs-type">int</span> p)</span> </span>&#123;<br>    <span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ret</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span> (p))</span></span>;<br>    <span class="hljs-comment">//â€¦ </span><br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å‘ unique_ptr ä¼ é€’åˆ é™¤å™¨</strong><br>unique_ptr é»˜è®¤æƒ…å†µä¸‹ç”¨ delete é‡Šæ”¾å®ƒæŒ‡å‘çš„å¯¹è±¡ã€‚<br>å¿…é¡»åœ¨å°–æ‹¬å·ä¸­ unique_ptr æŒ‡å‘ç±»å‹ä¹‹åæä¾›åˆ é™¤å™¨ç±»å‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">unique_ptr&lt;objT, delT&gt; <span class="hljs-title">p</span> <span class="hljs-params">(<span class="hljs-keyword">new</span> objT, fun)</span></span>;<br></code></pre></td></tr></table></figure><h3 id="12-1-6-weak-ptr"><a href="#12-1-6-weak-ptr" class="headerlink" title="12.1.6 weak_ptr"></a>12.1.6 weak_ptr</h3><p>weak_ptr æ˜¯ä¸€ç§ä¸æ§åˆ¶æ‰€æŒ‡å‘å¯¹è±¡ç”Ÿå­˜æœŸçš„æ™ºèƒ½æŒ‡é’ˆã€‚åˆ›å»ºä¸€ä¸ª weak_ptr æ—¶ï¼Œè¦ç”¨ä¸€ä¸ª shared_ptr æ¥åˆå§‹åŒ–å®ƒã€‚<br>ç”±äºå¯¹è±¡å¯èƒ½ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ weak_ptr ç›´æ¥è®¿é—®å¯¹è±¡ï¼Œè€Œå¿…é¡»è°ƒç”¨lockæ£€æŸ¥ weak_ptr æŒ‡å‘çš„å¯¹è±¡æ˜¯å¦ä»å­˜åœ¨ã€‚</p><h2 id="12-2-åŠ¨æ€æ•°ç»„"><a href="#12-2-åŠ¨æ€æ•°ç»„" class="headerlink" title="12.2 åŠ¨æ€æ•°ç»„"></a>12.2 åŠ¨æ€æ•°ç»„</h2><h3 id="12-2-1-new-å’Œæ•°ç»„"><a href="#12-2-1-new-å’Œæ•°ç»„" class="headerlink" title="12.2.1 new å’Œæ•°ç»„"></a>12.2.1 new å’Œæ•°ç»„</h3><p><strong>åˆ†é…ä¸€ä¸ªæ•°ç»„ä¼šå¾—åˆ°ä¸€ä¸ªå…ƒç´ ç±»å‹çš„æŒ‡é’ˆ</strong><br>å½“ç”¨ new åˆ†é…ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œæˆ‘ä»¬å¹¶æœªå¾—åˆ°ä¸€ä¸ªæ•°ç»„ç±»å‹çš„å¯¹è±¡ï¼Œè€Œæ˜¯å¾—åˆ°ä¸€ä¸ªæ•°ç»„å…ƒç´ ç±»å‹çš„æŒ‡é’ˆã€‚<br>ç”±äºåˆ†é…çš„å†…å­˜å¹¶ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œå› æ­¤ä¸èƒ½å¯¹åŠ¨æ€æ•°ç»„è°ƒç”¨ begin æˆ– endï¼Œä¹Ÿä¸èƒ½ç”¨èŒƒå›´ forã€‚ </p><p><strong>åŠ¨æ€åˆ†é…ä¸€ä¸ªç©ºæ•°ç»„æ˜¯åˆæ³•çš„</strong><br>å½“æˆ‘ä»¬ç”¨ new åˆ†é…ä¸€ä¸ªå¤§å°ä¸º0çš„æ•°ç»„æ—¶ï¼Œnew è¿”å›ä¸€ä¸ªåˆæ³•çš„éç©ºæŒ‡é’ˆã€‚æ­¤æŒ‡é’ˆä¿è¯ä¸ new è¿”å›çš„å…¶ä»–ä»»ä½•æŒ‡é’ˆéƒ½ä¸ç›¸åŒï¼Œä½†æ­¤æŒ‡é’ˆä¸èƒ½è§£å¼•ç”¨ã€‚</p><p><strong>é‡Šæ”¾åŠ¨æ€æ•°ç»„</strong><br>é”€æ¯ p æŒ‡å‘çš„æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¹¶é‡Šæ”¾å¯¹åº”çš„å†…å­˜ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ æŒ‰é€†åºé”€æ¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">delete</span> [] p; <span class="hljs-comment">// p å¿…é¡»æŒ‡å‘ä¸€ä¸ªåŠ¨æ€åˆ†é…çš„æ•°ç»„æˆ–ä¸ºç©º</span><br></code></pre></td></tr></table></figure><p><strong>æ™ºèƒ½æŒ‡é’ˆå’ŒåŠ¨æ€æ•°ç»„</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>[]&gt; <span class="hljs-title">p</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">10</span>])</span></span>;<br>p.<span class="hljs-built_in">release</span> (); <span class="hljs-comment">// è‡ªåŠ¨ç”¨ delete [] é”€æ¯å…¶æŒ‡é’ˆ</span><br></code></pre></td></tr></table></figure><p>å¯¹äºæŒ‡å‘æ•°ç»„çš„ unique_ptr æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ç‚¹å’Œç®­å¤´æˆå‘˜è¿ç®—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹æ ‡è¿ç®—ç¬¦æ¥è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ ã€‚<br>shared_ptr ä¸ç›´æ¥æ”¯æŒç®¡ç†åŠ¨æ€æ•°ç»„ã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨ shared_ptr ç®¡ç†ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œå¿…é¡»æä¾›è‡ªå·±å®šä¹‰çš„åˆ é™¤å™¨ã€‚<br>shared_ptr æœªå®šä¹‰ä¸‹æ ‡è¿ç®—ç¬¦ï¼Œè€Œä¸”æ™ºèƒ½æŒ‡é’ˆç±»å‹ä¸æ”¯æŒæŒ‡é’ˆç®—æœ¯è¿ç®—ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i != <span class="hljs-number">10</span>; ++i) &#123;<br>    *(sp.<span class="hljs-built_in">get</span>() + i) = i; <span class="hljs-comment">// ä½¿ç”¨getè·å–ä¸€ä¸ªå†…ç½®æŒ‡é’ˆ</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="12-2-2-allocator-ç±»"><a href="#12-2-2-allocator-ç±»" class="headerlink" title="12.2.2 allocator ç±»"></a>12.2.2 allocator ç±»</h3><p>allocator åˆ†é…çš„å†…å­˜æ˜¯åŸå§‹çš„ã€æœªæ„é€ çš„ã€‚construct æˆå‘˜å‡½æ•°æ¥å—ä¸€ä¸ªæŒ‡é’ˆå’Œé›¶ä¸ªæˆ–å¤šä¸ªé¢å¤–å‚æ•°ï¼Œåœ¨ç»™å®šä½ç½®æ„é€ ä¸€ä¸ªå…ƒç´ ã€‚é¢å¤–å‚æ•°ç”¨æ¥åˆå§‹åŒ–æ„é€ çš„å¯¹è±¡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">allocator&lt;string&gt; alloc; <span class="hljs-comment">// å¯ä»¥åˆ†é… string çš„ allocator å¯¹è±¡</span><br><span class="hljs-keyword">auto</span> <span class="hljs-type">const</span> p = alloc.<span class="hljs-built_in">allocate</span>(n); <span class="hljs-comment">// åˆ†é… n ä¸ªæœªåˆå§‹åŒ–çš„ string</span><br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ç”¨å®Œå¯¹è±¡åï¼Œå¿…é¡»å¯¹æ¯ä¸ªæ„é€ çš„å…ƒç´ è°ƒç”¨ destroy æ¥é”€æ¯å®ƒä»¬ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> q = p; <span class="hljs-comment">// q æŒ‡å‘æœ€åæ„é€ çš„å…ƒç´ ä¹‹åçš„ä½ç½®</span><br>alloc.<span class="hljs-built_in">construct</span>(q++, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;c&#x27;</span>) <span class="hljs-comment">// *q ä¸º cccccccccc</span><br><span class="hljs-keyword">while</span> (q != p) &#123;<br>    alloc. <span class="hljs-built_in">destroy</span> (--q) ;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡Šæ”¾å†…å­˜é€šè¿‡è°ƒç”¨ deallocate æ¥å®Œæˆã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">alloc.<span class="hljs-built_in">deallocate</span>(p, n); <span class="hljs-comment">// n å°±æ˜¯ allocate(n) æ—¶çš„å¤§å°</span><br></code></pre></td></tr></table></figure><h1 id="ç¬¬åä¸‰ç« -æ‹·è´æ§åˆ¶"><a href="#ç¬¬åä¸‰ç« -æ‹·è´æ§åˆ¶" class="headerlink" title="ç¬¬åä¸‰ç«  æ‹·è´æ§åˆ¶"></a>ç¬¬åä¸‰ç«  æ‹·è´æ§åˆ¶</h1><h2 id="13-1-æ‹·è´ã€èµ‹å€¼ä¸é”€æ¯"><a href="#13-1-æ‹·è´ã€èµ‹å€¼ä¸é”€æ¯" class="headerlink" title="13.1 æ‹·è´ã€èµ‹å€¼ä¸é”€æ¯"></a>13.1 æ‹·è´ã€èµ‹å€¼ä¸é”€æ¯</h2><h3 id="13-1-1-æ‹·è´æ„é€ å‡½æ•°"><a href="#13-1-1-æ‹·è´æ„é€ å‡½æ•°" class="headerlink" title="13.1.1 æ‹·è´æ„é€ å‡½æ•°"></a>13.1.1 æ‹·è´æ„é€ å‡½æ•°</h3><p>å¦‚æœä¸€ä¸ªæ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è‡ªèº«ç±»ç±»å‹çš„å¼•ç”¨ï¼Œä¸”ä»»ä½•é¢å¤–å‚æ•°éƒ½æœ‰é»˜è®¤å€¼ï¼Œ åˆ™æ­¤æ„é€ å‡½æ•°æ˜¯æ‹·è´æ„é€ å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Foo</span> (<span class="hljs-type">const</span> Foo&amp;); <span class="hljs-comment">//æ‹·è´æ„é€ å‡½æ•°</span><br>&#125;ï¼›<br></code></pre></td></tr></table></figure><p><strong>åˆæˆæ‹·è´æ„é€ å‡½æ•°</strong><br>åˆæˆçš„æ‹·è´æ„é€ å‡½æ•°ä¼šå°†å…¶å‚æ•°çš„æˆå‘˜é€ä¸ªæ‹·è´åˆ°æ­£åœ¨åˆ›å»ºçš„å¯¹è±¡ä¸­ï¼Œå¹¶ä¸”ä¼šé€å…ƒç´ åœ°æ‹·è´ä¸€ä¸ªæ•°ç»„ç±»å‹çš„æˆå‘˜ã€‚</p><h3 id="13-1-3-ææ„å‡½æ•°"><a href="#13-1-3-ææ„å‡½æ•°" class="headerlink" title="13.1.3 ææ„å‡½æ•°"></a>13.1.3 ææ„å‡½æ•°</h3><p>ææ„å‡½æ•°çš„åå­—ç”±æ³¢æµªå·æ¥ç±»åæ„æˆï¼Œå®ƒæ²¡æœ‰è¿”å›å€¼ï¼Œä¸æ¥å—å‚æ•°ï¼Œä¹Ÿä¸èƒ½è¢«é‡è½½ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    ã€œ<span class="hljs-built_in">Foo</span>(); <span class="hljs-comment">//ææ„å‡½æ•°</span><br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>ææ„å‡½æ•°å®Œæˆä»€ä¹ˆå·¥ä½œ</strong><br>åœ¨ä¸€ä¸ªææ„å‡½æ•°ä¸­ï¼Œé¦–å…ˆæ‰§è¡Œå‡½æ•°ä½“ï¼Œç„¶åé”€æ¯æˆå‘˜ã€‚æˆå‘˜æŒ‰åˆå§‹åŒ–é¡ºåºçš„é€†åºé”€æ¯ã€‚<br>æˆå‘˜é”€æ¯æ—¶å‘ç”Ÿä»€ä¹ˆå®Œå…¨ä¾èµ–äºæˆå‘˜çš„ç±»å‹ã€‚é”€æ¯ç±»ç±»å‹çš„æˆå‘˜éœ€è¦æ‰§è¡Œæˆå‘˜è‡ªå·±çš„ææ„å‡½æ•°ã€‚å†…ç½®ç±»å‹æ²¡æœ‰ææ„å‡½æ•°ï¼Œå› æ­¤é”€æ¯å†…ç½®ç±»å‹æˆå‘˜ä»€ä¹ˆä¹Ÿä¸éœ€è¦åšã€‚<br>éšå¼é”€æ¯ä¸€ä¸ªå†…ç½®æŒ‡é’ˆç±»å‹çš„æˆå‘˜ä¸ä¼šdeleteå®ƒæ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚ä¸æ™®é€šæŒ‡é’ˆä¸åŒï¼Œæ™ºèƒ½æŒ‡é’ˆæˆå‘˜åœ¨ææ„é˜¶æ®µä¼šè¢«è‡ªåŠ¨é”€æ¯ã€‚</p><p><strong>ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨ææ„å‡½æ•°</strong><br>æ— è®ºä½•æ—¶ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨å…¶ææ„å‡½æ•°ã€‚<br>å½“æŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æˆ–æŒ‡é’ˆç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œææ„å‡½æ•°ä¸ä¼šæ‰§è¡Œã€‚</p><p><strong>åˆæˆææ„å‡½æ•°</strong><br>ææ„å‡½æ•°ä½“è‡ªèº«å¹¶ä¸ç›´æ¥é”€æ¯æˆå‘˜ï¼Œæˆå‘˜æ˜¯åœ¨ææ„å‡½æ•°ä½“ä¹‹åéšå«çš„ææ„é˜¶æ®µä¸­è¢«é”€æ¯çš„ã€‚</p><h3 id="13-1-4-ä¸‰-äº”æ³•åˆ™"><a href="#13-1-4-ä¸‰-äº”æ³•åˆ™" class="headerlink" title="13.1.4 ä¸‰&#x2F;äº”æ³•åˆ™"></a>13.1.4 ä¸‰&#x2F;äº”æ³•åˆ™</h3><p><strong>éœ€è¦ææ„å‡½æ•°çš„ç±»ä¹Ÿéœ€è¦æ‹·è´å’Œèµ‹å€¼æ“ä½œ</strong><br>åˆæˆææ„å‡½æ•°ä¸ä¼šdeleteâ€”ä¸ªæŒ‡é’ˆæ•°æ®æˆå‘˜ã€‚å› æ­¤ï¼Œæ­¤ç±»éœ€è¦å®šä¹‰ä¸€ä¸ªææ„å‡½æ•°æ¥é‡Šæ”¾æ„é€ å‡½æ•°åˆ†é…çš„å†…å­˜ã€‚</p><p><strong>åˆæˆçš„æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´</strong><br>èµ‹å€¼è¿ç®—ç¬¦ç®€å•æ‹·è´æŒ‡é’ˆæˆå‘˜ï¼Œè¿™æ„å‘³ç€å¤šä¸ªæŒ‡é’ˆå¯èƒ½æŒ‡å‘ç›¸åŒçš„å†…å­˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">HasPtr <span class="hljs-title">f</span> <span class="hljs-params">(HasPtr hp)</span> &#125; <span class="hljs-comment">// HasPtr æ˜¯ä¼ å€¼å‚æ•°ï¼Œæ‰€ä»¥å°†è¢«æ‹·è´</span></span><br><span class="hljs-function">    HasPtr ret </span>= hp; <span class="hljs-comment">// æ‹·è´ç»™å®šçš„ HasPtr</span><br>    <span class="hljs-keyword">return</span> ret;<span class="hljs-comment">// ret å’Œ hp è¢«é”€æ¯</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ f è¿”å›æ—¶ï¼Œhp å’Œ ret éƒ½è¢«é”€æ¯ã€‚æ­¤ä»£ç ä¼šå¯¼è‡´æ­¤æŒ‡é’ˆè¢« delete ä¸¤æ¬¡ï¼Œå°†è¦å‘ç”Ÿä»€ä¹ˆæ˜¯æœªå®šä¹‰çš„ã€‚</p><p><strong>éœ€è¦æ‹·è´æ¡ä½œçš„ç±»ä¹Ÿéœ€è¦èµ‹å€¼æ“ä½œï¼Œåä¹‹äº¦ç„¶</strong></p><h3 id="13-1-5-ä½¿ç”¨-default"><a href="#13-1-5-ä½¿ç”¨-default" class="headerlink" title="13.1.5 ä½¿ç”¨ &#x3D;default"></a>13.1.5 ä½¿ç”¨ &#x3D;default</h3><p>å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›åˆæˆçš„æˆå‘˜æ˜¯å†…è”å‡½æ•°ï¼Œåº”è¯¥åªå¯¹æˆå‘˜çš„ç±»å¤–å®šä¹‰ä½¿ç”¨ &#x3D;defaultã€‚</p><h3 id="13-1-6-é˜»æ­¢æ‹·è´-delete"><a href="#13-1-6-é˜»æ­¢æ‹·è´-delete" class="headerlink" title="13.1.6 é˜»æ­¢æ‹·è´ &#x3D;delete"></a>13.1.6 é˜»æ­¢æ‹·è´ &#x3D;delete</h3><p>å¯ä»¥å°†æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦å®šä¹‰ä¸ºåˆ é™¤çš„å‡½æ•°æ¥é˜»æ­¢æ‹·è´ã€‚æˆ‘ä»¬è™½ç„¶å£°æ˜äº†åˆ é™¤çš„å‡½æ•°ï¼Œä½†ä¸èƒ½ä»¥ä»»ä½•æ–¹å¼ä½¿ç”¨å®ƒä»¬ã€‚<br>ä¸ &#x3D;default ä¸åŒï¼Œ&#x3D;delete å¿…é¡»å‡ºç°åœ¨å‡½æ•°ç¬¬ä¸€æ¬¡å£°æ˜çš„æ—¶å€™ã€‚</p><p><strong>ææ„å‡½æ•°ä¸èƒ½æ˜¯åˆ é™¤çš„æˆå‘˜</strong><br>å¯¹äºä¸€ä¸ªåˆ é™¤äº†ææ„å‡½æ•°çš„ç±»å‹ï¼Œç¼–è¯‘å™¨å°†ä¸å…è®¸å®šä¹‰è¯¥ç±»å‹çš„å˜é‡æˆ–åˆ›å»ºè¯¥ç±»çš„ä¸´æ—¶å¯¹è±¡ã€‚<br>å¦‚æœä¸€ä¸ªç±»æœ‰æŸä¸ªæˆå‘˜çš„ç±»å‹åˆ é™¤äº†ææ„å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½å®šä¹‰è¯¥ç±»çš„å˜é‡æˆ–ä¸´æ—¶å¯¹è±¡ã€‚<br>å¯¹äºåˆ é™¤äº†ææ„å‡½æ•°çš„ç±»å‹ï¼Œè™½ç„¶æˆ‘ä»¬ä¸èƒ½å®šä¹‰è¿™ç§ç±»å‹çš„å˜é‡æˆ–æˆå‘˜ï¼Œä½†å¯ä»¥åŠ¨æ€åˆ†é…è¿™ç§ç±»å‹çš„å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œä¸èƒ½é‡Šæ”¾è¿™äº›å¯¹è±¡ã€‚</p><p><strong>åˆæˆçš„æ‹·è´æ§åˆ¶æˆå‘˜å¯èƒ½æ˜¯åˆ é™¤çš„</strong><br>å¦‚æœä¸€ä¸ªç±»æœ‰æ•°æ®æˆå‘˜ä¸èƒ½é»˜è®¤æ„é€ ã€æ‹·è´ã€å¤åˆ¶æˆ–é”€æ¯ï¼Œåˆ™å¯¹åº”çš„æˆå‘˜å‡½æ•°å°†è¢«å®šä¹‰ä¸ºåˆ é™¤çš„ã€‚</p><h2 id="13-2-æ‹·è´æ§åˆ¶å’Œèµ„æºç®¡ç†"><a href="#13-2-æ‹·è´æ§åˆ¶å’Œèµ„æºç®¡ç†" class="headerlink" title="13.2 æ‹·è´æ§åˆ¶å’Œèµ„æºç®¡ç†"></a>13.2 æ‹·è´æ§åˆ¶å’Œèµ„æºç®¡ç†</h2><p>é€šå¸¸ï¼Œç®¡ç†ç±»å¤–èµ„æºçš„ç±»å¿…é¡»å®šä¹‰æ‹·è´æ§åˆ¶æˆå‘˜ã€‚</p><h3 id="13-2-1-è¡Œä¸ºåƒå€¼çš„ç±»"><a href="#13-2-1-è¡Œä¸ºåƒå€¼çš„ç±»" class="headerlink" title="13.2.1 è¡Œä¸ºåƒå€¼çš„ç±»"></a>13.2.1 è¡Œä¸ºåƒå€¼çš„ç±»</h3><p><strong>ç±»å€¼æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</strong><br>ç±»ä¼¼ææ„å‡½æ•°ï¼Œèµ‹å€¼æ“ä½œä¼šé”€æ¯å·¦ä¾§è¿ç®—å¯¹è±¡çš„èµ„æºã€‚ç±»ä¼¼æ‹·è´æ„é€ å‡½æ•°ï¼Œèµ‹å€¼æ“ä½œä¼šä»å³ä¾§è¿ç®—å¯¹è±¡æ‹·è´æ•°æ®ã€‚<br>å¦‚æœå°†ä¸€ä¸ªå¯¹è±¡èµ‹äºˆå®ƒè‡ªèº«ï¼Œèµ‹å€¼è¿ç®—ç¬¦å¿…é¡»èƒ½æ­£ç¡®å·¥ä½œã€‚<br>å¤§å¤šæ•°èµ‹å€¼è¿ç®—ç¬¦ç»„åˆäº†ææ„å‡½æ•°å’Œæ‹·è´æ„é€ å‡½æ•°çš„å·¥ä½œï¼Œå½“å³ä¾§æ‹·è´å®Œæˆåï¼Œé”€æ¯å·¦ä¾§è¿ç®—å¯¹è±¡çš„ç°æœ‰æˆå‘˜å°±æ˜¯å®‰å…¨çš„äº†ã€‚</p><h3 id="13-2-2-å®šä¹‰è¡Œä¸ºåƒæŒ‡é’ˆçš„ç±»"><a href="#13-2-2-å®šä¹‰è¡Œä¸ºåƒæŒ‡é’ˆçš„ç±»" class="headerlink" title="13.2.2 å®šä¹‰è¡Œä¸ºåƒæŒ‡é’ˆçš„ç±»"></a>13.2.2 å®šä¹‰è¡Œä¸ºåƒæŒ‡é’ˆçš„ç±»</h3><p>ä»¤ä¸€ä¸ªç±»å±•ç°ç±»ä¼¼æŒ‡é’ˆçš„è¡Œä¸ºçš„æœ€å¥½æ–¹æ³•æ˜¯ä½¿ç”¨ shared_ptr æ¥ç®¡ç†ç±»ä¸­çš„èµ„æºã€‚</p><h2 id="13-6-å¯¹è±¡ç§»åŠ¨"><a href="#13-6-å¯¹è±¡ç§»åŠ¨" class="headerlink" title="13.6 å¯¹è±¡ç§»åŠ¨"></a>13.6 å¯¹è±¡ç§»åŠ¨</h2><p>åœ¨é‡æ–°åˆ†é…å†…å­˜çš„è¿‡ç¨‹ä¸­ï¼Œä»æ—§å†…å­˜å°†å…ƒç´ æ‹·è´åˆ°æ–°å†…å­˜æ˜¯ä¸å¿…è¦çš„ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯ç§»åŠ¨å…ƒç´ ã€‚<br>ä½¿ç”¨ç§»åŠ¨è€Œä¸æ˜¯æ‹·è´çš„å¦ä¸€ä¸ªåŸå› æºäº IO ç±»æˆ– unique_ptr è¿™æ ·çš„ç±»éƒ½åŒ…å«ä¸èƒ½è¢«å…±äº«çš„èµ„æºï¼ˆå¦‚æŒ‡é’ˆæˆ–IOç¼“å†²ï¼‰ã€‚å› æ­¤ï¼Œè¿™äº›ç±»å‹å¯¹è±¡ä¸èƒ½æ‹·è´ä½†å¯ä»¥ç§»åŠ¨ã€‚</p><h3 id="13-6-1-å³å€¼å¼•ç”¨"><a href="#13-6-1-å³å€¼å¼•ç”¨" class="headerlink" title="13.6.1 å³å€¼å¼•ç”¨"></a>13.6.1 å³å€¼å¼•ç”¨</h3><p>å³å€¼å¼•ç”¨åªèƒ½ç»‘å®šåˆ°ä¸€ä¸ªå°†è¦é”€æ¯çš„å¯¹è±¡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> i = <span class="hljs-number">42</span>;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> &amp;r = i * <span class="hljs-number">42</span>; <span class="hljs-comment">// æ­£ç¡®ï¼šæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ª const çš„å¼•ç”¨ç»‘å®šåˆ°ä¸€ä¸ªå³å€¼ä¸Š</span><br><span class="hljs-type">int</span> &amp;&amp;rr = i * <span class="hljs-number">42</span>; <span class="hljs-comment">// æ­£ç¡®ï¼šå°† rr ç»‘å®šåˆ°ä¹˜æ³•ç»“æœä¸Š</span><br></code></pre></td></tr></table></figure><p><strong>å·¦å€¼æŒä¹…ï¼›å³å€¼çŸ­æš‚</strong></p><ul><li>æ‰€å¼•ç”¨çš„å¯¹è±¡å°†è¦è¢«é”€æ¯</li><li>è¯¥å¯¹è±¡æ²¡æœ‰å…¶ä»–ç”¨æˆ·</li></ul><p>è¿™ä¸¤ä¸ªç‰¹æ€§æ„å‘³ç€ï¼šä½¿ç”¨å³å€¼å¼•ç”¨çš„ä»£ç å¯ä»¥è‡ªç”±åœ°æ¥ç®¡æ‰€å¼•ç”¨çš„å¯¹è±¡çš„èµ„æºã€‚</p><p><strong>å˜é‡æ˜¯å·¦å€¼</strong><br>å˜é‡è¡¨è¾¾å¼éƒ½æ˜¯å·¦å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å°†ä¸€ä¸ªå³å€¼å¼•ç”¨ç»‘å®šåˆ°ä¸€ä¸ªå³å€¼å¼•ç”¨ç±»å‹çš„å˜é‡ä¸Šã€‚</p><p><strong>æ ‡å‡†åº“ move å‡½æ•°</strong><br>å¯ä»¥æ˜¾å¼åœ°å°†ä¸€ä¸ªå·¦å€¼è½¬æ¢ä¸ºå¯¹åº”çš„å³å€¼å¼•ç”¨ç±»å‹ã€‚<br>è¿˜å¯ä»¥é€šè¿‡è°ƒç”¨ä¸€ä¸ªåä¸º move çš„æ–°æ ‡å‡†åº“å‡½æ•°æ¥è·å¾—ç»‘å®šåˆ°å·¦å€¼ä¸Šçš„å³å€¼å¼•ç”¨ã€‚<br>move è°ƒç”¨å‘Šè¯‰ç¼–è¯‘å™¨ï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªå·¦å€¼ï¼Œä½†æˆ‘ä»¬å¸Œæœ›åƒä¸€ä¸ªå³å€¼ä¸€æ ·å¤„ç†å®ƒã€‚<br>è°ƒç”¨ move å°±æ„å‘³ç€æ‰¿è¯ºï¼šé™¤äº†å¯¹rrlèµ‹å€¼æˆ–é”€æ¯å®ƒå¤–ï¼Œæˆ‘ä»¬å°†ä¸å†ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬ä¸èƒ½å¯¹ç§»åæºå¯¹è±¡çš„å€¼åšä»»ä½•å‡è®¾ã€‚<br>æˆ‘ä»¬å¯ä»¥é”€æ¯ä¸€ä¸ªç§»åæºå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥èµ‹äºˆå®ƒæ–°å€¼ï¼Œä½†ä¸èƒ½ä½¿ç”¨ä¸€ä¸ªç§»åæºå¯¹è±¡çš„å€¼ã€‚</p><h3 id="13-6-2-ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦"><a href="#13-6-2-ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦" class="headerlink" title="13.6.2 ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦"></a>13.6.2 ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</h3><p>ä¸ºäº†è®©æˆ‘ä»¬è‡ªå·±çš„ç±»å‹æ”¯æŒç§»åŠ¨æ“ä½œï¼Œéœ€è¦ä¸ºå…¶å®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼Œå®ƒä»¬ä»ç»™å®šå¯¹è±¡â€œçªƒå–â€èµ„æºè€Œä¸æ˜¯æ‹·è´èµ„æºã€‚<br>ç§»åŠ¨æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯¥ç±»ç±»å‹çš„ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œä»»ä½•é¢å¤–çš„å‚æ•°éƒ½å¿…é¡»æœ‰é»˜è®¤å®å‚ã€‚<br>ç§»åŠ¨æ„é€ å‡½æ•°è¿˜å¿…é¡»ç¡®ä¿é”€æ¯ç§»åæºå¯¹è±¡æ˜¯æ— å®³çš„ã€‚ä¸€æ—¦èµ„æºå®Œæˆç§»åŠ¨ï¼Œæºå¯¹è±¡å¿…é¡»ä¸å†æŒ‡å‘è¢«ç§»åŠ¨çš„èµ„æºã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp">StrVec::<span class="hljs-built_in">StrVec</span> (StrVec &amp;&amp;s) <span class="hljs-keyword">noexcept</span><br>:<span class="hljs-built_in">elements</span>(s.elements), <span class="hljs-built_in">first_free</span>(s.first_free), <span class="hljs-built_in">cap</span>(s.cap)<br>&#123;<br>    <span class="hljs-comment">// ä»¤ s è¿›å…¥è¿™æ ·çš„çŠ¶æ€ï¼šå¯¹å…¶è¿è¡Œææ„å‡½æ•°æ˜¯å®‰å…¨çš„</span><br>    s.elements = s.first_free = s.cap = <span class="hljs-literal">nullptr</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç§»åŠ¨æ“ä½œã€æ ‡å‡†åº“å®¹å™¨å’Œå¼‚å¸¸</strong><br>é™¤éæ ‡å‡†åº“çŸ¥é“æˆ‘ä»¬çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™å®ƒä¼šè®¤ä¸ºç§»åŠ¨æˆ‘ä»¬çš„ç±»å¯¹è±¡æ—¶å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”ä¸ºäº†å¤„ç†è¿™ç§å¯èƒ½æ€§è€Œåšä¸€äº›é¢å¤–çš„å·¥ä½œã€‚<br>noexcept æ˜¯æˆ‘ä»¬æ‰¿è¯ºä¸€ä¸ªå‡½æ•°ä¸æŠ›å‡ºå¼‚å¸¸çš„ä¸€ç§æ–¹æ³•ã€‚åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°ä¸­ï¼Œnoexcept å‡ºç°åœ¨å‚æ•°åˆ—è¡¨å’Œåˆå§‹åŒ–åˆ—è¡¨å¼€å§‹çš„å†’å·ä¹‹é—´ã€‚<br>å¦‚æœé‡æ–°åˆ†é…è¿‡ç¨‹ä½¿ç”¨äº†ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä¸”åœ¨ç§»åŠ¨äº†éƒ¨åˆ†è€Œä¸æ˜¯å…¨éƒ¨å…ƒç´ åæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œå°±ä¼šäº§ç”Ÿé—®é¢˜ï¼šæ—§ç©ºé—´ä¸­çš„ç§»åŠ¨æºå…ƒç´ å·²ç»è¢«æ”¹å˜äº†ï¼Œè€Œæ–°ç©ºé—´ä¸­æœªæ„é€ çš„å…ƒç´ å¯èƒ½å°šä¸å­˜åœ¨ã€‚<br>ä¸ºäº†é¿å…è¿™ç§æ½œåœ¨é—®é¢˜ï¼Œé™¤é vector çŸ¥é“å…ƒç´ ç±»å‹çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œ å¦åˆ™åœ¨é‡æ–°åˆ†é…å†…å­˜çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒå°±å¿…é¡»ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°è€Œä¸æ˜¯ç§»åŠ¨æ„é€ å‡½æ•°ã€‚å¦‚æœå¸Œæœ›åœ¨ vector é‡æ–°åˆ†é…å†…å­˜è¿™ç±»æƒ…å†µä¸‹å¯¹æˆ‘ä»¬è‡ªå®šä¹‰ç±»å‹çš„å¯¹è±¡è¿›è¡Œç§»åŠ¨è€Œä¸æ˜¯æ‹·è´ï¼Œå°±å¿…é¡»æ˜¾å¼åœ°å‘Šè¯‰æ ‡å‡†åº“æˆ‘ä»¬çš„ç§»åŠ¨æ„é€ å‡½æ•°å¯ä»¥å®‰å…¨ä½¿ç”¨ã€‚æˆ‘ä»¬é€šè¿‡å°†ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆåŠç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼‰æ ‡è®°ä¸º noexcept æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p><strong>ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</strong><br>ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ä¸æŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦å¿…é¡»æ­£ç¡®å¤„ç†è‡ªèµ‹å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp">StrVec StrVec::<span class="hljs-keyword">operator</span>=(StrVec &amp;&amp;rhs) <span class="hljs-keyword">noexcept</span> &#123;<br>    <span class="hljs-comment">// ç›´æ¥æ£€æµ‹è‡ªè³¦å€¼</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != &amp;rhs) &#123;<br>        <span class="hljs-built_in">free</span>();<br>        elements = rhs.elements; <span class="hljs-comment">// ä» rhs æ¥ç®¡èµ„æº</span><br>        first_free = rhs.first_free;<br>        cap = rhs.cap;<br>        <span class="hljs-comment">// å°† rhs ç½®äºå¯ææ„çŠ¶æ€</span><br>        rhs.elements = rhs.first_free = rhs.cap = <span class="hljs-literal">nullptr</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç§»åæºå¯¹è±¡å¿…é¡»å¯ææ„</strong><br>åœ¨ç§»åŠ¨æ“ä½œä¹‹åï¼Œç§»åæºå¯¹è±¡å¿…é¡»ä¿æŒæœ‰æ•ˆçš„ã€å¯ææ„çš„çŠ¶æ€ï¼Œä½†æ˜¯ç”¨æˆ·ä¸èƒ½å¯¹å…¶å€¼è¿›è¡Œä»»ä½•å‡è®¾</p><p><strong>åˆæˆçš„ç§»åŠ¨æ“ä½œ</strong><br>å¦‚æœä¸€ä¸ªç±»å®šä¹‰äº†è‡ªå·±çš„æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦æˆ–è€…ææ„å‡½æ•°ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šä¸ºå®ƒåˆæˆç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦äº†ã€‚<br>åªæœ‰å½“ä¸€ä¸ªç±»æ²¡æœ‰å®šä¹‰ä»»ä½•è‡ªå·±ç‰ˆæœ¬çš„æ‹·è´æ§åˆ¶æˆå‘˜ï¼Œä¸”ç±»çš„æ¯ä¸ªé static æ•°æ®æˆ å‘˜éƒ½å¯ä»¥ç§»åŠ¨æ—¶ï¼Œç¼–è¯‘å™¨æ‰ä¼šä¸ºå®ƒåˆæˆç§»åŠ¨æ„é€ å‡½æ•°æˆ–ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ã€‚ç¼–è¯‘å™¨å¯ä»¥ç§»åŠ¨å†…ç½®ç±»å‹çš„æˆå‘˜ã€‚å¦‚æœä¸€ä¸ªæˆå‘˜æ˜¯ç±»ç±»å‹ï¼Œä¸”è¯¥ç±»æœ‰å¯¹åº”çš„ç§»åŠ¨æ“ä½œï¼Œç¼–è¯‘å™¨ä¹Ÿèƒ½ç§»åŠ¨è¿™ä¸ªæˆå‘˜ã€‚<br>ç§»åŠ¨æ“ä½œæ°¸è¿œä¸ä¼šéšå¼å®šä¹‰ä¸ºåˆ é™¤çš„å‡½æ•°ï¼Œå¦‚æœæˆ‘ä»¬æ˜¾å¼åœ°è¦æ±‚ç¼–è¯‘å™¨ç”Ÿæˆ &#x3D;default çš„ç§»åŠ¨æ“ä½œï¼Œä¸”ç¼–è¯‘å™¨ä¸èƒ½ç§»åŠ¨æ‰€æœ‰æˆå‘˜ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šå°†ç§»åŠ¨æ“ä½œå®šä¹‰ä¸ºåˆ é™¤çš„å‡½æ•°ã€‚<br>å¦‚æœç±»å®šä¹‰äº†ä¸€ä¸ªç§»åŠ¨æ„é€ å‡½æ•°å’Œ&#x2F;æˆ–ä¸€ä¸ªç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼Œåˆ™è¯¥ç±»çš„åˆæˆæ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ä¼šè¢«å®šä¹‰ä¸ºåˆ é™¤çš„ã€‚</p><p><strong>ç§»åŠ¨å³å€¼ï¼Œæ‹·è´å·¦å€¼â€¦â€¦</strong><br>å¦‚æœä¸€ä¸ªç±»æ—¢æœ‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä¹Ÿæœ‰æ‹·è´æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨ä½¿ç”¨æ™®é€šçš„å‡½æ•°åŒ¹é…è§„åˆ™æ¥ç¡®å®šä½¿ç”¨å“ªä¸ªæ„é€ å‡½æ•°ã€‚</p><p><strong>â€¦â€¦ä½†å¦‚æœæ²¡æœ‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå³å€¼ä¹Ÿè¢«æ‹·è´</strong><br>å¦‚æœä¸€ä¸ªç±»æœ‰ä¸€ä¸ªæ‹·è´æ„é€ å‡½æ•°ä½†æœªå®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¸ä¼šåˆæˆç§»åŠ¨æ„é€ å‡½æ•°</p><p><strong>ç§»åŠ¨è¿­ä»£å™¨</strong><br>ç§»åŠ¨è¿­ä»£å™¨é€šè¿‡æ”¹å˜ç»™å®šè¿­ä»£å™¨çš„è§£å¼•ç”¨è¿ç®—ç¬¦çš„è¡Œä¸ºæ¥é€‚é…æ­¤è¿­ä»£å™¨ï¼Œç§»åŠ¨è¿­ä»£å™¨çš„è§£å¼•ç”¨è¿ç®—ç¬¦ç”Ÿæˆä¸€ä¸ªå³å€¼å¼•ç”¨ã€‚<br>é€šè¿‡è°ƒç”¨æ ‡å‡†åº“çš„ make_move_iterator å‡½æ•°å°†ä¸€ä¸ªæ™®é€šè¿­ä»£å™¨è½¬æ¢ä¸ºä¸€ä¸ªç§»åŠ¨è¿­ä»£å™¨ã€‚</p><h3 id="13-6-3-å³å€¼å¼•ç”¨å’Œæˆå‘˜å‡½æ•°"><a href="#13-6-3-å³å€¼å¼•ç”¨å’Œæˆå‘˜å‡½æ•°" class="headerlink" title="13.6.3 å³å€¼å¼•ç”¨å’Œæˆå‘˜å‡½æ•°"></a>13.6.3 å³å€¼å¼•ç”¨å’Œæˆå‘˜å‡½æ•°</h3><p><strong>å³å€¼å’Œå·¦å€¼å¼•ç”¨æˆå‘˜å‡½æ•°</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">sl + s2 = <span class="hljs-string">&quot;wow!&quot;</span><br></code></pre></td></tr></table></figure><p>æ­¤å¤„æˆ‘ä»¬å¯¹ä¸¤ä¸ª string çš„è¿æ¥ç»“æœï¼ˆå³å€¼ï¼‰ï¼Œè¿›è¡Œäº†èµ‹å€¼ã€‚æ–°æ ‡å‡†åº“ç±»ä»ç„¶å…è®¸å‘å³å€¼èµ‹å€¼ï¼Œé˜»æ­¢è¿™ç§ç”¨æ³•çš„æ–¹å¼æ˜¯åœ¨å‚æ•°åˆ—è¡¨åæ”¾ç½®ä¸€ä¸ªå¼•ç”¨é™å®šç¬¦ã€‚<br>å¼•ç”¨é™å®šç¬¦å¯ä»¥æ˜¯ &amp; æˆ– &amp;&amp;ï¼Œåˆ†åˆ«æŒ‡å‡º this å¯ä»¥æŒ‡å‘ä¸€ä¸ªå·¦å€¼æˆ–å³å€¼ã€‚ç±»ä¼¼ const é™å®šç¬¦, å¼•ç”¨é™å®šç¬¦åªèƒ½ç”¨äºï¼ˆé staticï¼‰æˆå‘˜å‡½æ•°ï¼Œä¸”å¿…é¡»åŒæ—¶å‡ºç°åœ¨å‡½æ•°çš„å£°æ˜å’Œå®šä¹‰ä¸­ã€‚å¼•ç”¨é™å®šç¬¦å¿…é¡»è·Ÿéšåœ¨ const é™å®šç¬¦ä¹‹åã€‚</p><p><strong>é‡è½½å’Œå¼•ç”¨å‡½æ•°</strong><br>å¦‚æœæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šå…·æœ‰ç›¸åŒåå­—å’Œç›¸åŒå‚æ•°åˆ—è¡¨çš„æˆå‘˜å‡½æ•°ï¼Œå°±å¿…é¡»å¯¹æ‰€æœ‰å‡½æ•°éƒ½åŠ ä¸Šå¼•ç”¨é™å®šç¬¦ï¼Œæˆ–è€…æ‰€æœ‰éƒ½ä¸åŠ ã€‚</p><h1 id="ç¬¬åå››ç« -é‡è½½è¿ç®—ä¸ç±»å‹è½¬æ¢"><a href="#ç¬¬åå››ç« -é‡è½½è¿ç®—ä¸ç±»å‹è½¬æ¢" class="headerlink" title="ç¬¬åå››ç«  é‡è½½è¿ç®—ä¸ç±»å‹è½¬æ¢"></a>ç¬¬åå››ç«  é‡è½½è¿ç®—ä¸ç±»å‹è½¬æ¢</h1><h2 id="14-1-åŸºæœ¬æ¦‚å¿µ"><a href="#14-1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="14.1 åŸºæœ¬æ¦‚å¿µ"></a>14.1 åŸºæœ¬æ¦‚å¿µ</h2><p>é‡è½½è¿ç®—ç¬¦å‡½æ•°çš„å‚æ•°æ•°é‡ä¸è¯¥è¿ç®—ç¬¦ä½œç”¨çš„è¿ç®—å¯¹è±¡æ•°é‡ä¸€æ ·å¤šã€‚<br>é™¤äº†é‡è½½çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ operator() ä¹‹å¤–ï¼Œå…¶ä»–é‡è½½è¿ç®—ç¬¦ä¸èƒ½å«æœ‰é»˜è®¤å®å‚ã€‚<br>å¦‚æœä¸€ä¸ªè¿ç®—ç¬¦å‡½æ•°æ˜¯æˆå‘˜å‡½æ•°ï¼Œåˆ™å®ƒçš„ç¬¬ä¸€ä¸ªï¼ˆå·¦ä¾§ï¼‰è¿ç®—å¯¹è±¡ç»‘å®šåˆ°éšå¼çš„ this æŒ‡é’ˆä¸Šã€‚<br>å¯¹äºä¸€ä¸ªè¿ç®—ç¬¦å‡½æ•°æ¥è¯´ï¼Œå®ƒæˆ–è€…æ˜¯ç±»çš„æˆå‘˜ï¼Œæˆ–è€…è‡³å°‘å«æœ‰ä¸€ä¸ªç±»ç±»å‹çš„å‚æ•°ï¼Œè¿™æ„å‘³ç€å½“è¿ç®—ç¬¦ä½œç”¨äºå†…ç½®ç±»å‹çš„è¿ç®—å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬æ— æ³•æ”¹å˜è¯¥è¿ç®—ç¬¦çš„å«ä¹‰ã€‚<br>æˆ‘ä»¬æ— æƒå‘æ˜æ–°çš„è¿ç®—ç¬¦å·ã€‚<br>é‡è½½çš„è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§å’Œç»“åˆå¾‹ä¸å¯¹åº”çš„å†…ç½®è¿ç®—ç¬¦ä¿æŒä¸€è‡´ã€‚</p><p><strong>æŸäº›è¿ç®—ç¬¦ä¸åº”è¯¥è¢«é‡è½½</strong><br>å› ä¸ºä½¿ç”¨é‡è½½çš„è¿ç®—ç¬¦æœ¬è´¨ä¸Šæ˜¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ï¼Œæ‰€ä»¥è¿™äº›å…³äºè¿ç®—å¯¹è±¡æ±‚å€¼é¡ºåºçš„è§„åˆ™æ— æ³•åº”ç”¨åˆ°é‡è½½çš„è¿ç®—ç¬¦ä¸Šã€‚</p><p><strong>é€‰æ‹©ä½œä¸ºæˆå‘˜æˆ–è€…éæˆå‘˜</strong></p><ul><li>èµ‹å€¼ã€ä¸‹æ ‡ã€è°ƒç”¨å’Œæˆå‘˜è®¿é—®ç®­å¤´è¿ç®—ç¬¦å¿…é¡»æ˜¯æˆå‘˜</li><li>å¤åˆèµ‹å€¼è¿ç®—ç¬¦ä¸€èˆ¬æ¥è¯´åº”è¯¥æ˜¯æˆå‘˜</li><li>æ”¹å˜å¯¹è±¡çŠ¶æ€çš„è¿ç®—ç¬¦æˆ–è€…ä¸ç»™å®šç±»å‹å¯†åˆ‡ç›¸å…³çš„è¿ç®—ç¬¦ï¼Œé€šå¸¸åº”è¯¥æ˜¯æˆå‘˜</li><li>å…·æœ‰å¯¹ç§°æ€§çš„è¿ç®—ç¬¦å¯èƒ½è½¬æ¢ä»»æ„ä¸€ç«¯çš„è¿ç®—å¯¹è±¡ï¼Œé€šå¸¸åº”è¯¥æ˜¯æ™®é€šçš„éæˆå‘˜å‡½æ•°</li></ul><p>å½“æˆ‘ä»¬æŠŠè¿ç®—ç¬¦å®šä¹‰æˆæˆå‘˜å‡½æ•°æ—¶ï¼Œå®ƒçš„å·¦ä¾§è¿ç®—å¯¹è±¡å¿…é¡»æ˜¯è¿ç®—ç¬¦æ‰€å±ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚</p><h2 id="14-2-è¾“å…¥å’Œè¾“å‡ºè¿ç®—ç¬¦"><a href="#14-2-è¾“å…¥å’Œè¾“å‡ºè¿ç®—ç¬¦" class="headerlink" title="14.2 è¾“å…¥å’Œè¾“å‡ºè¿ç®—ç¬¦"></a>14.2 è¾“å…¥å’Œè¾“å‡ºè¿ç®—ç¬¦</h2><h3 id="14-2-1-é‡è½½è¾“å‡ºè¿ç®—ç¬¦"><a href="#14-2-1-é‡è½½è¾“å‡ºè¿ç®—ç¬¦" class="headerlink" title="14.2.1 é‡è½½è¾“å‡ºè¿ç®—ç¬¦ &lt;&lt;"></a>14.2.1 é‡è½½è¾“å‡ºè¿ç®—ç¬¦ &lt;&lt;</h3><p>è¾“å‡ºè¿ç®—ç¬¦çš„ç¬¬ä¸€ä¸ªå½¢å‚æ˜¯ä¸€ä¸ªéå¸¸é‡ ostream å¯¹è±¡çš„å¼•ç”¨ï¼Œç¬¬äºŒä¸ªå½¢å‚ä¸€èˆ¬æ¥è¯´æ˜¯ä¸€ä¸ªå¸¸é‡çš„å¼•ç”¨ï¼Œä¸€èˆ¬è¦è¿”å›å®ƒçš„ ostream å½¢å‚ã€‚</p><p><strong>è¾“å…¥è¾“å‡ºè¿ç®—ç¬¦å¿…é¡»æ˜¯éæˆå‘˜å‡½æ•°</strong><br>å¦åˆ™å®ƒå·¦ä¾§çš„è¿ç®—å¯¹è±¡å°†æ˜¯æˆ‘ä»¬çš„ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚<br>IO è¿ç®—ç¬¦é€šå¸¸éœ€è¦è¯»å†™ç±»çš„éå…¬æœ‰æ•°æ®æˆå‘˜ï¼Œæ‰€ä»¥ IO è¿ç®—ç¬¦ä¸€èˆ¬è¢«å£°æ˜ä¸ºå‹å…ƒã€‚</p><h3 id="14-2-2-é‡è½½è¾“äººè¿ç®—ç¬¦"><a href="#14-2-2-é‡è½½è¾“äººè¿ç®—ç¬¦" class="headerlink" title="14.2.2 é‡è½½è¾“äººè¿ç®—ç¬¦ &gt;&gt;"></a>14.2.2 é‡è½½è¾“äººè¿ç®—ç¬¦ &gt;&gt;</h3><p>å¸¸ä¼šè¿”å›æŸä¸ªç»™å®šæµçš„å¼•ç”¨ã€‚<br>è¾“å…¥è¿ç®—ç¬¦å¿…é¡»å¤„ç†è¾“å…¥å¯èƒ½å¤±è´¥çš„æƒ…å†µï¼Œè€Œè¾“å‡ºè¿ç®—ç¬¦ä¸éœ€è¦ã€‚<br>å¦‚æœåœ¨å‘ç”Ÿé”™è¯¯å‰å¯¹è±¡å·²ç»æœ‰ä¸€éƒ¨åˆ†è¢«æ”¹å˜ï¼Œåˆ™é€‚æ—¶åœ°å°†å¯¹è±¡ç½®ä¸ºåˆæ³•çŠ¶æ€æ˜¾å¾—å¼‚å¸¸é‡è¦ã€‚</p><h2 id="14-3-ç®—æœ¯å’Œå…³ç³»è¿ç®—ç¬¦"><a href="#14-3-ç®—æœ¯å’Œå…³ç³»è¿ç®—ç¬¦" class="headerlink" title="14.3 ç®—æœ¯å’Œå…³ç³»è¿ç®—ç¬¦"></a>14.3 ç®—æœ¯å’Œå…³ç³»è¿ç®—ç¬¦</h2><p>é€šå¸¸æŠŠç®—æœ¯å’Œå…³ç³»è¿ç®—ç¬¦å®šä¹‰æˆéæˆå‘˜å‡½æ•°ä»¥å…è®¸å¯¹å·¦ä¾§æˆ–å³ä¾§çš„è¿ç®—å¯¹è±¡è¿›è¡Œè½¬æ¢ã€‚<br>æ“ä½œå®Œæˆåè¿”å›è¯¥å±€éƒ¨å˜é‡çš„å‰¯æœ¬ä½œä¸ºå…¶ç»“æœã€‚<br>å¦‚æœç±»åŒæ—¶å®šä¹‰äº†ç®—æœ¯è¿ç®—ç¬¦å’Œç›¸å…³çš„å¤åˆèµ‹å€¼è¿ç®—ç¬¦ï¼Œåˆ™é€šå¸¸æƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨å¤åˆèµ‹å€¼æ¥å®ç°ç®—æœ¯è¿ç®—ç¬¦ã€‚</p><h3 id="14-3-1-ç›¸ç­‰è¿ç®—ç¬¦"><a href="#14-3-1-ç›¸ç­‰è¿ç®—ç¬¦" class="headerlink" title="14.3.1 ç›¸ç­‰è¿ç®—ç¬¦"></a>14.3.1 ç›¸ç­‰è¿ç®—ç¬¦</h3><p>ç›¸ç­‰è¿ç®—ç¬¦å’Œä¸ç›¸ç­‰è¿ç®—ç¬¦ä¸­çš„ä¸€ä¸ªåº”è¯¥æŠŠå·¥ä½œå§”æ‰˜ç»™å¦å¤–ä¸€ä¸ªã€‚</p><h2 id="14-5-ä¸‹æ ‡è¿ç®—ç¬¦"><a href="#14-5-ä¸‹æ ‡è¿ç®—ç¬¦" class="headerlink" title="14.5 ä¸‹æ ‡è¿ç®—ç¬¦"></a>14.5 ä¸‹æ ‡è¿ç®—ç¬¦</h2><p>å¦‚æœä¸€ä¸ªç±»åŒ…å«ä¸‹æ ‡è¿ç®—ç¬¦ï¼Œåˆ™å®ƒé€šå¸¸ä¼šå®šä¹‰ä¸¤ä¸ªç‰ˆæœ¬ï¼šä¸€ä¸ªè¿”å›æ™®é€šå¼•ç”¨ï¼Œå¦ä¸€ä¸ªæ˜¯ç±»çš„å¸¸é‡æˆå‘˜å¹¶ä¸”è¿”å›å¸¸é‡å¼•ç”¨ã€‚</p><h2 id="14-6-é€’å¢å’Œé€’å‡è¿ç®—ç¬¦"><a href="#14-6-é€’å¢å’Œé€’å‡è¿ç®—ç¬¦" class="headerlink" title="14.6 é€’å¢å’Œé€’å‡è¿ç®—ç¬¦"></a>14.6 é€’å¢å’Œé€’å‡è¿ç®—ç¬¦</h2><p><strong>å®šä¹‰å‰ç½®é€’å¢&#x2F;é€’å‡è¿ç®—ç¬¦</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">StrBlobPtrS <span class="hljs-keyword">operator</span>++(); <span class="hljs-comment">// å‰ç½®è¿ç®—ç¬¦</span><br></code></pre></td></tr></table></figure><p><strong>åŒºåˆ†å‰ç½®å’Œåç½®è¿ç®—ç¬¦</strong><br>åç½®ç‰ˆæœ¬æ¥å—ä¸€ä¸ªé¢å¤–çš„ï¼ˆä¸è¢«ä½¿ç”¨ï¼‰int ç±»å‹çš„å½¢å‚ã€‚å½“æˆ‘ä»¬ä½¿ç”¨åç½®è¿ç®—ç¬¦æ—¶ï¼Œç¼–è¯‘å™¨ä¸ºè¿™ä¸ªå½¢å‚æä¾›ä¸€ä¸ªå€¼ä¸º 0 çš„å®å‚ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">StrBlobPtr <span class="hljs-keyword">operator</span>++(<span class="hljs-type">int</span>); <span class="hljs-comment">// åç½®è¿ç®—ç¬¦</span><br></code></pre></td></tr></table></figure><p><strong>æ˜¾å¼åœ°è°ƒç”¨åç½®è¿ç®—ç¬¦</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">p.<span class="hljs-keyword">operator</span>++(<span class="hljs-number">0</span>); <span class="hljs-comment">// è°ƒç”¨åç½®ç‰ˆæœ¬çš„ operator++</span><br></code></pre></td></tr></table></figure><h2 id="14-7-æˆå‘˜è®¿é—®è¿ç®—ç¬¦"><a href="#14-7-æˆå‘˜è®¿é—®è¿ç®—ç¬¦" class="headerlink" title="14.7 æˆå‘˜è®¿é—®è¿ç®—ç¬¦"></a>14.7 æˆå‘˜è®¿é—®è¿ç®—ç¬¦</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StrBlobPtr</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    std::strings <span class="hljs-keyword">operator</span>*() <span class="hljs-type">const</span> &#123;<br>        <span class="hljs-comment">//...</span><br>    &#125;<br>    std::string* <span class="hljs-keyword">operator</span>-&gt;() <span class="hljs-type">const</span> &#123; <span class="hljs-comment">// å°†å®é™…å·¥ä½œå§”æ‰˜ç»™è§£å¼•ç”¨è¿ç®—ç¬¦ </span><br>        <span class="hljs-keyword">return</span> &amp; <span class="hljs-keyword">this</span>-&gt;<span class="hljs-keyword">operator</span>*();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç®­å¤´è¿ç®—ç¬¦ä¸æ‰§è¡Œä»»ä½•è‡ªå·±çš„æ“ä½œï¼Œè€Œæ˜¯è°ƒç”¨è§£å¼•ç”¨è¿ç®—ç¬¦å¹¶è¿”å›è§£å¼•ç”¨ç»“æœå…ƒç´ çš„åœ°å€ã€‚</p><p><strong>å¯¹ç®­å¤´è¿ç®—ç¬¦è¿”å›å€¼çš„é™å®š</strong><br>æ ¹æ® point ç±»å‹çš„ä¸åŒï¼Œpoint-&gt;mem åˆ†åˆ«ç­‰ä»·äº</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">(*point).mem; <span class="hljs-comment">// point æ˜¯ä¸€ä¸ªå†…ç½®çš„æŒ‡é’ˆç±»å‹</span><br>point.<span class="hljs-built_in">operator</span>()-&gt;mem;<span class="hljs-comment">// point æ˜¯ç±»çš„ä¸€ä¸ªå¯¹è±¡</span><br></code></pre></td></tr></table></figure><p>å¦‚æœ point æ˜¯å®šä¹‰äº† operator-&gt; çš„ç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™æˆ‘ä»¬ä½¿ç”¨ point.operator-&gt;() çš„ç»“æœæ¥è·å– memã€‚å…¶ä¸­ï¼Œå¦‚æœè¯¥ç»“æœæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œåˆ™æ‰§è¡Œ (*point).memã€‚å¦‚æœè¯¥ç»“æœæœ¬èº«å«æœ‰é‡è½½çš„ operator-&gt;()ï¼Œåˆ™é‡å¤è°ƒç”¨å½“å‰æ­¥éª¤ã€‚æœ€ç»ˆï¼Œå½“è¿™ä¸€è¿‡ç¨‹ç»“æŸæ—¶ç¨‹åºæˆ–è€…è¿”å›äº†æ‰€éœ€çš„å†…å®¹ï¼Œæˆ–è€…è¿”å›ä¸€äº›è¡¨ç¤ºç¨‹åºé”™è¯¯çš„ä¿¡æ¯ã€‚</p><h2 id="14-8-å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦"><a href="#14-8-å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦" class="headerlink" title="14.8 å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦"></a>14.8 å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦</h2><p>å¯ä»¥åƒä½¿ç”¨å‡½æ•°ä¸€æ ·ä½¿ç”¨è¯¥ç±»çš„å¯¹è±¡ã€‚å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦å¿…é¡»æ˜¯æˆå‘˜å‡½æ•°ã€‚å¦‚æœç±»å®šä¹‰äº†è°ƒç”¨è¿ç®—ç¬¦ï¼Œåˆ™è¯¥ç±»çš„å¯¹è±¡ç§°ä½œå‡½æ•°å¯¹è±¡ã€‚</p><h3 id="14-8-1-lambda-æ˜¯å‡½æ•°å¯¹è±¡"><a href="#14-8-1-lambda-æ˜¯å‡½æ•°å¯¹è±¡" class="headerlink" title="14.8.1 lambda æ˜¯å‡½æ•°å¯¹è±¡"></a>14.8.1 lambda æ˜¯å‡½æ•°å¯¹è±¡</h3><p>å½“æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ª lambda åï¼Œç¼–è¯‘å™¨å°†è¯¥è¡¨è¾¾å¼ç¿»è¯‘æˆä¸€ä¸ªæœªå‘½åç±»çš„æœªå‘½åå¯¹è±¡ï¼Œåœ¨ lambda è¡¨è¾¾å¼äº§ç”Ÿçš„ç±»ä¸­å«æœ‰ä¸€ä¸ªé‡è½½çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ã€‚</p><p><strong>è¡¨ç¤º lambda åŠç›¸åº”æ•è·è¡Œä¸ºçš„ç±»</strong><br>å½“ä¸€ä¸ª lambda è¡¨è¾¾å¼é€šè¿‡å¼•ç”¨æ•è·å˜é‡æ—¶ï¼Œç¼–è¯‘å™¨å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å¼•ç”¨è€Œæ— é¡»åœ¨ lambda äº§ç”Ÿçš„ç±»ä¸­å°†å…¶å­˜å‚¨ä¸ºæ•°æ®æˆå‘˜ã€‚<br>ç›¸åï¼Œé€šè¿‡å€¼æ•è·çš„å˜é‡è¢«æ‹·è´åˆ° lambda ä¸­ï¼Œè¿™ç§ç±»å¿…é¡»ä¸ºæ¯ä¸ªå€¼æ•è·çš„å˜é‡å»ºç«‹å¯¹åº”çš„æ•°æ®æˆå‘˜ï¼ŒåŒæ—¶åˆ›å»ºæ„é€ å‡½æ•°ï¼Œä»¤å…¶ä½¿ç”¨æ•è·çš„å˜é‡çš„å€¼æ¥åˆå§‹åŒ–æ•°æ®æˆå‘˜ã€‚<br>lambda è¡¨è¾¾å¼äº§ç”Ÿçš„ç±»ä¸å«é»˜è®¤æ„é€ å‡½æ•°ã€èµ‹å€¼è¿ç®—ç¬¦åŠé»˜è®¤ææ„å‡½æ•°ã€‚å®ƒæ˜¯å¦å«æœ‰é»˜è®¤çš„æ‹·è´&#x2F;ç§»åŠ¨æ„é€ å‡½æ•°åˆ™é€šå¸¸è¦è§†æ•è·çš„æ•°æ®æˆå‘˜ç±»å‹è€Œå®šã€‚</p><h3 id="14-8-3-å¯è°ƒç”¨å¯¹è±¡ä¸-function"><a href="#14-8-3-å¯è°ƒç”¨å¯¹è±¡ä¸-function" class="headerlink" title="14.8.3 å¯è°ƒç”¨å¯¹è±¡ä¸ function"></a>14.8.3 å¯è°ƒç”¨å¯¹è±¡ä¸ function</h3><p>ä¸¤ä¸ªä¸åŒç±»å‹çš„å¯è°ƒç”¨å¯¹è±¡å´å¯èƒ½å…±äº«åŒä¸€ç§è°ƒç”¨å½¢å¼ã€‚è°ƒç”¨å½¢å¼æŒ‡æ˜äº†è°ƒç”¨è¿”å›çš„ç±»å‹ä»¥åŠä¼ é€’ç»™è°ƒç”¨çš„å®å‚ç±»å‹ã€‚</p><p><strong>æ ‡å‡†åº“functionç±»å‹</strong><br>å½“åˆ›å»ºä¸€ä¸ªå…·ä½“çš„ function ç±»å‹æ—¶æˆ‘ä»¬å¿…é¡»æä¾›è¯¥ function ç±»å‹èƒ½å¤Ÿè¡¨ç¤ºçš„å¯¹è±¡çš„è°ƒç”¨å½¢å¼ï¼Œå¦‚ï¼š<br><code>function&lt;int(int, int)&gt;</code><br>function ç±»å‹é‡è½½äº†è°ƒç”¨è¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—ç¬¦æ¥å—å®ƒè‡ªå·±çš„å®å‚ç„¶åå°†å…¶ä¼ é€’ç»™å­˜å¥½çš„å¯è°ƒç”¨å¯¹è±¡:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">map&lt;string, function&lt;<span class="hljs-type">int</span>(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)&gt;&gt; binops = &#123;<br>    &#123;<span class="hljs-string">&quot;*&quot;</span>, [](<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j) &#123; <span class="hljs-keyword">return</span> i * j; &#125;&#125;<br>&#125;<br>binops[<span class="hljs-string">&quot;*&quot;</span>](<span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// è°ƒç”¨ lambda å¯¹è±¡</span><br></code></pre></td></tr></table></figure><p><strong>é‡è½½çš„å‡½æ•°ä¸ function</strong><br>æˆ‘ä»¬ä¸èƒ½ï¼ˆç›´æ¥ï¼‰å°†é‡è½½å‡½æ•°çš„åå­—å­˜å…¥ function ç±»å‹çš„å¯¹è±¡ä¸­ï¼Œè§£å†³ä¸Šè¿°äºŒä¹‰æ€§é—®é¢˜çš„ä¸€æ¡é€”å¾„æ˜¯å­˜å‚¨å‡½æ•°æŒ‡é’ˆï¼Œè€Œéå‡½æ•°åã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> </span>&#123; <span class="hljs-keyword">return</span> i + j; &#125;<br><span class="hljs-function">Sales_data <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">const</span> Sales_data&amp;, <span class="hljs-type">const</span> Sales_data&amp;)</span></span>;<br>map&lt;string, function&lt;<span class="hljs-type">int</span>(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)&gt;&gt; binops;<br>binops.<span class="hljs-built_in">insert</span>(&#123;<span class="hljs-string">&quot;+&quot;</span>, add&#125;); <span class="hljs-comment">// é”™è¯¯ï¼šå“ªä¸ª addï¼Ÿ</span><br><span class="hljs-built_in">int</span> (*fp)(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>) = add; <span class="hljs-comment">// æŒ‡é’ˆæ‰€æŒ‡çš„ add æ˜¯æ¥å—ä¸¤ä¸ª int çš„ç‰ˆæœ¬</span><br>binops.<span class="hljs-built_in">insert</span>(&#123;<span class="hljs-string">&quot;+&quot;</span>, fp&#125;); <span class="hljs-comment">// æ­£ç¡®</span><br></code></pre></td></tr></table></figure><h2 id="14-9-é‡è½½ã€ç±»å‹è½¬æ¢ä¸è¿ç®—ç¬¦"><a href="#14-9-é‡è½½ã€ç±»å‹è½¬æ¢ä¸è¿ç®—ç¬¦" class="headerlink" title="14.9 é‡è½½ã€ç±»å‹è½¬æ¢ä¸è¿ç®—ç¬¦"></a>14.9 é‡è½½ã€ç±»å‹è½¬æ¢ä¸è¿ç®—ç¬¦</h2><p>è½¬æ¢æ„é€ å‡½æ•°å’Œç±»å‹è½¬æ¢è¿ç®—ç¬¦å…±åŒå®šä¹‰äº†ç±»ç±»å‹è½¬æ¢ã€‚</p><h3 id="14-9-1-ç±»å‹è½¬æ¢è¿ç®—ç¬¦"><a href="#14-9-1-ç±»å‹è½¬æ¢è¿ç®—ç¬¦" class="headerlink" title="14.9.1 ç±»å‹è½¬æ¢è¿ç®—ç¬¦"></a>14.9.1 ç±»å‹è½¬æ¢è¿ç®—ç¬¦</h3><p>ç±»å‹è½¬æ¢è¿ç®—ç¬¦æ˜¯ç±»çš„ä¸€ç§ç‰¹æ®Šæˆå‘˜å‡½æ•°ï¼Œå®ƒè´Ÿè´£å°†ä¸€ä¸ªç±»ç±»å‹çš„å€¼è½¬æ¢æˆå…¶ä»–ç±»å‹ã€‚<br><code>operator type() const;</code><br>ä¸å…è®¸è½¬æ¢æˆæ•°ç»„æˆ–è€…å‡½æ•°ç±»å‹ï¼Œä½†å…è®¸è½¬æ¢æˆæŒ‡é’ˆæˆ–è€…å¼•ç”¨ç±»å‹ã€‚<br>ç±»å‹è½¬æ¢è¿ç®—ç¬¦æ—¢æ²¡æœ‰æ•å¼çš„è¿”å›ç±»å‹ï¼Œä¹Ÿæ²¡æœ‰å½¢å‚ï¼Œè€Œä¸”å¿…é¡»å®šä¹‰æˆç±»çš„æˆå‘˜å‡½æ•°ï¼Œä¸€èˆ¬è¢«å®šä¹‰æˆ const æˆå‘˜ã€‚</p><p><strong>æ˜¾å¼çš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmallInt</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">//ç¼–è¯‘å™¨ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œè¿™ä¸€ç±»å‹è½¬æ¢</span><br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-keyword">operator</span> <span class="hljs-title">int</span> <span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> val; &#125;<br>&#125;ï¼›<br>SmallInt si = <span class="hljs-number">1</span>;<br>si + <span class="hljs-number">3</span>; <span class="hljs-comment">// é”™è¯¯ï¼šæ­¤å¤„éœ€è¦éšå¼çš„ç±»å‹è½¬æ¢ï¼Œä½†ç±»çš„è¿ç®—ç¬¦æ˜¯æ˜¾å¼çš„</span><br><span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(si) + <span class="hljs-number">3</span>; <span class="hljs-comment">// æ­£ç¡®ï¼šæ˜¾å¼åœ°è¯·æ±‚ç±»å‹è½¬æ¢</span><br></code></pre></td></tr></table></figure><p>è¯¥è§„å®šå­˜åœ¨ä¸€ä¸ªä¾‹å¤–ï¼Œå³å¦‚æœè¡¨è¾¾å¼è¢«ç”¨ä½œæ¡ä»¶ï¼Œæ˜¾å¼çš„ç±»å‹è½¬æ¢å°†è¢«éšå¼åœ°æ‰§è¡Œã€‚</p><h1 id="ç¬¬åäº”ç« -é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡"><a href="#ç¬¬åäº”ç« -é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡" class="headerlink" title="ç¬¬åäº”ç«  é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡"></a>ç¬¬åäº”ç«  é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡</h1><h2 id="15-2-å®šä¹‰åŸºç±»å’Œæ´¾ç”Ÿç±»"><a href="#15-2-å®šä¹‰åŸºç±»å’Œæ´¾ç”Ÿç±»" class="headerlink" title="15.2 å®šä¹‰åŸºç±»å’Œæ´¾ç”Ÿç±»"></a>15.2 å®šä¹‰åŸºç±»å’Œæ´¾ç”Ÿç±»</h2><h3 id="15-2-1-å®šä¹‰åŸºç±»"><a href="#15-2-1-å®šä¹‰åŸºç±»" class="headerlink" title="15.2.1 å®šä¹‰åŸºç±»"></a>15.2.1 å®šä¹‰åŸºç±»</h3><p>åŸºç±»é€šå¸¸éƒ½åº”è¯¥å®šä¹‰ä¸€ä¸ªè™šææ„å‡½æ•°ã€‚</p><p><strong>æˆå‘˜å‡½æ•°ä¸ç»§æ‰¿</strong><br>å…³é”®å­— virtual åªèƒ½å‡ºç°åœ¨ç±»å†…éƒ¨çš„å£°æ˜è¯­å¥ä¹‹å‰è€Œä¸èƒ½ç”¨äºç±»å¤–éƒ¨çš„å‡½æ•°å®šä¹‰ã€‚å¦‚æœåŸºç±»æŠŠä¸€ä¸ªå‡½æ•°å£°æ˜æˆè™šå‡½æ•°ï¼Œåˆ™è¯¥å‡½æ•°åœ¨æ´¾ç”Ÿç±»ä¸­éšå¼åœ°ä¹Ÿæ˜¯è™šå‡½æ•°ã€‚</p><h3 id="15-2-2-å®šä¹‰æ´¾ç”Ÿç±»"><a href="#15-2-2-å®šä¹‰æ´¾ç”Ÿç±»" class="headerlink" title="15.2.2 å®šä¹‰æ´¾ç”Ÿç±»"></a>15.2.2 å®šä¹‰æ´¾ç”Ÿç±»</h3><p><strong>æ´¾ç”Ÿç±»ä¸­çš„è™šå‡½æ•°</strong><br>æ´¾ç”Ÿç±»å¯ä»¥åœ¨å®ƒè¦†ç›–çš„å‡½æ•°å‰ä½¿ç”¨ virtual å…³é”®å­—ï¼Œä½†ä¸æ˜¯éå¾—è¿™ä¹ˆåšã€‚C++11 æ–°æ ‡å‡†å…è®¸æ´¾ç”Ÿç±»æ˜¾å¼åœ°æ³¨æ˜å®ƒä½¿ç”¨æŸä¸ªæˆå‘˜å‡½æ•°è¦†ç›–äº†å®ƒç»§æ‰¿çš„è™šå‡½æ•°ã€‚å…·ä½“åšæ³•æ˜¯åœ¨åé¢æ·»åŠ ä¸€ä¸ªå…³é”®å­— overrideã€‚</p><p><strong>æ´¾ç”Ÿç±»æ„é€ å‡½æ•°</strong><br>æ´¾ç”Ÿç±»å¿…é¡»ä½¿ç”¨åŸºç±»çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–å®ƒçš„åŸºç±»éƒ¨åˆ†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">Bulk_quote</span>(<span class="hljs-type">const</span> std::string&amp; book, <span class="hljs-type">double</span> p, std::<span class="hljs-type">size_t</span> qty, <span class="hljs-type">double</span> disc) :<br>    <span class="hljs-built_in">Quote</span>(book, p), <span class="hljs-built_in">min_qty</span>(qty), <span class="hljs-built_in">discount</span>(disc) &#123; &#125;<br>&#125;ï¼›<br></code></pre></td></tr></table></figure><p>é¦–å…ˆåˆå§‹åŒ–åŸºç±»çš„éƒ¨åˆ†ï¼Œç„¶åæŒ‰ç…§å£°æ˜çš„é¡ºåºä¾æ¬¡åˆå§‹åŒ–æ´¾ç”Ÿç±»çš„æˆå‘˜ã€‚</p><p><strong>æ´¾ç”Ÿç±»ä½¿ç”¨åŸºç±»çš„æˆå‘˜</strong><br>æ´¾ç”Ÿç±»çš„ä½œç”¨åŸŸåµŒå¥—åœ¨åŸºç±»çš„ä½œç”¨åŸŸä¹‹å†…ã€‚<br>æ´¾ç”Ÿç±»åº”è¯¥éµå¾ªåŸºç±»çš„æ¥å£ï¼Œå¹¶ä¸”é€šè¿‡è°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–é‚£äº›ä»åŸºç±»ä¸­ç»§æ‰¿è€Œæ¥çš„æˆå‘˜ã€‚</p><p><strong>ç»§æ‰¿ä¸é™æ€æˆå‘˜</strong><br>ä¸è®ºä»åŸºç±»ä¸­æ´¾ç”Ÿå‡ºæ¥å¤šå°‘ä¸ªæ´¾ç”Ÿç±»ï¼Œå¯¹äºæ¯ä¸ªé™æ€æˆå‘˜æ¥è¯´éƒ½åªå­˜åœ¨å”¯ä¸€çš„å®ä¾‹ã€‚</p><p><strong>æ´¾ç”Ÿç±»çš„å£°æ˜</strong><br>å£°æ˜ä¸­åŒ…å«ç±»åä½†æ˜¯ä¸åŒ…å«å®ƒçš„æ´¾ç”Ÿåˆ—è¡¨ï¼Œæ´¾ç”Ÿåˆ—è¡¨ä»¥åŠä¸å®šä¹‰æœ‰å…³çš„å…¶ä»–ç»†èŠ‚å¿…é¡»ä¸ç±»çš„ä¸»ä½“ä¸€èµ·å‡ºç°ã€‚</p><p><strong>è¢«ç”¨ä½œåŸºç±»çš„ç±»</strong><br>å¦‚æœæˆ‘ä»¬æƒ³å°†æŸä¸ªç±»ç”¨ä½œåŸºç±»ï¼Œåˆ™è¯¥ç±»å¿…é¡»å·²ç»å®šä¹‰è€Œéä»…ä»…å£°æ˜ã€‚</p><p><strong>é˜²æ­¢ç»§æ‰¿çš„å‘ç”Ÿ</strong><br>C++11 æ–°æ ‡å‡†æä¾›äº†ä¸€ç§é˜²æ­¢ç»§æ‰¿å‘ç”Ÿçš„æ–¹æ³•ï¼Œå³åœ¨ç±»ååè·Ÿä¸€ä¸ªå…³é”®å­— finalã€‚</p><h3 id="15-2-3-ç±»å‹è½¬æ¢ä¸ç»§æ‰¿"><a href="#15-2-3-ç±»å‹è½¬æ¢ä¸ç»§æ‰¿" class="headerlink" title="15.2.3 ç±»å‹è½¬æ¢ä¸ç»§æ‰¿"></a>15.2.3 ç±»å‹è½¬æ¢ä¸ç»§æ‰¿</h3><p><strong>é™æ€ç±»å‹ä¸åŠ¨æ€ç±»å‹</strong><br>åŠ¨æ€ç±»å‹ç›´åˆ°è¿è¡Œæ—¶æ‰å¯çŸ¥ã€‚å¦‚æœè¡¨è¾¾å¼æ—¢ä¸æ˜¯å¼•ç”¨ä¹Ÿä¸æ˜¯æŒ‡é’ˆï¼Œåˆ™å®ƒçš„åŠ¨æ€ç±»å‹æ°¸è¿œä¸é™æ€ç±»å‹ä¸€è‡´ã€‚</p><p><strong>ä¸å­˜åœ¨ä»åŸºç±»å‘æ´¾ç”Ÿç±»çš„éšå¼ç±»å‹è½¬æ¢â€¦â€¦</strong><br>å¦‚æœæˆ‘ä»¬å·±çŸ¥æŸä¸ªåŸºç±»å‘æ´¾ç”Ÿç±»çš„è½¬æ¢æ˜¯å®‰å…¨çš„ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ static_cast æ¥å¼ºåˆ¶è¦†ç›–æ‰ç¼–è¯‘å™¨çš„æ£€æŸ¥å·¥ä½œã€‚</p><p><strong>â€¦â€¦åœ¨å¯¹è±¡ä¹‹é—´ä¸å­˜åœ¨ç±»å‹è½¬æ¢</strong><br>æ´¾ç”Ÿç±»å‘åŸºç±»çš„è‡ªåŠ¨ç±»å‹è½¬æ¢åªå¯¹æŒ‡é’ˆæˆ–å¼•ç”¨ç±»å‹æœ‰æ•ˆã€‚<br>å½“æˆ‘ä»¬ç”¨ä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡ä¸ºä¸€ä¸ªåŸºç±»å¯¹è±¡åˆå§‹åŒ–æˆ–èµ‹å€¼æ—¶ï¼Œåªæœ‰è¯¥æ´¾ç”Ÿç±»å¯¹è±¡ä¸­çš„åŸºç±»éƒ¨åˆ†ä¼šè¢«æ‹·è´ã€ç§»åŠ¨æˆ–èµ‹å€¼ï¼Œå®ƒçš„æ´¾ç”Ÿç±»éƒ¨åˆ†å°†è¢«å¿½ç•¥æ‰ã€‚</p><h2 id="15-3-è™šå‡½æ•°"><a href="#15-3-è™šå‡½æ•°" class="headerlink" title="15.3 è™šå‡½æ•°"></a>15.3 è™šå‡½æ•°</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨åŸºç±»çš„å¼•ç”¨æˆ–æŒ‡é’ˆè°ƒç”¨ä¸€ä¸ªè™šæˆå‘˜å‡½æ•°æ—¶ä¼šæ‰§è¡ŒåŠ¨æ€ç»‘å®šï¼Œå› ä¸ºæˆ‘ä»¬ç›´åˆ°è¿è¡Œæ—¶æ‰èƒ½çŸ¥é“åˆ°åº•è°ƒç”¨äº†å“ªä¸ªç‰ˆæœ¬çš„è™šå‡½æ•°ï¼Œæ‰€ä»¥æ‰€æœ‰è™šå‡½æ•°éƒ½å¿…é¡»æœ‰å®šä¹‰ã€‚</p><p><strong>å¯¹è™šå‡½æ•°çš„è°ƒç”¨å¯èƒ½åœ¨è¿è¡Œæ—¶æ‰è¢«è§£æ</strong><br>è¢«è°ƒç”¨çš„å‡½æ•°æ˜¯ä¸ç»‘å®šåˆ°æŒ‡é’ˆæˆ–å¼•ç”¨ä¸Šçš„å¯¹è±¡çš„åŠ¨æ€ç±»å‹ç›¸åŒ¹é…çš„é‚£ä¸€ä¸ªã€‚</p><p><strong>æ´¾ç”Ÿç±»ä¸­çš„è™šå‡½æ•°</strong><br>ä¸€æ—¦æŸä¸ªå‡½æ•°è¢«å£°æ˜æˆè™šå‡½æ•°ï¼Œåˆ™åœ¨æ‰€æœ‰æ´¾ç”Ÿç±»ä¸­å®ƒéƒ½æ˜¯è™šå‡½æ•°ã€‚<br>æ´¾ç”Ÿç±»ä¸­è™šå‡½æ•°çš„è¿”å›ç±»å‹å¿…é¡»ä¸åŸºç±»å‡½æ•°åŒ¹é…ã€‚å½“ç±»çš„è™šå‡½æ•°è¿”å›ç±»å‹æ˜¯ç±»æœ¬èº«çš„æŒ‡é’ˆæˆ–å¼•ç”¨æ—¶ï¼Œä¸Šè¿°è§„åˆ™æ— æ•ˆã€‚<br>åŸºç±»çš„è™šå‡½æ•°åœ¨æ´¾ç”Ÿç±»ä¸­éšå«çš„ä¹Ÿæ˜¯ä¸€ä¸ªè™šå‡½æ•°ã€‚å½“æ´¾ç”Ÿç±»è¦†ç›–äº†æŸä¸ªè™šå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°åœ¨åŸºç±»ä¸­çš„å½¢å‚å¿…é¡»ä¸æ´¾ç”Ÿç±»ä¸­çš„å½¢å‚ä¸¥æ ¼åŒ¹é…ã€‚</p><p><strong>final å’Œ override è¯´æ˜ç¬¦</strong><br>æ´¾ç”Ÿç±»å¦‚æœå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ä¸åŸºç±»ä¸­è™šå‡½æ•°çš„åå­—ç›¸åŒä½†æ˜¯å½¢å‚åˆ—è¡¨ä¸åŒï¼Œç¼–è¯‘å™¨å°†è®¤ä¸ºæ–°å®šä¹‰çš„è¿™ä¸ªå‡½æ•°ä¸åŸºç±»ä¸­åŸæœ‰çš„å‡½æ•°æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚<br>åœ¨ C++11 æ–°æ ‡å‡†ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ override å…³é”®å­—æ¥è¯´æ˜æ´¾ç”Ÿç±»ä¸­çš„è™šå‡½æ•°ï¼Œä½¿å¾—ç¨‹åºå‘˜çš„æ„å›¾æ›´åŠ æ¸…æ™°çš„åŒæ—¶è®©ç¼–è¯‘å™¨å¯ä»¥ä¸ºæˆ‘ä»¬å‘ç°ä¸€äº›é”™è¯¯ã€‚<br>final å’Œ override è¯´æ˜ç¬¦å‡ºç°åœ¨å½¢å‚åˆ—è¡¨ä»¥åŠå°¾ç½®è¿”å†‹ç±»å‹ä¹‹åã€‚</p><p><strong>è™šå‡½æ•°ä¸é»˜è®¤å®å‚</strong><br>å¦‚æœæˆ‘ä»¬é€šè¿‡åŸºç±»çš„å¼•ç”¨æˆ–æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼Œåˆ™ä½¿ç”¨åŸºç±»ä¸­å®šä¹‰çš„é»˜è®¤å®å‚ï¼Œå³ä½¿å®é™…è¿è¡Œçš„æ˜¯æ´¾ç”Ÿç±»ä¸­çš„å‡½æ•°ç‰ˆæœ¬ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p><strong>å›é¿è™šå‡½æ•°çš„æœºåˆ¶</strong><br>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å¼ºåˆ¶æ‰§è¡Œè™šå‡½æ•°çš„æŸä¸ªç‰¹å®šç‰ˆæœ¬ï¼Œä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦å¯ä»¥å®ç°è¿™ä¸€ç›®çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">double</span> undiscounted = baseP-&gt;Quote::<span class="hljs-built_in">net_price</span>(<span class="hljs-number">42</span>);<br></code></pre></td></tr></table></figure><p>è¯¥ä»£ç å¼ºè¡Œè°ƒç”¨ Quote çš„ net_price å‡½æ•°ï¼Œè€Œä¸ç®¡ baseP å®é™…æŒ‡å‘çš„å¯¹è±¡ç±»å‹åˆ°åº•æ˜¯ä»€ä¹ˆã€‚è¯¥è°ƒç”¨å°†åœ¨ç¼–è¯‘æ—¶å®Œæˆè§£æã€‚</p><h2 id="15-4-æŠ½è±¡åŸºç±»"><a href="#15-4-æŠ½è±¡åŸºç±»" class="headerlink" title="15.4 æŠ½è±¡åŸºç±»"></a>15.4 æŠ½è±¡åŸºç±»</h2><p><strong>çº¯è™šå‡½æ•°</strong><br>ä¸€ä¸ªçº¯è™šå‡½æ•°æ— é¡»å®šä¹‰ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨å‡½æ•°ä½“çš„ä½ç½®ä¹¦å†™ &#x3D;0 å°±å¯ä»¥å°†ä¸€ä¸ªè™šå‡½æ•°è¯´æ˜ä¸ºçº¯è™šå‡½æ•°ã€‚&#x3D;0 åªèƒ½å‡ºç°åœ¨ç±»å†…éƒ¨çš„è™šå‡½æ•°å£°æ˜è¯­å¥å¤„ã€‚<br>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºçº¯è™šå‡½æ•°æä¾›å®šä¹‰ï¼Œä¸è¿‡å‡½æ•°ä½“å¿…é¡»å®šä¹‰åœ¨ç±»çš„å¤–éƒ¨ã€‚</p><p><strong>å«æœ‰çº¯è™šå‡½æ•°çš„ç±»æ˜¯æŠ½è±¡åŸºç±»</strong><br>å«æœ‰ï¼ˆæˆ–è€…æœªç»è¦†ç›–ç›´æ¥ç»§æ‰¿ï¼‰çº¯è™šå‡½æ•°çš„ç±»æ˜¯æŠ½è±¡åŸºç±»ã€‚æˆ‘ä»¬ä¸èƒ½ï¼ˆç›´æ¥ï¼‰åˆ›å»ºä¸€ä¸ªæŠ½è±¡åŸºç±»çš„å¯¹è±¡ã€‚</p><h2 id="15-5-è®¿é—®æ§åˆ¶ä¸ç»§æ‰¿"><a href="#15-5-è®¿é—®æ§åˆ¶ä¸ç»§æ‰¿" class="headerlink" title="15.5 è®¿é—®æ§åˆ¶ä¸ç»§æ‰¿"></a>15.5 è®¿é—®æ§åˆ¶ä¸ç»§æ‰¿</h2><p>æ´¾ç”Ÿç±»çš„æˆå‘˜æˆ–å‹å…ƒåªèƒ½é€šè¿‡æ´¾ç”Ÿç±»å¯¹è±¡æ¥è®¿é—®åŸºç±»çš„å—ä¿æŠ¤æˆå‘˜ã€‚æ´¾ç”Ÿç±»å¯¹äºä¸€ä¸ªåŸºç±»å¯¹è±¡ä¸­çš„å—ä¿æŠ¤æˆå‘˜æ²¡æœ‰ä»»ä½•è®¿é—®ç‰¹æƒã€‚<br>æ´¾ç”Ÿç±»çš„æˆå‘˜çš„å‹å…ƒåªèƒ½è®¿é—®æ´¾ç”Ÿç±»å¯¹è±¡ä¸­çš„åŸºç±»éƒ¨åˆ†çš„å—ä¿æŠ¤æˆå‘˜ï¼Œå¯¹äºæ™®é€šçš„åŸºç±»å¯¹è±¡ä¸­çš„æˆå‘˜æ²¡æœ‰ç‰¹æ®Šçš„è®¿é—®æƒé™ã€‚</p><p><strong>å…¬æœ‰ã€ç§æœ‰å’Œå—ä¿æŠ¤ç»§æ‰¿</strong><br>æ´¾ç”Ÿç±»è®¿é—®è¯´æ˜ç¬¦å¯¹äºæ´¾ç”Ÿç±»çš„æˆå‘˜ï¼ˆåŠå‹å…ƒï¼‰èƒ½å¦è®¿é—®å…¶ç›´æ¥åŸºç±»çš„æˆå‘˜æ²¡ä»€ä¹ˆå½±å“ã€‚å¯¹åŸºç±»æˆå‘˜çš„è®¿é—®æƒé™åªä¸åŸºç±»ä¸­çš„è®¿é—®è¯´æ˜ç¬¦æœ‰å…³ã€‚æ´¾ç”Ÿç±»è®¿é—®è¯´æ˜ç¬¦çš„ç›®çš„æ˜¯æ§åˆ¶æ´¾ç”Ÿç±»ç”¨æˆ·ï¼ˆåŒ…æ‹¬æ´¾ç”Ÿç±»çš„æ´¾ç”Ÿç±»åœ¨å†…ï¼‰å¯¹äºåŸºç±»æˆå‘˜çš„è®¿é—®æƒé™ï¼Œä»¥åŠç»§æ‰¿è‡ªæ´¾ç”Ÿç±»çš„æ–°ç±»çš„è®¿é—®æƒé™ã€‚</p><p><strong>æ´¾ç”Ÿç±»å‘åŸºç±»è½¬æ¢çš„å¯è®¿é—®æ€§</strong><br>å‡å®š D ç»§æ‰¿è‡ª Bï¼š</p><ul><li>åªæœ‰å½“ D å…¬æœ‰åœ°ç»§æ‰¿ Ğ’ æ—¶ï¼Œç”¨æˆ·ä»£ç æ‰èƒ½ä½¿ç”¨æ´¾ç”Ÿç±»å‘åŸºç±»çš„è½¬æ¢ã€‚</li><li>ä¸è®º D ä»¥ä»€ä¹ˆæ–¹å¼ç»§æ‰¿ B, D çš„æˆå‘˜å‡½æ•°å’Œå‹å…ƒéƒ½èƒ½ä½¿ç”¨æ´¾ç”Ÿç±»å‘åŸºç±»çš„è½¬æ¢ã€‚</li><li>å¦‚æœ D ç»§æ‰¿ Ğ’ çš„æ–¹å¼æ˜¯å…¬æœ‰çš„æˆ–è€…å—ä¿æŠ¤çš„ï¼Œåˆ™ D çš„æ´¾ç”Ÿç±»çš„æˆå‘˜å’Œå‹å…ƒå¯ä»¥ä½¿ç”¨ D å‘ Ğ’ çš„ç±»å‹è½¬æ¢ã€‚</li></ul><p><strong>å‹å…ƒä¸ç»§æ‰¿</strong><br>å‹å…ƒå…³ç³»åŒæ ·ä¹Ÿä¸èƒ½ç»§æ‰¿ï¼Œ åŸºç±»çš„å‹å…ƒåœ¨è®¿é—®æ´¾ç”Ÿç±»æˆå‘˜æ—¶ä¸å…·æœ‰ç‰¹æ®Šæ€§ã€‚<br>å¯¹åŸºç±»çš„è®¿é—®æƒé™ç”±åŸºç±»æœ¬èº«æ§åˆ¶ï¼Œå³ä½¿å¯¹äºæ´¾ç”Ÿç±»çš„åŸºç±»éƒ¨åˆ†ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p><strong>æ”¹å˜ä¸ªåˆ«æˆå‘˜çš„å¯è®¿é—®æ€§</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">protected</span>:<br>    std::<span class="hljs-type">size_t</span> n;<br>&#125;ï¼›<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">private</span> Base &#123; <span class="hljs-comment">// æ³¨æ„ï¼šprivate ç»§æ‰¿</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> Base::n;<br>&#125;ï¼›<br></code></pre></td></tr></table></figure><p>using å£°æ˜è¯­å¥ä¸­åå­—çš„è®¿é—®æƒé™ç”±è¯¥ using å£°æ˜è¯­å¥ä¹‹å‰çš„è®¿é—®è¯´æ˜ç¬¦æ¥å†³å®šã€‚<br>using åªå½±å“æ´¾ç”Ÿç±»çš„ä½¿ç”¨è€…å¯¹åŸºç±»æˆå‘˜çš„è®¿é—®æƒé™ï¼Œæ´¾ç”Ÿç±»åªèƒ½ä¸ºé‚£äº›å®ƒå¯ä»¥è®¿é—®çš„åå­—æä¾› using å£°æ˜ã€‚</p><h2 id="15-6-ç»§æ‰¿ä¸­çš„ç±»ä½œç”¨åŸŸ"><a href="#15-6-ç»§æ‰¿ä¸­çš„ç±»ä½œç”¨åŸŸ" class="headerlink" title="15.6 ç»§æ‰¿ä¸­çš„ç±»ä½œç”¨åŸŸ"></a>15.6 ç»§æ‰¿ä¸­çš„ç±»ä½œç”¨åŸŸ</h2><p>æ´¾ç”Ÿç±»çš„ä½œç”¨åŸŸåµŒå¥—åœ¨å…¶åŸºç±»çš„ä½œç”¨åŸŸä¹‹å†…ï¼Œå¦‚æœä¸€ä¸ªåå­—åœ¨æ´¾ç”Ÿç±»çš„ä½œç”¨åŸŸå†…æ— æ³•æ­£ç¡®è§£æï¼Œåˆ™ç¼–è¯‘å™¨å°†ç»§ç»­åœ¨å¤–å±‚çš„åŸºç±»ä½œç”¨åŸŸä¸­å¯»æ‰¾è¯¥åå­—çš„å®šä¹‰ã€‚</p><p><strong>åœ¨ç¼–è¯‘æ—¶è¿›è¡Œåå­—æŸ¥æ‰¾</strong><br>ä¸€ä¸ªå¯¹è±¡ã€å¼•ç”¨æˆ–æŒ‡é’ˆçš„é™æ€ç±»å‹å†³å®šäº†è¯¥å¯¹è±¡çš„å“ªäº›æˆå‘˜æ˜¯å¯è§çš„ã€‚ä¸èƒ½é€šè¿‡åŸºç±»å¯¹è±¡&#x2F;æŒ‡é’ˆ&#x2F;å¼•ç”¨ï¼ˆé™æ€ç±»å‹ï¼‰è°ƒç”¨æ´¾ç”Ÿç±»ï¼ˆåŠ¨æ€ç±»å‹ï¼‰ç‹¬æœ‰çš„æˆå‘˜ã€‚</p><p><strong>åå­—å†²çªä¸ç»§æ‰¿</strong><br>å®šä¹‰åœ¨å†…å±‚ä½œç”¨åŸŸçš„åå­—å°†éšè—å®šä¹‰åœ¨å¤–å±‚ä½œç”¨åŸŸçš„åå­—ã€‚</p><p><strong>é€šè¿‡ä½œç”¨åŸŸè¿ç®—ç¬¦æ¥ä½¿ç”¨éšè—çš„æˆå‘˜</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Derived</span> : Base &#123;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get_base_mem</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> Base::mem; &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½œç”¨åŸŸè¿ç®—ç¬¦å°†è¦†ç›–æ‰åŸæœ‰çš„æŸ¥æ‰¾è§„åˆ™ï¼Œå¹¶æŒ‡ç¤ºç¼–è¯‘å™¨ä» Base ç±»çš„ä½œç”¨åŸŸå¼€å§‹æŸ¥æ‰¾ menã€‚</p><p><strong>åå­—æŸ¥æ‰¾å…ˆäºç±»å‹æ£€æŸ¥</strong></p><p><strong>è™šå‡½æ•°ä¸ä½œç”¨åŸŸ</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">int</span> <span class="hljs-title">fun1</span><span class="hljs-params">()</span></span>;<br>&#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D1</span> : <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">fun1</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span>; <span class="hljs-comment">// éšè—åŸºç±»çš„ fun1()ï¼Œè¿™ä¸ª fun1() ä¸æ˜¯è™šå‡½æ•°</span><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">fun2</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// ä¸€ä¸ªæ–°çš„è™šå‡½æ•°</span><br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D2</span> : <span class="hljs-keyword">public</span> D1 &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">fun1</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span>; <span class="hljs-comment">// éè™šå‡½æ•°ï¼Œéšè—äº† D1::fun1(int)</span><br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">fun1</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// è¦†ç›–äº† Base çš„è™šå‡½æ•° fun1()</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fun2</span><span class="hljs-params">()</span></span>; <span class="hljs-comment">// è¦†ç›–äº† D1 çš„è™šå‡½æ•° fun2()</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>é€šè¿‡åŸºç±»è°ƒç”¨éšè—çš„è™šå‡½æ•°</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">D2 d2;<br>Base *p1 = &amp;d2; D1 *p2 = &amp;d2; D2 *p3 = &amp;d2;<br>p1-&gt;<span class="hljs-built_in">fun1</span>(<span class="hljs-number">42</span>); <span class="hljs-comment">// é”™è¯¯ï¼ŒBase ä¸­æ²¡æœ‰æ¥å—ä¸€ä¸ª int çš„ fun1</span><br>p2-&gt;<span class="hljs-built_in">fun1</span>(<span class="hljs-number">42</span>); <span class="hljs-comment">// é™æ€ç»‘å®šï¼Œè°ƒç”¨ D1::fun1(int)</span><br>p3-&gt;<span class="hljs-built_in">fun1</span>(<span class="hljs-number">42</span>); <span class="hljs-comment">// é™æ€ç»‘å®šï¼Œè°ƒç”¨ D2::fun1(int)</span><br></code></pre></td></tr></table></figure><p><strong>è¦†ç›–é‡è½½çš„å‡½æ•°</strong><br>å¦‚æœæ´¾ç”Ÿç±»å¸Œæœ›æ‰€æœ‰çš„é‡è½½ç‰ˆæœ¬å¯¹äºå®ƒæ¥è¯´éƒ½æ˜¯å¯è§çš„ï¼Œé‚£ä¹ˆå®ƒå°±éœ€è¦è¦†ç›–æ‰€æœ‰çš„ç‰ˆæœ¬ï¼Œæˆ–è€…ä¸€ä¸ªä¹Ÿä¸è¦†ç›–ã€‚<br>ä¸€ç§å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸ºé‡è½½çš„æˆå‘˜æä¾›ä¸€æ¡ using å£°æ˜è¯­å¥ã€‚using å£°æ˜è¯­å¥æŒ‡å®šä¸€ä¸ªåå­—è€Œä¸æŒ‡å®šå½¢å‚åˆ—è¡¨ï¼Œæ‰€ä»¥ä¸€æ¡åŸºç±»æˆå‘˜å‡½æ•°çš„ using å£°æ˜è¯­å¥å°±å¯ä»¥æŠŠè¯¥å‡½æ•°çš„æ‰€æœ‰é‡è½½å®ä¾‹æ·»åŠ åˆ°æ´¾ç”Ÿç±»ä½œç”¨åŸŸä¸­ã€‚æ­¤æ—¶ï¼Œæ´¾ç”Ÿç±»åªéœ€è¦å®šä¹‰å…¶ç‰¹æœ‰çš„å‡½æ•°å°±å¯ä»¥äº†ã€‚</p><h2 id="15-7-æ„é€ å‡½æ•°ä¸æ‹·è´æ§åˆ¶"><a href="#15-7-æ„é€ å‡½æ•°ä¸æ‹·è´æ§åˆ¶" class="headerlink" title="15.7 æ„é€ å‡½æ•°ä¸æ‹·è´æ§åˆ¶"></a>15.7 æ„é€ å‡½æ•°ä¸æ‹·è´æ§åˆ¶</h2><h3 id="15-7-1è™šææ„å‡½æ•°"><a href="#15-7-1è™šææ„å‡½æ•°" class="headerlink" title="15.7.1è™šææ„å‡½æ•°"></a>15.7.1è™šææ„å‡½æ•°</h3><p>æˆ‘ä»¬é€šè¿‡åœ¨åŸºç±»ä¸­å°†ææ„å‡½æ•°å®šä¹‰æˆè™šå‡½æ•°ä»¥ç¡®ä¿æ‰§è¡Œæ­£ç¡®çš„ææ„å‡½æ•°ç‰ˆæœ¬ã€‚<br>ä¸€ä¸ªåŸºç±»æ€»æ˜¯éœ€è¦ææ„å‡½æ•°ï¼Œè€Œä¸”å®ƒèƒ½å°†ææ„å‡½æ•°è®¾å®šä¸ºè™šå‡½æ•°ï¼Œä½†æ˜¯æ— æ³•ç”±æ­¤æ¨æ–­è¯¥åŸºç±»è¿˜éœ€è¦èµ‹å€¼è¿ç®—ç¬¦æˆ–æ‹·è´æ„é€ å‡½æ•°ã€‚</p><p><strong>è™šææ„å‡½æ•°å°†é˜»æ­¢åˆæˆç§»åŠ¨æ“ä½œ</strong><br>å¦‚æœä¸€ä¸ªç±»å®šä¹‰äº†ææ„å‡½æ•°ï¼Œå³ä½¿å®ƒé€šè¿‡ &#x3D;default çš„å½¢å¼ä½¿ç”¨äº†åˆæˆçš„ç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨ä¹Ÿä¸ä¼šä¸ºè¿™ä¸ªç±»åˆæˆç§»åŠ¨æ“ä½œã€‚</p><h3 id="15-7-2-åˆæˆæ‹·è´æ§åˆ¶ä¸ç»§æ‰¿"><a href="#15-7-2-åˆæˆæ‹·è´æ§åˆ¶ä¸ç»§æ‰¿" class="headerlink" title="15.7.2 åˆæˆæ‹·è´æ§åˆ¶ä¸ç»§æ‰¿"></a>15.7.2 åˆæˆæ‹·è´æ§åˆ¶ä¸ç»§æ‰¿</h3><p><strong>æ´¾ç”Ÿç±»ä¸­åˆ é™¤çš„æ‹·è´æ§åˆ¶ä¸åŸºç±»çš„å…³ç³»</strong></p><ul><li>å¦‚æœåŸºç±»ä¸­çš„é»˜è®¤æ„é€ å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦æˆ–ææ„å‡½æ•°æ˜¯è¢«åˆ é™¤çš„å‡½æ•°æˆ–è€…ä¸å¯è®¿é—®ï¼Œåˆ™æ´¾ç”Ÿç±»ä¸­å¯¹åº”çš„æˆå‘˜å°†æ˜¯è¢«åˆ é™¤çš„ã€‚</li><li>å¦‚æœåœ¨åŸºç±»ä¸­æœ‰ä¸€ä¸ªä¸å¯è®¿é—®æˆ–åˆ é™¤æ‰çš„ææ„å‡½æ•°ï¼Œåˆ™æ´¾ç”Ÿç±»ä¸­åˆæˆçš„é»˜è®¤å’Œæ‹·è´æ„é€ å‡½æ•°å°†æ˜¯è¢«åˆ é™¤çš„ã€‚</li></ul><h3 id="15-7-3-æ´¾ç”Ÿç±»çš„æ‹·è´æ§åˆ¶æˆå‘˜"><a href="#15-7-3-æ´¾ç”Ÿç±»çš„æ‹·è´æ§åˆ¶æˆå‘˜" class="headerlink" title="15.7.3 æ´¾ç”Ÿç±»çš„æ‹·è´æ§åˆ¶æˆå‘˜"></a>15.7.3 æ´¾ç”Ÿç±»çš„æ‹·è´æ§åˆ¶æˆå‘˜</h3><p>æ´¾ç”Ÿç±»çš„æ‹·è´å’Œç§»åŠ¨æ„é€ å‡½æ•°åœ¨æ‹·è´å’Œç§»åŠ¨è‡ªæœ‰æˆå‘˜çš„åŒæ—¶ï¼Œä¹Ÿè¦æ‹·è´å’Œç§»åŠ¨åŸºç±»éƒ¨åˆ†çš„æˆå‘˜ã€‚ç±»ä¼¼çš„ï¼Œæ´¾ç”Ÿç±»èµ‹å€¼è¿ç®—ç¬¦ä¹Ÿå¿…é¡»ä¸ºå…¶åŸºç±»éƒ¨åˆ†çš„æˆå‘˜èµ‹å€¼ã€‚<br>ææ„å‡½æ•°åªè´Ÿè´£é”€æ¯æ´¾ç”Ÿç±»è‡ªå·±åˆ†é…çš„èµ„æºã€‚</p><p><strong>å®šä¹‰æ´¾ç”Ÿç±»çš„æ‹·è´æˆ–ç§»åŠ¨æ„é€ å‡½æ•°</strong><br>å½“ä¸ºæ´¾ç”Ÿç±»å®šä¹‰æ‹·è´æˆ–ç§»åŠ¨æ„é€ å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨å¯¹åº”çš„åŸºç±»æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡çš„åŸºç±»éƒ¨åˆ†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123; <span class="hljs-comment">/*...*/</span> &#125;;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">D</span>: <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸºç±»çš„é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡çš„åŸºç±»éƒ¨åˆ†</span><br>    <span class="hljs-comment">// è¦æƒ³ä½¿ç”¨æ‹·è´æˆ–ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨ä¸­æ˜¾å¼åœ°è°ƒç”¨è¯¥æ„é€ å‡½æ•°</span><br>    <span class="hljs-built_in">D</span>(<span class="hljs-type">const</span> D&amp; d) : <span class="hljs-built_in">Base</span>(d)&#123;&#125; <span class="hljs-comment">// æ‹·è´åŸºç±»æˆå‘˜</span><br>    <span class="hljs-built_in">D</span>(D&amp;&amp; d) : <span class="hljs-built_in">Base</span>(std::<span class="hljs-built_in">move</span>(d)) &#123;&#125; <span class="hljs-comment">// ç§»åŠ¨åŸºç±»æˆå‘˜</span><br>&#125;ï¼›<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³æ‹·è´æˆ–ç§»åŠ¨åŸºç±»éƒ¨åˆ†ï¼Œåˆ™å¿…é¡»åœ¨æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨ä¸­æ˜¾å¼åœ°ä½¿ç”¨åŸºç±»çš„æ‹·æˆ–ç§»åŠ¨æ„é€ å‡½æ•°ã€‚</p><p><strong>æ´¾ç”Ÿç±»èµ‹å€¼è¿ç®—ç¬¦</strong><br>ä¸æ‹·è´å’Œç§»åŠ¨æ„é€ å‡½æ•°ä¸€æ ·ï¼Œæ´¾ç”Ÿç±»çš„èµ‹å€¼è¿ç®—ç¬¦ä¹Ÿå¿…é¡»æ˜¾å¼åœ°ä¸ºå…¶åŸºç±»éƒ¨åˆ†èµ‹å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">D &amp;D::<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> D &amp;rhs) &#123;<br>    Base::<span class="hljs-keyword">operator</span>=(rhs); <span class="hljs-comment">// ä¸ºåŸºç±»éƒ¨åˆ†è³¦å€¼</span><br>    <span class="hljs-comment">// æŒ‰ç…§è¿‡å»çš„æ–¹å¼ä¸ºæ´¾ç”Ÿç±»çš„æˆå‘˜èµ‹å€¼ï¼Œé…Œæƒ…å¤„ç†è‡ªèµ‹å€¼åŠé‡Šæ”¾å·²æœ‰èµ„æºç­‰æƒ…å†µ</span><br>    <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åœ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°</strong><br>å½“æ‰§è¡ŒåŸºç±»çš„æ„é€ å‡½æ•°æ—¶ï¼Œè¯¥å¯¹è±¡çš„æ´¾ç”Ÿç±»éƒ¨åˆ†æ˜¯æœªè¢«åˆå§‹åŒ–çš„çŠ¶æ€ã€‚é”€æ¯æ´¾ç”Ÿç±»å¯¹è±¡çš„æ¬¡åºæ­£å¥½ç›¸åï¼Œå½“æ‰§è¡ŒåŸºç±»çš„ææ„å‡½æ•°æ—¶ï¼Œæ´¾ç”Ÿç±»éƒ¨åˆ†å·²ç»è¢«é”€æ¯æ‰äº†ã€‚<br>å¦‚æœæ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°è°ƒç”¨äº†æŸä¸ªè™šå‡½æ•°ï¼Œåˆ™æˆ‘ä»¬åº”è¯¥æ‰§è¡Œä¸æ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°æ‰€å±ç±»å‹ç›¸å¯¹åº”çš„è™šå‡½æ•°ç‰ˆæœ¬ã€‚</p><h3 id="15-7-4-ç»§æ‰¿çš„æ„é€ å‡½æ•°"><a href="#15-7-4-ç»§æ‰¿çš„æ„é€ å‡½æ•°" class="headerlink" title="15.7.4 ç»§æ‰¿çš„æ„é€ å‡½æ•°"></a>15.7.4 ç»§æ‰¿çš„æ„é€ å‡½æ•°</h3><p>æ´¾ç”Ÿç±»ç»§æ‰¿åŸºç±»æ„é€ å‡½æ•°çš„æ–¹å¼æ˜¯æä¾›ä¸€æ¡æ³¨æ˜äº†ï¼ˆç›´æ¥ï¼‰åŸºç±»åçš„ using å£°æ˜è¯­å¥ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bulk_quote</span> : <span class="hljs-keyword">public</span> Disc_quote &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> Disc_quote::Disc_quote; <span class="hljs-comment">// ç»§æ‰¿ Disc_quote çš„æ„é€ å‡½æ•°</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>å¯¹äºåŸºç±»çš„æ¯ä¸ªæ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨éƒ½åœ¨æ´¾ç”Ÿç±»ä¸­ç”Ÿæˆä¸€ä¸ªå½¢å‚åˆ—è¡¨å®Œå…¨ç›¸åŒçš„æ„é€ å‡½æ•°ã€‚åœ¨æˆ‘ä»¬çš„ Bulk_quote ç±»ä¸­ï¼Œç»§æ‰¿çš„æ„é€ å‡½æ•°ç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">Bulk_quote</span>(<span class="hljs-type">const</span> std::strings book, <span class="hljs-type">double</span> price, std::<span class="hljs-type">size_t</span> qty, <span class="hljs-type">double</span> disc):<br>    <span class="hljs-built_in">Disc_quote</span>(book, price, qty, disc) &#123; &#125;<br></code></pre></td></tr></table></figure><p><strong>ç»§æ‰¿çš„æ„é€ å‡½æ•°çš„ç‰¹ç‚¹</strong><br>ä¸€ä¸ªæ„é€ å‡½æ•°çš„ using å£°æ˜ä¸ä¼šæ”¹å˜è¯¥æ„é€ å‡½æ•°çš„è®¿é—®çº§åˆ«ã€‚ä¸€ä¸ª using å£°æ˜è¯­å¥ä¸èƒ½æŒ‡å®š explicit æˆ– constexprã€‚å¦‚æœåŸºç±»çš„æ„é€ å‡½æ•°æ˜¯ explicit æˆ–è€… constexprï¼Œåˆ™ç»§æ‰¿çš„æ„é€ å‡½æ•°ä¹Ÿæ‹¥æœ‰ç›¸åŒçš„å±æ€§ã€‚<br>å½“ä¸€ä¸ªåŸºç±»æ„é€ å‡½æ•°å«æœ‰é»˜è®¤å®å‚æ—¶ï¼Œè¿™äº›å®å‚å¹¶ä¸ä¼šè¢«ç»§æ‰¿ã€‚ç›¸åï¼Œæ´¾ç”Ÿç±»å°†è·å¾—å¤šä¸ªç»§æ‰¿çš„æ„é€ å‡½æ•°ï¼Œå…¶ä¸­æ¯ä¸ªæ„é€ å‡½æ•°åˆ†åˆ¥çœç•¥æ‰ä¸€ä¸ªå«æœ‰é»˜è®¤å®å‚çš„å½¢å‚ã€‚<br>å¦‚æœæ´¾ç”Ÿç±»å®šä¹‰çš„æ„é€ å‡½æ•°ä¸åŸºç±»çš„æ„é€ å‡½æ•°å…·æœ‰ç›¸é—®çš„å‚æ•°åˆ—è¡¨ï¼Œåˆ™è¯¥æ„é€ å‡½æ•°å°†ä¸ä¼šè¢«ç»§æ‰¿ã€‚å®šä¹‰åœ¨æ´¾ç”Ÿç±»ä¸­çš„æ„é€ å‡½æ•°å°†æ›¿æ¢ç»§æ‰¿è€Œæ¥çš„æ„é€ å‡½æ•°ã€‚<br>é»˜è®¤ã€æ‹·è´å’Œç§»åŠ¨æ„é€ å‡½æ•°ä¸ä¼šè¢«ç»§æ‰¿ã€‚å¦‚æœä¸€ä¸ªç±»åªå«æœ‰ç»§æ‰¿çš„æ„é€ å‡½æ•°ï¼Œåˆ™å®ƒä¹Ÿå°†æ‹¥æœ‰ä¸€ä¸ªåˆæˆçš„é»˜è®¤æ„é€ å‡½æ•°ã€‚</p><h2 id="15-8-å®¹å™¨ä¸ç»§æ‰¿"><a href="#15-8-å®¹å™¨ä¸ç»§æ‰¿" class="headerlink" title="15.8 å®¹å™¨ä¸ç»§æ‰¿"></a>15.8 å®¹å™¨ä¸ç»§æ‰¿</h2><p>å½“æ´¾ç”Ÿç±»å¯¹è±¡è¢«èµ‹å€¼ç»™åŸºç±»å¯¹è±¡æ—¶ï¼Œå…¶ä¸­çš„æ´¾ç”Ÿç±»éƒ¨åˆ†å°†è¢«â€œåˆ‡æ‰â€ï¼Œå› æ­¤å®¹å™¨å’Œå­˜åœ¨ç»§æ‰¿å…³ç³»çš„ç±»å‹æ— æ³•å…¼å®¹ã€‚</p><p><strong>åœ¨å®¹å™¨ä¸­æ”¾ç½®ï¼ˆæ™ºèƒ½ï¼‰æŒ‡é’ˆè€Œéå¯¹è±¡</strong><br>å½“æˆ‘ä»¬å¸Œæœ›åœ¨å®¹å™¨ä¸­å­˜æ”¾å…·æœ‰ç»§æ‰¿å…³ç³»çš„å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šå­˜æ”¾çš„é€šå¸¸æ˜¯åŸºç±»çš„æŒ‡é’ˆã€‚</p><h1 id="ç¬¬åå…­ç« -æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹"><a href="#ç¬¬åå…­ç« -æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹" class="headerlink" title="ç¬¬åå…­ç«  æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹"></a>ç¬¬åå…­ç«  æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹</h1><h2 id="16-1-å®šä¹‰æ¨¡æ¿"><a href="#16-1-å®šä¹‰æ¨¡æ¿" class="headerlink" title="16.1 å®šä¹‰æ¨¡æ¿"></a>16.1 å®šä¹‰æ¨¡æ¿</h2><h3 id="16-1-1-å‡½æ•°æ¨¡æ¿"><a href="#16-1-1-å‡½æ•°æ¨¡æ¿" class="headerlink" title="16.1.1 å‡½æ•°æ¨¡æ¿"></a>16.1.1 å‡½æ•°æ¨¡æ¿</h3><p><strong>æ¨¡æ¿ç±»å‹å‚æ•°</strong><br>ç±»å‹å‚æ•°å‰å¿…é¡»ä½¿ç”¨å…³é”®å­— class æˆ– typename</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">class</span> <span class="hljs-title class_">U</span>&gt; <span class="hljs-built_in">calc</span> (<span class="hljs-type">const</span> T&amp;, <span class="hljs-type">const</span> U&amp;);<br><span class="hljs-comment">// æ­£ç¡®ï¼šåœ¨æ¨¡æ¿å‚æ•°åˆ—è¡¨ä¸­ï¼Œtypename å’Œ class æ²¡æœ‰ä»€ä¹ˆä¸åŒ</span><br></code></pre></td></tr></table></figure><p><strong>éç±»å‹æ¨¡æ¿å‚æ•°</strong><br>å½“ä¸€ä¸ªæ¨¡æ¿è¢«å®ä¾‹åŒ–æ—¶ï¼Œéç±»å‹å‚æ•°è¢«ä¸€ä¸ªç”¨æˆ·æä¾›çš„æˆ–ç¼–è¯‘å™¨æ¨æ–­å‡ºçš„å€¼æ‰€ä»£æ›¿ã€‚è¿™äº›å€¼å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-type">unsigned</span> N, <span class="hljs-type">unsigned</span> M&gt;</span><br><span class="hljs-function">    <span class="hljs-type">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> (&amp;pl)[N], <span class="hljs-type">const</span> <span class="hljs-type">char</span> (&amp;p2)[M])</span></span><br><span class="hljs-function">        <span class="hljs-keyword">return</span> <span class="hljs-title">strcrap</span><span class="hljs-params">(p1, p2)</span></span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬è°ƒç”¨ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">compare</span>(<span class="hljs-string">&quot;hi&quot;</span>, <span class="hljs-string">&quot;mom&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä½¿ç”¨å­—é¢å¸¸é‡çš„å¤§å°æ¥ä»£æ›¿ N å’Œ Mï¼Œä»è€Œå®ä¾‹åŒ–æ¨¡æ¿ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> (&amp;pl)[<span class="hljs-number">3</span>], <span class="hljs-type">const</span> <span class="hljs-type">char</span> (&amp;p2)[<span class="hljs-number">4</span>])</span></span><br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªéç±»å‹å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªæ•´å‹ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡æˆ–å‡½æ•°ç±»å‹çš„æŒ‡é’ˆæˆ–ï¼ˆå·¦å€¼ï¼‰å¼•ç”¨ã€‚ç»‘å®šåˆ°éç±»å‹æ•´å‹å‚æ•°çš„å®å‚å¿…é¡»æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ã€‚ç»‘å®šåˆ°æŒ‡é’ˆæˆ–å¼•ç”¨éç±»å‹å‚æ•°çš„å®å‚å¿…é¡»å…·æœ‰é™æ€çš„ç”Ÿå­˜æœŸã€‚é’ˆå‚æ•°ä¹Ÿå¯ä»¥ç”¨ nullptr æˆ–ä¸€ä¸ªå€¼ä¸º 0 çš„å¸¸é‡è¡¨è¾¾å¼æ¥å®ä¾‹åŒ–ã€‚</p><p><strong>æ¨¡æ¿ç¼–è¯‘</strong><br>ç¼–è¯‘å™¨é‡åˆ°ä¸€ä¸ªæ¨¡æ¿å®šä¹‰æ—¶ï¼Œå®ƒå¹¶ä¸ç”Ÿæˆä»£ç ã€‚åªæœ‰å½“æˆ‘ä»¬å®ä¾‹åŒ–å‡ºæ¨¡æ¿çš„ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬æ—¶ï¼Œç¼–è¯‘å™¨æ‰ä¼šç”Ÿæˆä»£ç ã€‚<br>å‡½æ•°æ¨¡æ¿å’Œç±»æ¨¡æ¿æˆå‘˜å‡½æ•°çš„å®šä¹‰é€šå¸¸æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ã€‚</p><p><strong>å¤§å¤šæ•°ç¼–è¯‘é”™è¯¯åœ¨å®ä¾‹åŒ–æœŸé—´æŠ¥å‘Š</strong><br>é€šå¸¸ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ä¸‰ä¸ªé˜¶æ®µæŠ¥å‘Šé”™è¯¯ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯ç¼–è¯‘æ¨¡æ¿æœ¬èº«æ—¶ã€‚åœ¨è¿™ä¸ªé˜¶æ®µç¼–è¯‘å™¨å¯ä»¥æ£€æŸ¥è¯­æ³•é”™è¯¯ã€‚</li><li>ç¬¬äºŒä¸ªé˜¶æ®µæ˜¯ç¼–è¯‘å™¨é‡åˆ°æ¨¡æ¿ä½¿ç”¨æ—¶ã€‚åœ¨æ­¤é˜¶æ®µç¼–è¯‘å™¨é€šå¸¸ä¼šæ£€æŸ¥å®å‚æ•°ç›®æ˜¯å¦æ­£ç¡®ï¼Œå®ƒè¿˜èƒ½æ£€æŸ¥å‚æ•°ç±»å‹æ˜¯å¦åŒ¹é…ã€‚</li><li>ç¬¬ä¸‰ä¸ªé˜¶æ®µæ˜¯æ¨¡æ¿å®ä¾‹åŒ–æ—¶ï¼Œåªæœ‰è¿™ä¸ªé˜¶æ®µæ‰èƒ½å‘ç°ç±»å‹ç›¸å…³çš„é”™è¯¯ã€‚ä¾èµ–äºç¼–è¯‘å™¨å¦‚ä½•ç®¡ç†å®ä¾‹åŒ–ï¼Œè¿™ç±»é”™è¯¯å¯èƒ½åœ¨é“¾æ¥æ—¶æ‰æŠ¥å‘Šã€‚</li></ul><h3 id="16-1-2-ç±»æ¨¡æ¿"><a href="#16-1-2-ç±»æ¨¡æ¿" class="headerlink" title="16.1.2 ç±»æ¨¡æ¿"></a>16.1.2 ç±»æ¨¡æ¿</h3><p>ç¼–è¯‘å™¨ä¸èƒ½ä¸ºç±»æ¨¡æ¿æ¨æ–­æ¨¡æ¿å‚æ•°ç±»å‹ã€‚</p><p><strong>å®ä¾‹åŒ–ç±»æ¨¡æ¿</strong><br>ä¸€ä¸ªç±»æ¨¡æ¿çš„æ¯ä¸ªå®ä¾‹éƒ½å½¢æˆä¸€ä¸ªç‹¬ç«‹çš„ç±»ã€‚ç±»å‹<code>Blob&lt;string&gt;</code>ä¸ä»»ä½•å…¶ä»– Blob ç±»å‹éƒ½æ²¡æœ‰å…³è”ã€‚</p><p><strong>åœ¨æ¨¡æ¿ä½œç”¨åŸŸä¸­å¼•ç”¨æ¨¡æ¿ç±»å‹</strong><br>ç±»æ¨¡æ¿çš„åå­—ä¸æ˜¯ä¸€ä¸ªç±»å‹åï¼Œç±»æ¨¡æ¿ç”¨æ¥å®ä¾‹åŒ–ç±»å‹ï¼Œè€Œä¸€ä¸ªå®ä¾‹åŒ–çš„ç±»å‹æ€»æ˜¯åŒ…å«æ¨¡æ¿å‚æ•°çš„ã€‚</p><p><strong>ç±»æ¨¡æ¿çš„æˆå‘˜å‡½æ•°</strong><br>å®šä¹‰åœ¨ç±»æ¨¡æ¿ä¹‹å¤–çš„æˆå‘˜å‡½æ•°å°±å¿…é¡»ä»¥å…³é”®å­— template å¼€å§‹ï¼Œåæ¥ç±»æ¨¡æ¿å‚æ•°åˆ—è¡¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br>    ret_type class_name&lt;T&gt;::<span class="hljs-built_in">member_name</span>(parm_list)<br></code></pre></td></tr></table></figure><p><strong>ç±»æ¨¡æ¿æˆå‘˜å‡½æ•°çš„å®ä¾‹åŒ–</strong><br>å¯¹äºä¸€ä¸ªå®ä¾‹åŒ–äº†çš„ç±»æ¨¡æ¿ï¼Œå…¶æˆå‘˜åªæœ‰åœ¨ä½¿ç”¨æ—¶æ‰è¢«å®ä¾‹åŒ–ã€‚</p><p><strong>åœ¨ç±»ä»£ç å†…ç®€åŒ–æ¨¡æ¿ç±»åçš„ä½¿ç”¨</strong><br>å½“æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç±»æ¨¡æ¿ç±»å‹æ—¶å¿…é¡»æä¾›æ¨¡æ¿å®å‚ï¼Œä½†æ˜¯åœ¨ç±»æ¨¡æ¿è‡ªå·±çš„ä½œç”¨åŸŸä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æ¨¡æ¿åè€Œä¸æä¾›å®å‚ã€‚</p><p><strong>ä¸€å¯¹ä¸€å‹å¥½å…³ç³»</strong><br>ç±»æ¨¡æ¿ä¸å¦ä¸€ä¸ªï¼ˆç±»æˆ–å‡½æ•°ï¼‰æ¨¡æ¿é—´å‹å¥½å…³ç³»çš„æœ€å¸¸è§çš„å½¢å¼æ˜¯å»ºç«‹å¯¹åº”å®ä¾‹åŠå…¶å‹å…ƒé—´çš„å‹å¥½å…³ç³»ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span>&gt; <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlobPtr</span>;<br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">class</span> <span class="hljs-title class_">Blob</span> &#123;<br>    <span class="hljs-comment">//æ¯ä¸ªBlobå®ä¾‹å°†è®¿é—®æƒé™æˆäºˆç”¨ç›¸åŒç±»å‹å®ä¾‹åŒ–çš„BlobPtrå’Œç›¸ç­‰è¿ç®—ç¬¦</span><br>    <span class="hljs-keyword">friend</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlobPtr</span>&lt;T&gt;;<br>&#125;;<br><br>Blob&lt;<span class="hljs-type">char</span>&gt; ca; <span class="hljs-comment">// BlobPtr&lt;char&gt; æ˜¯æœ¬å¯¹è±¡çš„å‹å…ƒ</span><br></code></pre></td></tr></table></figure><p>BlobPtr<char> çš„æˆå‘˜å¯ä»¥è®¿é—®ä»»ä½•å…¶ä»– Blob<char> å¯¹è±¡çš„é public éƒ¨åˆ†ï¼Œä½† ca å¯¹ Blob çš„ä»»ä½•å…¶ä»–å®ä¾‹éƒ½æ²¡æœ‰ç‰¹æ®Šè®¿é—®æƒé™ã€‚</p><p><strong>é€šç”¨å’Œç‰¹å®šçš„æ¨¡æ¿å‹å¥½å…³ç³»</strong><br>ä¸€ä¸ªç±»ä¹Ÿå¯ä»¥å°†å¦ä¸€ä¸ªæ¨¡æ¿çš„æ¯ä¸ªå®ä¾‹éƒ½å£°æ˜ä¸ºè‡ªå·±çš„å‹å…ƒï¼Œæˆ–è€…é™å®šç‰¹å®šçš„å®ä¾‹ä¸ºå‹å…ƒï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// å‰ç½®å£°æ˜ï¼Œåœ¨å°†æ¨¡æ¿çš„ä¸€ä¸ªç‰¹å®šå®ä¾‹å£°æ˜ä¸ºå‹å…ƒæ—¶è¦ç”¨åˆ°</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pal</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> &#123; <span class="hljs-comment">// C æ˜¯ä¸€ä¸ªæ™®é€šçš„éæ¨¡æ¿ç±»</span><br>    <span class="hljs-keyword">friend</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pal</span>&lt;C&gt;; <span class="hljs-comment">// ç”¨ç±» C å®ä¾‹åŒ–çš„ Pal æ˜¯ C çš„ä¸€ä¸ªå‹å…ƒ</span><br>    <span class="hljs-comment">// Ğ Ğ°12 çš„æ‰€æœ‰å®ä¾‹éƒ½æ˜¯ Ğ¡ çš„å‹å…ƒï¼Œè¿™ç§æƒ…å†µæ— é¡»å‰ç½®å£°æ˜</span><br>    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">friend</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pal2</span>;<br>&#125;;<br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">class</span> <span class="hljs-title class_">C2</span> &#123; <span class="hljs-comment">// C2 æœ¬èº«æ˜¯ä¸€ä¸ªç±»æ¨¡æ¿</span><br>    <span class="hljs-comment">// C2 çš„æ¯ä¸ªå®ä¾‹å°†ç›¸åŒå®ä¾‹åŒ–çš„ Pal å£°æ˜ä¸ºå‹å…ƒ</span><br>    <span class="hljs-keyword">friend</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pal</span>&lt;T&gt;; <span class="hljs-comment">// Pal çš„æ¨¡æ¿å£°æ˜å¿…é¡»åœ¨ä½œç”¨åŸŸä¹‹å†…</span><br>    <span class="hljs-comment">// Pal2 çš„æ‰€æœ‰å®ä¾‹éƒ½æ˜¯ C2 çš„æ¯ä¸ªå®ä¾‹çš„å‹å…ƒï¼Œä¸éœ€è¦å‰ç½®å£°æ˜</span><br>    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> X&gt; <span class="hljs-keyword">friend</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pal2</span>;<br>    <span class="hljs-comment">// Pal3 æ˜¯ä¸€ä¸ªéæ¨¡æ¿ç±»ï¼Œå®ƒæ˜¯ C2 æ‰€æœ‰å®ä¾‹çš„å‹å…ƒ</span><br>    <span class="hljs-keyword">friend</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pal3</span>; <span class="hljs-comment">// ä¸éœ€è¦ Pal3 çš„å‰ç½®å£°æ˜</span><br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>ä»¤æ¨¡æ¿è‡ªå·±çš„ç±»å‹å‚æ•°æˆä¸ºå‹å…ƒ</strong><br>æˆ‘ä»¬å¯ä»¥å°†æ¨¡æ¿ç±»å‹å‚æ•°å£°æ˜ä¸ºå‹å…ƒï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Type&gt; <span class="hljs-keyword">class</span> <span class="hljs-title class_">Bar</span> &#123;<br>    <span class="hljs-keyword">friend</span> Type; <span class="hljs-comment">// å°†è®¿é—®æƒé™æˆäºˆç”¨æ¥å®ä¾‹åŒ–Barçš„ç±»å‹</span><br>    <span class="hljs-comment">//...</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>å¯¹äºæŸä¸ªç±»å‹å Nameï¼ŒName å°†æˆä¸º Bar<name> çš„å‹å…ƒã€‚</p><p><strong>æ¨¡æ¿ç±»å‹åˆ«å</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> Blob&lt;string&gt; StrBlob;<br></code></pre></td></tr></table></figure><p>æ–°æ ‡å‡†å…è®¸æˆ‘ä»¬ä¸ºç±»æ¨¡æ¿å®šä¹‰ä¸€ä¸ªç±»å‹åˆ«å:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">using</span> twin = pair&lt;T, T&gt;;<br>twin&lt;string&gt; authors; <span class="hljs-comment">// authors æ˜¯ä¸€ä¸ª pair&lt;string, string&gt;</span><br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¨¡æ¿ç±»å‹åˆ«åæ—¶ï¼Œå¯ä»¥å›ºå®šä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡æ¿å‚æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">using</span> partNo = pair&lt;T, <span class="hljs-type">unsigned</span>&gt;;<br>partNo&lt;string&gt; books; <span class="hljs-comment">// books æ˜¯ä¸€ä¸ª pair&lt;string, unsigned&gt;</span><br></code></pre></td></tr></table></figure><p><strong>ç±»æ¨¡æ¿çš„ static æˆå‘˜</strong><br>æ¯ä¸ªå®ä¾‹éƒ½æœ‰å…¶è‡ªå·±çš„ static æˆå‘˜å®ä¾‹ã€‚<br>æ¨¡æ¿ç±»çš„æ¯ä¸ªstatic æ•°æ®æˆå‘˜å¿…é¡»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå®šä¹‰ã€‚ä½†æ˜¯ï¼Œç±»æ¨¡æ¿çš„æ¯ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä¸ªç‹¬æœ‰çš„ static å¯¹è±¡ã€‚å› æ­¤ï¼Œä¸å®šä¹‰æ¨¡æ¿çš„æˆå‘˜å‡½æ•°ç±»ä¼¼ï¼Œæˆ‘ä»¬å°† static æ•°æ®æˆå‘˜ä¹Ÿå®šä¹‰ä¸ºæ¨¡æ¿ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">size_t</span> Foo&lt;T&gt;::ctr = <span class="hljs-number">0</span>; <span class="hljs-comment">// å®šä¹‰å¹¶åˆå§‹åŒ– ctr</span><br></code></pre></td></tr></table></figure><p>ä¸ºäº†é€šè¿‡ç±»æ¥ç›´æ¥è®¿é—® static æˆå‘˜ï¼Œæˆ‘ä»¬å¿…é¡»å¼•ç”¨ä¸€ä¸ªç‰¹å®šçš„å®ä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Foo&lt;<span class="hljs-type">int</span>&gt; fi; <br><span class="hljs-keyword">auto</span> ct = Foo&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">count</span>(); <span class="hljs-comment">// å®ä¾‹åŒ– Foo&lt;int&gt;::count</span><br>ct = fi.<span class="hljs-built_in">count</span>(); <span class="hljs-comment">// ä½¿ç”¨ Foo&lt;int&gt;::count</span><br>ct = Foo::<span class="hljs-built_in">count</span>(); <span class="hljs-comment">// é”™è¯¯</span><br></code></pre></td></tr></table></figure><h3 id="16-1-3-æ¨¡æ¿å‚æ•°"><a href="#16-1-3-æ¨¡æ¿å‚æ•°" class="headerlink" title="16.1.3 æ¨¡æ¿å‚æ•°"></a>16.1.3 æ¨¡æ¿å‚æ•°</h3><p>æˆ‘ä»¬é€šå¸¸å°†ç±»å‹å‚æ•°å‘½åä¸º Tï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•åå­—ã€‚</p><p><strong>æ¨¡æ¿å‚æ•°ä¸ä½œç”¨åŸŸ</strong><br>æ¨¡æ¿å‚æ•°ä¼šéšè—å¤–å±‚ä½œç”¨åŸŸä¸­å£°æ˜çš„ç›¸åŒåå­—ã€‚ä½†æ˜¯åœ¨æ¨¡æ¿å†…ä¸èƒ½é‡ç”¨æ¨¡æ¿å‚æ•°åã€‚</p><p><strong>æ¨¡æ¿å£°æ˜</strong><br>å£°æ˜ä¸­çš„æ¨¡æ¿å‚æ•°çš„åå­—ä¸å¿…ä¸å®šä¹‰ä¸­ç›¸åŒã€‚<br>ä¸€ä¸ªç‰¹å®šæ–‡ä»¶æ‰€éœ€è¦çš„æ‰€æœ‰æ¨¡æ¿çš„å£°æ˜é€šå¸¸ä¸€èµ·æ”¾ç½®åœ¨æ–‡ä»¶å¼€å§‹ä½ç½®ï¼Œå‡ºç°äºä»»ä½•ä½¿ç”¨è¿™äº›æ¨¡æ¿çš„ä»£ç ä¹‹å‰ã€‚</p><p><strong>ä½¿ç”¨ç±»çš„ç±»å‹æˆå‘˜</strong><br>å‡å®š T æ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»å‹å‚æ•°ï¼Œå½“ç¼–è¯‘å™¨é‡åˆ°ç±»ä¼¼ T::mem è¿™æ ·çš„ä»£ç æ—¶ï¼Œå®ƒä¸ä¼šçŸ¥é“ mem æ˜¯ä¸€ä¸ªç±»å‹æˆå‘˜è¿˜æ˜¯ä¸€ä¸ª static æ•°æ®æˆå‘˜ï¼Œç›´è‡³å®ä¾‹åŒ–æ—¶æ‰ä¼šçŸ¥é“ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒC++ å‡å®šé€šè¿‡ä½œç”¨åŸŸè¿ç®—ç¬¦è®¿é—®çš„åå­—ä¸æ˜¯ç±»å‹ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ä¸€ä¸ªæ¨¡æ¿ç±»å‹å‚æ•°çš„ç±»å‹æˆå‘˜ï¼Œå°±å¿…é¡»æ˜¾å¼å‘Šè¯‰ç¼–è¯‘å™¨è¯¥åå­—æ˜¯ä¸€ä¸ªç±»å‹ï¼Œé€šè¿‡ä½¿ç”¨å…³é”®å­— typename æ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-function"><span class="hljs-keyword">typename</span> T::value_type <span class="hljs-title">top</span> <span class="hljs-params">(<span class="hljs-type">const</span> T&amp; c)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typename</span> T::<span class="hljs-built_in">value_type</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å¸Œæœ›é€šçŸ¥ç¼–è¯‘å™¨ä¸€ä¸ªåå­—è¡¨ç¤ºç±»å‹æ—¶ï¼Œå¿…é¡»ä½¿ç”¨å…³é”®å­— typenameï¼Œè€Œä¸èƒ½ä½¿ç”¨ classã€‚</p><p><strong>é»˜è®¤æ¨¡æ¿å®å‚</strong><br>ä¸å‡½æ•°é»˜è®¤å®å‚ä¸€æ ·ï¼Œå¯¹äºä¸€ä¸ªæ¨¡æ¿å‚æ•°ï¼Œåªæœ‰å½“å®ƒå³ä¾§çš„æ‰€æœ‰å‚æ•°éƒ½æœ‰é»˜è®¤å®å‚æ—¶, å®ƒæ‰å¯ä»¥æœ‰é»˜è®¤å®å‚ã€‚</p><p><strong>æ¨¡æ¿é»˜è®¤å®å‚ä¸ç±»æ¨¡æ¿</strong><br>å¦‚æœä¸€ä¸ªç±»æ¨¡æ¿ä¸ºå…¶æ‰€æœ‰æ¨¡æ¿å‚æ•°éƒ½æä¾›äº†é»˜è®¤å®å‚ï¼Œä¸”æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨è¿™äº›é»˜è®¤å®å‚ï¼Œå°±å¿…é¡»åœ¨æ¨¡æ¿åä¹‹åè·Ÿä¸€ä¸ªç©ºå°–æ‹¬å·å¯¹ã€‚</p><h3 id="16-1-4-æˆå‘˜æ¨¡æ¿"><a href="#16-1-4-æˆå‘˜æ¨¡æ¿" class="headerlink" title="16.1.4 æˆå‘˜æ¨¡æ¿"></a>16.1.4 æˆå‘˜æ¨¡æ¿</h3><p>æˆå‘˜æ¨¡æ¿ä¸èƒ½æ˜¯è™šå‡½æ•°ã€‚</p><p><strong>ç±»æ¨¡æ¿çš„æˆå‘˜æ¨¡æ¿</strong><br>å½“æˆ‘ä»¬åœ¨ç±»æ¨¡æ¿å¤–å®šä¹‰ä¸€ä¸ªæˆå‘˜æ¨¡æ¿æ—¶ï¼Œå¿…é¡»åŒæ—¶ä¸ºç±»æ¨¡æ¿å’Œæˆå‘˜æ¨¡æ¿æä¾›æ¨¡æ¿å‚æ•°åˆ—è¡¨ã€‚ç±»æ¨¡æ¿çš„å‚æ•°åˆ—è¡¨åœ¨å‰ï¼Œåè·Ÿæˆå‘˜è‡ªå·±çš„æ¨¡æ¿å‚æ•°åˆ—è¡¨ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-comment">// ç±»çš„ç±»å‹å‚æ•°</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> It&gt; <span class="hljs-comment">// æ„é€ å‡½æ•°çš„ç±»å‹å‚æ•¸</span><br>    Blob&lt;T&gt;::<span class="hljs-built_in">Blob</span>(It b, It e) :<br>        <span class="hljs-built_in">data</span>(std::make_shared&lt;std::vector&lt;T&gt;&gt;(b, e)) &#123; &#125;<br></code></pre></td></tr></table></figure><h3 id="16-1-5-æ§åˆ¶å®ä¾‹åŒ–"><a href="#16-1-5-æ§åˆ¶å®ä¾‹åŒ–" class="headerlink" title="16.1.5 æ§åˆ¶å®ä¾‹åŒ–"></a>16.1.5 æ§åˆ¶å®ä¾‹åŒ–</h3><p>åœ¨å¤šä¸ªæ–‡ä»¶ä¸­å®ä¾‹åŒ–ç›¸åŒæ¨¡æ¿çš„é¢å¤–å¼€é”€å¯èƒ½éå¸¸ä¸¥é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ˜¾å¼å®ä¾‹åŒ–æ¥é¿å…è¿™ç§å¼€é”€ã€‚<br>å½“ç¼–è¯‘å™¨é‡åˆ° extern æ¨¡æ¿å£°æ˜æ—¶ï¼Œå®ƒä¸ä¼šåœ¨æœ¬æ–‡ä»¶ä¸­ç”Ÿæˆå®ä¾‹åŒ–ä»£ç ã€‚å°†ä¸€ä¸ªå®ä¾‹åŒ–å£°æ˜ä¸º extern å°±è¡¨ç¤ºæ‰¿è¯ºåœ¨ç¨‹åºå…¶ä»–ä½ç½®æœ‰è¯¥å®ä¾‹åŒ–çš„ä¸€ä¸ªé extern å£°æ˜ï¼ˆå®šä¹‰ï¼‰ã€‚å¯¹äºä¸€ä¸ªç»™å®šçš„å®ä¾‹åŒ–ç‰ˆæœ¬ï¼Œå¯èƒ½æœ‰å¤šä¸ª extern å£°æ˜ï¼Œä½†å¿…é¡»åªæœ‰ä¸€ä¸ªå®šä¹‰ã€‚extern å£°æ˜å¿…é¡»å‡ºç°åœ¨ä»»ä½•ä½¿ç”¨æ­¤å®ä¾‹åŒ–ç‰ˆæœ¬çš„ä»£ç ä¹‹å‰ã€‚<br>å®ä¾‹åŒ–æ–‡ä»¶å¿…é¡»ä¸ºæ¯ä¸ªåœ¨å…¶ä»–æ–‡ä»¶ä¸­å£°æ˜ä¸º extern çš„ç±»å‹å’Œå‡½æ•°æä¾›ä¸€ä¸ªï¼ˆéexternï¼‰çš„å®šä¹‰ã€‚<br>å½“ç¼–è¯‘å™¨é‡åˆ°ä¸€ä¸ªå®ä¾‹åŒ–å®šä¹‰æ—¶ï¼Œå®ƒä¸ºå…¶ç”Ÿæˆä»£ç ã€‚<br>å®ä¾‹åŒ–å®šä¹‰ä¼šå®ä¾‹åŒ–æ‰€æœ‰æˆå‘˜ã€‚</p><h3 id="16-2-2-å‡½æ•°æ¨¡æ¿æ˜¾å¼å®å‚"><a href="#16-2-2-å‡½æ•°æ¨¡æ¿æ˜¾å¼å®å‚" class="headerlink" title="16.2.2 å‡½æ•°æ¨¡æ¿æ˜¾å¼å®å‚"></a>16.2.2 å‡½æ•°æ¨¡æ¿æ˜¾å¼å®å‚</h3><p><strong>æŒ‡å®šæ˜¾å¼æ¨¡æ¿å®å‚</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ç¼–è¯‘å™¨æ— æ³•æ¨æ–­T1ï¼Œå®ƒæœªå‡ºç°åœ¨å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tl, <span class="hljs-keyword">typename</span> T2, <span class="hljs-keyword">typename</span> T3&gt;<br><span class="hljs-function">T1 <span class="hljs-title">sum</span><span class="hljs-params">(T2, T3)</span></span>;<br></code></pre></td></tr></table></figure><p>æ²¡æœ‰ä»»ä½•å‡½æ•°å®å‚çš„ç±»å‹å¯ç”¨ç±³æ¨æ–­ Tl çš„ç±»å‹ã€‚æ¯æ¬¡è°ƒç”¨ sum æ—¶è°ƒç”¨è€…éƒ½å¿…é¡»ä¸º T1 æä¾›ä¸€ä¸ªæ˜¾å¼æ¨¡æ¿å®å‚:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// T1 æ˜¯æ˜¾å¼æŒ‡å®šçš„ï¼ŒT2 å’Œ T3 æ˜¯ä»å‡½æ•°å®å‚ç±»å‹æ¨æ–­è€Œæ¥çš„</span><br><span class="hljs-keyword">auto</span> val3 = <span class="hljs-built_in">sum</span>&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>&gt;(i, lng); <span class="hljs-comment">// long long sum(int, long)</span><br></code></pre></td></tr></table></figure><p>æ˜¾å¼æ¨¡æ¿å®å‚æŒ‰ç”±å·¦è‡³å³çš„é¡ºåºä¸å¯¹åº”çš„æ¨¡æ¿å‚æ•°åŒ¹é…ï¼Œåªæœ‰å°¾éƒ¨ï¼ˆæœ€å³ï¼‰å‚æ•°çš„æ˜¾å¼æ¨¡æ¿å®å‚æ‰å¯ä»¥å¿½ç•¥ï¼Œè€Œä¸”å‰ææ˜¯å®ƒä»¬å¯ä»¥ä»å‡½æ•°å‚æ•°æ¨æ–­å‡ºæ¥ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ç³Ÿç³•çš„è®¾è®¡ï¼šç”¨æˆ·å¿…é¡»æŒ‡å®šæ‰€æœ‰ä¸‰ä¸ªæ¨¡æ¿å‚æ•°</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tl, <span class="hljs-keyword">typename</span> T2, <span class="hljs-keyword">typename</span> T3&gt;<br><span class="hljs-function">T3 <span class="hljs-title">alternative_sum</span><span class="hljs-params">(T2, Tl)</span></span>;<br><span class="hljs-keyword">auto</span> val2 = <span class="hljs-built_in">alternative_sum</span>&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>, <span class="hljs-type">int</span>, <span class="hljs-type">long</span>&gt;(i, lng);<br></code></pre></td></tr></table></figure><p><strong>æ­£å¸¸ç±»å‹è½¬æ¢åº”ç”¨äºæ˜¾å¼æŒ‡å®šçš„å®å‚</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">long</span> lng;<br><span class="hljs-built_in">compare</span> (lng, <span class="hljs-number">1024</span>); <span class="hljs-comment">// é”™è¯¯ï¼šæ¨¡æ¿å‚æ•°ä¸åŒ¹é…</span><br><span class="hljs-built_in">compare</span>&lt;<span class="hljs-type">long</span>&gt; (lng, <span class="hljs-number">1024</span>); <span class="hljs-comment">// æ­£ç¡®ï¼šå®ä¾‹åŒ– compare (long, long)</span><br><span class="hljs-built_in">compare</span>&lt;<span class="hljs-type">int</span>&gt; (lng, <span class="hljs-number">1024</span>); <span class="hljs-comment">// æ­£ç¡®ï¼šå®ä¾‹åŒ– compare (int, int)</span><br></code></pre></td></tr></table></figure><h3 id="16-2-3-å°¾ç½®è¿”å›ç±»å‹ä¸ç±»å‹è½¬æ¢"><a href="#16-2-3-å°¾ç½®è¿”å›ç±»å‹ä¸ç±»å‹è½¬æ¢" class="headerlink" title="16.2.3 å°¾ç½®è¿”å›ç±»å‹ä¸ç±»å‹è½¬æ¢"></a>16.2.3 å°¾ç½®è¿”å›ç±»å‹ä¸ç±»å‹è½¬æ¢</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> It&gt;<br>??? &amp;<span class="hljs-built_in">fcn</span>(It beg, It end) &#123;<br>    <span class="hljs-keyword">return</span> *beg; <span class="hljs-comment">// è¿”å›åºåˆ—ä¸­ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ç¼–è¯‘å™¨é‡åˆ°å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¹‹å‰ï¼Œbeg éƒ½æ˜¯ä¸å­˜åœ¨çš„ã€‚ä¸ºäº†å®šä¹‰æ­¤å‡½æ•°ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨å°¾ç½®è¿”å›ç±»å‹ã€‚ç”±äºå°¾ç½®è¿”å›å‡ºç°åœ¨å‚æ•°åˆ—è¡¨ä¹‹åï¼Œå®ƒå¯ä»¥ä½¿ç”¨å‡½æ•°çš„å‚æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// å°¾ç½®è¿”å›å…è®¸æˆ‘ä»¬åœ¨å‚æ•°åˆ—è¡¨ä¹‹åå£°æ˜è¿”å›ç±»å‹</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> It&gt;<br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">fcn</span> <span class="hljs-params">(It beg, It end)</span> -&gt; <span class="hljs-title">decltype</span><span class="hljs-params">(*beg)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> *beg; <span class="hljs-comment">// è¿”å›åºåˆ—ä¸­ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>è¿›è¡Œç±»å‹è½¬æ¢çš„æ ‡å‡†åº“æ¨¡æ¿ç±»</strong><br>ä¸ºäº†è·å¾—å…ƒç´ ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡å‡†åº“çš„ç±»å‹è½¬æ¢æ¨¡æ¿ã€‚remove_reference æ¨¡æ¿æœ‰ä¸€ä¸ªæ¨¡æ¿ç±»å‹å‚æ•°å’Œä¸€ä¸ªåä¸º type çš„ public ç±»å‹æˆå‘˜ã€‚å¦‚æœæˆ‘ä»¬ç”¨ä¸€ä¸ªå¼•ç”¨ç±»å‹å®ä¾‹åŒ– remove_referenceï¼Œåˆ™ type å°†è¡¨ç¤ºè¢«å¼•ç”¨çš„ç±»å‹ã€‚<br><code>decltype(*beg)</code>è¿”å›å…ƒç´ ç±»å‹çš„å¼•ç”¨ç±»å‹ã€‚<code>remove_reference::type</code>è„±å»å¼•ç”¨ï¼Œå‰©ä¸‹å…ƒç´ ç±»å‹æœ¬èº«ã€‚<br>ç»„åˆä½¿ç”¨ remove_referenceã€å°¾ç½®è¿”å†‹åŠ decltypeï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å‡½æ•°ä¸­è¿”å›å…ƒç´ å€¼çš„æ‹·è´ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ä¸ºäº†ä½¿ç”¨æ¨¡æ¿å‚æ•°çš„æˆå‘˜ï¼Œå¿…é¡»ç”¨ typename</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> It&gt;<br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">fcn2</span><span class="hljs-params">(It beg, It end)</span>-&gt;</span><br><span class="hljs-function">    <span class="hljs-keyword">typename</span> remove_reference&lt;<span class="hljs-title">decltype</span><span class="hljs-params">(*beg)</span>&gt;::type </span>&#123;<br>        <span class="hljs-keyword">return</span> *beg; <span class="hljs-comment">// è¿”å›åºåˆ—ä¸­ä¸€ä¸ªå…ƒç´ çš„æ‹·è´</span><br>    &#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼štype æ˜¯ä¸€ä¸ªç±»çš„æˆå‘˜ï¼Œè€Œè¯¥ç±»ä¾èµ–äºä¸€ä¸ªæ¨¡æ¿å‡½æ•°ã€‚å› æ­¤æˆ‘ä»¬å¿…é¡»åœ¨è¿”å›ç±»å‹çš„å£°æ˜ä¸­ä½¿ç”¨ typename å‘ŠçŸ¥ç¼–è¯‘å™¨ï¼Œtype è¡¨ç¤ºä¸€ä¸ªç±»å‹ã€‚</p><h3 id="16-2-4-å‡½æ•°æŒ‡é’ˆå’Œå®å‚æ¨æ–­"><a href="#16-2-4-å‡½æ•°æŒ‡é’ˆå’Œå®å‚æ¨æ–­" class="headerlink" title="16.2.4 å‡½æ•°æŒ‡é’ˆå’Œå®å‚æ¨æ–­"></a>16.2.4 å‡½æ•°æŒ‡é’ˆå’Œå®å‚æ¨æ–­</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(<span class="hljs-type">const</span> T&amp;, <span class="hljs-type">const</span> T&amp;)</span></span>;<br><span class="hljs-built_in">int</span> (*pfl)(<span class="hljs-type">const</span> <span class="hljs-type">int</span>&amp;, <span class="hljs-type">const</span> <span class="hljs-type">int</span>&amp;) = compare;<br><span class="hljs-comment">// pfl æŒ‡å‘å®ä¾‹ int compare (const int&amp;, const int&amp;)</span><br></code></pre></td></tr></table></figure><p>pfl ä¸­å‚æ•°çš„ç±»å‹å†³å®šäº† T çš„æ¨¡æ¿å®å‚çš„ç±»å‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒT çš„æ¨¡æ¿å®å‚ç±»å‹ä¸º intã€‚æŒ‡é’ˆ pfl æŒ‡å‘ compare çš„ int ç‰ˆæœ¬å®ä¾‹ã€‚<br>å½“å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°æ¨¡æ¿å®ä¾‹çš„åœ°å€æ—¶ï¼Œç¨‹åºä¸Šä¸‹æ–‡å¿…é¡»æ»¡è¶³ï¼šå¯¹æ¯ä¸ªæ¨¡æ¿å‚æ•°ï¼Œèƒ½å”¯ä¸€ç¡®å®šå…¶ç±»å‹æˆ–å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// func çš„é‡è½½ç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬æ¥å—ä¸€ä¸ªä¸åŒçš„å‡½æ•°æŒ‡é’ˆç±»å‹</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">int</span>(*)(<span class="hljs-type">const</span> strings, <span class="hljs-type">const</span> strings))</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">int</span>(*)(<span class="hljs-type">const</span> <span class="hljs-type">int</span>&amp;, <span class="hljs-type">const</span> <span class="hljs-type">int</span>&amp;))</span></span>;<br><span class="hljs-built_in">func</span>(compare); <span class="hljs-comment">// é”™è¯¯ï¼šä½¿ç”¨ compare çš„å“ªä¸ªå®ä¾‹ï¼Ÿ</span><br><span class="hljs-built_in">func</span>(compare&lt;<span class="hljs-type">int</span>&gt;); <span class="hljs-comment">// æ­£ç¡®ï¼šæ˜¾å¼æŒ‡å‡ºå®ä¾‹åŒ–å“ªä¸ª compare ç‰ˆæœ¬</span><br><span class="hljs-comment">// ä¼ é€’ compare (const int&amp;, const int&amp;)</span><br></code></pre></td></tr></table></figure><h3 id="16-2-5-æ¨¡æ¿å®å‚æ¨æ–­å’Œå¼•ç”¨"><a href="#16-2-5-æ¨¡æ¿å®å‚æ¨æ–­å’Œå¼•ç”¨" class="headerlink" title="16.2.5 æ¨¡æ¿å®å‚æ¨æ–­å’Œå¼•ç”¨"></a>16.2.5 æ¨¡æ¿å®å‚æ¨æ–­å’Œå¼•ç”¨</h3><p><strong>ä»å·¦å€¼å¼•ç”¨å‡½æ•°å‚æ•°æ¨æ–­ç±»å‹</strong><br>å½“ä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯æ¨¡æ¿ç±»å‹å‚æ•°çš„ä¸€ä¸ªæ™®é€šï¼ˆå·¦å€¼ï¼‰å¼•ç”¨æ—¶ï¼Œåªèƒ½ä¼ é€’ç»™å®ƒä¸€ä¸ªå·¦å€¼ï¼Œå¦‚æœå®å‚æ˜¯ const çš„ï¼Œåˆ™ T å°†è¢«æ¨æ–­ä¸º const ç±»å‹ã€‚<br>å¦‚æœä¸€ä¸ªå‡½æ•°å‚æ•°çš„ç±»å‹æ˜¯ const T&amp;ï¼Œå½“å‡½æ•°å‚æ•°æœ¬èº«æ˜¯ const æ—¶ï¼ŒT çš„ç±»å‹æ¨æ–­çš„ç»“æœä¸ä¼šæ˜¯ä¸€ä¸ª const ç±»å‹ã€‚</p><p><strong>å¼•ç”¨æŠ˜å å’Œå³å€¼å¼•ç”¨å‚æ•°</strong><br>å½“æˆ‘ä»¬å°†ä¸€ä¸ªå·¦å€¼ï¼ˆiï¼‰ä¼ é€’ç»™å‡½æ•°çš„å³å€¼å¼•ç”¨å‚æ•°ï¼Œä¸”æ­¤å³å€¼å¼•ç”¨æŒ‡å‘æ¨¡æ¿ç±»å‹å‚æ•°ï¼ˆT&amp;&amp;ï¼‰æ—¶ï¼Œç¼–è¯‘å™¨æ¨æ–­æ¨¡æ¿ç±»å‹å‚æ•°ä¸ºå®å‚çš„å·¦å€¼å¼•ç”¨ç±»å‹ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ f3(i) æ—¶ï¼Œç¼–è¯‘å™¨æ¨æ–­ T çš„ç±»å‹ä¸º int&amp;ï¼Œè€Œé intã€‚<br>è¿™å¥½åƒæ„å‘³ç€ f3 çš„å‡½æ•°å‚æ•°åº”è¯¥æ˜¯ä¸€ä¸ªç±»å‹ int&amp; çš„å³å€¼å¼•ç”¨ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¸èƒ½ï¼ˆç›´æ¥ï¼‰å®šä¹‰ä¸€ä¸ªå¼•ç”¨çš„å¼•ç”¨ã€‚ä½†æ˜¯ï¼Œé€šè¿‡ç±»å‹åˆ«åæˆ–é€šè¿‡æ¨¡æ¿ç±»å‹å‚æ•°é—´æ¥å®šä¹‰æ˜¯å¯ä»¥çš„ã€‚<br>å¦‚æœæˆ‘ä»¬é—´æ¥åˆ›å»ºä¸€ä¸ªå¼•ç”¨çš„å¼•ç”¨ï¼Œåˆ™è¿™äº›å¼•ç”¨å½¢æˆäº†â€œæŠ˜å â€ã€‚é™¤äº†å³å€¼å¼•ç”¨çš„å³å€¼å¼•ç”¨ä¼šæŠ˜å ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œå…¶ä½™æƒ…å†µéƒ½ä¼šæŠ˜å ä¸ºä¸€ä¸ªæ™®é€šçš„å·¦å€¼å¼•ç”¨ç±»å‹ã€‚<br>è¿™ä¸¤ä¸ªè§„åˆ™æš—ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»»æ„ç±»å‹çš„å®å‚ä¼ é€’ç»™ T&amp;&amp; ç±»å‹çš„å‡½æ•°å‚æ•°ã€‚</p><h3 id="16-2-6-ç†è§£-std-move"><a href="#16-2-6-ç†è§£-std-move" class="headerlink" title="16.2.6 ç†è§£ std::move"></a>16.2.6 ç†è§£ std::move</h3><p><strong>ä»ä¸€ä¸ªå·¦å€¼ static_cast åˆ°ä¸€ä¸ªå³å€¼å¼•ç”¨æ˜¯å…è®¸çš„</strong><br>å¯ä»¥ç”¨ static_cast æ˜¾å¼åœ°å°†ä¸€ä¸ªå·¦å€¼è½¬æ¢ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ã€‚</p><h3 id="16-2-7-è½¬å‘"><a href="#16-2-7-è½¬å‘" class="headerlink" title="16.2.7 è½¬å‘"></a>16.2.7 è½¬å‘</h3><p><strong>å®šä¹‰èƒ½ä¿æŒç±»å‹ä¿¡æ¯çš„å‡½æ•°å‚æ•°</strong><br>å¦‚æœä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯æŒ‡å‘æ¨¡æ¿ç±»å‹å‚æ•°çš„å³å€¼å¼•ç”¨ï¼ˆå¦‚T&amp;&amp;ï¼‰ï¼Œå®ƒå¯¹åº”çš„å®å‚çš„ const å±æ€§å’Œå·¦å€¼&#x2F;å³å€¼å±æ€§å°†å¾—åˆ°ä¿æŒã€‚</p><p><strong>åœ¨è°ƒç”¨ä¸­ä½¿ç”¨ std::forward ä¿æŒç±»å‹ä¿¡æ¯</strong><br>forward è¿”å›è¯¥æ˜¾å¼å®å‚ç±»å‹çš„å³å€¼å¼•ç”¨å³ï¼Œforward<T> çš„è¿”å›ç±»å‹æ˜¯ T&amp;&amp;ã€‚é€šè¿‡å…¶è¿”å›ç±»å‹ä¸Šçš„å¼•ç”¨æŠ˜å ï¼Œforward å¯ä»¥ä¿æŒç»™å®šå®å‚çš„å·¦å€¼&#x2F;å³å€¼å±æ€§ã€‚<br>å½“ç”¨äºä¸€ä¸ªæŒ‡å‘æ¨¡æ¿å‚æ•°ç±»å‹çš„å³å€¼å¼•ç”¨å‡½æ•°å‚æ•°ï¼ˆT&amp;&amp;ï¼‰æ—¶ï¼Œforward ä¼šä¿æŒå®å‚ç±»å‹çš„æ‰€æœ‰ç»†èŠ‚ã€‚</p><h2 id="16-4-å¯å˜å‚æ•°æ¨¡æ¿"><a href="#16-4-å¯å˜å‚æ•°æ¨¡æ¿" class="headerlink" title="16.4 å¯å˜å‚æ•°æ¨¡æ¿"></a>16.4 å¯å˜å‚æ•°æ¨¡æ¿</h2><p>å¯å˜æ•°é‡çš„å‚æ•°è¢«ç§°ä¸ºå‚æ•°åŒ…ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªçœç•¥å·æ¥æŒ‡å‡ºä¸€ä¸ªæ¨¡æ¿å‚æ•°æˆ–å‡½æ•°å‚æ•°è¡¨ç¤ºä¸€ä¸ªåŒ…ã€‚<br>åœ¨ä¸€ä¸ªæ¨¡æ¿å‚æ•°åˆ—è¡¨ä¸­ï¼Œclassâ€¦ æˆ– typenameâ€¦ æŒ‡å‡ºæ¥ä¸‹æ¥çš„å‚æ•°è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªç±»å‹çš„åˆ—è¡¨ã€‚ä¸€ä¸ªç±»å‹ååé¢è·Ÿä¸€ä¸ªçœç•¥å·è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªç»™å®šç±»å‹çš„éç±»å‹å‚æ•°çš„åˆ—è¡¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Args æ˜¯ä¸€ä¸ªæ¨¡æ¿å‚æ•°åŒ…ï¼Œrest æ˜¯ä¸€ä¸ªå‡½æ•°å‚æ•°åŒ…</span><br><span class="hljs-comment">// Args è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªæ¨¡æ¿ç±»å‹å‚æ•°</span><br><span class="hljs-comment">// rest è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªå‡½æ•°å‚æ•°</span><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span>... Args&gt;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span> <span class="hljs-params">(<span class="hljs-type">const</span> T &amp;t, <span class="hljs-type">const</span> Args&amp; ... rest)</span></span>;<br></code></pre></td></tr></table></figure><p><strong>sizeofâ€¦ è¿ç®—ç¬¦</strong><br>å½“æˆ‘ä»¬éœ€è¦çŸ¥é“åŒ…ä¸­æœ‰å¤šå°‘å…ƒç´ æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ sizeofâ€¦ è¿ç®—ç¬¦ã€‚sizeofâ€¦è¿”å›ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œè€Œä¸”ä¸ä¼šå¯¹å…¶å®å‚æ±‚å€¼ã€‚</p><h3 id="16-4-1-ç¼–å†™å¯å˜å‚æ•°å‡½æ•°æ¨¡æ¿"><a href="#16-4-1-ç¼–å†™å¯å˜å‚æ•°å‡½æ•°æ¨¡æ¿" class="headerlink" title="16.4.1 ç¼–å†™å¯å˜å‚æ•°å‡½æ•°æ¨¡æ¿"></a>16.4.1 ç¼–å†™å¯å˜å‚æ•°å‡½æ•°æ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span>... Args&gt;<br><span class="hljs-function">ostream &amp;<span class="hljs-title">print</span><span class="hljs-params">(ostream &amp;os, <span class="hljs-type">const</span> T &amp;t, <span class="hljs-type">const</span> Args&amp;... rest)</span> </span>&#123;<br>    os Â« t Â« <span class="hljs-string">&quot;, &quot;</span>ï¼›<span class="hljs-comment">// æ‰“å°ç¬¬ä¸€ä¸ªå®å‚</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">print</span> (os, rest...);<span class="hljs-comment">// é€’å½’è°ƒç”¨ï¼Œæ‰“å°å…¶ä»–å®å‚</span><br>)<br></code></pre></td></tr></table></figure><p>rest ä¸­çš„ç¬¬ä¸€ä¸ªå®å‚è¢«ç»‘å®šåˆ° tï¼Œå‰©ä½™å®å‚å½¢æˆä¸‹ä¸€ä¸ª print è°ƒç”¨çš„å‚æ•°åŒ…ã€‚</p><h3 id="16-4-2-åŒ…æ‰©å±•"><a href="#16-4-2-åŒ…æ‰©å±•" class="headerlink" title="16.4.2 åŒ…æ‰©å±•"></a>16.4.2 åŒ…æ‰©å±•</h3><p>å½“æ‰©å±•ä¸€ä¸ªåŒ…æ—¶ï¼Œæˆ‘ä»¬è¿˜è¦æä¾›ç”¨äºæ¯ä¸ªæ‰©å±•å…ƒç´ çš„æ¨¡å¼ã€‚æ‰©å±•ä¸€ä¸ªåŒ…å°±æ˜¯å°†å®ƒåˆ†è§£ä¸ºæ„æˆçš„å…ƒç´ ï¼Œå¯¹æ¯ä¸ªå…ƒç´ åº”ç”¨æ¨¡å¼ï¼Œè·å¾—æ‰©å±•åçš„åˆ—è¡¨ã€‚æˆ‘ä»¬é€šè¿‡åœ¨æ¨¡å¼å³è¾¹æ”¾ä¸€ä¸ªçœç•¥å·æ¥è§¦å‘æ‰©å±•æ“ä½œã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span>... Args&gt;<br><span class="hljs-function">ostream &amp;<span class="hljs-title">print</span><span class="hljs-params">(ostream &amp;os, <span class="hljs-type">const</span> T &amp;t, <span class="hljs-type">const</span> Args&amp;... rest)</span> </span>&#123; <span class="hljs-comment">// æ‰©å±• Args</span><br>    os Â« t &lt;&lt; <span class="hljs-string">&quot;,&quot;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">print</span>(os, rest...);<span class="hljs-comment">// æ‰©å±• rest</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹ Args çš„æ‰©å±•ä¸­ï¼Œç¼–è¯‘å™¨å°†æ¨¡å¼ const Arg&amp; åº”ç”¨åˆ°æ¨¡æ¿å‚æ•°åŒ… Args ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚å› æ­¤ï¼Œæ­¤æ¨¡å¼çš„æ‰©å±•ç»“æœæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„é›¶ä¸ªæˆ–å¤šä¸ªç±»å‹çš„åˆ—è¡¨ï¼Œæ¯ä¸ªç±»å‹éƒ½å½¢å¦‚ const type&amp;ã€‚<br>ç¬¬äºŒä¸ªæ‰©å±•å‘ç”Ÿåœ¨å¯¹ print çš„è°ƒç”¨ä¸­ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæ¨¡å¼æ˜¯å‡½æ•°å‚æ•°åŒ…çš„åå­—ï¼ˆå³ rest)ã€‚æ­¤æ¨¡å¼æ‰©å±•å‡ºä¸€ä¸ªç”±åŒ…ä¸­å…ƒç´ ç»„æˆçš„ã€é€—å·åˆ†éš”çš„åˆ—è¡¨ã€‚å› æ­¤ï¼Œè¿™ä¸ªè°ƒç”¨ç­‰ä»·äºï¼š</p><p><strong>ç†è§£åŒ…æ‰©å±•</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">return</span> <span class="hljs-built_in">print</span>(os, <span class="hljs-built_in">debug_rep</span>(rest)...);<br></code></pre></td></tr></table></figure><p>è¿™ä¸ª print è°ƒç”¨ä½¿ç”¨äº†æ¨¡å¼ debug_reg(rest)ã€‚æ­¤æ¨¡å¼è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›å¯¹å‡½æ•°å‚æ•°åŒ… rest ä¸­çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨ debug_repã€‚æ‰©å±•ç»“æœå°†æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„ debug_rep è°ƒç”¨åˆ—è¡¨ã€‚å³ï¼Œä¸‹é¢è°ƒç”¨ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">errorMsg</span>(cerr, fcnName, code.<span class="hljs-built_in">num</span>(), otherData, <span class="hljs-string">&quot;other&quot;</span>, item);<br></code></pre></td></tr></table></figure><p>å°±å¥½åƒæˆ‘ä»¬è¿™æ ·ç¼–å†™ä»£ç ä¸€æ ·</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">print</span> (cerr, <span class="hljs-built_in">debug_rep</span>(fcnName), <span class="hljs-built_in">debug_rep</span>(code.<span class="hljs-built_in">num</span>()),<br>    <span class="hljs-built_in">debug_rep</span>(otherData), <span class="hljs-built_in">debug_rep</span>(<span class="hljs-string">&quot;otherData&quot;</span>), <span class="hljs-built_in">debug_rep</span>(item));<br></code></pre></td></tr></table></figure><h2 id="16-5-æ¨¡æ¿ç‰¹ä¾‹åŒ–"><a href="#16-5-æ¨¡æ¿ç‰¹ä¾‹åŒ–" class="headerlink" title="16.5 æ¨¡æ¿ç‰¹ä¾‹åŒ–"></a>16.5 æ¨¡æ¿ç‰¹ä¾‹åŒ–</h2><p>ä¸€ä¸ªç‰¹ä¾‹åŒ–ç‰ˆæœ¬å°±æ˜¯æ¨¡æ¿çš„ä¸€ä¸ªç‹¬ç«‹çš„å®šä¹‰ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡æ¿å‚æ•°è¢«æŒ‡å®šä¸ºç‰¹å®šçš„ç±»å‹ã€‚</p><p><strong>å®šä¹‰å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–</strong><br>å½“æˆ‘ä»¬ç‰¹ä¾‹åŒ–ä¸€ä¸ªå‡½æ•°æ¨¡æ¿æ—¶ï¼Œå¿…é¡»ä¸ºåŸæ¨¡æ¿ä¸­çš„æ¯ä¸ªæ¨¡æ¿å‚æ•°éƒ½æä¾›å®å‚ã€‚ä¸ºäº†æŒ‡å‡ºæˆ‘ä»¬æ­£åœ¨å®ä¾‹åŒ–ä¸€ä¸ªæ¨¡æ¿ï¼Œåº”ä½¿ç”¨å…³é”®å­— template åè·Ÿä¸€ä¸ªç©ºå°–æ‹¬å·å¯¹ï¼ŒæŒ‡å‡ºæˆ‘ä»¬å°†ä¸ºåŸæ¨¡æ¿çš„æ‰€æœ‰æ¨¡æ¿å‚æ•°æä¾›å®å‚ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// compare çš„ç‰¹æ®Šç‰ˆæœ¬ï¼Œå¤„ç†å­—ç¬¦æ•°ç»„çš„æŒ‡é’ˆ</span><br><span class="hljs-keyword">template</span> &lt;&gt;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-type">const</span> &amp;pl, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-type">const</span> &amp;p2)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">strcmp</span>(pi, p2);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å‡½æ•°é‡è½½ä¸æ¨¡æ¿ç‰¹ä¾‹åŒ–</strong><br>å½“å®šä¹‰å‡½æ•°æ¨¡æ¿çš„ç‰¹ä¾‹åŒ–ç‰ˆæœ¬æ—¶ï¼Œæˆ‘ä»¬æœ¬è´¨ä¸Šæ¥ç®¡äº†ç¼–è¯‘å™¨çš„å·¥ä½œã€‚å³ï¼Œæˆ‘ä»¬ä¸ºåŸæ¨¡æ¿çš„ä¸€ä¸ªç‰¹æ®Šå®ä¾‹æä¾›äº†å®šä¹‰ã€‚ä¸€ä¸ªç‰¹ä¾‹åŒ–ç‰ˆæœ¬æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œè€Œéå‡½æ•°åçš„ä¸€ä¸ªé‡è½½ç‰ˆæœ¬ã€‚<br>ç‰¹ä¾‹åŒ–ä¸å½±å“å‡½æ•°åŒ¹é…ã€‚<br>ä¸ºäº†ç‰¹ä¾‹åŒ–ä¸€ä¸ªæ¨¡æ¿ï¼ŒåŸæ¨¡æ¿çš„å£°æ˜å¿…é¡»åœ¨ä½œç”¨åŸŸä¸­ã€‚è€Œä¸”ï¼Œåœ¨ä»»ä½•ä½¿ç”¨æ¨¡æ‰³å®ä¾‹çš„ä»£ç ä¹‹å‰ï¼Œç‰¹ä¾‹åŒ–ç‰ˆæœ¬çš„å£°æ˜ä¹Ÿå¿…é¡»åœ¨ä½œç”¨åŸŸä¸­ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>CPP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…‰æ …åŒ–è½¯æ¸² Simple Renderer</title>
    <link href="/2021/11/08/SimpleRenderer/"/>
    <url>/2021/11/08/SimpleRenderer/</url>
    
    <content type="html"><![CDATA[<h2 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h2><p>ä¸€ä¸ªç”¨ C++ ç¼–å†™çš„ç®€å•çš„å…‰æ …åŒ–è½¯æ¸²æŸ“å™¨ï¼Œæ²¡æƒ³å¥½èµ·ä»€ä¹ˆåå­—ï¼Œä¸å¦‚å°±å« Simple Renderer å§ã€‚ä¸»è¦è¿˜æ˜¯ä¸ºäº†å·©å›ºä¸€ä¸‹å›¾å½¢å­¦ç›¸å…³çš„åŸºç¡€çŸ¥è¯†ï¼Œæ¯•ç«Ÿæœ‰å¾ˆå¤šé—®é¢˜ä¸å®é™…ä¸Šæ‰‹æ˜¯ä¸ä¼šé‡åˆ°çš„ã€‚</p><p>åŸºç¡€åº“çš„é€‰æ‹©ï¼šæˆ‘ä¸æƒ³å°†æ³¨æ„åŠ›æ”¾åœ¨æ¸²æŸ“ç®¡çº¿ä»¥å¤–çš„éƒ¨åˆ†ä¸Šï¼Œæ‰€ä»¥æ•°å­¦å’Œæ˜¾ç¤ºçš„éƒ¨åˆ†ç›´æ¥ä½¿ç”¨äº† Eigen å’Œ EasyXã€‚<strong>Eigen</strong> æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„çº¿æ€§ä»£æ•°åº“ï¼Œ<strong>EasyX</strong> æ˜¯ä¸€ä¸ªè¶³å¤Ÿè½»ä¾¿åˆä¸è‡³äºå¤ªè¿‡åº•å±‚çš„å›¾å½¢åº“ã€‚å½“ç„¶æˆ‘åªå…è®¸è‡ªå·±ä½¿ç”¨å…¶ä¸­çš„ putpixel() å‡½æ•°ã€‚</p><h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><ul><li>Bresenham ç”»çº¿æ³•</li><li>æ‰«æçº¿ç®—æ³•å…‰æ …åŒ–ä¸‰è§’å½¢</li><li>é‡å¿ƒåæ ‡æ’å€¼</li><li>é€è§†çŸ«æ­£æ’å€¼</li><li>mvpã€viewport æŠ•å½±çŸ©é˜µ</li><li>æ·±åº¦æµ‹è¯•</li><li>èƒŒé¢å‰”é™¤</li><li>Blinn-Phong å…‰ç…§æ¨¡å‹</li><li>Diffuse è´´å›¾</li><li>é«˜å…‰è´´å›¾</li><li>æ³•çº¿è´´å›¾</li></ul><h2 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h2><p>é¡¶ç‚¹æ•°æ®å°è£…åœ¨ Vertex ç±»ä¸­ã€‚æŠ•å½±å˜æ¢åœ¨ VertexShader ç±»ä¸­å®ç°ã€‚å…‰æ …åŒ–ä¸ç‰‡å…ƒç€è‰²å™¨è€¦åˆåœ¨ Rasterizerã€‚</p><h2 id="å†ç¨‹"><a href="#å†ç¨‹" class="headerlink" title="å†ç¨‹"></a>å†ç¨‹</h2><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/SimpleRenderer/1.png"></div><div class="group-image-wrap"><img src="/img/SimpleRenderer/2.png"></div><div class="group-image-wrap"><img src="/img/SimpleRenderer/3.png"></div><div class="group-image-wrap"><img src="/img/SimpleRenderer/5.png"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/SimpleRenderer/7.png"></div><div class="group-image-wrap"><img src="/img/SimpleRenderer/8.png"></div><div class="group-image-wrap"><img src="/img/SimpleRenderer/9.png"></div><div class="group-image-wrap"><img src="/img/SimpleRenderer/10.png"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/SimpleRenderer/11.png"></div><div class="group-image-wrap"><img src="/img/SimpleRenderer/12.png"></div><div class="group-image-wrap"><img src="/img/SimpleRenderer/13.png"></div><div class="group-image-wrap"><img src="/img/SimpleRenderer/14.png"></div></div></div><h2 id="ä»“åº“"><a href="#ä»“åº“" class="headerlink" title="ä»“åº“"></a>ä»“åº“</h2><p><a href="https://github.com/Hinageshi01/simpleRenderer">GitHub</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/ssloy/tinyrenderer">tinyrenderer</a><br><a href="http://games-cn.org/forums/topic/%e4%bd%9c%e4%b8%9a3%e6%9b%b4%e6%ad%a3%e5%85%ac%e5%91%8a/">GAMES101 Assignment3</a></p><h2 id="é€è§†çŸ«æ­£æ’å€¼"><a href="#é€è§†çŸ«æ­£æ’å€¼" class="headerlink" title="é€è§†çŸ«æ­£æ’å€¼"></a>é€è§†çŸ«æ­£æ’å€¼</h2><p>å…·ä½“çš„æ¨å¯¼åœ¨ <a href="https://blog.csdn.net/n5/article/details/100148540">CSDN</a> å’Œ <a href="https://www.comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf">lowk_persp_interp_techrep</a> é‡Œå·²ç»è®²çš„å¾ˆæ¸…æ¥šäº†ã€‚<br>é‡è¦çš„ç»“è®ºæ˜¯ï¼š</p><ul><li>åœ¨æŠ•å½±é¢ä¸Šå¯¹å±æ€§ $I$ æ’å€¼æ—¶ï¼Œå…ˆå¯¹ $\frac{I}{Z}$ æ’å€¼ï¼Œç„¶åå°†ç»“æœé™¤ä»¥å¯¹ $\frac{1}{Z}$ æ’å€¼çš„ç»“æœã€‚è¿™æ ·å°±å¾—åˆ°äº†é€è§†æ­£ç¡®çš„å±æ€§æ’å€¼ã€‚</li></ul><p>è¿™é‡Œæ˜¯ OpenGL å’Œæˆ‘çš„æ¸²æŸ“å™¨é‡Œçš„å®ç°ï¼š<br><a href="https://stackoverflow.com/questions/24441631/how-exactly-does-opengl-do-perspectively-correct-linear-interpolation">StackOverflow</a><br>é¦–å…ˆï¼ŒClipSpace ä¸­çš„ w åˆ†é‡ç­‰äº ViewSpace ä¸­çš„ z åˆ†é‡ï¼ˆç¬¦å·ç”±å·¦å³æ‰‹åæ ‡ç³»å†³å®šï¼Œè¿™å°†å½±å“åˆ°åç»­çš„æ·±åº¦æµ‹è¯•ï¼‰ã€‚<br>ç„¶åå°† ClipSpace çš„ 1&#x2F;w åˆ†é‡ä¿å­˜èµ·æ¥ï¼Œé¿å…å¤šæ¬¡çš„é™¤æ³•è¿ç®—ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Eigen::Vector4f p = mvp * vertex[i].pos;<br>p[<span class="hljs-number">3</span>] = <span class="hljs-number">1.f</span> / p[<span class="hljs-number">3</span>];<br>p[<span class="hljs-number">0</span>] *= p[<span class="hljs-number">3</span>];<br>p[<span class="hljs-number">1</span>] *= p[<span class="hljs-number">3</span>];<br>p[<span class="hljs-number">2</span>] *= p[<span class="hljs-number">3</span>];<br></code></pre></td></tr></table></figure><p>ç„¶åå°†é‡å¿ƒåæ ‡ (a, b, c) è°ƒæ•´ä¸ºï¼š<br>$(a,b,c)&#x3D;\frac{(a&#x2F;pos[0].w, b&#x2F;pos[1].w, c&#x2F;pos[2].w)}{a&#x2F;pos[0].w+b&#x2F;pos[1].w+c&#x2F;pos[2].w}$<br>è¿™é‡Œçš„ w å°±æ˜¯ ViewSpace çš„ z ï¼Œè¿™ä¸ªå¾ˆé•¿çš„åˆ†æ¯å°±æ˜¯æ‰€è°“å¯¹ $\frac{1}{Z}$ æ’å€¼çš„ç»“æœï¼Œä¸‰ä¸ªåˆ†å­å°±æ˜¯å°† $I$ æå‡ºåå‰©ä½™çš„éƒ¨åˆ†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// åœ¨æŠ•å½±å¹³é¢ä¸Šæ±‚å¾—é€è§†ä¸æ­£ç¡®çš„é‡å¿ƒåæ ‡ã€‚</span><br>Eigen::Vector3f tmpBC = <span class="hljs-built_in">BarycentricCoor</span>(x + <span class="hljs-number">0.5f</span>, y + <span class="hljs-number">0.5f</span>, v);<br><span class="hljs-comment">// pos[3] å­˜å‚¨çš„æ˜¯ ViewSpace ä¸­çš„ 1/zã€‚</span><br><span class="hljs-type">float</span> a = tmpBC[<span class="hljs-number">0</span>] * v[<span class="hljs-number">0</span>].pos[<span class="hljs-number">3</span>];<br><span class="hljs-type">float</span> b = tmpBC[<span class="hljs-number">1</span>] * v[<span class="hljs-number">1</span>].pos[<span class="hljs-number">3</span>];<br><span class="hljs-type">float</span> c = tmpBC[<span class="hljs-number">2</span>] * v[<span class="hljs-number">2</span>].pos[<span class="hljs-number">3</span>];<br><span class="hljs-type">float</span> div = <span class="hljs-number">1.f</span> / (a + b + c);<br>a *= div;<br>b *= div;<br>c *= div;<br><span class="hljs-comment">// é‡å¿ƒåæ ‡æ’å€¼ã€‚</span><br><span class="hljs-type">float</span> z = <span class="hljs-built_in">Interpolate</span>(a, b, c, v[<span class="hljs-number">0</span>].pos[<span class="hljs-number">2</span>], v[<span class="hljs-number">1</span>].pos[<span class="hljs-number">2</span>], v[<span class="hljs-number">2</span>].pos[<span class="hljs-number">2</span>]);<br></code></pre></td></tr></table></figure><h2 id="åˆ‡çº¿ç©ºé—´ä¸æ³•çº¿è´´å›¾"><a href="#åˆ‡çº¿ç©ºé—´ä¸æ³•çº¿è´´å›¾" class="headerlink" title="åˆ‡çº¿ç©ºé—´ä¸æ³•çº¿è´´å›¾"></a>åˆ‡çº¿ç©ºé—´ä¸æ³•çº¿è´´å›¾</h2><p>æ¨å¯¼ï¼š<a href="https://blog.csdn.net/weixin_46525412/article/details/120278159">CSDN</a>ã€<a href="https://learnopengl-cn.github.io/05%20Advanced%20Lighting/04%20Normal%20Mapping/">LearnOpenGL</a>ã€<a href="http://www.thetenthplanet.de/archives/1180">ShaderX</a><br>è®°å½•ä¸€ç‚¹è‡ªå·±çš„ç†è§£ï¼ŒçŸ©é˜µä¹˜æ³•å¯ä»¥çœ‹åšåæ ‡ç³»çš„è½¬æ¢ï¼Œä¾‹å¦‚ M * a ä¾¿æ˜¯å°†å®šä¹‰åœ¨ M åæ ‡ç³»ä¸‹çš„ a å‘é‡è½¬æ¢è‡³ <strong>å®šä¹‰äº† M åæ ‡ç³»çš„åæ ‡ç³»</strong> ä¸‹ã€‚<br>åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼ŒM ä¾¿æ˜¯å½“å‰ç‰‡å…ƒæ‰€åœ¨çš„åˆ‡çº¿ç©ºé—´åœ¨ä¸–ç•Œåæ ‡ç³»ä¸‹çš„è¡¨ç¤ºï¼ˆå°±æ˜¯ TBN çŸ©é˜µï¼‰ï¼Œa ä¾¿æ˜¯æ³•çº¿è´´å›¾ä¸­çš„å‘é‡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Eigen::Vector2f dUV1 = v[<span class="hljs-number">1</span>].uv - v[<span class="hljs-number">0</span>].uv;<br>Eigen::Vector2f dUV2 = v[<span class="hljs-number">2</span>].uv - v[<span class="hljs-number">0</span>].uv;<br><span class="hljs-type">float</span> inverse = <span class="hljs-number">1.f</span> / (dUV1[<span class="hljs-number">0</span>] * dUV2[<span class="hljs-number">1</span>] - dUV2[<span class="hljs-number">0</span>] * dUV1[<span class="hljs-number">1</span>]);<br><br>Eigen::Vector3f e1 = v[<span class="hljs-number">1</span>].viewPos - v[<span class="hljs-number">0</span>].viewPos;<br>Eigen::Vector3f e2 = v[<span class="hljs-number">2</span>].viewPos - v[<span class="hljs-number">0</span>].viewPos;<br><br><span class="hljs-function">Eigen::Vector3f <span class="hljs-title">T</span><span class="hljs-params">(dUV2[<span class="hljs-number">1</span>] * e1[<span class="hljs-number">0</span>] - dUV1[<span class="hljs-number">1</span>] * e2[<span class="hljs-number">0</span>],</span></span><br><span class="hljs-params"><span class="hljs-function">    dUV2[<span class="hljs-number">1</span>] * e1[<span class="hljs-number">1</span>] - dUV1[<span class="hljs-number">1</span>] * e2[<span class="hljs-number">1</span>],</span></span><br><span class="hljs-params"><span class="hljs-function">    dUV2[<span class="hljs-number">1</span>] * e1[<span class="hljs-number">2</span>] - dUV1[<span class="hljs-number">1</span>] * e2[<span class="hljs-number">2</span>])</span></span>;<br><span class="hljs-function">Eigen::Vector3f <span class="hljs-title">B</span><span class="hljs-params">(dUV1[<span class="hljs-number">0</span>] * e2[<span class="hljs-number">0</span>] - dUV2[<span class="hljs-number">0</span>] * e1[<span class="hljs-number">0</span>],</span></span><br><span class="hljs-params"><span class="hljs-function">    dUV1[<span class="hljs-number">0</span>] * e2[<span class="hljs-number">1</span>] - dUV2[<span class="hljs-number">0</span>] * e1[<span class="hljs-number">1</span>],</span></span><br><span class="hljs-params"><span class="hljs-function">    dUV1[<span class="hljs-number">0</span>] * e2[<span class="hljs-number">2</span>] - dUV2[<span class="hljs-number">0</span>] * e1[<span class="hljs-number">2</span>])</span></span>;<br>B *= inverse;<br>T *= inverse;<br>T.<span class="hljs-built_in">normalize</span>();<br>B.<span class="hljs-built_in">normalize</span>();<br><br>Eigen::Matrix3f TBN;<br>TBN &lt;&lt; T[<span class="hljs-number">0</span>], B[<span class="hljs-number">0</span>], normal[<span class="hljs-number">0</span>],<br>    T[<span class="hljs-number">1</span>], B[<span class="hljs-number">1</span>], normal[<span class="hljs-number">1</span>],<br>    T[<span class="hljs-number">2</span>], B[<span class="hljs-number">2</span>], normal[<span class="hljs-number">2</span>];<br>normal = (TBN * model-&gt;<span class="hljs-built_in">normalMap</span>(uv)).<span class="hljs-built_in">normalized</span>();<br></code></pre></td></tr></table></figure><h2 id="æ³•å‘é‡ä¿®å¤"><a href="#æ³•å‘é‡ä¿®å¤" class="headerlink" title="æ³•å‘é‡ä¿®å¤"></a>æ³•å‘é‡ä¿®å¤</h2><p><a href="https://learnopengl-cn.github.io/02%20Lighting/02%20Basic%20Lighting/#_6">LearnOpenGL è¯„è®ºåŒº</a><br>æ³•å‘é‡ä¹˜ä»¥ model çŸ©é˜µå·¦ä¸Šè§’ 3x3 çŸ©é˜µçš„é€†çš„è½¬ç½®ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>CPP</tag>
      
      <tag>Rendering</tag>
      
      <tag>Rasterization</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Archiveã€‘GAMES202</title>
    <link href="/2021/09/22/GAMES202/"/>
    <url>/2021/09/22/GAMES202/</url>
    
    <content type="html"><![CDATA[<h1 id="ç™¾åˆ†æ¯”è¿‘ä¼¼è½¯é˜´å½±"><a href="#ç™¾åˆ†æ¯”è¿‘ä¼¼è½¯é˜´å½±" class="headerlink" title="ç™¾åˆ†æ¯”è¿‘ä¼¼è½¯é˜´å½±"></a>ç™¾åˆ†æ¯”è¿‘ä¼¼è½¯é˜´å½±</h1><p>&emsp;&emsp;è‹¥è¦åˆ¤æ–­å½“å‰ç€è‰²ç‚¹æ˜¯å¦å¤„äºé˜´å½±ä¹‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥åˆ°è¯¥ç‚¹ä¸å…‰æºä¹‹é—´çš„é®æŒ¡å…³ç³»ã€‚ä¸€ç§å¸¸è§çš„åšæ³•æ˜¯ Shadow Mappingï¼Œå‡è®¾ä»å…‰æºçœ‹å‘åœºæ™¯ï¼Œå°±åƒåšæ·±åº¦æµ‹è¯•ä¸€æ ·ï¼Œä¿å­˜ä¸€å¼ ä»å…‰æºå¤„è·å¾—çš„ DepthBufferï¼Œç„¶åæ¯”è¾ƒç€è‰²ç‚¹ä¸å…‰æºä¹‹é—´çš„è·ç¦»ä¸ DepthBuffer ä¸­å¯¹åº”ç‚¹çš„æ·±åº¦ï¼Œå‰è€…æ›´å¤§åˆ™ä»£è¡¨åœºæ™¯ä¸­æœ‰å¦ä¸€ç‰©ä½“æ¯”å½“å‰ç€è‰²ç‚¹æ›´æ¥è¿‘å…‰æºï¼Œå³è¯¥ç€è‰²ç‚¹è¢«é®æŒ¡ã€‚</p><h2 id="Two-Pass-Shadow-Map-ç¡¬é˜´å½±"><a href="#Two-Pass-Shadow-Map-ç¡¬é˜´å½±" class="headerlink" title="Two Pass Shadow Map ç¡¬é˜´å½±"></a>Two Pass Shadow Map ç¡¬é˜´å½±</h2><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">float</span> useShadowMap(<span class="hljs-type">sampler2D</span> shadowMap, <span class="hljs-type">vec4</span> coord) &#123;<br>    <span class="hljs-type">vec4</span> closestDepthVec = <span class="hljs-built_in">texture2D</span>(shadowMap, coord.xy);<br>    <span class="hljs-type">float</span> closestDepth = unpack(closestDepthVec);<br><br>    <span class="hljs-keyword">return</span> coord.z &lt; closestDepth + <span class="hljs-number">0.011</span> ? <span class="hljs-number">1.0</span> : <span class="hljs-number">0.0</span>;<br>&#125;<br><br><span class="hljs-type">void</span> main(<span class="hljs-type">void</span>) &#123;<br>    <span class="hljs-comment">// è½¬æ¢è‡³ NDC ç©ºé—´</span><br>    <span class="hljs-type">vec3</span> shadowCoord = vPositionFromLight.xyz / vPositionFromLight.w;<br>    shadowCoord = shadowCoord * <span class="hljs-number">0.5</span> + <span class="hljs-number">0.5</span>;<br><br>    <span class="hljs-comment">// çœç•¥å¸ƒæ—å†¯å…‰ç…§æ¨¡å‹çš„å®ç°</span><br>    <span class="hljs-type">vec3</span> phongColor = blinnPhong();<br>    <span class="hljs-comment">// è¿™é‡Œå°†å¯è§åº¦ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„é¡¹æ‹†åˆ†å‡ºæ¥</span><br>    <span class="hljs-type">float</span> visibility = <span class="hljs-number">1.0</span>;<br><br>    visibility = useShadowMap(uShadowMap, <span class="hljs-type">vec4</span>(shadowCoord, <span class="hljs-number">1.0</span>));<br>    <span class="hljs-comment">//visibility = PCF(uShadowMap, vec4(shadowCoord, 1.0));</span><br>    <span class="hljs-comment">//visibility = PCSS(uShadowMap, vec4(shadowCoord, 1.0));</span><br>    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(phongColor * visibility, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="coord-z-closestDepth-1-0-0-0-çš„é—®é¢˜"><a href="#coord-z-closestDepth-1-0-0-0-çš„é—®é¢˜" class="headerlink" title="coord.z &lt; closestDepth ? 1.0 : 0.0 çš„é—®é¢˜"></a>coord.z &lt; closestDepth ? 1.0 : 0.0 çš„é—®é¢˜</h3><p>è¿™ä¸ªé—®é¢˜æºè‡ªäº Shadow Map å¯¹åœºæ™¯èµ°æ ·&#x2F;å¤±çœŸçš„ç†è§£ã€‚å…‰æºå¯¹åœºæ™¯çš„ç¦»æ•£åŒ–è®¤ä¸º Shadow Map å†…æ¯ä¸€ä¸ªçº¹ç´ å¯¹åº”çš„è¡¨é¢å±äºåŒä¸€ä¸ªæ·±åº¦ï¼Œæ­¤æ—¶å¯¹äºä¾§å¯¹å…‰æºçš„è¡¨é¢ï¼Œå•ä¸ªçº¹ç´ å†…æ— æ³•è¡¨ç¤ºè¡¨é¢æ·±åº¦å‰§çƒˆçš„å˜åŒ–ï¼ŒShadow Map ä¾¿ä¼šå°†å¹³é¢ç†è§£ä¸ºä¸€ä¸ªâ€¦æ“è¡£æ¿ã€‚<br><img src="/img/GAMES202/s.png" alt="å…‰æºä¸åœ°æ¿å‡ ä¹ä½äºåŒä¸€å¹³é¢ä¸Š"><br><strong>è§£å†³æ–¹æ³•</strong>ï¼šä¸ºåˆ¤æ–­æ¡ä»¶æ·»åŠ ä¸€ä¸ªå®¹å¿åº¦ã€‚<br><code>return coord.z &lt; (closestDepth + 0.01) ? 1.0 : 0.0;</code><br><img src="/img/GAMES202/H.png"><br><strong>æ–°çš„é—®é¢˜</strong>ï¼šå½“è¿™ä¸ªå®¹å¿åº¦è¾ƒå¤§æ—¶é˜´å½±çš„æ ¹éƒ¨ä¼šä¸æ¨¡å‹å‘ç”Ÿåˆ†ç¦»ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯ç›®å‰éš¾ä»¥è§£å†³çš„ã€‚</p><h2 id="Percentage-Closer-Filter"><a href="#Percentage-Closer-Filter" class="headerlink" title="Percentage Closer Filter"></a>Percentage Closer Filter</h2><p>ä¸å†ä»…ä»…æŸ¥è¯¢ DepthBuffer ä¸­å¯¹åº”ç‚¹çš„æ·±åº¦ï¼Œè€Œæ˜¯è®¡ç®—ä¸€å®šèŒƒå›´å†…æ·±åº¦å¤§äºç€è‰²ç‚¹æ·±åº¦çš„æ¯”ä¾‹ï¼Œè®¤ä¸ºæ·±åº¦å°äºç€è‰²ç‚¹æ·±åº¦çš„ç‰©ä½“ä¼šé®æŒ¡ç€è‰²ç‚¹ã€‚</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">float</span> PCF(<span class="hljs-type">sampler2D</span> shadowMap, <span class="hljs-type">vec4</span> coord) &#123;<br>    poissonDiskSamples(coord.xy);<br><br>    <span class="hljs-type">int</span> unShadowCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; NUM_SAMPLES; i ++) &#123;<br>        <span class="hljs-type">vec2</span> sampleCoord = poissonDisk[i] * FILTER_DIAMETER + coord.xy;<br>        <span class="hljs-type">vec4</span> closestDepthVec = <span class="hljs-built_in">texture2D</span>(shadowMap, sampleCoord); <br>        <span class="hljs-type">float</span> closestDepth = unpack(closestDepthVec);<br>        <span class="hljs-keyword">if</span>(coord.z &lt; closestDepth + <span class="hljs-number">0.011</span>) &#123;<br>            unShadowCount += <span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-type">float</span>(unShadowCount) / <span class="hljs-type">float</span>(NUM_SAMPLES);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/GAMES202/PCF.png"></p><h2 id="Percentage-Closer-Soft-Shadow"><a href="#Percentage-Closer-Soft-Shadow" class="headerlink" title="Percentage Closer Soft Shadow"></a>Percentage Closer Soft Shadow</h2><p><strong>PCF çš„é—®é¢˜</strong>ï¼šæ•´ä½“çš„é˜´å½±éƒ½ä¼šè·å¾—ä¸€ä¸ªæ¨¡ç³Šï¼Œè€Œç°å®æƒ…å†µæ˜¯é˜´å½±çš„æ ¹éƒ¨å¾€å¾€æ˜¯æœ€â€œæ‰å®â€çš„ï¼Œè¿œç«¯çš„é˜´å½±æ‰ä¼šæ¸æ¸å˜å¾—æ¨¡ç³Šã€‚<br><strong>è§£å†³æ–¹æ³•</strong>ï¼šå·²çŸ¥é˜´å½±æ¨¡ç³Šçš„ç¨‹åº¦å–å†³äº Filter çš„å¤§å°ï¼Œå¦‚æœèƒ½è®© Filter çš„å¤§å°éšé˜´å½±ç€è‰²ç‚¹ä¸é®æŒ¡ç‰©çš„è·ç¦»å¢åŠ è€Œå¢åŠ ï¼Œä¾¿èƒ½å®ç°è¾ƒä¸ºçœŸå®çš„è½¯é˜´å½±ã€‚<br>PCSS åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ol><li>avgblocker depth</li><li>calculate penumbra size</li><li>filtering (PCF)</li></ol><h3 id="avgblocker-depth"><a href="#avgblocker-depth" class="headerlink" title="avgblocker depth"></a>avgblocker depth</h3><p>åœ¨ä¸€å®šèŒƒå›´å†…æŸ¥æ‰¾èƒ½å¤Ÿé®æŒ¡ç€è‰²ç‚¹çš„ç‰©ä½“çš„æ·±åº¦å¹³å‡å€¼ã€‚</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">float</span> findBlocker(<span class="hljs-type">sampler2D</span> shadowMap, <span class="hljs-type">vec2</span> uv, <span class="hljs-type">float</span> zReceiver) &#123;<br>    poissonDiskSamples(uv);<br><br>    <span class="hljs-type">int</span> shadowCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">float</span> blockDepthSum = <span class="hljs-number">0.0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; NUM_SAMPLES; i++) &#123;<br>        <span class="hljs-type">vec2</span> sampleCoord = poissonDisk[i] * FILTER_DIAMETER + uv;<br>        <span class="hljs-type">vec4</span> closestDepthVec = <span class="hljs-built_in">texture2D</span>(shadowMap, sampleCoord);<br>        <span class="hljs-type">float</span> closestDepth = unpack(closestDepthVec);<br>        <span class="hljs-keyword">if</span>(zReceiver &gt; closestDepth + <span class="hljs-number">0.011</span>) &#123;<br>            blockDepthSum += closestDepth;<br>            shadowCount += <span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> blockDepthSum / <span class="hljs-type">float</span>(shadowCount);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="calculate-penumbra-size"><a href="#calculate-penumbra-size" class="headerlink" title="calculate penumbra size"></a>calculate penumbra size</h3><p>æ ¹æ®ç¬¬ä¸€æ­¥å¾—åˆ°çš„é®æŒ¡ç‰©æ·±åº¦è®¡ç®—é˜´å½±çš„æ¨¡ç³Šç¨‹åº¦ã€‚<br><img src="/img/GAMES202/3.png" alt="ç›¸ä¼¼ä¸‰è§’å½¢åŸç†ï¼ŒwPenumbra ä¾¿ä»£è¡¨äº†é˜´å½±çš„æ¨¡ç³Šç¨‹åº¦"></p><ul><li>$W_{Penumbra}&#x3D;(d_{Receiver}-d_{Blocker})*W_{Light}&#x2F;d_{Blocker}$</li></ul><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">float</span> PCSS(<span class="hljs-type">sampler2D</span> shadowMap, <span class="hljs-type">vec4</span> coord) &#123;<br>    <span class="hljs-type">float</span> zReceiver = coord.z;<br><br>    <span class="hljs-comment">// STEP 1: avgblocker depth</span><br>    <span class="hljs-type">float</span> zBlocker = findBlocker(shadowMap, coord.xy, zReceiver);<br>    <span class="hljs-keyword">if</span>(zBlocker &lt;= EPS) <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span>;<br>    <span class="hljs-keyword">if</span>(zBlocker &gt;= <span class="hljs-number">1.0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;<br><br>    <span class="hljs-comment">// STEP 2: penumbra size</span><br>    <span class="hljs-type">float</span> wPenumbra = W_LIGHT * (zReceiver - zBlocker) / zBlocker;<br><br>    <span class="hljs-comment">// STEP 3: filtering</span><br>    <span class="hljs-type">int</span> unShadowCount = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; NUM_SAMPLES; i ++) &#123;<br>        <span class="hljs-type">vec2</span> sampleCoord = poissonDisk[i] * FILTER_DIAMETER * wPenumbra + coord.xy;<br>        <span class="hljs-type">vec4</span> closestDepthVec = <span class="hljs-built_in">texture2D</span>(shadowMap, sampleCoord); <br>        <span class="hljs-type">float</span> closestDepth = unpack(closestDepthVec);<br>        <span class="hljs-keyword">if</span>(zReceiver &lt; closestDepth + <span class="hljs-number">0.011</span>) &#123;<br>            unShadowCount += <span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-type">float</span>(unShadowCount) / <span class="hljs-type">float</span>(NUM_SAMPLES);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p><img src="/img/GAMES202/PCSS.png"></p><h1 id="é¢„è®¡ç®—è¾å°„ä¼ é€’"><a href="#é¢„è®¡ç®—è¾å°„ä¼ é€’" class="headerlink" title="é¢„è®¡ç®—è¾å°„ä¼ é€’"></a>é¢„è®¡ç®—è¾å°„ä¼ é€’</h1><p>&emsp;&emsp;å¦‚ä½•è®¡ç®—ç¯å¢ƒå…‰ç…§å¯ä»¥è¿‘ä¼¼ä¸ºä¸€ä¸ª ManyLight çš„é—®é¢˜ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæƒ³è¦å¾—çŸ¥æŸä¸€ç€è‰²ç‚¹è·å¾—çš„å…‰ç…§ï¼Œéœ€è¦å¯¹è¯¥ç‚¹çš„ä¸ŠåŠçƒè¿›è¡Œé‡‡æ ·ï¼Œè¿™ä¼šæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ€§èƒ½å¼€é”€ã€‚ä½¿ç”¨ PRT çš„åšæ³•å¯ä»¥ä½¿ç”¨é¢„è®¡ç®—çš„æ•°æ®ï¼Œåœ¨å®æ—¶çš„æ¡ä»¶ä¸‹å®ç°ç¯å¢ƒå…‰ç…§ã€‚æœªå®ç°ï¼šçƒè°å‡½æ•°çš„å¿«é€Ÿæ—‹è½¬ã€‚</p><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="Product-Integral"><a href="#Product-Integral" class="headerlink" title="Product Integral"></a>Product Integral</h3><ul><li>$\int _\Omega f(x)g(x)dx$&emsp;ä¸¤å‡½æ•°ä¹˜ç§¯çš„ç§¯åˆ†å¯ä»¥è§†ä¸ºæ»¤æ³¢ï¼Œç»“æœçš„é¢‘ç‡ç”±å…¶ä¸­æ›´ä½é¢‘çš„å‡½æ•°å†³å®šã€‚</li></ul><h3 id="åŸºå‡½æ•°"><a href="#åŸºå‡½æ•°" class="headerlink" title="åŸºå‡½æ•°"></a>åŸºå‡½æ•°</h3><ul><li>$f(x)&#x3D;\sum c_i\cdot B_i(x)$&emsp;å¯¹äºä»»ä¸€å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç³»åˆ—åŸºå‡½æ•°çš„çº¿æ€§ç»„åˆæ¥è¿‘ä¼¼å‡ºåŸå‡½æ•°ã€‚</li></ul><h3 id="çƒè°å‡½æ•°"><a href="#çƒè°å‡½æ•°" class="headerlink" title="çƒè°å‡½æ•°"></a>çƒè°å‡½æ•°</h3><p><img src="/img/GAMES202/SH.png"><br><strong>å®šä¹‰</strong>ï¼š$\frac{1}{\sin \theta}\frac{\partial}{\partial \theta}(\sin \theta \frac{\partial Y}{\partial \theta})+\frac{1}{\sin ^2\theta}\frac{\partial ^2Y}{\partial \varphi ^2}+l(l+1)Y&#x3D;0$<br>çƒè°å‡½æ•°æ˜¯ä¸€ç³»åˆ—å®šä¹‰åœ¨çƒé¢ä¸Šçš„åŸºå‡½æ•°ï¼Œè¿™é‡Œä¸æ·±å…¥ç†è§£å‡½æ•°çš„å®šä¹‰ï¼Œè€Œæ˜¯é‡ç‚¹å…³æ³¨è¯¥å‡½æ•°çš„å‡ ä¸ªæ€§è´¨ï¼š</p><ul><li>$c_i&#x3D;\int _\Omega f(\omega)B_i(\omega){\rm d}x$</li><li>æ­£äº¤æ€§ï¼Œä»»æ„ä¸¤åˆ†é‡ç›¸ä¹˜ç»“æœä¸ºé›¶ã€‚</li><li>æ—‹è½¬ä¸å˜æ€§ï¼Œæ—‹è½¬çš„ç»“æœå¯ç”±åŒé˜¶åŸºå‡½æ•°çš„çº¿æ€§ç»„åˆå¾—åˆ°ã€‚</li><li>åªç”¨ä¸‰é˜¶çš„çƒè°å‡½æ•°ä¾¿å¯ä»¥å¾ˆå¥½åœ°æ¢å¤å‡ºæ¸²æŸ“æ–¹ç¨‹ä¸­çš„ BRDF é¡¹ã€‚ <img src="/img/GAMES202/BRDF.png"></li><li>æ‰€ä»¥å¯¹äº Diffuse æè´¨ï¼ŒåŒæ ·ç”¨ä¸‰é˜¶çš„çƒè°å‡½æ•°è¡¨ç¤º Lighting é¡¹ï¼Œè¯¯å·®ä¸ä¼šè¶…è¿‡ %3ã€‚ <img src="/img/GAMES202/L.png"></li></ul><h2 id="Precomputed-Radiance-Transfer"><a href="#Precomputed-Radiance-Transfer" class="headerlink" title="Precomputed Radiance Transfer"></a>Precomputed Radiance Transfer</h2><p>å…ˆå†™å‡ºå®æ—¶æ¸²æŸ“ä¸­æ¸²æŸ“æ–¹ç¨‹çš„å½¢å¼ï¼š</p><ul><li>$L(o)&#x3D;\int _\Omega L(i)V(i)\rho (i, o)max(0, n\cdot i)di$</li></ul><p>ç§¯åˆ†ä¸­ L(i) å½“ä½œ Lighting é¡¹ï¼Œå…¶ä½™ä¸º LightTransport é¡¹ã€‚å‡è®¾åœºæ™¯ä¸­çš„ç‰©ä½“ä¸å˜ï¼ˆå³æ¯ä¸ªç‚¹çš„ LightTransport å°±åƒè¯¥ç‚¹çš„ä¸€ä¸ªæ€§è´¨ä¸€æ ·ä¸å˜ï¼‰ï¼Œå…‰æºå¯ä»¥æ—‹è½¬ã€‚</p><h3 id="Diffuse-çš„æƒ…å†µ"><a href="#Diffuse-çš„æƒ…å†µ" class="headerlink" title="Diffuse çš„æƒ…å†µ"></a>Diffuse çš„æƒ…å†µ</h3><p>BRDF é¡¹ä¸ºä¸€ä¸ªå¸¸å€¼ï¼Œå¯ä»¥ç›´æ¥æåˆ°ç§¯åˆ†å¤–ã€‚</p><ul><li>$L(o)&#x3D;\rho \int _\Omega L(i)V(i)max(0, n\cdot i)di$</li></ul><p>ç”±&nbsp;$L(i)\approx \sum l_iB_i(i)$&nbsp;å¾—</p><ul><li>$L(o)\approx \rho \sum l_i\int _\Omega B_i(i)V(i)max(0, n\cdot i)di$ï¼ˆä¸è€ƒè™‘äº¤æ¢ç§¯åˆ†ä¸æ±‚å’Œé¡ºåºçš„æ¡ä»¶ï¼‰</li></ul><p>ç”±&nbsp;$c_i&#x3D;\int _\Omega f(\omega)B_i(\omega){\rm d}x$&nbsp;å¾—</p><ul><li>$L(o)\approx \rho \sum l_iT_i$</li></ul><h2 id="Precompute-éƒ¨åˆ†"><a href="#Precompute-éƒ¨åˆ†" class="headerlink" title="Precompute éƒ¨åˆ†"></a>Precompute éƒ¨åˆ†</h2><ul><li>$c_i&#x3D;\int _\Omega f(\omega)B_i(\omega){\rm d}x$&emsp;</li></ul><p>ä½¿ç”¨é»æ›¼ç§¯åˆ†çš„æ–¹å¼è®¡ç®—ã€‚</p><ul><li>$c_i&#x3D;\sum _if(\omega)B_i(\omega)\Delta \omega$</li></ul><p><code>std::vector&lt;Eigen::Array3f&gt; PrecomputeCubemapSH(const std::vector&lt;std::unique_ptr&lt;float[]&gt;&gt; &amp;images,                                                     const int &amp;width, const int &amp;height,                                                     const int &amp;channel)</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) &#123;<br><span class="hljs-comment">// éå†å¤©ç©ºç›’æ¯ä¸ªé¢çš„æ¯ä¸ªåƒç´ </span><br><br>            <span class="hljs-comment">// åƒç´ å¯¹åº”çš„æ–¹å‘</span><br>            Eigen::Vector3f dir = cubemapDirs[i * width * height + y * width + x];<br>            <span class="hljs-type">int</span> index = (y * width + x) * channel;<br>            <span class="hljs-comment">// åƒç´ å¯¹åº”çš„å…‰ç…§</span><br>            <span class="hljs-function">Eigen::Array3f <span class="hljs-title">Le</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">images[i][index],</span></span><br><span class="hljs-params"><span class="hljs-function">images[i][index + <span class="hljs-number">1</span>],</span></span><br><span class="hljs-params"><span class="hljs-function">images[i][index + <span class="hljs-number">2</span>])</span></span>;<br>            <span class="hljs-comment">// åƒç´ åœ¨å•ä½çƒä¸Šå¯¹åº”çš„é¢ç§¯</span><br>            <span class="hljs-type">float</span> w = <span class="hljs-built_in">CalcArea</span>(x, y, width, height);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> l = <span class="hljs-number">0</span>; l &lt;= SHOrder; l++) &#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> m = -l; m &lt;= l; m++) &#123;<br>                    <span class="hljs-type">int</span> k = sh::<span class="hljs-built_in">GetIndex</span>(l, m);<br><span class="hljs-comment">// æŠ•å½±äºåŸºå‡½æ•°ä¸Š</span><br>                    <span class="hljs-type">double</span> basisFunc =<br>sh::<span class="hljs-built_in">EvalSH</span>(l, m, dir.<span class="hljs-built_in">cast</span>&lt;<span class="hljs-type">double</span>&gt;().<span class="hljs-built_in">normalized</span>());<br>                    SHCoeffiecents[k] += Le * basisFunc * w;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>void preprocess(const Scene *scene)</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; mesh-&gt;<span class="hljs-built_in">getVertexCount</span>(); i++) <br><span class="hljs-comment">// è·å–å½“å‰ mesh çš„åæ ‡å’Œæ³•çº¿&#123;</span><br><span class="hljs-type">const</span> Point3f &amp;v = mesh-&gt;<span class="hljs-built_in">getVertexPositions</span>().<span class="hljs-built_in">col</span>(i);<br><span class="hljs-type">const</span> Normal3f &amp;n = mesh-&gt;<span class="hljs-built_in">getVertexNormals</span>().<span class="hljs-built_in">col</span>(i);<br><span class="hljs-keyword">auto</span> shFunc = [&amp;](<span class="hljs-type">double</span> phi, <span class="hljs-type">double</span> theta) -&gt; <span class="hljs-type">double</span> &#123;<br>Eigen::Array3d d = sh::<span class="hljs-built_in">ToVector</span>(phi, theta);<br><span class="hljs-type">const</span> <span class="hljs-keyword">auto</span> wi = <span class="hljs-built_in">Vector3f</span>(d.<span class="hljs-built_in">x</span>(), d.<span class="hljs-built_in">y</span>(), d.<span class="hljs-built_in">z</span>());<br><span class="hljs-type">double</span> H = wi.<span class="hljs-built_in">dot</span>(n);<br><span class="hljs-keyword">if</span> (m_Type == Type::Unshadowed) &#123;<br><span class="hljs-keyword">if</span> (H &gt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">return</span> H;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>Ray3f <span class="hljs-built_in">ray</span>(v, wi.<span class="hljs-built_in">normalized</span>());<br><span class="hljs-comment">// æ²¡æœ‰hitåˆ°å…¶ä»–åœ°æ–¹çš„å°„çº¿å°±å¯¹æœ€ç»ˆå…‰ç…§ä¿¡æ¯æœ‰è´¡çŒ®</span><br><span class="hljs-keyword">if</span> (H &gt; <span class="hljs-number">0</span> &amp;&amp; !scene-&gt;<span class="hljs-built_in">rayIntersect</span>(ray)) &#123;<br><span class="hljs-keyword">return</span> H;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>&#125;;<br><span class="hljs-comment">// æŠ•å½±</span><br><span class="hljs-keyword">auto</span> shCoeff = sh::<span class="hljs-built_in">ProjectFunction</span>(SHOrder, shFunc, m_SampleCount);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; shCoeff-&gt;<span class="hljs-built_in">size</span>(); j++) &#123;<br>m_TransportSHCoeffs.<span class="hljs-built_in">col</span>(i).<span class="hljs-built_in">coeffRef</span>(j) = (*shCoeff)[j];<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœä¿å­˜åœ¨ light.txt ä¸ transport.txt ä¸­ã€‚</p><h2 id="Real-Time-éƒ¨åˆ†"><a href="#Real-Time-éƒ¨åˆ†" class="headerlink" title="Real Time éƒ¨åˆ†"></a>Real Time éƒ¨åˆ†</h2><p>æè´¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DiffuseMaterial</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Material</span> &#123;<br><br><span class="hljs-title function_">constructor</span>(<span class="hljs-params">vertexShader, fragmentShader</span>) &#123;<br><span class="hljs-keyword">let</span> precomputeL_mat = <span class="hljs-title function_">getMat3ValueFromRGB</span>(precomputeL[guiParams.<span class="hljs-property">envmapId</span>]);<br><br><span class="hljs-variable language_">super</span>(&#123;<br><span class="hljs-string">&#x27;aPrecomputeLR&#x27;</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;matrix3fv&#x27;</span>, <span class="hljs-attr">value</span>: precomputeL_mat[<span class="hljs-number">0</span>]&#125;,<br><span class="hljs-string">&#x27;aPrecomputeLG&#x27;</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;matrix3fv&#x27;</span>, <span class="hljs-attr">value</span>: precomputeL_mat[<span class="hljs-number">1</span>]&#125;,<br><span class="hljs-string">&#x27;aPrecomputeLB&#x27;</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;matrix3fv&#x27;</span>, <span class="hljs-attr">value</span>: precomputeL_mat[<span class="hljs-number">2</span>]&#125;<br>&#125;, [<span class="hljs-string">&#x27;aPrecomputeLT&#x27;</span>], vertexShader, fragmentShader, <span class="hljs-literal">null</span>);<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">mapid</span> = guiParams.<span class="hljs-property">envmapId</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">buildDiffuseMaterial</span>(<span class="hljs-params">vertexPath, fragmentPath</span>) &#123;<br><span class="hljs-keyword">let</span> vertexShader = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getShaderString</span>(vertexPath);<br><span class="hljs-keyword">let</span> fragmentShader = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getShaderString</span>(fragmentPath);<br><br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiffuseMaterial</span>(vertexShader, fragmentShader);<br>&#125;<br></code></pre></td></tr></table></figure><p>VertexShader</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat3</span> aPrecomputeLR;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat3</span> aPrecomputeLG;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat3</span> aPrecomputeLB;<br><span class="hljs-keyword">attribute</span> <span class="hljs-type">mat3</span> aPrecomputeLT;<br><br><span class="hljs-keyword">attribute</span> <span class="hljs-type">vec3</span> aVertexPosition;<br><span class="hljs-keyword">attribute</span> <span class="hljs-type">vec3</span> aNormalPosition;<br><span class="hljs-keyword">attribute</span> <span class="hljs-type">vec2</span> aTextureCoord;<br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat4</span> uModelMatrix;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat4</span> uViewMatrix;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat4</span> uProjectionMatrix;<br><br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec2</span> vTextureCoord;<br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec3</span> vFragPos;<br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec3</span> vNormal;<br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec3</span> vColor;<br><br><span class="hljs-keyword">const</span> <span class="hljs-type">float</span> kd = <span class="hljs-number">2.0</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-type">float</span> pi = <span class="hljs-number">3.14159</span>;<br><br><span class="hljs-type">void</span> main(<span class="hljs-type">void</span>) &#123;<br>  vFragPos = (uModelMatrix * <span class="hljs-type">vec4</span>(aVertexPosition, <span class="hljs-number">1.0</span>)).xyz;<br>  vNormal = (uModelMatrix * <span class="hljs-type">vec4</span>(aNormalPosition, <span class="hljs-number">0.0</span>)).xyz;<br><br>  <span class="hljs-type">vec3</span> iden = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);<br>  vColor = <span class="hljs-type">vec3</span>(<br>      <span class="hljs-built_in">dot</span>(<span class="hljs-built_in">matrixCompMult</span>(aPrecomputeLR, aPrecomputeLT) * iden, iden),<br>      <span class="hljs-built_in">dot</span>(<span class="hljs-built_in">matrixCompMult</span>(aPrecomputeLG, aPrecomputeLT) * iden, iden),<br>      <span class="hljs-built_in">dot</span>(<span class="hljs-built_in">matrixCompMult</span>(aPrecomputeLB, aPrecomputeLT) * iden, iden)<br>  ) * kd / pi;<br><br>  <span class="hljs-built_in">gl_Position</span> =<br>  uProjectionMatrix * uViewMatrix * uModelMatrix * <span class="hljs-type">vec4</span>(aVertexPosition, <span class="hljs-number">1.0</span>);<br>  vTextureCoord = aTextureCoord;<br>&#125;<br></code></pre></td></tr></table></figure><p>FragmentShader</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#ifdef GL_ES</span><br><span class="hljs-keyword">precision</span> <span class="hljs-keyword">mediump</span> <span class="hljs-type">float</span>;<br><span class="hljs-meta">#endif</span><br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> uSampler;<br><br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec2</span> vTextureCoord;<br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec3</span> vFragPos;<br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec3</span> vNormal;<br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec3</span> vColor;<br><br><span class="hljs-type">void</span> main(<span class="hljs-type">void</span>) &#123;<br>  <span class="hljs-type">vec3</span> color = <span class="hljs-built_in">texture2D</span>(uSampler, vTextureCoord).rgb;<br>  color = <span class="hljs-built_in">pow</span>(color, <span class="hljs-type">vec3</span>(<span class="hljs-number">2.2</span>));<br><br>  <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(vColor, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»“æœ-1"><a href="#ç»“æœ-1" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES202/1.png"></div><div class="group-image-wrap"><img src="/img/GAMES202/2.png"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES202/33.png"></div><div class="group-image-wrap"><img src="/img/GAMES202/4.png"></div></div></div><h1 id="å±å¹•ç©ºé—´åå°„"><a href="#å±å¹•ç©ºé—´åå°„" class="headerlink" title="å±å¹•ç©ºé—´åå°„"></a>å±å¹•ç©ºé—´åå°„</h1><p>&emsp;&emsp;ç¦»çº¿æ¸²æŸ“çš„æ¡ä»¶ä¸‹ï¼Œå…‰çº¿è¿½è¸ªå¯ä»¥å¤„ç†å…‰çº¿åœ¨ç©ºé—´å†…çš„å¤šæ¬¡å¼¹å°„ï¼Œå¸¦æ¥é«˜è´¨é‡çš„é—´æ¥å…‰ç…§ç»“æœï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨å®æ—¶çš„æ¡ä»¶ä¸‹å¾—åˆ°ä»¤äººæ»¡æ„çš„å…¨å±€å…‰ç…§æ•ˆæœå‘¢ã€‚å…¶ä¸­çš„ä¸€ç§åšæ³•æ˜¯åœ¨åš RayTracing æ—¶ä½¿ç”¨ DepthBuffer åˆ¤æ–­å°„çº¿ä¸å¹³é¢çš„ç›¸äº¤é—®é¢˜ï¼Œè®¤ä¸ºèƒ½è¢« DepthBuffer çœ‹è§å¾—ä¸–ç•Œåæ ‡æ˜¯â€œä½äºç‰©ä½“å¤–éƒ¨â€çš„åæ ‡ï¼Œçœ‹ä¸è§åˆ™åœ¨ç‰©ä½“å†…éƒ¨ï¼Œé‚£ä¹ˆä¸€æ¡æ­¥è¿›çš„ Ray ä»å¯è§è½¬ä¸ºä¸å¯è§æ—¶çš„ä½ç½®ä¾¿æ˜¯æŸä¸€è¡¨é¢æ‰€åœ¨çš„åæ ‡ï¼Œè¿™æ ·ç›¸äº¤çš„è®¡ç®—å°±è½¬å˜ä¸ºäºŒç»´ç©ºé—´ä¸‹çš„æ­¥è¿›ä¸æŸ¥è¡¨ã€‚</p><h2 id="Shader"><a href="#Shader" class="headerlink" title="Shader"></a>Shader</h2><h3 id="Diffuse"><a href="#Diffuse" class="headerlink" title="Diffuse"></a>Diffuse</h3><p>EvalDiffuse(wi, wo, uv) çš„è¿”å›å€¼ä¸º BSDF çš„å€¼ã€‚å‚æ•° wi å’Œ wo ä¸ºä¸–ç•Œåæ ‡ç³»ä¸­çš„å€¼ï¼Œåˆ†åˆ«ä»£è¡¨å…¥å°„æ–¹å‘å’Œå‡ºå°„æ–¹å‘ï¼Œè¿™ä¸¤ä¸ªæ–¹å‘çš„èµ·ç‚¹éƒ½æ˜¯ç€è‰²ç‚¹ï¼Œuv ä¸ºç€è‰²ç‚¹åœ¨å±å¹•ç©ºé—´ä¸­çš„åæ ‡ã€‚</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">vec3</span> EvalDiffuse(<span class="hljs-type">vec3</span> wi, <span class="hljs-type">vec3</span> wo, <span class="hljs-type">vec2</span> uv) &#123;<br>  <span class="hljs-type">vec3</span> Ld = GetGBufferDiffuse(uv);<br>  <span class="hljs-type">vec3</span> n = GetGBufferNormalWorld(uv);<br>  <span class="hljs-type">float</span> nDotL = <span class="hljs-built_in">max</span>(<span class="hljs-number">0.0</span>, <span class="hljs-built_in">dot</span>(n, wi));<br><br>  <span class="hljs-keyword">return</span> Ld * nDotL * INV_PI;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="DirectionalLight"><a href="#DirectionalLight" class="headerlink" title="DirectionalLight"></a>DirectionalLight</h3><p>EvalDirectionalLight(uv) çš„è¿”å›å€¼ä¸ºï¼Œç€è‰²ç‚¹ä½äº uv å¤„å¾—åˆ°çš„å…‰æºçš„è¾å°„åº¦ï¼Œå¹¶ä¸”éœ€è¦è€ƒè™‘é®æŒ¡å…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨ GetGBufferuShadow(uv) å‡½æ•°å¾—åˆ°ã€‚</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">vec3</span> EvalDirectionalLight(<span class="hljs-type">vec2</span> uv) &#123;<br>    <span class="hljs-type">vec3</span> woeldPos = GetGBufferPosWorld(uv);<br>    <span class="hljs-type">vec3</span> wi = <span class="hljs-built_in">normalize</span>(uLightDir);<br>    <span class="hljs-type">vec3</span> wo = <span class="hljs-built_in">normalize</span>(uCameraPos - woeldPos);<br>    <span class="hljs-type">vec3</span> bsdf = EvalDiffuse(wi, wo, uv);<br><br>    <span class="hljs-keyword">return</span> uLightRadiance * bsdf * GetGBufferuShadow(uv);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="RayMarch"><a href="#RayMarch" class="headerlink" title="RayMarch"></a>RayMarch</h3><p>RayMarch(vec3 ori, vec3 dir, vec3 hitPos) çš„è¿”å›å€¼ä¸ºæ˜¯å¦ç›¸äº¤ï¼Œç›¸äº¤æ—¶å°†å‚æ•° hitPos è®¾ç½®ä¸ºäº¤ç‚¹ã€‚å‚æ•° ori å’Œ dir ä¸ºä¸–ç•Œåæ ‡ç³»ï¼Œåˆ†åˆ«ä»£è¡¨å…‰çº¿çš„èµ·ç‚¹å’Œæ–¹å‘ã€‚</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#define EPS 1e-3</span><br><span class="hljs-type">bool</span> OutOfScreen(<span class="hljs-type">vec3</span> pos) &#123;<br>    <span class="hljs-type">vec2</span> uv = GetScreenCoordinate(pos);<br>    <span class="hljs-keyword">return</span> uv.x &lt; <span class="hljs-number">0.0</span> || uv.y &lt; <span class="hljs-number">0.0</span> || uv.x &gt; <span class="hljs-number">1.0</span> || uv.y &gt; <span class="hljs-number">1.0</span>;<br>&#125;<br><span class="hljs-type">bool</span> Visible(<span class="hljs-type">vec3</span> pos) &#123;<br>    <span class="hljs-keyword">return</span> GetDepth(pos) &lt; GetGBufferDepth(GetScreenCoordinate(pos));<br>&#125;<br><br><span class="hljs-type">bool</span> RayMarch(<span class="hljs-type">vec3</span> ori, <span class="hljs-type">vec3</span> dir, <span class="hljs-keyword">out</span> <span class="hljs-type">vec3</span> hitPos) &#123;<br>    <span class="hljs-type">bool</span> isHit = <span class="hljs-literal">false</span>, intersected = <span class="hljs-literal">false</span>;<br>    <span class="hljs-type">float</span> stepLenth = <span class="hljs-number">1.0</span>;<br>    <span class="hljs-type">vec3</span> crtPos = ori;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1280</span>; i++) &#123;<br>        <span class="hljs-keyword">if</span>(OutOfScreen(crtPos)) &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(Visible(crtPos + dir * stepLenth)) &#123;<br>            <span class="hljs-comment">// æ— äº¤ç‚¹åˆ™æ­¥é•¿ä¸å˜ç»§ç»­æ­¥è¿›</span><br>            crtPos += dir * stepLenth;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            intersected = <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(stepLenth &lt; EPS) &#123;<br>            <span class="hljs-comment">// å½“ç²¾åº¦é«˜åˆ°ä¸€å®šç¨‹åº¦æ—¶ç»“æŸå¾ªç¯</span><br>            isHit = <span class="hljs-literal">true</span>;<br>            hitPos = crtPos;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(intersected) &#123;<br>            <span class="hljs-comment">// ä¸€æ—¦å‘ç°å‰æ–¹ä¸ºäº¤ç‚¹åˆ™ä¸æ–­æé«˜ç²¾åº¦</span><br>            stepLenth *= <span class="hljs-number">0.5</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> isHit;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="IndirectLight"><a href="#IndirectLight" class="headerlink" title="IndirectLight"></a>IndirectLight</h3><p>ä½¿ç”¨è’™ç‰¹å¡æ´›çš„æ–¹å¼å¯¹åŠçƒè¿›è¡Œç§¯åˆ†ï¼Œç›´æ¥å…‰ç…§ç€è‰²ç‚¹ q å¯¹é—´æ¥å…‰ç…§ä½œè‰²ç‚¹ p çš„è´¡çŒ®ä¸º</p><ul><li>$L_{indir}&#x3D;\frac{EvalDiffuse(q)}{pdf}*EvalDiffuse(p)*EvalDirectionalLight(p)$</li></ul><p>SampleHemisphereCos(seed, pdf) ä¼šè¿”å›ä¸€ä¸ªå±€éƒ¨åæ ‡ç³»çš„éšæœºä½ç½®ã€‚LocalBasis(n, b1, b2) é€šè¿‡ä¼ å…¥çš„ä¸–ç•Œåæ ‡ç³»çš„æ³•çº¿ nï¼Œå»ºç«‹å±€éƒ¨åæ ‡ç³»ï¼Œè¿”å›ä¸¤ä¸ªåˆ‡çº¿å‘é‡ã€‚</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#define SAMPLE_NUM 2</span><br><span class="hljs-type">vec3</span> EvalIndirectLight(<span class="hljs-type">float</span> seed, <span class="hljs-type">vec3</span> pos) &#123;<br>    <span class="hljs-type">float</span> pdf;<br>    <span class="hljs-type">vec3</span> Lid = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>), hitPos;<br>    <span class="hljs-type">vec2</span> screenPos = GetScreenCoordinate(pos);<br><br>    <span class="hljs-comment">// å±€éƒ¨è½¬æ¢è‡³ä¸–ç•Œåæ ‡</span><br>    <span class="hljs-type">vec3</span> normal = GetGBufferNormalWorld(screenPos), b1, b2;<br>    LocalBasis(normal, b1, b2);<br>    <span class="hljs-type">mat3</span> TBN = <span class="hljs-type">mat3</span>(b1, b2, normal);<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; SAMPLE_NUM; i++) &#123;<br>        <span class="hljs-type">vec3</span> sampleDir = <span class="hljs-built_in">normalize</span>(TBN * SampleHemisphereCos(seed, pdf));<br>        <span class="hljs-comment">// SampleHemisphereUniform(seed, pdf);</span><br>        <span class="hljs-keyword">if</span>(RayMarch(pos, sampleDir, hitPos)) &#123;<br>            <span class="hljs-type">vec3</span> wi = <span class="hljs-built_in">normalize</span>(uLightDir);<br>            <span class="hljs-type">vec3</span> wo = <span class="hljs-built_in">normalize</span>(uCameraPos - pos);<br>            <span class="hljs-type">vec2</span> screenHitPos = GetScreenCoordinate(hitPos);<br><br>            <span class="hljs-type">vec3</span> L = EvalDiffuse(sampleDir, wo, screenPos) / pdf *<br>        EvalDiffuse(wi, -sampleDir, screenHitPos) * EvalDirectionalLight(screenHitPos);<br>            <br>            Lid += L;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> Lid / <span class="hljs-type">float</span>(SAMPLE_NUM);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å®Œæ•´çš„-FragmentSHader"><a href="#å®Œæ•´çš„-FragmentSHader" class="headerlink" title="å®Œæ•´çš„ FragmentSHader"></a>å®Œæ•´çš„ FragmentSHader</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#ifdef GL_ES</span><br><span class="hljs-keyword">precision</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">float</span>;<br><span class="hljs-meta">#endif</span><br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> uLightDir;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> uCameraPos;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> uLightRadiance;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> uGDiffuse;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> uGDepth;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> uGNormalWorld;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> uGShadow;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> uGPosWorld;<br><br><span class="hljs-keyword">varying</span> <span class="hljs-type">mat4</span> vWorldToScreen;<br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec4</span> vPosWorld;<br><br><span class="hljs-meta">#define M_PI 3.1415926535897932384626433832795</span><br><span class="hljs-meta">#define TWO_PI 6.283185307</span><br><span class="hljs-meta">#define INV_PI 0.31830988618</span><br><span class="hljs-meta">#define INV_TWO_PI 0.15915494309</span><br><br><span class="hljs-type">float</span> Rand1(<span class="hljs-keyword">inout</span> <span class="hljs-type">float</span> p) &#123;<br>  p = <span class="hljs-built_in">fract</span>(p * <span class="hljs-number">.1031</span>);<br>  p *= p + <span class="hljs-number">33.33</span>;<br>  p *= p + p;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">fract</span>(p);<br>&#125;<br><br><span class="hljs-type">vec2</span> Rand2(<span class="hljs-keyword">inout</span> <span class="hljs-type">float</span> p) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-type">vec2</span>(Rand1(p), Rand1(p));<br>&#125;<br><br><span class="hljs-type">float</span> InitRand(<span class="hljs-type">vec2</span> uv) &#123;<br>  <span class="hljs-type">vec3</span> p3 = <span class="hljs-built_in">fract</span>(<span class="hljs-type">vec3</span>(uv.xyx) * <span class="hljs-number">.1031</span>);<br>  p3 += <span class="hljs-built_in">dot</span>(p3, p3.yzx + <span class="hljs-number">33.33</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">fract</span>((p3.x + p3.y) * p3.z);<br>&#125;<br><br><span class="hljs-type">vec3</span> SampleHemisphereUniform(<span class="hljs-keyword">inout</span> <span class="hljs-type">float</span> s, <span class="hljs-keyword">out</span> <span class="hljs-type">float</span> pdf) &#123;<br>  <span class="hljs-type">vec2</span> uv = Rand2(s);<br>  <span class="hljs-type">float</span> z = uv.x;<br>  <span class="hljs-type">float</span> phi = uv.y * TWO_PI;<br>  <span class="hljs-type">float</span> sinTheta = <span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1.0</span> - z*z);<br>  <span class="hljs-type">vec3</span> dir = <span class="hljs-type">vec3</span>(sinTheta * <span class="hljs-built_in">cos</span>(phi), sinTheta * <span class="hljs-built_in">sin</span>(phi), z);<br>  pdf = INV_TWO_PI;<br>  <span class="hljs-keyword">return</span> dir;<br>&#125;<br><br><span class="hljs-type">vec3</span> SampleHemisphereCos(<span class="hljs-keyword">inout</span> <span class="hljs-type">float</span> s, <span class="hljs-keyword">out</span> <span class="hljs-type">float</span> pdf) &#123;<br>  <span class="hljs-type">vec2</span> uv = Rand2(s);<br>  <span class="hljs-type">float</span> z = <span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1.0</span> - uv.x);<br>  <span class="hljs-type">float</span> phi = uv.y * TWO_PI;<br>  <span class="hljs-type">float</span> sinTheta = <span class="hljs-built_in">sqrt</span>(uv.x);<br>  <span class="hljs-type">vec3</span> dir = <span class="hljs-type">vec3</span>(sinTheta * <span class="hljs-built_in">cos</span>(phi), sinTheta * <span class="hljs-built_in">sin</span>(phi), z);<br>  pdf = z * INV_PI;<br>  <span class="hljs-keyword">return</span> dir;<br>&#125;<br><br><span class="hljs-type">void</span> LocalBasis(<span class="hljs-type">vec3</span> n, <span class="hljs-keyword">out</span> <span class="hljs-type">vec3</span> b1, <span class="hljs-keyword">out</span> <span class="hljs-type">vec3</span> b2) &#123;<br>  <span class="hljs-type">float</span> sign_ = <span class="hljs-built_in">sign</span>(n.z);<br>  <span class="hljs-keyword">if</span> (n.z == <span class="hljs-number">0.0</span>) &#123;<br>    sign_ = <span class="hljs-number">1.0</span>;<br>  &#125;<br>  <span class="hljs-type">float</span> a = <span class="hljs-number">-1.0</span> / (sign_ + n.z);<br>  <span class="hljs-type">float</span> b = n.x * n.y * a;<br>  b1 = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span> + sign_ * n.x * n.x * a, sign_ * b, -sign_ * n.x);<br>  b2 = <span class="hljs-type">vec3</span>(b, sign_ + n.y * n.y * a, -n.y);<br>&#125;<br><br><span class="hljs-type">vec4</span> Project(<span class="hljs-type">vec4</span> a) &#123;<br>  <span class="hljs-keyword">return</span> a / a.w;<br>&#125;<br><br><span class="hljs-type">float</span> GetDepth(<span class="hljs-type">vec3</span> posWorld) &#123;<br>  <span class="hljs-type">float</span> depth = (vWorldToScreen * <span class="hljs-type">vec4</span>(posWorld, <span class="hljs-number">1.0</span>)).w;<br>  <span class="hljs-keyword">return</span> depth;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Transform point from world space to screen space([0, 1] x [0, 1])</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">vec2</span> GetScreenCoordinate(<span class="hljs-type">vec3</span> posWorld) &#123;<br>  <span class="hljs-type">vec2</span> uv = Project(vWorldToScreen * <span class="hljs-type">vec4</span>(posWorld, <span class="hljs-number">1.0</span>)).xy * <span class="hljs-number">0.5</span> + <span class="hljs-number">0.5</span>;<br>  <span class="hljs-keyword">return</span> uv;<br>&#125;<br><br><span class="hljs-type">float</span> GetGBufferDepth(<span class="hljs-type">vec2</span> uv) &#123;<br>  <span class="hljs-type">float</span> depth = <span class="hljs-built_in">texture2D</span>(uGDepth, uv).x;<br>  <span class="hljs-keyword">if</span> (depth &lt; <span class="hljs-number">1e-2</span>) &#123;<br>    depth = <span class="hljs-number">1000.0</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> depth;<br>&#125;<br><br><span class="hljs-type">vec3</span> GetGBufferNormalWorld(<span class="hljs-type">vec2</span> uv) &#123;<br>  <span class="hljs-type">vec3</span> normal = <span class="hljs-built_in">texture2D</span>(uGNormalWorld, uv).xyz;<br>  <span class="hljs-keyword">return</span> normal;<br>&#125;<br><br><span class="hljs-type">vec3</span> GetGBufferPosWorld(<span class="hljs-type">vec2</span> uv) &#123;<br>  <span class="hljs-type">vec3</span> posWorld = <span class="hljs-built_in">texture2D</span>(uGPosWorld, uv).xyz;<br>  <span class="hljs-keyword">return</span> posWorld;<br>&#125;<br><br><span class="hljs-type">float</span> GetGBufferuShadow(<span class="hljs-type">vec2</span> uv) &#123;<br>  <span class="hljs-type">float</span> visibility = <span class="hljs-built_in">texture2D</span>(uGShadow, uv).x;<br>  <span class="hljs-keyword">return</span> visibility;<br>&#125;<br><br><span class="hljs-type">vec3</span> GetGBufferDiffuse(<span class="hljs-type">vec2</span> uv) &#123;<br>  <span class="hljs-type">vec3</span> diffuse = <span class="hljs-built_in">texture2D</span>(uGDiffuse, uv).xyz;<br>  diffuse = <span class="hljs-built_in">pow</span>(diffuse, <span class="hljs-type">vec3</span>(<span class="hljs-number">2.2</span>));<br>  <span class="hljs-keyword">return</span> diffuse;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Evaluate diffuse bsdf value.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * wi, wo are all in world space.</span><br><span class="hljs-comment"> * uv is in screen space, [0, 1] x [0, 1].</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">vec3</span> EvalDiffuse(<span class="hljs-type">vec3</span> wi, <span class="hljs-type">vec3</span> wo, <span class="hljs-type">vec2</span> uv) &#123;<br>  <span class="hljs-type">vec3</span> Ld = GetGBufferDiffuse(uv);<br>  <span class="hljs-type">vec3</span> n = GetGBufferNormalWorld(uv);<br>  <span class="hljs-type">float</span> nDotL = <span class="hljs-built_in">max</span>(<span class="hljs-number">0.0</span>, <span class="hljs-built_in">dot</span>(n, wi));<br>  <span class="hljs-keyword">return</span> Ld * nDotL * INV_PI;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Evaluate directional light with shadow map</span><br><span class="hljs-comment"> * uv is in screen space, [0, 1] x [0, 1].</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">vec3</span> EvalDirectionalLight(<span class="hljs-type">vec2</span> uv) &#123;<br>  <span class="hljs-type">vec3</span> woeldPos = GetGBufferPosWorld(uv);<br>  <span class="hljs-type">vec3</span> wi = <span class="hljs-built_in">normalize</span>(uLightDir);<br>  <span class="hljs-type">vec3</span> wo = <span class="hljs-built_in">normalize</span>(uCameraPos - woeldPos);<br>  <span class="hljs-type">vec3</span> bsdf = EvalDiffuse(wi, wo, uv);<br>  <span class="hljs-keyword">return</span> uLightRadiance * bsdf * GetGBufferuShadow(uv);<br>&#125;<br><br><span class="hljs-meta">#define EPS 1e-3</span><br><span class="hljs-type">bool</span> OutOfScreen(<span class="hljs-type">vec3</span> pos) &#123;<br>  <span class="hljs-type">vec2</span> uv = GetScreenCoordinate(pos);<br>  <span class="hljs-keyword">return</span> uv.x &lt; <span class="hljs-number">0.0</span> || uv.y &lt; <span class="hljs-number">0.0</span> || uv.x &gt; <span class="hljs-number">1.0</span> || uv.y &gt; <span class="hljs-number">1.0</span>;<br>&#125;<br><span class="hljs-type">bool</span> Visible(<span class="hljs-type">vec3</span> pos) &#123;<br>  <span class="hljs-keyword">return</span> GetDepth(pos) &lt; GetGBufferDepth(GetScreenCoordinate(pos));<br>&#125;<br><span class="hljs-type">bool</span> RayMarch(<span class="hljs-type">vec3</span> ori, <span class="hljs-type">vec3</span> dir, <span class="hljs-keyword">out</span> <span class="hljs-type">vec3</span> hitPos) &#123;<br>  <span class="hljs-type">bool</span> isHit = <span class="hljs-literal">false</span>, intersected = <span class="hljs-literal">false</span>;<br>  <span class="hljs-type">float</span> stepLenth = <span class="hljs-number">0.1</span>;<br>  <span class="hljs-type">vec3</span> crtPos = ori;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1280</span>; i++) &#123;<br>    <span class="hljs-keyword">if</span>(OutOfScreen(crtPos)) &#123;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(Visible(crtPos + dir * stepLenth)) &#123;<br>      <span class="hljs-comment">// æ— äº¤ç‚¹åˆ™æ­¥é•¿ä¸å˜ç»§ç»­æ­¥è¿›</span><br>      crtPos += dir * stepLenth;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>      intersected = <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(stepLenth &lt; EPS) &#123;<br>      <span class="hljs-comment">// å½“ç²¾åº¦é«˜åˆ°ä¸€å®šç¨‹åº¦æ—¶ç»“æŸå¾ªç¯</span><br>      isHit = <span class="hljs-literal">true</span>;<br>      hitPos = crtPos;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(intersected) &#123;<br>      <span class="hljs-comment">// ä¸€æ—¦å‘ç°å‰æ–¹ä¸ºäº¤ç‚¹åˆ™ä¸æ–­æé«˜ç²¾åº¦</span><br>      stepLenth *= <span class="hljs-number">0.5</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> isHit;<br>&#125;<br><br><span class="hljs-meta">#define SAMPLE_NUM 2</span><br><span class="hljs-type">vec3</span> EvalIndirectLight(<span class="hljs-type">float</span> seed, <span class="hljs-type">vec3</span> pos) &#123;<br>  <span class="hljs-type">float</span> pdf;<br>  <span class="hljs-type">vec3</span> Lid = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>), hitPos;<br>  <span class="hljs-type">vec2</span> screenPos = GetScreenCoordinate(pos);<br><br>  <span class="hljs-type">vec3</span> normal = GetGBufferNormalWorld(screenPos), b1, b2;<br>  LocalBasis(normal, b1, b2);<br>  <span class="hljs-type">mat3</span> TBN = <span class="hljs-type">mat3</span>(b1, b2, normal);<br><br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; SAMPLE_NUM; i++) &#123;<br>    <span class="hljs-comment">// SampleHemisphere</span><br>    <span class="hljs-type">vec3</span> sampleDir = <span class="hljs-built_in">normalize</span>(TBN * SampleHemisphereCos(seed, pdf));<br>    <span class="hljs-keyword">if</span>(RayMarch(pos, sampleDir, hitPos)) &#123;<br>      <span class="hljs-type">vec3</span> wi = <span class="hljs-built_in">normalize</span>(uLightDir);<br>      <span class="hljs-type">vec3</span> wo = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>);<br>      <span class="hljs-type">vec2</span> screenHitPos = GetScreenCoordinate(hitPos);<br><br>      <span class="hljs-type">vec3</span> L = EvalDiffuse(sampleDir, wo, screenPos) / pdf *<br>        EvalDiffuse(wi, wo, screenHitPos) * EvalDirectionalLight(screenHitPos);<br>        <br>      Lid += L;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> Lid / <span class="hljs-type">float</span>(SAMPLE_NUM) * <span class="hljs-number">100.0</span>;<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>  <span class="hljs-type">float</span> s = InitRand(<span class="hljs-built_in">gl_FragCoord</span>.xy);<br><br>  <span class="hljs-type">vec3</span> L = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>);<br>  <span class="hljs-comment">// L += GetGBufferDiffuse(GetScreenCoordinate(vPosWorld.xyz));</span><br>  L += EvalDirectionalLight(GetScreenCoordinate(vPosWorld.xyz));<br><br>  <span class="hljs-comment">// vec3 test_dir = vec3(0.0);</span><br>  <span class="hljs-comment">// vec3 wo = normalize(uCameraPos - vPosWorld.xyz);</span><br>  <span class="hljs-comment">// vec3 normal = GetGBufferNormalWorld(GetScreenCoordinate(vPosWorld.xyz));</span><br>  <span class="hljs-comment">// test_dir = reflect(-wo,normal);</span><br>  <span class="hljs-comment">// vec3 test_hit;</span><br>  <span class="hljs-comment">// if(RayMarch(vPosWorld.xyz, test_dir, test_hit)) &#123;</span><br>  <span class="hljs-comment">//   L = GetGBufferDiffuse(GetScreenCoordinate(test_hit));</span><br>  <span class="hljs-comment">// &#125;</span><br><br>  L += EvalIndirectLight(s, vPosWorld.xyz);<br><br>  <span class="hljs-type">vec3</span> color = <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">clamp</span>(L, <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>), <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>)), <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span> / <span class="hljs-number">2.2</span>));<br>  <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(<span class="hljs-type">vec3</span>(color.rgb), <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»“æœ-2"><a href="#ç»“æœ-2" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES202/df.png" alt="Diffuse Albedo"></div><div class="group-image-wrap"><img src="/img/GAMES202/ssr.png" alt="SSR"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES202/di.png" alt="Direct Light"></div><div class="group-image-wrap"><img src="/img/GAMES202/dis.png" alt="ç»“åˆ"></div></div></div><h1 id="Kulla-Conty-å¾®è¡¨é¢æ¨¡å‹èƒ½é‡è¡¥å¿"><a href="#Kulla-Conty-å¾®è¡¨é¢æ¨¡å‹èƒ½é‡è¡¥å¿" class="headerlink" title="Kulla-Conty å¾®è¡¨é¢æ¨¡å‹èƒ½é‡è¡¥å¿"></a>Kulla-Conty å¾®è¡¨é¢æ¨¡å‹èƒ½é‡è¡¥å¿</h1><p>&emsp;&emsp;å¾®è¡¨é¢æ¨¡å‹çš„ BRDF(Microfacet BRDF) å­˜åœ¨ä¸€ä¸ªæ ¹æœ¬é—®é¢˜ï¼Œå°±æ˜¯å…¶ä¸­çš„ G é¡¹è®¤ä¸ºè¢«å¾®è¡¨é¢é®æŒ¡çš„åå°„å…‰ä¼šç›´æ¥æ¶ˆå¤±ï¼Œä»è€Œå¿½ç•¥äº†å¾®è¡¨é¢é—´çš„å¤šæ¬¡å¼¹å°„ï¼Œè¿™å°±å¯¼è‡´äº†èƒ½é‡çš„æŸå¤±ã€‚å¹¶ä¸”å½“æè´¨çš„ç²—ç³™åº¦è¶Šé«˜æ—¶ï¼Œèƒ½é‡çš„æŸå¤±ä¼šè¶Šä¸¥é‡ã€‚Kulla-Conty è¿‘ä¼¼æ¨¡å‹é€šè¿‡å¼•å…¥ä¸€ä¸ªå¾®è¡¨é¢ BRDF çš„è¡¥å¿é¡¹ï¼Œæ¥è¡¥å¿å…‰çº¿çš„å¤šæ¬¡å¼¹å°„ï¼Œä½¿å¾—æè´¨çš„æ¸²æŸ“ç»“æœå¯ä»¥è¿‘ä¼¼ä¿æŒèƒ½é‡å®ˆæ’ã€‚</p><h2 id="BRDF"><a href="#BRDF" class="headerlink" title="BRDF"></a>BRDF</h2><ul><li>$f_r(i,o)&#x3D;\frac{F(i,h)G(i,o,h)D(h)}{4(n,i)(n,o)}$</li></ul><p><strong>F é¡¹ï¼Œé€‰ç”¨ Schlick è¿‘ä¼¼ï¼š</strong></p><ul><li>$F&#x3D;R_0+(1-R_0)(1-\cos \theta)^5$</li></ul><p><strong>D é¡¹ï¼Œé€‰ç”¨ GGX åˆ†å¸ƒï¼š</strong></p><ul><li>$D_{GGX}(h)&#x3D;\frac{\alpha ^2}{\pi ((n\cdot h)^2(\alpha ^2-1)+1)^2}$</li></ul><p><strong>G é¡¹ï¼Œé€‰ç”¨ Smith æ¨¡å‹ï¼š</strong></p><ul><li>$G_{Smith}(i,o,h)&#x3D;G_{Schlick}(l,h)G_{Schlick}(v,h)$</li><li>$G_{Schlick}(v,n)+\frac{n\cdot v}{n\cdot v(1-k)+k}$</li><li>$k&#x3D;\frac{(roughness+1)^2}{8}$</li></ul><h2 id="Precompute-éƒ¨åˆ†-1"><a href="#Precompute-éƒ¨åˆ†-1" class="headerlink" title="Precompute éƒ¨åˆ†"></a>Precompute éƒ¨åˆ†</h2><h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>Kulla-Conty æ¨¡å‹å‡è®¾ Li ä¸º 1ï¼Œå¹¶è¯•å›¾ç§¯åˆ†å‡ºåœ¨ç»™å®š BRDF ä¸‹ä¸€ç€è‰²ç‚¹è¾å°„å‡ºçš„æ‰€æœ‰èƒ½é‡ Eï¼Œé‚£ä¹ˆåœ¨è€ƒè™‘å…‰çº¿åªå‘ç”Ÿä¸€æ¬¡å¼¹å°„çš„æƒ…å†µä¸‹ï¼Œæ‰€æŸå¤±çš„ã€éœ€è¦è¡¥å……çš„èƒ½é‡è‡ªç„¶å°±æ˜¯ (1 - E) äº†ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬å¸Œæœ›èƒ½å¾—åˆ°ä¸€ä¸ª BRDFï¼Œå¹¶ä¸”è¯¥å…¬å¼åœ¨åŠçƒä¸Šçš„ç§¯åˆ†å€¼ä¸º (1 - E)ï¼Œåœ¨å®æ—¶è®¡ç®—æ—¶å°†è¯¥ BRDF è¡¥å……è‡³åŸ BRDF ä¸Šä¾¿èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p><h3 id="GGX-E"><a href="#GGX-E" class="headerlink" title="GGX_E"></a>GGX_E</h3><ul><li>$E(\mu _o)&#x3D;\int _0^{2\pi}\int _0 ^1f_r(\mu _o,\mu _i,\phi)\mu _id\mu _id\phi$</li></ul><p>æ³¨ï¼š$\mu &#x3D;\sin \theta$ï¼Œè¯¥å…¬å¼æœ¬è´¨ä¸Šä»ç„¶æ˜¯æ¸²æŸ“æ–¹ç¨‹çš„ä¸€ç§å˜å½¢ï¼Œå°†è¯¥ç§¯åˆ†æ¢å…ƒä¾¿å¯å¾—åˆ°ä¸€ä¸ªåœ¨åŠçƒä¸Šå¯¹ $\omega$ ç§¯åˆ†çš„å…¬å¼ã€‚</p><h4 id="é¢„è®¡ç®—å®ç°"><a href="#é¢„è®¡ç®—å®ç°" class="headerlink" title="é¢„è®¡ç®—å®ç°"></a>é¢„è®¡ç®—å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sstream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;random&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;vec.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> STB_IMAGE_WRITE_IMPLEMENTATION</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;stb_image_write.h&quot;</span></span><br><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> resolution = <span class="hljs-number">128</span>;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">samplePoints</span> &#123;<br>    std::vector&lt;Vec3f&gt; directions;<br>    std::vector&lt;<span class="hljs-type">float</span>&gt; PDFs;<br>&#125;samplePoints;<br><br><span class="hljs-comment">// è¿”å›åŠçƒä¸Š sample_count ä¸ªé‡‡æ ·ç‚¹</span><br><span class="hljs-function">samplePoints <span class="hljs-title">squareToCosineHemisphere</span><span class="hljs-params">(<span class="hljs-type">int</span> sample_count)</span></span>&#123;<br>    samplePoints samlpeList;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> sample_side = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">floor</span>(<span class="hljs-built_in">sqrt</span>(sample_count)));<br><br>    std::random_device rd;<br>    <span class="hljs-function">std::mt19937 <span class="hljs-title">gen</span><span class="hljs-params">(rd())</span></span>;<br>    std::uniform_real_distribution&lt;&gt; <span class="hljs-built_in">rng</span>(<span class="hljs-number">0.f</span>, <span class="hljs-number">1.f</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> t = <span class="hljs-number">0</span>; t &lt; sample_side; t++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> p = <span class="hljs-number">0</span>; p &lt; sample_side; p++) &#123;<br>            <span class="hljs-type">double</span> samplex = (t + <span class="hljs-built_in">rng</span>(gen)) / sample_side;<br>            <span class="hljs-type">double</span> sampley = (p + <span class="hljs-built_in">rng</span>(gen)) / sample_side;<br>            <br>            <span class="hljs-type">double</span> theta = <span class="hljs-number">0.5f</span> * <span class="hljs-built_in">acos</span>(<span class="hljs-number">1</span> - <span class="hljs-number">2</span> * samplex);<br>            <span class="hljs-type">double</span> phi =  <span class="hljs-number">2</span> * PI * sampley;<br>            Vec3f wi = <span class="hljs-built_in">Vec3f</span>(<span class="hljs-built_in">sin</span>(theta) * <span class="hljs-built_in">cos</span>(phi), <span class="hljs-built_in">sin</span>(theta) * <span class="hljs-built_in">sin</span>(phi), <span class="hljs-built_in">cos</span>(theta));<br>            <span class="hljs-type">float</span> pdf = wi.z / PI;<br>            <br>            samlpeList.directions.<span class="hljs-built_in">push_back</span>(wi);<br>            samlpeList.PDFs.<span class="hljs-built_in">push_back</span>(pdf);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> samlpeList;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">FresnelSchlick</span><span class="hljs-params">(<span class="hljs-type">float</span> HdotV, <span class="hljs-type">float</span> R0)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> R0 + (<span class="hljs-number">1.f</span> - R0) * <span class="hljs-built_in">pow</span>(<span class="hljs-number">1.f</span> - HdotV, <span class="hljs-number">5.f</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">DistributionGGX</span><span class="hljs-params">(<span class="hljs-type">float</span> NdotH, <span class="hljs-type">float</span> roughness)</span> </span>&#123;<br>    <span class="hljs-type">float</span> a = roughness*roughness;<br>    <span class="hljs-type">float</span> a2 = a*a;<br>    <span class="hljs-type">float</span> NdotH2 = NdotH*NdotH;<br><br>    <span class="hljs-type">float</span> nom   = a2;<br>    <span class="hljs-type">float</span> denom = (NdotH2 * (a2 - <span class="hljs-number">1.f</span>) + <span class="hljs-number">1.f</span>);<br>    denom = PI * denom * denom;<br><br>    <span class="hljs-keyword">return</span> nom / denom;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">GeometrySchlickGGX</span><span class="hljs-params">(<span class="hljs-type">float</span> cosTerm, <span class="hljs-type">float</span> roughness)</span> </span>&#123;<br>    <span class="hljs-type">float</span> a = roughness;<br>    <span class="hljs-type">float</span> k = (a * a) / <span class="hljs-number">2.f</span>;<br><br>    <span class="hljs-type">float</span> nom = cosTerm;<br>    <span class="hljs-type">float</span> denom = cosTerm * (<span class="hljs-number">1.f</span> - k) + k;<br><br>    <span class="hljs-keyword">return</span> nom / denom;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">GeometrySmith</span><span class="hljs-params">(<span class="hljs-type">float</span> roughness, <span class="hljs-type">float</span> NdotV, <span class="hljs-type">float</span> NdotL)</span> </span>&#123;<br>    <span class="hljs-type">float</span> ggx2 = <span class="hljs-built_in">GeometrySchlickGGX</span>(NdotV, roughness);<br>    <span class="hljs-type">float</span> ggx1 = <span class="hljs-built_in">GeometrySchlickGGX</span>(NdotL, roughness);<br><br>    <span class="hljs-keyword">return</span> ggx1 * ggx2;<br>&#125;<br><br><span class="hljs-function">Vec3f <span class="hljs-title">IntegrateBRDF</span><span class="hljs-params">(<span class="hljs-type">float</span> roughness, <span class="hljs-type">float</span> NdotV)</span> </span>&#123;<br>    <span class="hljs-type">float</span> A = <span class="hljs-number">0.f</span>, B = <span class="hljs-number">0.f</span>, C = <span class="hljs-number">0.f</span>;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> sample_count = <span class="hljs-number">1024</span>;<br><br>    Vec3f N = <span class="hljs-built_in">Vec3f</span>(<span class="hljs-number">0.f</span>, <span class="hljs-number">0.f</span>, <span class="hljs-number">1.f</span>);<br>    Vec3f V = <span class="hljs-built_in">Vec3f</span>(std::<span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1.f</span> - NdotV * NdotV), <span class="hljs-number">0.f</span>, NdotV);<br>    <br>    samplePoints sampleList = <span class="hljs-built_in">squareToCosineHemisphere</span>(sample_count);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; sample_count; i++) &#123;<br>        Vec3f L = <span class="hljs-built_in">normalize</span>(sampleList.directions[i]);<br>        Vec3f H = <span class="hljs-built_in">normalize</span>(V + L);<br><br>        <span class="hljs-type">float</span> HdotV = std::<span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(H, V), <span class="hljs-number">0.f</span>);<br>        <span class="hljs-type">float</span> NdotL = std::<span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(N, L), <span class="hljs-number">0.f</span>);<br>        <span class="hljs-type">float</span> NdotH = std::<span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(N, H), <span class="hljs-number">0.f</span>);<br><br>        <span class="hljs-type">float</span> R0 = <span class="hljs-number">1.f</span>;<br>        <span class="hljs-type">float</span> F = <span class="hljs-built_in">FresnelSchlick</span>(HdotV, R0);<br>        <span class="hljs-type">float</span> G = <span class="hljs-built_in">GeometrySmith</span>(roughness, NdotV, NdotL);<br>        <span class="hljs-type">float</span> D = <span class="hljs-built_in">DistributionGGX</span>(NdotH, roughness);<br><br>        <span class="hljs-type">float</span> numerator = F * G * D;<br>        <span class="hljs-type">float</span> denominator = <span class="hljs-number">4.f</span> * NdotV * NdotL;<br>        <span class="hljs-type">float</span> micro = numerator / std::<span class="hljs-built_in">max</span>(denominator, <span class="hljs-number">1e-10f</span>);<br><br>        <span class="hljs-type">float</span> pdf = sampleList.PDFs[i];<br>        A += micro * NdotL / pdf;<br>    &#125;<br>    C = B = A;<br><br>    <span class="hljs-keyword">return</span> &#123;A / sample_count, B / sample_count, C / sample_count&#125;;<br>&#125;<br><br><span class="hljs-type">uint8_t</span> data[resolution * resolution * <span class="hljs-number">3</span>];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">float</span> step = <span class="hljs-number">1.f</span> / resolution;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; resolution; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; resolution; j++) &#123;<br>            <span class="hljs-type">float</span> roughness = step * (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">float</span>&gt;(i) + <span class="hljs-number">0.5f</span>);<br>            <span class="hljs-type">float</span> NdotV = step * (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">float</span>&gt;(j) + <span class="hljs-number">0.5f</span>);<br><br>            Vec3f irr = <span class="hljs-built_in">IntegrateBRDF</span>(roughness, NdotV);<br><br>            data[(i * resolution + j) * <span class="hljs-number">3</span> + <span class="hljs-number">0</span>] = <span class="hljs-built_in">uint8_t</span>(irr.x * <span class="hljs-number">255.0</span>);<br>            data[(i * resolution + j) * <span class="hljs-number">3</span> + <span class="hljs-number">1</span>] = <span class="hljs-built_in">uint8_t</span>(irr.y * <span class="hljs-number">255.0</span>);<br>            data[(i * resolution + j) * <span class="hljs-number">3</span> + <span class="hljs-number">2</span>] = <span class="hljs-built_in">uint8_t</span>(irr.z * <span class="hljs-number">255.0</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">stbi_flip_vertically_on_write</span>(<span class="hljs-literal">true</span>);<br>    <span class="hljs-built_in">stbi_write_png</span>(<span class="hljs-string">&quot;GGX_E_MC_LUT.png&quot;</span>, resolution, resolution, <span class="hljs-number">3</span>, data, resolution * <span class="hljs-number">3</span>);<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Finished precomputed!&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç»“æœ-3"><a href="#ç»“æœ-3" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p><img src="/img/GAMES202/GGX_E_LUT.png" alt="GGX_E_LUT å…¶ä¸­çºµè½´ä¸ºç²—ç³™åº¦ï¼Œæ¨ªè½´ä¸ºè§‚å¯Ÿè§’åº¦"></p><p><strong>éšæœºé‡‡æ ·çš„é—®é¢˜</strong>ï¼šç²—ç³™åº¦ä»ä¸‹å‘ä¸Šå¢åŠ ï¼Œå¯ä»¥çœ‹åˆ°ç²—ç³™åº¦è¾ƒä½æ—¶ç»“æœæœ‰å¾ˆå¤šå™ªå£°ï¼Œè¿™æ˜¯å› ä¸ºä½ç²—ç³™åº¦çš„å¾®è¡¨é¢æè´¨æ¥è¿‘é•œé¢åå°„æè´¨ï¼Œè¯¥ç‚¹æ¥æ”¶åˆ°çš„å…‰çº¿åªä¼šè¢«åå°„å‘ä¸€ä¸ªå¾ˆå°çš„ç«‹ä½“è§’ã€‚è€Œå‡åŒ€éšæœºé‡‡æ ·çš„è’™ç‰¹å¡æ´›ç§¯åˆ†å¾ˆéš¾å¤„ç†è¿™ç§é«˜é¢‘ä¿¡æ¯ï¼Œå› æ­¤ç§¯åˆ†å€¼çš„æ–¹å·®å°±ä¼šå¾ˆå¤§ã€‚<br><strong>è§£å†³æ–¹æ³•</strong>ï¼šé‡è¦æ€§é‡‡æ ·ã€‚</p><h3 id="GGX-E-IS"><a href="#GGX-E-IS" class="headerlink" title="GGX_E_IS"></a>GGX_E_IS</h3><p>å¯¹äºç»™å®šå‡ºå°„æ–¹å‘ o çš„æƒ…å†µï¼Œç›®çš„æ˜¯é‡è¦æ€§é‡‡æ ·ç”Ÿæˆå…¥å°„æ–¹å‘ iï¼Œé‚£ä¹ˆæœ‰ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜éœ€è¦è§£å†³ï¼šå¦‚ä½•é‡‡æ ·å’Œå¯¹åº”çš„æ¦‚ç‡ pdf æ˜¯ä»€ä¹ˆã€‚</p><h4 id="é‡‡æ ·"><a href="#é‡‡æ ·" class="headerlink" title="é‡‡æ ·"></a>é‡‡æ ·</h4><p>æˆ‘ä»¬é¦–å…ˆæ ¹æ®é€‰ç”¨çš„ NDF æ¨¡å‹ï¼Œé‡è¦æ€§é‡‡æ ·å¾®è¡¨é¢æ³•å‘ mï¼ˆä¹Ÿå°±æ˜¯ i, o çš„åŠç¨‹å‘é‡ hï¼‰ï¼Œéšååˆ©ç”¨åå°„å…³ç³»æ¥è®¡ç®—å…¥å°„æ–¹å‘ iã€‚</p><ul><li>$i&#x3D;2(m\cdot o)m-o$</li></ul><p>åŒæ—¶å¯¹äºä»»æ„ NDF ä¸‹ï¼Œé‡‡æ · m å¯¹åº”çš„æ¦‚ç‡å¯†åº¦ $pdf_m(m)$ï¼Œæœ‰</p><ul><li>$pdf_m(m)&#x3D;D(m)(m\cdot n)$</li></ul><p>GGX NDF å¯¹åº”çš„é‡‡æ ·ç‚¹åº”è¯¥ä¸º</p><ul><li>$\theta &#x3D;\arctan (\frac{\alpha \sqrt{\xi_ 1}}{\sqrt{1-\xi _1}})$</li><li>$\phi &#x3D;2\pi \xi _2$</li></ul><p>å…¶ä¸­ $\xi _1$ ä¸ $\xi _2$ ç”± Hammersley é‡‡æ ·å¾—åˆ°ã€‚</p><h4 id="pdf"><a href="#pdf" class="headerlink" title="pdf"></a>pdf</h4><p>å› ä¸ºæœ€åç”Ÿæˆçš„é‡‡æ ·æ–¹å‘æ˜¯å…¥å°„æ–¹å‘ i, æ‰€ä»¥æœ€åç»“æœçš„æƒé‡åº”è¯¥æ˜¯ï¼š</p><ul><li>$weight(i)&#x3D;\frac{f_r(i,o,h)(i,n)}{pdf_i(i)}$</li></ul><p>å°†ä¹‹å‰é‡‡æ ·å¾®è¡¨é¢æ³•çº¿çš„æ¦‚ç‡å¯†åº¦ $pdf_m(m)$ è½¬æ¢æˆé‡‡æ ·å…¥å°„çš„æ¦‚ç‡å¯†åº¦ $pdf_i(i)$ï¼Œä¸¤è€…ä¹‹é—´çš„è½¬æ¢åªéœ€è¦ä¹˜ä¸Šä¸€ä¸ª Jacobian é¡¹ï¼š</p><ul><li>$pdf_i(i)&#x3D;pdf_m(m)|\frac{\partial \omega _m}{\partial \omega _i}|$</li></ul><p>å¯¹äºåå°„æœ‰ï¼š</p><ul><li>$|\frac{\partial \omega _m}{\partial \omega _i}|&#x3D;\frac{1}{4(i\cdot m)}$</li></ul><p>æ‰€ä»¥ï¼š</p><ul><li>$weight(i)&#x3D;\frac{(o\cdot m)G(i,o,h)}{(o\cdot n)(m\cdot n)}$</li></ul><h4 id="é¢„è®¡ç®—å®ç°-1"><a href="#é¢„è®¡ç®—å®ç°-1" class="headerlink" title="é¢„è®¡ç®—å®ç°"></a>é¢„è®¡ç®—å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// çœç•¥ä¸€äº›é‡å¤çš„ä»£ç </span><br><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">FresnelSchlick</span><span class="hljs-params">(<span class="hljs-type">float</span> HdotV, <span class="hljs-type">float</span> R0)</span></span>;<br><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">GeometrySchlickGGX</span><span class="hljs-params">(<span class="hljs-type">float</span> cosTerm, <span class="hljs-type">float</span> roughness)</span></span>;<br><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">GeometrySmith</span><span class="hljs-params">(<span class="hljs-type">float</span> roughness, <span class="hljs-type">float</span> NoV, <span class="hljs-type">float</span> NoL)</span></span>;<br><br><span class="hljs-comment">// çƒé¢ä¸Šçš„å‡åŒ€åˆ†å¸ƒ</span><br><span class="hljs-function">Vec2f <span class="hljs-title">Hammersley</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> i, <span class="hljs-type">uint32_t</span> N)</span> </span>&#123; <span class="hljs-comment">// 0-1</span><br>    <span class="hljs-type">uint32_t</span> bits = (i &lt;&lt; <span class="hljs-number">16u</span>) | (i &gt;&gt; <span class="hljs-number">16u</span>);<br>    bits = ((bits &amp; <span class="hljs-number">0x55555555u</span>) &lt;&lt; <span class="hljs-number">1u</span>) | ((bits &amp; <span class="hljs-number">0xAAAAAAAAu</span>) &gt;&gt; <span class="hljs-number">1u</span>);<br>    bits = ((bits &amp; <span class="hljs-number">0x33333333u</span>) &lt;&lt; <span class="hljs-number">2u</span>) | ((bits &amp; <span class="hljs-number">0xCCCCCCCCu</span>) &gt;&gt; <span class="hljs-number">2u</span>);<br>    bits = ((bits &amp; <span class="hljs-number">0x0F0F0F0Fu</span>) &lt;&lt; <span class="hljs-number">4u</span>) | ((bits &amp; <span class="hljs-number">0xF0F0F0F0u</span>) &gt;&gt; <span class="hljs-number">4u</span>);<br>    bits = ((bits &amp; <span class="hljs-number">0x00FF00FFu</span>) &lt;&lt; <span class="hljs-number">8u</span>) | ((bits &amp; <span class="hljs-number">0xFF00FF00u</span>) &gt;&gt; <span class="hljs-number">8u</span>);<br>    <span class="hljs-type">float</span> rdi = <span class="hljs-built_in">float</span>(bits) * <span class="hljs-number">2.3283064365386963e-10</span>;<br><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-built_in">float</span>(i) / <span class="hljs-built_in">float</span>(N), rdi&#125;;<br>&#125;<br><br><span class="hljs-comment">// é‡è¦æ€§é‡‡æ ·æ³•çº¿æ–¹å‘ï¼Œå³ H</span><br><span class="hljs-function">Vec3f <span class="hljs-title">ImportanceSampleGGX</span><span class="hljs-params">(Vec2f Xi, Vec3f N, <span class="hljs-type">float</span> roughness)</span> </span>&#123;<br>    <span class="hljs-type">float</span> a = roughness * roughness;<br><br>    <span class="hljs-comment">// å®šä¹‰çƒé¢åæ ‡ç³»</span><br>    <span class="hljs-type">float</span> sinTheta = a * <span class="hljs-built_in">sqrt</span>(Xi.x);<br>    <span class="hljs-type">float</span> cosTheta = <span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1.f</span> - Xi.x);<br>    <span class="hljs-type">float</span> phi = <span class="hljs-number">2</span> * PI * Xi.y;<br><br>    <span class="hljs-comment">// çƒé¢åæ ‡ç³»è½¬æ¢ä¸ºç¬›å¡å°”åæ ‡ç³»ï¼Œå•ä½çƒä¸ŠåŠå¾„ä¸º 1</span><br>    <span class="hljs-type">float</span> carX = sinTheta * <span class="hljs-built_in">cos</span>(phi);<br>    <span class="hljs-type">float</span> carY = sinTheta * <span class="hljs-built_in">sin</span>(phi);<br>    <span class="hljs-type">float</span> carZ = cosTheta;<br><br>    Vec3f result = <span class="hljs-built_in">Vec3f</span>(carX, carY, carZ);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">normalize</span>(result);<br>&#125;<br><br><span class="hljs-function">Vec3f <span class="hljs-title">IntegrateBRDF</span><span class="hljs-params">(<span class="hljs-type">float</span> roughness, <span class="hljs-type">float</span> NoV)</span> </span>&#123;<br>    <span class="hljs-type">float</span> A = <span class="hljs-number">0.f</span>, B = <span class="hljs-number">0.f</span>, C = <span class="hljs-number">0.f</span>;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> sample_count = <span class="hljs-number">1024</span>;<br><br>    Vec3f N = <span class="hljs-built_in">Vec3f</span>(<span class="hljs-number">0.f</span>, <span class="hljs-number">0.f</span>, <span class="hljs-number">1.f</span>);<br>    Vec3f V = <span class="hljs-built_in">Vec3f</span>(std::<span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1.f</span> - NoV * NoV), <span class="hljs-number">0.f</span>, NoV);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; sample_count; i++) &#123;<br>        Vec2f Xi = <span class="hljs-built_in">Hammersley</span>(i, sample_count);<br>        Vec3f H = <span class="hljs-built_in">ImportanceSampleGGX</span>(Xi, N, roughness);<br>        Vec3f L = <span class="hljs-built_in">normalize</span>(H * <span class="hljs-number">2.f</span> * <span class="hljs-built_in">dot</span>(H, V) - V);<br><br>        <span class="hljs-type">float</span> NoL = std::<span class="hljs-built_in">max</span>(L.z, <span class="hljs-number">0.f</span>);<br>        <span class="hljs-type">float</span> NoH = std::<span class="hljs-built_in">max</span>(H.z, <span class="hljs-number">0.f</span>);<br>        <span class="hljs-type">float</span> VoH = std::<span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(V, H), <span class="hljs-number">0.f</span>);<br>        <br>        <span class="hljs-type">float</span> R0 = <span class="hljs-number">1.f</span>;<br>        <span class="hljs-type">float</span> F = <span class="hljs-built_in">FresnelSchlick</span>(VoH, R0);<br>        <span class="hljs-type">float</span> G = <span class="hljs-built_in">GeometrySmith</span>(roughness, NoV, NoL);<br><br>        A += F * G * VoH / (NoV * NoH);<br>    &#125;<br>    C = B = A;<br><br>    <span class="hljs-keyword">return</span> &#123;A / sample_count, B / sample_count, C / sample_count&#125;;<br>&#125;<br><br><span class="hljs-type">uint8_t</span> data[resolution * resolution * <span class="hljs-number">3</span>];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">float</span> step = <span class="hljs-number">1.f</span> / resolution;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; resolution; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; resolution; j++) &#123;<br>            <span class="hljs-type">float</span> roughness = step * (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">float</span>&gt;(i) + <span class="hljs-number">0.5f</span>);<br>            <span class="hljs-type">float</span> NdotV = step * (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">float</span>&gt;(j) + <span class="hljs-number">0.5f</span>);<br><br>            Vec3f irr = <span class="hljs-built_in">IntegrateBRDF</span>(roughness, NdotV);<br>            <span class="hljs-comment">//Vec3f irr = Vec3f(1.f) - IntegrateBRDF(roughness, NdotV);</span><br><br>            data[(i * resolution + j) * <span class="hljs-number">3</span> + <span class="hljs-number">0</span>] = <span class="hljs-built_in">uint8_t</span>(irr.x * <span class="hljs-number">255.0</span>);<br>            data[(i * resolution + j) * <span class="hljs-number">3</span> + <span class="hljs-number">1</span>] = <span class="hljs-built_in">uint8_t</span>(irr.y * <span class="hljs-number">255.0</span>);<br>            data[(i * resolution + j) * <span class="hljs-number">3</span> + <span class="hljs-number">2</span>] = <span class="hljs-built_in">uint8_t</span>(irr.z * <span class="hljs-number">255.0</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">stbi_flip_vertically_on_write</span>(<span class="hljs-literal">true</span>);<br>    <span class="hljs-built_in">stbi_write_png</span>(<span class="hljs-string">&quot;GGX_E_LUT_IS.png&quot;</span>, resolution, resolution, <span class="hljs-number">3</span>, data, resolution * <span class="hljs-number">3</span>);<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Finished precomputed!&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç»“æœ-4"><a href="#ç»“æœ-4" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p>æ—¢ç„¶å·²ç»å¾—åˆ°äº†ä¸€ç€è‰²ç‚¹åœ¨å„ç§æ¡ä»¶ä¸‹çš„å‡ºå°„èƒ½é‡ Eï¼ˆå·¦å›¾ï¼‰ï¼Œé‚£ä¹ˆéœ€è¦è¡¥å¿çš„èƒ½é‡ä¾¿æ˜¯ (1 - E)ï¼ˆå³å›¾ï¼‰ã€‚</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES202/GGX_E_LUT_IS.png" alt="GGX_E_LUT_IS"></div><div class="group-image-wrap"><img src="/img/GAMES202/GGX_E_LUT_IS_ANTI.png" alt="GGX_E_LUT_IS_ANTI"></div></div></div><h3 id="GGX-Eavg"><a href="#GGX-Eavg" class="headerlink" title="GGX_Eavg"></a>GGX_Eavg</h3><p>ä¸Šé¢è¯´åˆ°æˆ‘ä»¬å¸Œæœ›èƒ½å¾—åˆ°ä¸€ä¸ª BRDFï¼Œå¹¶ä¸”è¯¥å…¬å¼åœ¨åŠçƒä¸Šçš„ç§¯åˆ†å€¼ä¸º (1 - E)ï¼Œå³ï¼š</p><ul><li>$\int f_{ms}(\mu _o,\mu _i)&#x3D;\int \frac{(1-E(\mu _o))(1-E(\mu <em>i))}{\pi (1-E</em>{avg})}&#x3D;1-E(\mu _o)$</li></ul><p>å…¶ä¸­ï¼š</p><ul><li>$E_{avg}(\mu _o)&#x3D;2\int _o^1E(\mu _i)\mu _id\mu _i$</li></ul><p>æ¨å¯¼ï¼š</p><ul><li>$E_{ms}(\mu _o)&#x3D;\int _0^{2\pi}\int <em>0^1f</em>{ms}(\mu _o,\mu _1,\phi)$</li><li>&emsp;&emsp;&emsp;&emsp;&nbsp;$&#x3D;2\pi \int _0^1\frac{(1-E(\mu _o))(1-E(\mu <em>i))}{\pi (1-E</em>{avg})}\mu _id\mu _i$</li><li>&emsp;&emsp;&emsp;&emsp;&nbsp;$&#x3D;2\frac{1-E(\mu <em>o)}{1-E</em>{avg}}\int _0^1(1-E(\mu _i))\mu _id\mu _i$</li><li>&emsp;&emsp;&emsp;&emsp;&nbsp;$&#x3D;\frac{1-E(\mu <em>o)}{1-E</em>{avg}}(1-E_{avg})$</li><li>&emsp;&emsp;&emsp;&emsp;&nbsp;$&#x3D;(1-E_{avg})$</li></ul><p>ä¹Ÿå°±æ˜¯è¯´åªè¦å†ç»™$E_{avg}$æ‰“ä¸€å¼ è¡¨ï¼Œå°±å¯ä»¥å®æ—¶åœ°æŸ¥è¯¢é¢„è®¡ç®—çš„ä¿¡æ¯å¾—åˆ°$f_{ms}$äº†ã€‚</p><h4 id="ç»“æœ-5"><a href="#ç»“æœ-5" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p>ä½¿ç”¨é‡è¦æ€§é‡‡æ ·ï¼ˆå·¦å›¾ï¼‰ï¼Œä½¿ç”¨å‡åŒ€é‡‡æ ·ï¼ˆå³å›¾ï¼‰</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES202/GGX_Eavg_LUT_IS.png" alt="GGX_Eavg_LUT_IS"></div><div class="group-image-wrap"><img src="/img/GAMES202/GGX_Eavg_LUT.png" alt="GGX_Eavg_LUT"></div></div></div><p>è¿™æ˜¯ä¸€å¼ ä¸€ç»´çš„è¡¨ï¼Œçºµè½´ä¸ºç²—ç³™åº¦ä»ä¸‹å‘ä¸Šå¢åŠ ï¼Œè€ŒåŒä¸€è¡Œä¸Šçš„å­˜å‚¨å€¼æ˜¯ç›¸åŒçš„ã€‚</p><h2 id="Real-Time-éƒ¨åˆ†-1"><a href="#Real-Time-éƒ¨åˆ†-1" class="headerlink" title="Real Time éƒ¨åˆ†"></a>Real Time éƒ¨åˆ†</h2><h3 id="é¢œè‰²"><a href="#é¢œè‰²" class="headerlink" title="é¢œè‰²"></a>é¢œè‰²</h3><p>å½“æè´¨æ‹¥æœ‰é¢œè‰²æ—¶ï¼Œé¢œè‰²çš„æ€§è´¨ä¼šè‡ªç„¶åœ°ã€æ­£ç¡®åœ°å¸¦æ¥èƒ½é‡çš„æŸå¤±ã€‚é‚£ä¹ˆåœ¨å®ç°æ— è‰²çš„ $f_{ms}$ çš„åŸºç¡€ä¸Šï¼Œå°†ä¸€è€ƒè™‘é¢œè‰²å¸¦æ¥çš„èƒ½é‡æŸå¤±çš„é¢œè‰²é¡¹ $f_{add}$ï¼ˆä¸‰é€šé“ï¼‰ä¸$f_{ms}$ ç›¸ä¹˜ä¾¿èƒ½å¾—åˆ°æœ€ç»ˆéœ€è¦è¡¥å……çš„ BRDFã€‚<br>å…ˆå¼•å…¥ä¸€ä¸ªæ¦‚å¿µï¼šå¹³å‡è²æ¶…å°”é¡¹ $F_{avg}$ï¼ˆä¸‰é€šé“ï¼‰<br><a href="https://blog.selfshadow.com/publications/s2017-shading-course/imageworks/s2017_pbs_imageworks_slides_v2.pdf">Favg çš„å®ç°</a><br>é‚£ä¹ˆä¸€æ¬¡åå°„åå‡ºå°„çš„èƒ½é‡ä¸ºï¼š$F_{avg}E_{avg}$<br>ä¸¤æ¬¡åå°„åå‡ºå°„çš„èƒ½é‡ä¸ºï¼š$F_{avg}(1-E_{avg})F_{avg}E_{avg}$<br>K æ¬¡åå°„åå‡ºå°„çš„èƒ½é‡ä¸ºï¼š$F_{avg}^k(1-E_{avg})^kF_{avg}E_{avg}$<br>ä¸Šè¿°èƒ½é‡å…¨éƒ¨å åŠ å³å¯å¾—åˆ°é¢œè‰²é¡¹ï¼š</p><ul><li>$f_{add}&#x3D;\frac{F_{avg}E_{avg}}{1-F_{avg}(1-E_{avg})}$</li></ul><h3 id="æœ€ç»ˆçš„-BRDF"><a href="#æœ€ç»ˆçš„-BRDF" class="headerlink" title="æœ€ç»ˆçš„ BRDF"></a>æœ€ç»ˆçš„ BRDF</h3><p>ä¹‹å‰æˆ‘ä»¬å¾—åˆ°äº†è¡¥å¿çš„ BRDF é¡¹ï¼š</p><ul><li>$f_{ms}(\mu _o,\mu _i)&#x3D;\frac{(1-E(\mu _o))(1-E(\mu <em>i))}{\pi (1-E</em>{avg})}$</li></ul><p>æœ€ç»ˆçš„ BRDF ä¾¿æ˜¯ï¼š</p><ul><li>$f_r&#x3D;f_{micro}+f_{add}f_{ms}$</li></ul><h3 id="KullaContyFragmentShader"><a href="#KullaContyFragmentShader" class="headerlink" title="KullaContyFragmentShader"></a>KullaContyFragmentShader</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#ifdef GL_ES</span><br><span class="hljs-keyword">precision</span> <span class="hljs-keyword">mediump</span> <span class="hljs-type">float</span>;<br><span class="hljs-meta">#endif</span><br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> uLightPos;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> uCameraPos;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> uLightRadiance;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> uLightDir;<br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> uAlbedoMap;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> uMetallic;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> uRoughness;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> uBRDFLut;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> uEavgLut;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">samplerCube</span> uCubeTexture;<br><br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec2</span> vTextureCoord;<br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec3</span> vFragPos;<br><span class="hljs-keyword">varying</span> <span class="hljs-keyword">highp</span> <span class="hljs-type">vec3</span> vNormal;<br><br><span class="hljs-keyword">const</span> <span class="hljs-type">float</span> PI = <span class="hljs-number">3.14159265359</span>;<br><br><span class="hljs-type">float</span> DistributionGGX(<span class="hljs-type">vec3</span> N, <span class="hljs-type">vec3</span> H, <span class="hljs-type">float</span> roughness) &#123;<br>    <span class="hljs-type">float</span> a = roughness * roughness;<br>    <span class="hljs-type">float</span> a2 = a * a;<br>    <span class="hljs-type">float</span> NdotH = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(N, H), <span class="hljs-number">0.0</span>);<br>    <span class="hljs-type">float</span> NdotH2 = NdotH * NdotH;<br><br>    <span class="hljs-type">float</span> nom = a2;<br>    <span class="hljs-type">float</span> denom = (NdotH2 * (a2 - <span class="hljs-number">1.0</span>) + <span class="hljs-number">1.0</span>);<br>    denom = PI * denom * denom;<br><br>    <span class="hljs-keyword">return</span> nom / denom;<br>&#125;<br><br><span class="hljs-type">float</span> GeometrySchlickGGX(<span class="hljs-type">float</span> cosTerm, <span class="hljs-type">float</span> roughness) &#123;<br>    <span class="hljs-type">float</span> a = roughness;<br>    <span class="hljs-type">float</span> k = (a * a) / <span class="hljs-number">2.0</span>;<br><br>    <span class="hljs-type">float</span> nom = cosTerm;<br>    <span class="hljs-type">float</span> denom = cosTerm * (<span class="hljs-number">1.0</span> - k) + k;<br><br>    <span class="hljs-keyword">return</span> nom / denom;<br>&#125;<br><br><span class="hljs-type">float</span> GeometrySmith(<span class="hljs-type">vec3</span> N, <span class="hljs-type">vec3</span> V, <span class="hljs-type">vec3</span> L, <span class="hljs-type">float</span> roughness) &#123;<br>    <span class="hljs-type">float</span> NdotL = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(N,L), <span class="hljs-number">0.0</span>);<br>    <span class="hljs-type">float</span> NdotV = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(N,V), <span class="hljs-number">0.0</span>);<br><br>    <span class="hljs-type">float</span> ggx2 = GeometrySchlickGGX(NdotV, roughness);<br>    <span class="hljs-type">float</span> ggx1 = GeometrySchlickGGX(NdotL, roughness);<br><br>    <span class="hljs-keyword">return</span> ggx1 * ggx2;<br>&#125;<br><br><span class="hljs-type">vec3</span> fresnelSchlick(<span class="hljs-type">vec3</span> F0, <span class="hljs-type">vec3</span> V, <span class="hljs-type">vec3</span> H) &#123;<br>    <span class="hljs-type">float</span> HdotV = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(H, V), <span class="hljs-number">0.0</span>);<br><br>    <span class="hljs-keyword">return</span> F0 + (<span class="hljs-number">1.0</span> - F0) * <span class="hljs-built_in">pow</span>(<span class="hljs-number">1.0</span> - HdotV, <span class="hljs-number">5.0</span>);<br>&#125;<br><br><br><span class="hljs-comment">/* https://blog.selfshadow.com/publications/s2017-shading-course/imageworks/</span><br><span class="hljs-comment">   s2017_pbs_imageworks_slides_v2.pdf */</span><br><span class="hljs-type">vec3</span> AverageFresnel(<span class="hljs-type">vec3</span> r, <span class="hljs-type">vec3</span> g) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">vec3</span>(<span class="hljs-number">0.087237</span>) + <span class="hljs-number">0.0230685</span>*g - <span class="hljs-number">0.0864902</span>*g*g + <span class="hljs-number">0.0774594</span>*g*g*g<br>           + <span class="hljs-number">0.782654</span>*r - <span class="hljs-number">0.136432</span>*r*r + <span class="hljs-number">0.278708</span>*r*r*r<br>           + <span class="hljs-number">0.19744</span>*g*r + <span class="hljs-number">0.0360605</span>*g*g*r - <span class="hljs-number">0.2586</span>*g*r*r;<br>&#125;<br><br><span class="hljs-type">vec3</span> MultiScatterBRDF(<span class="hljs-type">float</span> NdotL, <span class="hljs-type">float</span> NdotV) &#123;<br>  <span class="hljs-type">vec3</span> albedo = <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">texture2D</span>(uAlbedoMap, vTextureCoord).rgb, <span class="hljs-type">vec3</span>(<span class="hljs-number">2.2</span>));<br><br>  <span class="hljs-type">vec3</span> E_o = <span class="hljs-built_in">texture2D</span>(uBRDFLut, <span class="hljs-type">vec2</span>(NdotL, uRoughness)).xyz;<br>  <span class="hljs-type">vec3</span> E_i = <span class="hljs-built_in">texture2D</span>(uBRDFLut, <span class="hljs-type">vec2</span>(NdotV, uRoughness)).xyz;<br><br>  <span class="hljs-type">vec3</span> E_avg = <span class="hljs-built_in">texture2D</span>(uEavgLut, <span class="hljs-type">vec2</span>(<span class="hljs-number">0</span>, uRoughness)).xyz;<br>  <span class="hljs-comment">// copper</span><br>  <span class="hljs-type">vec3</span> edgetint = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.827</span>, <span class="hljs-number">0.792</span>, <span class="hljs-number">0.678</span>);<br>  <span class="hljs-type">vec3</span> F_avg = AverageFresnel(albedo, edgetint);<br>  <br>  <span class="hljs-type">vec3</span> fms = (<span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>) - E_o) * (<span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>) - E_i) / (PI * (<span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>) - E_avg));<br>  <span class="hljs-type">vec3</span> F_add = F_avg * E_avg / (<span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>) - F_avg * (<span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>) - E_avg));<br><br>  <span class="hljs-keyword">return</span> F_add*fms;<br>&#125;<br><br><span class="hljs-type">void</span> main(<span class="hljs-type">void</span>) &#123;<br>  <span class="hljs-type">vec3</span> albedo = <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">texture2D</span>(uAlbedoMap, vTextureCoord).rgb, <span class="hljs-type">vec3</span>(<span class="hljs-number">2.2</span>));<br><br>  <span class="hljs-type">vec3</span> N = <span class="hljs-built_in">normalize</span>(vNormal);<br>  <span class="hljs-type">vec3</span> V = <span class="hljs-built_in">normalize</span>(uCameraPos - vFragPos);<br>  <span class="hljs-type">float</span> NdotV = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(N, V), <span class="hljs-number">0.0</span>);<br><br>  <span class="hljs-type">vec3</span> F0 = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.04</span>); <br>  F0 = <span class="hljs-built_in">mix</span>(F0, albedo, uMetallic);<br><br>  <span class="hljs-type">vec3</span> Lo = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>);<br><br>  <span class="hljs-comment">// calculate per-light radiance</span><br>  <span class="hljs-type">vec3</span> L = <span class="hljs-built_in">normalize</span>(uLightDir);<br>  <span class="hljs-type">vec3</span> H = <span class="hljs-built_in">normalize</span>(V + L);<br>  <span class="hljs-type">float</span> <span class="hljs-built_in">distance</span> = <span class="hljs-built_in">length</span>(uLightPos - vFragPos);<br>  <span class="hljs-type">float</span> attenuation = <span class="hljs-number">1.0</span> / (<span class="hljs-built_in">distance</span> * <span class="hljs-built_in">distance</span>);<br>  <span class="hljs-type">vec3</span> radiance = uLightRadiance;<br><br>  <span class="hljs-type">float</span> NDF = DistributionGGX(N, H, uRoughness);   <br>  <span class="hljs-type">float</span> G   = GeometrySmith(N, V, L, uRoughness);<br>  <span class="hljs-type">vec3</span> F = fresnelSchlick(F0, V, H);<br>      <br>  <span class="hljs-type">vec3</span> numerator    = NDF * G * F; <br>  <span class="hljs-type">float</span> denominator = <span class="hljs-number">4.0</span> * <span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(N, V), <span class="hljs-number">0.0</span>) * <span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(N, L), <span class="hljs-number">0.0</span>);<br>  <span class="hljs-type">vec3</span> Fmicro = numerator / <span class="hljs-built_in">max</span>(denominator, <span class="hljs-number">0.001</span>); <br>  <br>  <span class="hljs-type">float</span> NdotL = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(N, L), <span class="hljs-number">0.0</span>);        <br><br>  <span class="hljs-type">vec3</span> Fms = MultiScatterBRDF(NdotL, NdotV);<br>  <span class="hljs-type">vec3</span> BRDF = Fmicro + Fms;<br>  <br>  Lo += BRDF * radiance * NdotL;<br>  <span class="hljs-type">vec3</span> color = Lo;<br>  <br>  color = color / (color + <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>));<br>  color = <span class="hljs-built_in">pow</span>(color, <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>/<span class="hljs-number">2.2</span>)); <br>  <br>  <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»“æœ-6"><a href="#ç»“æœ-6" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p><img src="/img/GAMES202/01.png"><br>ç²—ç³™åº¦ä»å³è‡³å·¦ä¾æ¬¡å¢åŠ ï¼Œä¸Šæ’æ˜¯æ­£ç¡®å®ç°äº† Kulla-Conty è¿‘ä¼¼çš„ç»“æœï¼Œä¸‹æ’æ˜¯å¾®è¡¨é¢æ¨¡å‹ä¸ä½¿ç”¨ Kulla-Conty è¿‘ä¼¼æ—¶é€ æˆçš„èƒ½é‡æŸå¤±ã€‚</p><h1 id="å®æ—¶å…‰çº¿è¿½è¸ª"><a href="#å®æ—¶å…‰çº¿è¿½è¸ª" class="headerlink" title="å®æ—¶å…‰çº¿è¿½è¸ª"></a>å®æ—¶å…‰çº¿è¿½è¸ª</h1><p>&emsp;&emsp;å¦‚æœè®¤ä¸ºï¼Œä»¥è·¯å¾„è¿½è¸ªçš„æ–¹å¼ï¼Œè®¡ç®—ä¸€æ¬¡<strong>ä¸€ç€è‰²ç‚¹çš„ç›´æ¥å…‰ç…§å’Œä¸€æ¬¡å¼¹å°„çš„é—´æ¥å…‰ç…§</strong>ä¸º 1 sample per pixel (1 SPP)ã€‚é‚£ä¹ˆå¯¹äºä¸€å¸§ï¼Œå³ä½¿æ˜¯ RTX ç³»åˆ—çš„ GPU ä¹Ÿåªèƒ½åšåˆ° 1 SPPï¼Œæ­¤æ—¶çš„å™ªå£°ä¼šéå¸¸å¤¸å¼ ã€‚ä½†æ˜¯è·¯å¾„è¿½è¸ªä¾æ—§ä¸ºæˆ‘ä»¬æä¾›äº†éå¸¸å®è´µçš„é—´æ¥å…‰ç…§ä¿¡æ¯ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å·¥ä½œçš„é‡å¿ƒå°±åœ¨å¦‚ä½•é™å™ªä¸Šäº†ã€‚é™å™ªåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œå•å¸§é™å™ªä¸åƒç´ åœ¨æ—¶é—´ä¸Šçš„å¤ç”¨ã€‚</p><h2 id="å•å¸§é™å™ª"><a href="#å•å¸§é™å™ª" class="headerlink" title="å•å¸§é™å™ª"></a>å•å¸§é™å™ª</h2><h3 id="åŒè¾¹æ»¤æ³¢"><a href="#åŒè¾¹æ»¤æ³¢" class="headerlink" title="åŒè¾¹æ»¤æ³¢"></a>åŒè¾¹æ»¤æ³¢</h3><p>ä¸å…¶ä»–æ»¤æ³¢æ–¹å¼ç±»ä¼¼ï¼ŒåŒè¾¹æ»¤æ³¢ä¹Ÿä½¿ç”¨å‘¨å›´åƒç´ çš„åŠ æƒå¹³å‡å€¼ä»£æ›¿ä¸­å¿ƒåƒç´ å€¼ã€‚é‡è¦çš„æ˜¯åŒè¾¹æ»¤æ³¢çš„æƒé‡ä¸ä»…è€ƒè™‘äº†åƒç´ çš„æ¬§æ°è·ç¦»ï¼ˆæ¯”å¦‚é«˜æ–¯æ»¤æ³¢åªè€ƒè™‘è·ç¦»å¯¹æƒå€¼çš„å½±å“ï¼‰ï¼Œè¿˜è€ƒè™‘äº†æ»¤æ³¢èŒƒå›´åŸŸä¸­çš„è¾å°„å·®å¼‚ã€‚<br>å‡è®¾ (i, j) ä¸ºä¸­å¿ƒåƒç´  (k, l) ä¸ºå‘¨å›´ä¸€åƒç´ ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸¤åƒç´ ä¹‹é—´çš„å·®å¼‚ï¼ˆè·ç¦»ï¼Œé¢œè‰²ï¼‰è¶Šå¤§è´¡çŒ®è¶Šå°ï¼š</p><ul><li>$w(i,j,k,l)&#x3D;exp(-\frac{(i-k)^2+(j-l)^2}{2\sigma _d^2}-\frac{|I(i,j)-I(k,l)|^2}{2\sigma _r^2})$</li></ul><h3 id="è”åˆåŒè¾¹æ»¤æ³¢"><a href="#è”åˆåŒè¾¹æ»¤æ³¢" class="headerlink" title="è”åˆåŒè¾¹æ»¤æ³¢"></a>è”åˆåŒè¾¹æ»¤æ³¢</h3><p>æ—¢ç„¶ç°åœ¨æ˜¯åœ¨å›¾å½¢å­¦ä¸­è¿›è¡Œæ»¤æ³¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“åœ°ä»æ¸²æŸ“ç®¡çº¿ä¸­æ‰’æ‹‰å‡ºæ›´å¤šæœ‰å‚è€ƒä»·å€¼çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ä»»æ„åƒç´ çš„æ·±åº¦ä¿¡æ¯ã€ä¸–ç•Œåæ ‡ã€æ³•çº¿æ–¹å‘ç­‰ï¼Œç”šè‡³ä¸ºä¸åŒçš„ç‰©ä½“è¿›è¡Œç¼–å·ï¼Œåªè¦å°†è¿™äº›ä¿¡æ¯å­˜åœ¨ä¸€å¼  Buffer ä¸­å³å¯ã€‚<br>è”åˆåŒè¾¹æ»¤æ³¢ä¾¿æ˜¯å°†è¿™äº›å±æ€§çš„å·®å¼‚ä¹Ÿè€ƒè™‘è¿›æƒé‡çš„è®¡ç®—å†…ï¼Œæ»¤æ³¢æ ¸ä»¥ä»»ä½•ä¸€ç§ä¼šå‘ 0 è¡°å‡çš„å‡½æ•°æè¿°å³å¯ã€‚<br>å‡è®¾ i ä¸ºä¸­å¿ƒåƒç´  j ä¸ºå‘¨å›´ä¸€åƒç´ ï¼Œè¿™æ¬¡ç”¨åˆ°çš„æ»¤æ³¢æ ¸ï¼š</p><ul><li>$J(i,j)&#x3D;exp(-\frac{|i-j|^2}{2\sigma _p^2}-\frac{|\widetilde{C}[i]-\widetilde{C}[j]|^2}{2\sigma <em>c^2}-\frac{D</em>{normal}(i,j)^2}{2\sigma <em>n^2}-\frac{D</em>{plane}(i,j)^2}{2\sigma _d^2})$</li></ul><p>å…¶ä¸­ï¼š</p><ul><li>$\widetilde{C}$ï¼šæœ‰å™ªå£°çš„è¾“å…¥å›¾åƒã€‚</li><li>$D_{normal}(i,j)&#x3D;arccos(Normal[i]\cdot Normal[j])$ï¼š<br>æŸä¸€å¤¹è§’å·¦å³ä¸¤å¹³é¢ä¸Šçš„åƒç´ ä¸åº”å½“æœ‰å¤ªå¤šè´¡çŒ®ã€‚</li><li>$D_{plane}(i,j)&#x3D;Normal[i]\cdot \frac{Position[i]-Position[i]}{|Position[j]-Position[i]}$ï¼š<br>æ³•çº¿ç›¸ä¼¼ä½†æ˜¯æœ‰é«˜ä½å·®çš„ä¸¤å¹³é¢ä¸Šçš„åƒç´ ä¸åº”å½“æœ‰å¤ªå¤šè´¡çŒ®ã€‚</li></ul><h3 id="a-trous-wavelet-transform"><a href="#a-trous-wavelet-transform" class="headerlink" title="a-trous wavelet transform"></a>a-trous wavelet transform</h3><p>å‡å¦‚è¦éå†å®Œ NxN ä¸ªåƒç´ ä¼šæ˜¯ä¸€ä¸ªè¾ƒå¤§çš„æ€§èƒ½å¼€é”€ï¼Œè¿™é‡Œä½¿ç”¨ a-trous wavelet transform çš„æ–¹å¼åŠ é€Ÿé‡‡æ ·æ»¤æ³¢æ ¸å†…çš„åƒç´ ã€‚æ¯ä¸€è¶Ÿå›ºå®šé‡‡æ · 5x5 ä¸ªåƒç´ ï¼Œç¬¬ i è¶Ÿæ—¶é‡‡æ ·ç‚¹ä¹‹é—´çš„è·ç¦»ä¸º $2^{i-1}$ã€‚<br>æ—¶é—´å¤æ‚åº¦ä»$o(n^2)$é™ä½ä¸º$o(log _2n)$ã€‚<br><img src="/img/GAMES202/at.png"></p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">DistanceDifPow</span><span class="hljs-params">(<span class="hljs-type">int</span> i_x, <span class="hljs-type">int</span> i_y, <span class="hljs-type">int</span> j_x, <span class="hljs-type">int</span> j_y)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>(<span class="hljs-built_in">pow</span>((i_x - j_x), <span class="hljs-number">2</span>) + <span class="hljs-built_in">pow</span>((i_y - j_y), <span class="hljs-number">2</span>));<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">CloorDifPow</span><span class="hljs-params">(Float3 color_i, Float3 color_j)</span> </span>&#123;<br>    Float3 dif = color_i - color_j;<br>    <span class="hljs-keyword">return</span> dif.x * dif.x + dif.y * dif.y + dif.z * dif.z;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">DnormalPow</span><span class="hljs-params">(Float3 normal_i, Float3 normal_j)</span> </span>&#123;<br>    <span class="hljs-type">float</span> cosTerm = std::<span class="hljs-built_in">clamp</span>(<span class="hljs-built_in">Dot</span>(normal_i, normal_j), <span class="hljs-number">0.f</span>, <span class="hljs-number">1.f</span>);<br>    <span class="hljs-type">float</span> acos = std::<span class="hljs-built_in">acos</span>(cosTerm);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">pow</span>(acos, <span class="hljs-number">2</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">DplanePow</span><span class="hljs-params">(Float3 normal_i, Float3 position_i, Float3 position_j)</span> </span>&#123;<br>    Float3 nor = <span class="hljs-built_in">Normalize</span>(position_j - position_i);<br>    <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">clamp</span>((<span class="hljs-type">float</span>)<span class="hljs-built_in">pow</span>(<span class="hljs-built_in">Dot</span>(normal_i, nor), <span class="hljs-number">2</span>), <span class="hljs-number">1e-5f</span>, <span class="hljs-number">1.f</span>);<br>&#125;<br><br><span class="hljs-comment">// è”åˆåŒè¾¹æ»¤æ³¢æ ¸</span><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">JointBilateralFilteringKernel</span><span class="hljs-params">(<span class="hljs-type">float</span> distanceDifPow, <span class="hljs-type">float</span> colorDifPow,</span></span><br><span class="hljs-params"><span class="hljs-function">                                    <span class="hljs-type">float</span> normalDifPow, <span class="hljs-type">float</span> positionDifPow,</span></span><br><span class="hljs-params"><span class="hljs-function">                                    <span class="hljs-type">float</span> sigma_p, <span class="hljs-type">float</span> sigma_c,</span></span><br><span class="hljs-params"><span class="hljs-function">                                    <span class="hljs-type">float</span> sigma_n, <span class="hljs-type">float</span> sigma_d)</span> </span>&#123;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">exp</span>(-(distanceDifPow / (<span class="hljs-number">2</span> * <span class="hljs-built_in">pow</span>(sigma_p, <span class="hljs-number">2</span>))) -<br>            (colorDifPow / (<span class="hljs-number">2</span> * <span class="hljs-built_in">pow</span>(sigma_c, <span class="hljs-number">2</span>))) -<br>            (normalDifPow / (<span class="hljs-number">2</span> * <span class="hljs-built_in">pow</span>(sigma_n, <span class="hljs-number">2</span>))) -<br>            (positionDifPow / (<span class="hljs-number">2</span> * <span class="hljs-built_in">pow</span>(sigma_d, <span class="hljs-number">2</span>))));<br>&#125;<br><br><span class="hljs-function">Buffer2D&lt;Float3&gt; <span class="hljs-title">Denoiser::Filter</span><span class="hljs-params">(<span class="hljs-type">const</span> FrameInfo &amp;frameInfo)</span> </span>&#123;<br>    <span class="hljs-type">int</span> height = frameInfo.m_beauty.m_height;<br>    <span class="hljs-type">int</span> width = frameInfo.m_beauty.m_width;<br>    <span class="hljs-type">int</span> kernelRadius = <span class="hljs-number">16</span>;<br><br>    Buffer2D&lt;Float3&gt; filteredImage = <span class="hljs-built_in">CreateBuffer2D</span>&lt;Float3&gt;(width, height);<br>    Buffer2D&lt;Float3&gt; imageBuffer = <span class="hljs-built_in">CreateBuffer2D</span>&lt;Float3&gt;(width, height);<br>    Buffer2D&lt;Float3&gt; normalBuffer = <span class="hljs-built_in">CreateBuffer2D</span>&lt;Float3&gt;(width, height);<br>    Buffer2D&lt;Float3&gt; positionBuffer = <span class="hljs-built_in">CreateBuffer2D</span>&lt;Float3&gt;(width, height);<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> omp parallel for</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) &#123;<br>            <span class="hljs-built_in">filteredImage</span>(x, y) = frameInfo.<span class="hljs-built_in">m_beauty</span>(x, y);<br>            <span class="hljs-built_in">imageBuffer</span>(x, y) = frameInfo.<span class="hljs-built_in">m_beauty</span>(x, y);<br>            <span class="hljs-built_in">normalBuffer</span>(x, y) = frameInfo.<span class="hljs-built_in">m_normal</span>(x, y);<br>            <span class="hljs-built_in">positionBuffer</span>(x, y) = frameInfo.<span class="hljs-built_in">m_position</span>(x, y);<br><br>            <span class="hljs-comment">// æƒé‡</span><br>            <span class="hljs-type">float</span> weight = <span class="hljs-number">0.f</span>;<br>            <span class="hljs-comment">// a-trous wavelet çš„æ­¥é•¿</span><br>            <span class="hljs-type">int</span> step = <span class="hljs-number">1</span>;<br><br>            <span class="hljs-type">bool</span> useA_trou = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">if</span> (useA_trou) &#123;<br>                <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå¾ªç¯ç¡®å®š filter å¤§å°ï¼Œç¬¬äºŒç¬¬ä¸‰ä¸ªå¾ªç¯çš„å†…å®¹å›ºå®šåœ°å¾ªç¯ 25 æ¬¡ã€‚</span><br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num = <span class="hljs-number">0</span>; <span class="hljs-number">2</span> * step &lt;= kernelRadius; num++) &#123;<br>                    step = <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, num);<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j_y = y - <span class="hljs-number">2</span> * step; j_y &lt;= y + <span class="hljs-number">2</span> * step; j_y += step) &#123;<br>                        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j_x = x - <span class="hljs-number">2</span> * step; j_x &lt;= x + <span class="hljs-number">2</span> * step; j_x += step) &#123;<br><br>                            <span class="hljs-keyword">if</span> (j_y &lt; <span class="hljs-number">0</span> || j_y &gt;= height || j_x &lt; <span class="hljs-number">0</span> || j_x &gt;= width) &#123;<br>                                <span class="hljs-comment">// è¶…å‡ºå›¾åƒèŒƒå›´æ—¶è¿”å›</span><br>                                <span class="hljs-keyword">continue</span>;<br>                            &#125;<br><br>                            <span class="hljs-built_in">imageBuffer</span>(j_x, j_y) = frameInfo.<span class="hljs-built_in">m_beauty</span>(j_x, j_y);<br>                            <span class="hljs-built_in">normalBuffer</span>(j_x, j_y) = frameInfo.<span class="hljs-built_in">m_normal</span>(j_x, j_y);<br>                            <span class="hljs-built_in">positionBuffer</span>(j_x, j_y) = frameInfo.<span class="hljs-built_in">m_position</span>(j_x, j_y);<br><br>                            <span class="hljs-type">float</span> distanceTerm = <span class="hljs-built_in">DistanceDifPow</span>(x, y, j_x, j_y);<br>                            <span class="hljs-type">float</span> colorTerm =<br>                                <span class="hljs-built_in">CloorDifPow</span>(<span class="hljs-built_in">imageBuffer</span>(x, y), <span class="hljs-built_in">imageBuffer</span>(j_x, j_y));<br>                            <span class="hljs-type">float</span> normalTerm =<br>                                <span class="hljs-built_in">DnormalPow</span>(<span class="hljs-built_in">normalBuffer</span>(x, y), <span class="hljs-built_in">normalBuffer</span>(j_x, j_y));<br>                            <span class="hljs-type">float</span> planeTerm =<br>                                <span class="hljs-built_in">DplanePow</span>(<span class="hljs-built_in">normalBuffer</span>(x, y),<br>                                    <span class="hljs-built_in">positionBuffer</span>(x, y), <span class="hljs-built_in">positionBuffer</span>(j_x, j_y));<br><br>                            <span class="hljs-keyword">if</span> (width &gt;= <span class="hljs-number">1280</span>) &#123;<br>                                <span class="hljs-comment">// pink-room</span><br>                                m_sigmaColor = <span class="hljs-number">20</span>;<br>                            &#125;<br><br>                            <span class="hljs-type">float</span> exp = <span class="hljs-built_in">JointBilateralFilteringKernel</span>(<br>                                distanceTerm, colorTerm, normalTerm, planeTerm,<br>                                m_sigmaCoord, m_sigmaColor, m_sigmaNormal, m_sigmaPlane);<br><br>                            <span class="hljs-built_in">filteredImage</span>(x, y) += <span class="hljs-built_in">imageBuffer</span>(j_x, j_y) * exp;<br>                            weight += exp;<br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// useA_trou == false</span><br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j_y = y - kernelRadius; j_y &lt;= y + kernelRadius; ++j_y) &#123;<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j_x = x - kernelRadius; j_x &lt;= x + kernelRadius; ++j_x) &#123;<br>                        <span class="hljs-keyword">if</span> (j_y &lt; <span class="hljs-number">0</span> || j_y &gt;= height || j_x &lt; <span class="hljs-number">0</span> || j_x &gt;= width) &#123;<br>                            <span class="hljs-keyword">continue</span>;<br>                        &#125;<br>                        <span class="hljs-built_in">imageBuffer</span>(j_x, j_y) = frameInfo.<span class="hljs-built_in">m_beauty</span>(j_x, j_y);<br>                        <span class="hljs-built_in">normalBuffer</span>(j_x, j_y) = frameInfo.<span class="hljs-built_in">m_normal</span>(j_x, j_y);<br>                        <span class="hljs-built_in">positionBuffer</span>(j_x, j_y) = frameInfo.<span class="hljs-built_in">m_position</span>(j_x, j_y);<br>                        <span class="hljs-type">float</span> distanceTerm = <span class="hljs-built_in">DistanceDifPow</span>(x, y, j_x, j_y);<br>                        <span class="hljs-type">float</span> colorTerm =<br>                            <span class="hljs-built_in">CloorDifPow</span>(<span class="hljs-built_in">imageBuffer</span>(x, y), <span class="hljs-built_in">imageBuffer</span>(j_x, j_y));<br>                        <span class="hljs-type">float</span> normalTerm =<br>                            <span class="hljs-built_in">DnormalPow</span>(<span class="hljs-built_in">normalBuffer</span>(x, y), <span class="hljs-built_in">normalBuffer</span>(j_x, j_y));<br>                        <span class="hljs-type">float</span> planeTerm =<br>                            <span class="hljs-built_in">DplanePow</span>(<span class="hljs-built_in">normalBuffer</span>(x, y),<br>                                <span class="hljs-built_in">positionBuffer</span>(x, y), <span class="hljs-built_in">positionBuffer</span>(j_x, j_y));<br>                        <span class="hljs-keyword">if</span> (width &gt;= <span class="hljs-number">1280</span>) &#123; <span class="hljs-comment">// for pink-room</span><br>                            m_sigmaColor = <span class="hljs-number">30</span>;<br>                        &#125;<br>                        <span class="hljs-type">float</span> exp = <span class="hljs-built_in">JointBilateralFilteringKernel</span>(<br>                            distanceTerm, colorTerm, normalTerm, planeTerm,<br>                            m_sigmaCoord, m_sigmaColor, m_sigmaNormal, m_sigmaPlane);<br>                        <span class="hljs-built_in">filteredImage</span>(x, y) += <span class="hljs-built_in">imageBuffer</span>(j_x, j_y) * exp;<br>                        weight += exp;<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (weight &gt; <span class="hljs-number">0.f</span>) &#123;<br>                <span class="hljs-built_in">filteredImage</span>(x, y) /= weight;<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-built_in">filteredImage</span>(x, y) = <span class="hljs-number">0.f</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> filteredImage;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç»“æœ-7"><a href="#ç»“æœ-7" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES202/n.gif" alt="1 SPP"></div><div class="group-image-wrap"><img src="/img/GAMES202/f.gif" alt="å•å¸§é™å™ª"></div></div></div><div class="note note-secondary">            <p><strong>æ»¤æ³¢ä¹‹åäº®åº¦æé«˜çš„åŸå› </strong>ï¼šäº‹å®ä¸Šç¬¬äºŒå¼ å›¾çš„äº®åº¦å¹¶æ²¡æœ‰æé«˜ï¼Œç¬¬ä¸€å¼ å›¾çš„è¾å°„æœŸæœ›ä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚ç¬¬ä¸€å¼ å›¾çš„äº®åº¦çœ‹èµ·æ¥åæš—æ˜¯ç”±äºè·¯å¾„è¿½è¸ªçš„æ–¹å·®è¿‡å¤§ï¼Œä»¥è‡³äºæœ‰å¤§é‡è¶…è¿‡ RGB è‰²åŸŸæ˜¾ç¤ºèŒƒå›´çš„ Irradiance è¢«ç›´æ¥ Clamp è‡³ 255ï¼Œäº§ç”Ÿäº†èƒ½é‡æŸå¤±ã€‚åœ¨ç¬¬äºŒå¼ å›¾ä¸­è¿›è¡Œæ»¤æ³¢ä¾¿æ˜¯å°†æ— æ³•æ˜¾ç¤ºçš„æ•°å€¼åˆ†é…ç»™äº†å‘¨å›´çš„åƒç´ ï¼Œä½¿å¾—è¿™éƒ¨åˆ†æ•°å€¼å¯ä»¥æ­£å¸¸åœ°è¢«æ˜¾ç¤ºå‡ºæ¥ã€‚</p>          </div><h2 id="æ—¶é—´ä¸Šçš„ç´¯ç§¯"><a href="#æ—¶é—´ä¸Šçš„ç´¯ç§¯" class="headerlink" title="æ—¶é—´ä¸Šçš„ç´¯ç§¯"></a>æ—¶é—´ä¸Šçš„ç´¯ç§¯</h2><p>å…ˆå°†å½“å‰å¸§åšå•å¸§æ»¤æ³¢ï¼Œç„¶åæŠŠä¸€åƒç´ ç‚¹åœ¨ä¸Šä¸€å¸§æ‰€åœ¨ä½ç½®çš„åƒç´ å€¼æŒ‰ä¸€å®šæƒå€¼æ··åˆå…¥å½“å‰å¸§ã€‚å¦‚æœè¯´æ¯ä¸€å¸§éƒ½èƒ½åš 1 SPPï¼Œé‚£ä¹ˆä¾¿å‡ ä¹ç›¸å½“äºä¸€ç§’å†…å°† 30 SPP çš„é‡‡æ ·ç»“æœç´¯ç§¯äº†ä¸‹æ¥ã€‚</p><h3 id="æŠ•å½±åˆ°ä¸Šä¸€å¸§"><a href="#æŠ•å½±åˆ°ä¸Šä¸€å¸§" class="headerlink" title="æŠ•å½±åˆ°ä¸Šä¸€å¸§"></a>æŠ•å½±åˆ°ä¸Šä¸€å¸§</h3><p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•æ‰¾åˆ°ä¸€åƒç´ ç‚¹åœ¨ä¸Šä¸€å¸§æ‰€å¯¹åº”çš„ä½ç½®ï¼Œå‡†ç¡®æ¥è¯´æ˜¯ï¼šä¸€åƒç´ ç‚¹å¯¹åº”ä¸–ç•Œåæ ‡å˜æ¢å›ä¸Šä¸€å¸§çš„ä¸–ç•Œåæ ‡ï¼Œç„¶åå˜æ¢è‡³ä¸Šä¸€å¸§çš„å±å¹•ç©ºé—´çš„åæ ‡ã€‚<br>å…¬å¼å¦‚ä¸‹ï¼š </p><ul><li>$Screen_{i-1}&#x3D;P_{i-1}V_{i-1}M_{i-1}M_i^{-1}World_i$</li></ul><p>å…¶ä¸­ï¼š</p><ul><li>ä¸‹è§’æ ‡çš„ i ä»£è¡¨ç¬¬ i å¸§</li><li>M ä»£è¡¨ç‰©ä½“åæ ‡ç³»åˆ°ä¸–ç•Œåæ ‡ç³»çš„çŸ©é˜µ</li><li>V ä»£è¡¨ä¸–ç•Œåæ ‡ç³»åˆ°æ‘„åƒæœºåæ ‡ç³»çš„çŸ©é˜µ</li><li>P ä»£è¡¨æ‘„åƒæœºåæ ‡ç³»åˆ°å±å¹•åæ ‡ç³»çš„çŸ©é˜µ</li></ul><p>å¾—åˆ°ä¸Šä¸€å¸§çš„å±å¹•ç©ºé—´åæ ‡åéœ€è¦æ£€æŸ¥ï¼š</p><ol><li>ä¸Šä¸€å¸§æ˜¯å¦åœ¨å±å¹•å†…ã€‚ï¼ˆè¯¥ç‚¹ç¬¬ä¸€æ¬¡å‡ºç°äºå±å¹•å†…ï¼Œæ²¡æœ‰æ—¶é—´ä¸Šçš„ä¿¡æ¯ï¼‰</li><li>ä¸Šä¸€å¸§å’Œå½“å‰å¸§çš„ç‰©ä½“çš„æ ‡å·ã€‚ï¼ˆè¯¥ç‚¹ä¸Šä¸€å¸§è¢«å¦ä¸€ç‰©ä½“é®æŒ¡ï¼Œä¸åº”å½“ä½¿ç”¨æ—¶é—´ä¸Šçš„ä¿¡æ¯ï¼‰</li></ol><p>è‹¥åæ ‡éæ³•ä¾¿ä¸ä½¿ç”¨ä¸Šä¸€å¸§çš„æ•°æ®ï¼Œ100% ä½¿ç”¨å½“å‰å¸§çš„æ•°æ®ã€‚æŠ•å½±åæ ‡çš„åˆæ³•æ€§ä¿å­˜åœ¨ m_valid ä¸­ä¾›ä¸‹ä¸€æ­¥å‚è€ƒã€‚</p><h4 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Denoiser::Reprojection</span><span class="hljs-params">(<span class="hljs-type">const</span> FrameInfo&amp; frameInfo)</span> </span>&#123;<br>    <span class="hljs-type">int</span> height = m_accColor.m_height;<br>    <span class="hljs-type">int</span> width = m_accColor.m_width;<br>    Matrix4x4 preWorldToScreen =<br>        m_preFrameInfo.m_matrix[m_preFrameInfo.m_matrix.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>];<br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> omp parallel for</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) &#123;<br><br>            <span class="hljs-type">int</span> id = (<span class="hljs-type">int</span>)frameInfo.<span class="hljs-built_in">m_id</span>(x, y);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-number">-1</span> != id) &#123;<br>                Matrix4x4 invModel = <span class="hljs-built_in">Inverse</span>(frameInfo.m_matrix[id]);<br>                Matrix4x4 preModel = m_preFrameInfo.m_matrix[id];<br>                Matrix4x4 PVMM_1 = preWorldToScreen * preModel * invModel;<br>                Float3 projPos = <span class="hljs-built_in">PVMM_1</span>(frameInfo.<span class="hljs-built_in">m_position</span>(x, y), Float3::Point);<br><br>                <span class="hljs-comment">//Float3 invPos = invModel(frameInfo.m_position(x, y), Float3::Point);</span><br>                <span class="hljs-comment">//Float3 prePos = preModel(invPos, Float3::Point);</span><br>                <span class="hljs-comment">//Float3 projPos = preWorldToScreen(prePos, Float3::Point);</span><br><br>                <span class="hljs-type">int</span> pre_x = (<span class="hljs-type">int</span>)projPos.x;<br>                <span class="hljs-type">int</span> pre_y = (<span class="hljs-type">int</span>)projPos.y;<br>                <span class="hljs-keyword">if</span> (pre_x &lt; <span class="hljs-number">0</span> || pre_x &gt;= width || pre_y &lt; <span class="hljs-number">0</span> || pre_y &gt;= height) &#123;<br>                    <span class="hljs-built_in">m_valid</span>(x, y) = <span class="hljs-literal">false</span>;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br><br>                <span class="hljs-comment">// åœ¨ pre_x æˆ– pre_y è¶…å‡ºå±å¹•æ—¶ m_id(pre_x, pre_y) å±äºè¿æ³•æ“ä½œã€‚</span><br>                <span class="hljs-type">int</span> pre_id = (<span class="hljs-type">int</span>)m_preFrameInfo.<span class="hljs-built_in">m_id</span>(pre_x, pre_y);<br>                <span class="hljs-keyword">if</span> (pre_id != id) &#123;<br>                    <span class="hljs-built_in">m_valid</span>(x, y) = <span class="hljs-literal">false</span>;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br><br>                <span class="hljs-built_in">m_misc</span>(x, y) = <span class="hljs-built_in">m_accColor</span>(pre_x, pre_y);<br>                <span class="hljs-built_in">m_valid</span>(x, y) = <span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-comment">//m_valid(x, y) = false;</span><br>            <span class="hljs-comment">//m_misc(x, y) = Float3(0.f);</span><br>        &#125;<br>    &#125;<br>    std::<span class="hljs-built_in">swap</span>(m_misc, m_accColor);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ··åˆå…¥å½“å‰å¸§"><a href="#æ··åˆå…¥å½“å‰å¸§" class="headerlink" title="æ··åˆå…¥å½“å‰å¸§"></a>æ··åˆå…¥å½“å‰å¸§</h3><p>å°†å·²é™å™ªçš„å½“å‰å¸§$\overline{C}<em>i$ä¸ä¸Šä¸€å¸§çš„ç»“æœ$\overline{C}</em>{i-1}$è¿›è¡Œèåˆï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><ul><li>$\overline{C}_i&#x3D;\alpha \overline{C}<em>i+(1-\alpha)Clamp(\overline{C}</em>{i-1})$</li></ul><p>å¦‚æœä¸Šä¸€å¸§çš„åæ ‡éæ³•ï¼Œ$\alpha$ ä¾¿ä¸º 1ã€‚</p><h4 id="Clamp"><a href="#Clamp" class="headerlink" title="Clamp"></a>Clamp</h4><p>è®¡ç®— $\overline{C}_i$ åœ¨ 5x5 é¢†åŸŸå†…çš„å‡å€¼ $\mu$ ä¸æ–¹å·® $\sigma$ï¼Œç„¶åå°†ä¸Šä¸€å¸§çš„é¢œè‰²å€¼ Clapm è¿› $(\mu -k\sigma,\mu +k\sigma)$ å†…ã€‚</p><h4 id="å®ç°-2"><a href="#å®ç°-2" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Denoiser::TemporalAccumulation</span><span class="hljs-params">(<span class="hljs-type">const</span> Buffer2D&lt;Float3&gt; &amp;curFilteredColor)</span> </span>&#123;<br>    <span class="hljs-type">int</span> height = m_accColor.m_height;<br>    <span class="hljs-type">int</span> width = m_accColor.m_width;<br>    <span class="hljs-type">int</span> range = <span class="hljs-number">2</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> omp parallel for</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) &#123;<br>            <span class="hljs-comment">/* TemporalAccumulation åœ¨ Reprojection ä¹‹åè¢«è°ƒç”¨ï¼Œ</span><br><span class="hljs-comment">            æ‰€ä»¥è¿™é‡Œçš„ m_accColor æ˜¯ä¸Šä¸€å¸§çš„ç»“æœã€‚*/</span><br>            Float3 preColor = <span class="hljs-built_in">m_accColor</span>(x, y);<br><br>            <span class="hljs-function">Float3 <span class="hljs-title">mu</span><span class="hljs-params">(<span class="hljs-number">0.f</span>)</span></span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = x - range; i &lt;= x + range; i++) &#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = y - range; j &lt;= y + range; j++) &#123;<br>                    mu += <span class="hljs-built_in">curFilteredColor</span>(i, j);<br>                &#125;<br>            &#125;<br>            mu /= (<span class="hljs-type">float</span>)<span class="hljs-built_in">pow</span>(<span class="hljs-number">2.f</span> * range + <span class="hljs-number">1.f</span>, <span class="hljs-number">2</span>);<br><br>            <span class="hljs-function">Float3 <span class="hljs-title">sigma</span><span class="hljs-params">(<span class="hljs-number">0.f</span>)</span></span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = x - range; i &lt;= x + range; i++) &#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = y - range; j &lt;= y + range; j++) &#123;<br>                    sigma += <span class="hljs-built_in">Sqr</span>(<span class="hljs-built_in">curFilteredColor</span>(i, j) - mu);<br>                &#125;<br>            &#125;<br>            sigma /= (<span class="hljs-type">float</span>)<span class="hljs-built_in">pow</span>(<span class="hljs-number">2.f</span> * range + <span class="hljs-number">1.f</span>, <span class="hljs-number">2</span>);<br><br>            <span class="hljs-keyword">if</span> (width &gt;= <span class="hljs-number">1280</span>) &#123;<br>                <span class="hljs-comment">// pink-room</span><br>                m_colorBoxK = <span class="hljs-number">0.1f</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// å°†ä¸Šä¸€å¸§å¯¹åº”çš„åƒç´ çš„å€¼æ‹‰è¿‘å½“å‰å¸§åƒç´ </span><br>            preColor = <span class="hljs-built_in">Clamp</span>(preColor,<br>                mu - sigma * m_colorBoxK, mu + sigma * m_colorBoxK);<br><br>            <span class="hljs-type">float</span> alpha = <span class="hljs-number">1.0f</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">m_valid</span>(x, y)) &#123;<br>                alpha = m_alpha;<br>            &#125;<br>            <span class="hljs-built_in">m_misc</span>(x, y) = <span class="hljs-built_in">Lerp</span>(preColor, <span class="hljs-built_in">curFilteredColor</span>(x, y), alpha);<br>            <span class="hljs-comment">//m_misc(x, y) = Lerp(preColor, curFilteredColor(x, y), 1.0f);</span><br>        &#125;<br>    &#125;<br>    std::<span class="hljs-built_in">swap</span>(m_misc, m_accColor);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç»“æœ-8"><a href="#ç»“æœ-8" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p><img src="/img/GAMES202/t.gif"></p>]]></content>
    
    
    
    <tags>
      
      <tag>GlobalIllumination</tag>
      
      <tag>Math</tag>
      
      <tag>Rendering</tag>
      
      <tag>RayTracing</tag>
      
      <tag>GLSL</tag>
      
      <tag>JavaScript</tag>
      
      <tag>Reflection</tag>
      
      <tag>Shadow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¾å°„åº¦é‡å­¦åŸºç¡€</title>
    <link href="/2021/09/14/Radiometry/"/>
    <url>/2021/09/14/Radiometry/</url>
    
    <content type="html"><![CDATA[<h2 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h2><p>&emsp;&emsp;è·¯å¾„è¿½è¸ªçš„å‰ç½®çŸ¥è¯†ã€‚</p><h2 id="ç‰©ç†é‡ä¸€è§ˆ"><a href="#ç‰©ç†é‡ä¸€è§ˆ" class="headerlink" title="ç‰©ç†é‡ä¸€è§ˆ"></a>ç‰©ç†é‡ä¸€è§ˆ</h2><table><thead><tr><th align="center">ç¬¦å·</th><th align="left">åç§°</th><th align="center">å•ä½</th><th align="left">å…‰åº¦å­¦åç§°</th><th align="center">å…‰åº¦å­¦å•ä½</th></tr></thead><tbody><tr><td align="center">Q</td><td align="left">Radiant Energy</td><td align="center">J</td><td align="left">Luminous Energy</td><td align="center">lm.s</td></tr><tr><td align="center">$\phi$</td><td align="left">Radiant Flux</td><td align="center">$\frac{J}{s}$ &#x2F; Watt(W)</td><td align="left">Luminous Flux</td><td align="center">Lumen(lm)</td></tr><tr><td align="center">I</td><td align="left">Radiant Intensity</td><td align="center">$\frac{W}{sr}$</td><td align="left">Luminous Intensity</td><td align="center">Candela(cd)</td></tr><tr><td align="center">E</td><td align="left">Irradiance</td><td align="center">$\frac{W}{m^2}$</td><td align="left">Illuminance</td><td align="center">Lux(lx)</td></tr><tr><td align="center">L</td><td align="left">Radiance</td><td align="center">$\frac{W}{m^2\cdot sr}$</td><td align="left">Luminance</td><td align="center">Nit(nt)</td></tr></tbody></table><h2 id="Radiant-Energy"><a href="#Radiant-Energy" class="headerlink" title="Radiant Energy"></a>Radiant Energy</h2><ul><li>Q (J)</li></ul><p>è¾å°„èƒ½é‡ã€‚</p><h2 id="Radiant-Flux"><a href="#Radiant-Flux" class="headerlink" title="Radiant Flux"></a>Radiant Flux</h2><ul><li>$\phi &#x3D;\frac{dQ}{dt}$ (W)</li></ul><p>è¾å°„é€šé‡ï¼Œå•ä½æ—¶é—´ä¸Šçš„èƒ½é‡ã€‚</p><h2 id="Radiant-Intensity"><a href="#Radiant-Intensity" class="headerlink" title="Radiant Intensity"></a>Radiant Intensity</h2><ul><li>$I(\omega)&#x3D;\frac{d\phi}{d\omega}$ ($\frac{W}{sr}$)</li></ul><p>è¾å°„å¼ºåº¦ï¼ŒåŠŸç‡æ¯ç«‹ä½“è§’ã€‚</p><h3 id="ç«‹ä½“è§’"><a href="#ç«‹ä½“è§’" class="headerlink" title="ç«‹ä½“è§’"></a>ç«‹ä½“è§’</h3><p><img src="/img/Radi/sa.png"><br>ç«‹ä½“è§’ï¼š$\Omega &#x3D;\frac{A}{r^2}$ (sr)ã€å•ä½ç«‹ä½“è§’ï¼š$d\omega &#x3D;\sin \theta d\theta d\varphi$<br>ä¸€ä¸ªå®Œæ•´çƒé¢çš„ç«‹ä½“è§’æ˜¯ $4\pi$ã€‚</p><h2 id="Irradiance"><a href="#Irradiance" class="headerlink" title="Irradiance"></a>Irradiance</h2><ul><li>$E(x)&#x3D;\frac{d\phi (x)}{dA}$ ($\frac{W}{m^2}$)</li></ul><p>è¾å°„ç…§åº¦ï¼ŒåŠŸç‡æ¯å‚ç›´é¢ç§¯ã€‚</p><h2 id="Radiance"><a href="#Radiance" class="headerlink" title="Radiance"></a>Radiance</h2><ul><li>$L(p,\omega)&#x3D;\frac{d^2\phi (p,\omega)}{d\omega dA\cos\theta}$ ($\frac{W}{sr\cdot m^2}$)<br>è¾å°„äº®åº¦ï¼ŒåŠŸç‡æ¯ç«‹ä½“è§’ï¼Œæ¯å‚ç›´é¢ç§¯ã€‚å¯ä»¥ç†è§£ä¸ºå•ä½é¢ç§¯å¯¹å•ä½ç«‹ä½“è§’è¾å°„æˆ–æ¥å—çš„åŠŸç‡ã€‚</li></ul><h2 id="æ¨å¯¼"><a href="#æ¨å¯¼" class="headerlink" title="æ¨å¯¼"></a>æ¨å¯¼</h2><p>ç”±å®šä¹‰å¯å¾— Radiance å³ Intensity æ¯å‚ç›´é¢ç§¯ï¼Œæˆ–è€… Irradiance æ¯ç«‹ä½“è§’ã€‚<br>å®ƒä»¬ä¹‹é—´çš„è½¬æ¢ä¸ºï¼š</p><ul><li>$dE(p)&#x3D;L(p,\omega)*\cos \theta d\omega$</li><li>$dI(p,\omega)&#x3D;L(p,\omega)*\cos \theta dA$</li></ul><p>è¿›ä¸€æ­¥æ¨å¯¼ï¼š<strong>ä¸€å•ä½é¢ç§¯çš„ Irradiance ä¸ºå…¶æ¥å—çš„ Radiance åœ¨å•ä½åŠçƒä¸Šçš„ç§¯åˆ†</strong>ã€‚</p><ul><li>$E(p)&#x3D;\int_{H^2}L_i(p,\omega)\cos \theta d\omega$</li></ul><h2 id="åŒå‘åå°„åˆ†å¸ƒå‡½æ•°-BRDF"><a href="#åŒå‘åå°„åˆ†å¸ƒå‡½æ•°-BRDF" class="headerlink" title="åŒå‘åå°„åˆ†å¸ƒå‡½æ•° BRDF"></a>åŒå‘åå°„åˆ†å¸ƒå‡½æ•° BRDF</h2><p>è¯¥å‡½æ•°å®šä¹‰äº†æŸä¸€å•ä½é¢ç§¯ä»æŸä¸€å•ä½ç«‹ä½“è§’æ¥æ”¶åˆ°çš„ Radiance è½¬åŒ–ä¸ºå…¶ Irradiance ç„¶åå†è¾å°„å‡ºå»çš„ Radiance æ˜¯å¦‚ä½•åˆ†é…åˆ°å„ä¸ªç«‹ä½“è§’ä¸Šçš„ï¼Œå³ï¼š<br>å‡ºå°„ <code>Radiance</code> &#x2F; å…¥å°„ <code>Irradiance</code></p><ul><li>$f_r(\omega_i\rightarrow \omega_r)&#x3D;\frac{dL_r{\omega_r}}{dE_i{\omega_i}}&#x3D;\frac{dL_r(\omega_r)}{L_i(p,\omega_i)\cos \theta_id\omega_i}$ ($\frac{1}{sr}$)</li></ul><h2 id="åå°„æ–¹ç¨‹"><a href="#åå°„æ–¹ç¨‹" class="headerlink" title="åå°„æ–¹ç¨‹"></a>åå°„æ–¹ç¨‹</h2><p>ç”± Radiance ä¸ BRDF çš„å®šä¹‰å¯å¾—ï¼š<strong>å•ä½é¢ç§¯å‘ä»»ä¸€å•ä½ç«‹ä½“è§’è¾å°„å‡ºçš„ Radiance å¯ç”±å…¶æ¥å—çš„ Radiance ä¸å…¶ BRDF çš„ä¹˜ç§¯åœ¨å•ä½åŠçƒä¸Šç§¯åˆ†æ±‚å¾—</strong>ã€‚</p><ul><li>$L_r(p,\omega_r)&#x3D;\int_{H^2}f_r(p,\omega_i\rightarrow \omega_r)L_i(p,\omega_i)\cos \theta_i{\rm d}\omega_i$</li></ul><h2 id="æ¸²æŸ“æ–¹ç¨‹"><a href="#æ¸²æŸ“æ–¹ç¨‹" class="headerlink" title="æ¸²æŸ“æ–¹ç¨‹"></a>æ¸²æŸ“æ–¹ç¨‹</h2><p>åœ¨åå°„æ–¹ç¨‹ä¸­åŠ ä¸Šè‡ªå‘å…‰é¡¹ï¼Œç”¨äºæè¿°å…‰æºç‰©ä½“ã€‚</p><ul><li>$L_o(p,\omega_o)&#x3D;L_e(p,\omega_o)+\int_{H^2}f_r(p,\omega_i,\omega_o)L_i(p,\omega_i)(n\cdot \omega_i){\rm d}\omega_i$</li></ul><p>$H^2$ å’Œ $\Omega^+$ 0éƒ½è¡¨ç¤ºå•ä½åŠçƒé¢ï¼Œæˆ‘ä»¬é»˜è®¤ä¸‹åŠçƒé¢ä¸ä¼šäº§ç”Ÿä»»ä½•è´¡çŒ®ï¼Œè¿™æ ·å°±ä¸ç”¨å†™ä»€ä¹ˆ $max(0, \cos\theta)$ äº†ã€‚</p><div class="note note-secondary">            <p>æ‰€æœ‰å‘é‡ç”±è¯¥ç‚¹å‘å‡ºï¼Œæ–¹å‘å‘å¤–ã€‚</p>          </div>]]></content>
    
    
    
    <tags>
      
      <tag>Math</tag>
      
      <tag>PBR</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Archiveã€‘GAMES101</title>
    <link href="/2021/09/03/GAMES101/"/>
    <url>/2021/09/03/GAMES101/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¸²æŸ“ç®¡çº¿ä¸­çš„å˜æ¢çŸ©é˜µ"><a href="#æ¸²æŸ“ç®¡çº¿ä¸­çš„å˜æ¢çŸ©é˜µ" class="headerlink" title="æ¸²æŸ“ç®¡çº¿ä¸­çš„å˜æ¢çŸ©é˜µ"></a>æ¸²æŸ“ç®¡çº¿ä¸­çš„å˜æ¢çŸ©é˜µ</h1><p>&emsp;&emsp;åœ¨æ¸²æŸ“ç®¡çº¿çš„å‰æœŸï¼Œå…‰æ …åŒ–ä¹‹å‰ï¼Œéœ€è¦å¯¹é¡¶ç‚¹å’Œç›¸æœºçš„åæ ‡è¿›è¡Œæ ‡å‡†åŒ–å˜æ¢ï¼Œç„¶åè¿›è¡Œè§†å£å˜æ¢è¿›å…¥å±å¹•åæ ‡ç©ºé—´ã€‚</p><h2 id="ç›¸æœºçš„å®šä¹‰"><a href="#ç›¸æœºçš„å®šä¹‰" class="headerlink" title="ç›¸æœºçš„å®šä¹‰"></a>ç›¸æœºçš„å®šä¹‰</h2><p>ä½ç½®ï¼š$\vec{e}$;&emsp;çœ‹å‘ï¼š$\vec{g}$;&emsp;ä¸Šæ–¹ï¼š$\vec{t}$;</p><p>æˆ‘ä»¬è§„å®šç›¸æœºä½äº (0, 0, 0) ï¼Œçœ‹å‘ -Zï¼Œä¸Šæ–¹ä¸º Yã€‚<br>å¯¹ç›¸æœºå’Œé¡¶ç‚¹åº”ç”¨åŒä¸€ä¸ªå˜æ¢çŸ©é˜µï¼Œä»–ä»¬çš„ç›¸å¯¹ä½ç½®åˆ™ä¸å˜ã€‚</p><h2 id="è§†é”¥ä½“çš„å®šä¹‰"><a href="#è§†é”¥ä½“çš„å®šä¹‰" class="headerlink" title="è§†é”¥ä½“çš„å®šä¹‰"></a>è§†é”¥ä½“çš„å®šä¹‰</h2><p><img src="/img/GAMES101/fru.png"><br>å·²çŸ¥fovYå’Œaspectå¯å¾—</p><ul><li>$tan\frac{fovY}{2} &#x3D; \frac{t}{|n|}$</li><li>$aspect &#x3D; \frac{r}{t}$</li></ul><h2 id="åƒç´ ç©ºé—´"><a href="#åƒç´ ç©ºé—´" class="headerlink" title="åƒç´ ç©ºé—´"></a>åƒç´ ç©ºé—´</h2><p>åƒç´ å—ç¼–å· (0, 0) -&gt; (width - 1, height - 1)<br>åƒç´ ä¸­å¿ƒ (x + 0.5, y + 0.5)<br>è¦†ç›–äº (0, 0) -&gt; (width, height)</p><h2 id="Viewing"><a href="#Viewing" class="headerlink" title="Viewing"></a>Viewing</h2><h3 id="Model-View"><a href="#Model-View" class="headerlink" title="Model-View"></a>Model-View</h3><p>$M_{view}&#x3D;R_{view}T_{view}$<br>â€‹<br>å°†ç›¸æœºç§»åŠ¨è‡³åŸç‚¹ã€‚<br>$T_{view}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  1 &amp; 0 &amp; 0 &amp; -x_e \<br>  0 &amp; 1 &amp; 0 &amp; -y_e \<br>  0 &amp; 0 &amp; 1 &amp; -z_e \<br>  0 &amp; 0 &amp; 0 &amp; 1 \<br>  \end{pmatrix}<br>$$<br>â€‹<br>ç„¶åå°† g æ—‹è½¬è‡³ -Zï¼Œt æ—‹è½¬è‡³ Yï¼Œï¼ˆg x tï¼‰æ—‹è½¬è‡³ Xã€‚<br>ä½†æ˜¯è¿™æ ·çš„çŸ©é˜µä¸å¥½æ±‚ï¼Œæ•…å…ˆè€ƒè™‘æ±‚å…¶ç®€å•çš„é€†çŸ©é˜µ $R_{view}^{-1}$ï¼š</p><ul><li>å°† Xï¼ˆ1ï¼Œ0ï¼Œ0ï¼‰æ—‹è½¬è‡³ï¼ˆg x tï¼‰ï¼Œå°† Yï¼ˆ0ï¼Œ1ï¼Œ0ï¼‰æ—‹è½¬è‡³ tï¼Œå°† Zï¼ˆ0ï¼Œ0ï¼Œ1ï¼‰æ—‹è½¬è‡³ -gã€‚<br>â€‹åŒæ—¶ï¼Œæ—‹è½¬çŸ©é˜µæ˜¯æ­£äº¤çŸ©é˜µï¼Œæ•…å…¶é€†çŸ©é˜µç­‰äºå…¶è½¬ç½®çŸ©é˜µã€‚</li></ul><p>ç”± $R_{view}^{-1}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  x_{g \times t} &amp; x_t &amp; x_{-g} &amp; 0 \<br>  y_{g \times t} &amp; y_t &amp; y_{-g} &amp; 0 \<br>  z_{g \times t} &amp; z_t &amp; z_{-g} &amp; 0 \<br>  0 &amp; 0 &amp; 0 &amp; 1 \<br>  \end{pmatrix}<br>$$<br>å¾— $R_{view}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  x_{g \times t} &amp; y_{g \times t} &amp; z_{g \times t} &amp; 0 \<br>  x_t &amp; y_t &amp; z_t &amp; 0 \<br>  x_{-g} &amp; y_{-g} &amp; z_{-g} &amp; 0 \<br>  0 &amp; 0 &amp; 0 &amp; 1 \<br>  \end{pmatrix}<br>$$</p><h3 id="Projection"><a href="#Projection" class="headerlink" title="Projection"></a>Projection</h3><h4 id="Persprctive-to-Orthographic"><a href="#Persprctive-to-Orthographic" class="headerlink" title="Persprctive to Orthographic"></a>Persprctive to Orthographic</h4><h2 id="å¾—-y-frac-n-z-y-emsp-x-frac-n-z-x-æ•…-ä¸€ç‚¹-x-y-z-1-T-ä¹˜-M-p2o-ä¹‹åä¼šè¢«å˜æ¢è‡³ï¼š-begin-pmatrix-frac-nx-z-frac-ny-z-1-end-pmatrix-å³ï¼š-begin-pmatrix-nx-ny-z-end-pmatrix-æ‰€ä»¥ï¼š-M-p2o-begin-pmatrix-n-0-0-0-0-n-0-0-0-0-1-0-end-pmatrix"><a href="#å¾—-y-frac-n-z-y-emsp-x-frac-n-z-x-æ•…-ä¸€ç‚¹-x-y-z-1-T-ä¹˜-M-p2o-ä¹‹åä¼šè¢«å˜æ¢è‡³ï¼š-begin-pmatrix-frac-nx-z-frac-ny-z-1-end-pmatrix-å³ï¼š-begin-pmatrix-nx-ny-z-end-pmatrix-æ‰€ä»¥ï¼š-M-p2o-begin-pmatrix-n-0-0-0-0-n-0-0-0-0-1-0-end-pmatrix" class="headerlink" title="å¾— $y^, &#x3D; \frac{n}{z}y$;&emsp;$x^, &#x3D; \frac{n}{z}x$;æ•… ä¸€ç‚¹ $(x,y,z,1)^T$ ä¹˜ $M_{p2o}$ ä¹‹åä¼šè¢«å˜æ¢è‡³ï¼š$$  \begin{pmatrix}  \frac{nx}{z} \  \frac{ny}{z} \  ? \  1 \  \end{pmatrix}$$å³ï¼š$$  \begin{pmatrix}  nx \  ny \  ? \  z \  \end{pmatrix}$$æ‰€ä»¥ï¼š$M_{p2o} &#x3D;$$$  \begin{pmatrix}  n &amp; 0 &amp; 0 &amp; 0 \  0 &amp; n &amp; 0 &amp; 0 \  ? &amp; ? &amp; ? &amp; ? \  0 &amp; 0 &amp; 1 &amp; 0 \  \end{pmatrix}$$"></a><img src="/img/GAMES101/p2o.png"><br>å¾— $y^, &#x3D; \frac{n}{z}y$;&emsp;$x^, &#x3D; \frac{n}{z}x$;<br><div class="note note-secondary">            <p>åœ¨é½æ¬¡åæ ‡ç³»ä¸‹ï¼Œå¯¹ä¸€ä¸ªåæ ‡çš„æ‰€æœ‰å…ƒç´ ä¹˜ä»¥æˆ–é™¤ä»¥åŒä¸€ä¸ªæ•°ä»ç„¶ä»£è¡¨åŸæœ¬çš„åæ ‡ã€‚</p>          </div><br>æ•… ä¸€ç‚¹ $(x,y,z,1)^T$ ä¹˜ $M_{p2o}$ ä¹‹åä¼šè¢«å˜æ¢è‡³ï¼š<br>$$<br>  \begin{pmatrix}<br>  \frac{nx}{z} \<br>  \frac{ny}{z} \<br>  ? \<br>  1 \<br>  \end{pmatrix}<br>$$<br>å³ï¼š<br>$$<br>  \begin{pmatrix}<br>  nx \<br>  ny \<br>  ? \<br>  z \<br>  \end{pmatrix}<br>$$<br>æ‰€ä»¥ï¼š<br>$M_{p2o} &#x3D;$<br>$$<br>  \begin{pmatrix}<br>  n &amp; 0 &amp; 0 &amp; 0 \<br>  0 &amp; n &amp; 0 &amp; 0 \<br>  ? &amp; ? &amp; ? &amp; ? \<br>  0 &amp; 0 &amp; 1 &amp; 0 \<br>  \end{pmatrix}<br>$$</h2><p>åˆå› ä¸º fã€n å¹³é¢åœ¨å˜æ¢å z è½´ä¸å˜ï¼Œ<br>å³è¿‘å¹³é¢ä¸Šä¸€ç‚¹ $(x,y,n,1)^T$ ä¹˜ $(?,?,?,?)$ å¾— nï¼Œæˆ–è€…è¯´ï¼Œå¾— $n^2$ã€‚<br>å¾—ï¼š</p><ul><li>$(?,?,?,?)&#x3D;(0,0,A,B)$ ä¸” $An+B&#x3D;n^2$</li></ul><p>ä¸”è¿œå¹³é¢ä¸Šä¸­å¿ƒç‚¹ $(0,0,f,1)^T$ ä¹˜ $(0,0,A,B)$ å¾— fï¼Œæˆ–è€…è¯´ï¼Œå¾— $f^2$ã€‚<br>å¾—ï¼š</p><ul><li>$Af+B&#x3D;f^2$</li></ul><p>è”ç«‹å¾—ï¼š</p><ul><li>$(0,0,A,B)&#x3D;(0,0,n+f,-nf)$</li></ul><hr><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ$M_{p2o}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  n &amp; 0 &amp; 0 &amp; 0 \<br>  0 &amp; n &amp; 0 &amp; 0 \<br>  0 &amp; 0 &amp; n+f &amp; -nf \<br>  0 &amp; 0 &amp; 1 &amp; 0 \<br>  \end{pmatrix}<br>$$</p><h4 id="Orthographic"><a href="#Orthographic" class="headerlink" title="Orthographic"></a>Orthographic</h4><p>å°†è£å‰ªç©ºé—´è½¬åŒ–ä¸ºæ ‡å‡†åŒ–è®¾å¤‡åæ ‡ï¼Œä¸­å¿ƒä¸º (0, 0, 0)ï¼Œå¤§å°ä¸º 1x1x1 çš„ç«‹æ–¹ä½“ã€‚<br><img src="/img/GAMES101/cj.png"></p><div class="note note-secondary">            <p>æ³¨æ„è¿™é‡Œ l&lt;r&emsp;b&lt;t&emsp;f&gt;nã€‚</p>          </div><p>$M_{ortho}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  \frac{2}{r-l} &amp; 0 &amp; 0 &amp; -\frac{r+l}{2} \<br>  0 &amp; \frac{2}{t-b} &amp; 0 &amp; -\frac{t+b}{2} \<br>  0 &amp; 0 &amp; \frac{2}{n-f} &amp; -\frac{n+f}{2} \<br>  0 &amp; 0 &amp; 0 &amp; 1 \<br>  \end{pmatrix}<br>$$</p><h4 id="Projection-1"><a href="#Projection-1" class="headerlink" title="Projection"></a>Projection</h4><p>$M_{Projection}&#x3D;M_{Orthographic}M_{PersprctiveToOrthographic}$</p><h2 id="Viewport"><a href="#Viewport" class="headerlink" title="Viewport"></a>Viewport</h2><p>å…ˆå°†æ ‡å‡†åŒ–è®¾å¤‡åæ ‡æ‹‰ä¼¸è‡³ä¸å±å¹•åŒç­‰å¤§å°ï¼Œå†å°†å…¶ä¸­å¿ƒ(0, 0)ç§»è‡³å±å¹•ä¸­å¿ƒã€‚ä¿ç•™zè½´ä¸å˜ç”¨äºä¹‹ååšæ·±åº¦æ£€æµ‹ã€‚<br>$M_{viewport}&#x3D;$<br>$$<br>  \begin{pmatrix}<br>  \frac{width}{2} &amp; 0 &amp; 0 &amp; \frac{width}{2} \<br>  0 &amp; \frac{height}{2} &amp; 0 &amp; \frac{height}{2} \<br>  0 &amp; 0 &amp; 1 &amp; 0 \<br>  0 &amp; 0 &amp; 0 &amp; 1 \<br>  \end{pmatrix}<br>$$</p><h1 id="Super-Sample-Anti-Aliasing"><a href="#Super-Sample-Anti-Aliasing" class="headerlink" title="Super Sample Anti-Aliasing"></a>Super Sample Anti-Aliasing</h1><p>&emsp;&emsp;SSAA ä½œä¸ºä¸€ç§æš´åŠ›çš„è¶…é‡‡æ ·æ‰‹æ®µå¸¦æ¥çš„æ€§èƒ½å¼€é”€æ˜¯éš¾ä»¥æ¥å—çš„ï¼Œä½†ä½œä¸ºåèµ°æ ·çš„å…¥é—¨ä»ç„¶æœ‰å­¦ä¹ ä¸€ä¸‹çš„å¿…è¦ã€‚</p><h2 id="insideTriangle"><a href="#insideTriangle" class="headerlink" title="insideTriangle"></a>insideTriangle</h2><p><strong>åˆ¤æ–­ä¸¤å‘é‡çš„å·¦å³å…³ç³»</strong></p><p>å‡è®¾ä¸¤å‘é‡ $\vec{a}$ã€$\vec{b}$ åœ¨åŒä¸€ z è½´ä¸º 0 çš„å¹³é¢ä¸Šï¼Œæ ¹æ®å³æ‰‹èºæ—‹å®šåˆ™ï¼Œè‹¥ $\vec{a} \times \vec{b}$ çš„ z è½´å¤§äº 0 åˆ™ $\vec{b}$ åœ¨ $\vec{a}$ çš„å·¦ä¾§ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>é‚£ä¹ˆå¯¹äºä¸‰è§’å½¢ä¸‰ç‚¹å½¢æˆçš„é¡º\é€†æ—¶é’ˆä¸‰æ¡å‘é‡æ¥è¯´ï¼Œè‹¥æœ‰ä¸€ç‚¹åŒæ—¶ä½äºä¸‰å‘é‡çš„åŒä¸€ä¾§ï¼Œåˆ™è¯¥ç‚¹ä½äºä¸‰è§’å½¢å†…éƒ¨ã€‚</p><p>å‡è®¾ä¸‰è§’å½¢ä¸‰ç‚¹ aã€bã€c ä¸ç‚¹ p åœ¨åŒä¸€å¹³é¢ä¸Šã€‚<br>ä¸‰è§’å½¢ä¸‰ç‚¹æŒ‰é¡ºåºå½¢æˆä¸‰æ¡å‘é‡ $\vec{ab}$ã€$\vec{bc}$ã€$\vec{ca}$ï¼Œä¸ p ç‚¹å½¢æˆä¸‰å‘æ¡é‡ $\vec{ap}$ã€$\vec{bp}$ã€$\vec{cp}$ã€‚<br>å°†ä»–ä»¬åˆ†åˆ«å‰ä¹˜ï¼Œåˆ¤æ–­ç»“æœæ˜¯å¦åŒå·å³å¯åˆ¤æ–­ä¸‰è§’å½¢æ˜¯å¦åŒ…å›´ç‚¹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">insideTriangle</span><span class="hljs-params">(<span class="hljs-type">float</span> x, <span class="hljs-type">float</span> y, <span class="hljs-type">const</span> Vector3f* _v)</span> </span>&#123;<br><span class="hljs-function">Eigen::Vector3f <span class="hljs-title">p</span><span class="hljs-params">(x, y, <span class="hljs-number">0</span>)</span></span>;<br><span class="hljs-function">Eigen::Vector3f <span class="hljs-title">a</span><span class="hljs-params">(_v[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], _v[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], <span class="hljs-number">0</span>)</span></span>;<br><span class="hljs-function">Eigen::Vector3f <span class="hljs-title">b</span><span class="hljs-params">(_v[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], _v[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], <span class="hljs-number">0</span>)</span></span>;<br><span class="hljs-function">Eigen::Vector3f <span class="hljs-title">c</span><span class="hljs-params">(_v[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], _v[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], <span class="hljs-number">0</span>)</span></span>;<br><br>Eigen::Vector3f ab = b - a;<br>Eigen::Vector3f bc = c - b;<br>Eigen::Vector3f ca = a - c;<br><br>Eigen::Vector3f ap = p - a;<br>Eigen::Vector3f bp = p - b;<br>Eigen::Vector3f cp = p - c;<br><br>Eigen::Vector3f crs1 = ab.<span class="hljs-built_in">cross</span>(ap);<br>Eigen::Vector3f crs2 = bc.<span class="hljs-built_in">cross</span>(bp);<br>Eigen::Vector3f crs3 = ca.<span class="hljs-built_in">cross</span>(cp);<br><br><span class="hljs-keyword">return</span> ((crs1[<span class="hljs-number">2</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; crs2[<span class="hljs-number">2</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; crs3[<span class="hljs-number">2</span>] &gt;= <span class="hljs-number">0</span>) ||<br>(crs1[<span class="hljs-number">2</span>] &lt;= <span class="hljs-number">0</span> &amp;&amp; crs2[<span class="hljs-number">2</span>] &lt;= <span class="hljs-number">0</span> &amp;&amp; crs3[<span class="hljs-number">2</span>] &lt;= <span class="hljs-number">0</span>));<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="SSAA-zBuffer"><a href="#SSAA-zBuffer" class="headerlink" title="SSAA &amp; zBuffer"></a>SSAA &amp; zBuffer</h2><p>éå†åŒ…å›´ç›’å†…çš„åƒç´ ï¼Œå¯¹äºæ¯ä¸ªåƒç´ éå†æ¯ä¸ªè¶…é‡‡æ ·ç‚¹ï¼Œç¡®å®šä¸‰è§’å½¢è¦†ç›–åƒç´ çš„æ¯”ä¾‹ï¼Œé€šè¿‡é‡å¿ƒåæ ‡è®¡ç®—å¯¹åº”çš„æ·±åº¦å€¼ï¼Œä¸æ·±åº¦ç¼“å­˜åšæ¯”è¾ƒå¹¶å†™å…¥å¸§ç¼“å­˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">void</span> rst::rasterizer::<span class="hljs-built_in">rasterize_triangle</span>(<span class="hljs-type">const</span> Triangle&amp; t) &#123;<br><span class="hljs-keyword">auto</span> v = t.<span class="hljs-built_in">toVector4</span>();<br><br><span class="hljs-comment">// åŒ…å›´ç›’å¤§å°</span><br><span class="hljs-type">int</span> minX = (<span class="hljs-type">int</span>)std::<span class="hljs-built_in">floor</span>(std::<span class="hljs-built_in">min</span>(v[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], std::<span class="hljs-built_in">min</span>(v[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], v[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>])));<br><span class="hljs-type">int</span> maxX = (<span class="hljs-type">int</span>)std::<span class="hljs-built_in">ceil</span>(std::<span class="hljs-built_in">max</span>(v[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], std::<span class="hljs-built_in">max</span>(v[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], v[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>])));<br><span class="hljs-type">int</span> minY = (<span class="hljs-type">int</span>)std::<span class="hljs-built_in">floor</span>(std::<span class="hljs-built_in">min</span>(v[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], std::<span class="hljs-built_in">min</span>(v[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], v[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>])));<br><span class="hljs-type">int</span> maxY = (<span class="hljs-type">int</span>)std::<span class="hljs-built_in">ceil</span>(std::<span class="hljs-built_in">max</span>(v[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], std::<span class="hljs-built_in">max</span>(v[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], v[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>])));<br><br><span class="hljs-comment">// å››ä¸ªè¶…é‡‡æ ·ç‚¹çš„ç›¸å¯¹åæ ‡</span><br>std::vector&lt;Eigen::Vector2f&gt; super&#123;<br>&#123;<span class="hljs-number">0.25f</span>,<span class="hljs-number">0.25f</span>&#125;,<br>&#123;<span class="hljs-number">0.75f</span>,<span class="hljs-number">0.25f</span>&#125;,<br>&#123;<span class="hljs-number">0.25f</span>,<span class="hljs-number">0.75f</span>&#125;,<br>&#123;<span class="hljs-number">0.75f</span>,<span class="hljs-number">0.75f</span>&#125;,<br>&#125;;<br><br><span class="hljs-comment">// éå†åŒ…å›´ç›’å†…æ‰€æœ‰åƒç´ ç‚¹</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = minX; x &lt;= maxX; x++) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = minY; y &lt;= maxY; y++) &#123;<br><span class="hljs-type">int</span> insideCount = <span class="hljs-number">0</span>;<br><span class="hljs-type">float</span> sumDepth = <span class="hljs-number">0.f</span>;<br><br><span class="hljs-comment">// éå†åƒç´ ç‚¹å†…æ‰€æœ‰è¶…é‡‡æ ·ç‚¹</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">insideTriangle</span>((<span class="hljs-type">float</span>)x + super[i][<span class="hljs-number">0</span>],<br>(<span class="hljs-type">float</span>)y + super[i][<span class="hljs-number">1</span>], t.v)) &#123;<br>insideCount++;<br><br><span class="hljs-comment">// è®¡ç®—é‡å¿ƒåæ ‡</span><br><span class="hljs-keyword">auto</span> tup = <span class="hljs-built_in">computeBarycentric2D</span>(<br>(<span class="hljs-type">float</span>)x + super[i][<span class="hljs-number">0</span>], (<span class="hljs-type">float</span>)y + super[i][<span class="hljs-number">1</span>], t.v);<br><br><span class="hljs-type">float</span> alpha, beta, gamma;<br>std::<span class="hljs-built_in">tie</span>(alpha, beta, gamma) = tup;<br><br><span class="hljs-comment">// åˆ©ç”¨é‡å¿ƒåæ ‡è®¡ç®—æ·±åº¦æ’å€¼</span><br><span class="hljs-type">float</span> w_reciprocal = <span class="hljs-number">1.f</span> /<br>(alpha / v[<span class="hljs-number">0</span>].<span class="hljs-built_in">w</span>() + beta / v[<span class="hljs-number">1</span>].<span class="hljs-built_in">w</span>() + gamma / v[<span class="hljs-number">2</span>].<span class="hljs-built_in">w</span>());<br><span class="hljs-type">float</span> z_interpolated = alpha * v[<span class="hljs-number">0</span>].<span class="hljs-built_in">z</span>() / v[<span class="hljs-number">0</span>].<span class="hljs-built_in">w</span>() +<br>beta * v[<span class="hljs-number">1</span>].<span class="hljs-built_in">z</span>() / v[<span class="hljs-number">1</span>].<span class="hljs-built_in">w</span>() + gamma * v[<span class="hljs-number">2</span>].<span class="hljs-built_in">z</span>() / v[<span class="hljs-number">2</span>].<span class="hljs-built_in">w</span>();<br><br>z_interpolated *= w_reciprocal;<br>sumDepth += z_interpolated;<br>&#125;<br>&#125;<br><span class="hljs-keyword">if</span> (insideCount &gt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-type">float</span> avgDepth = sumDepth / <span class="hljs-number">4.f</span>;<br><span class="hljs-keyword">if</span> (avgDepth &lt; depth_buf[<span class="hljs-built_in">get_index</span>(x, y)]) &#123;<br>depth_buf[<span class="hljs-built_in">get_index</span>(x, y)] = avgDepth;<br><br><span class="hljs-function">Eigen::Vector3f <span class="hljs-title">point</span><span class="hljs-params">((<span class="hljs-type">float</span>)x, (<span class="hljs-type">float</span>)y, avgDepth)</span></span>;<br>Eigen::Vector3f color = t.<span class="hljs-built_in">getColor</span>() * insideCount / <span class="hljs-number">4.f</span>;<br><span class="hljs-built_in">set_pixel</span>(point, color);<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES101/null.png" alt="ä¸ä½¿ç”¨åèµ°æ ·"></div><div class="group-image-wrap"><img src="/img/GAMES101/ssaa.png" alt="SSAAx4"></div></div></div><h1 id="Blinn-Phong-å…‰ç…§æ¨¡å‹"><a href="#Blinn-Phong-å…‰ç…§æ¨¡å‹" class="headerlink" title="Blinn-Phong å…‰ç…§æ¨¡å‹"></a>Blinn-Phong å…‰ç…§æ¨¡å‹</h1><p>&emsp;&emsp;è¯¥æ¨¡å‹å°†ä»»ä¸€ç‚¹çš„å…‰ç…§åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š1.ç”±å…‰æºæ–¹å‘ä¸æ³•çº¿æ–¹å‘å†³å®šçš„æ¼«åå°„ã€2.ç”±å…‰æºæ–¹å‘æ³•çº¿æ–¹å‘ä¸è§‚å¯Ÿæ–¹å‘å†³å®šçš„é«˜å…‰ã€3.æ’å®šçš„ç¯å¢ƒå…‰ã€‚</p><h2 id="getColorBilinear"><a href="#getColorBilinear" class="headerlink" title="getColorBilinear"></a>getColorBilinear</h2><p><img src="/img/GAMES101/bi.png"><br>å¯¹è´´å›¾é‡‡æ ·æ—¶é‡‡ç”¨åŒçº¿æ€§æ’å€¼çš„æ–¹æ³•ä»¥è·å¾—æŸ”å’Œçš„è¿‡åº¦ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">Eigen::Vector3f <span class="hljs-title">getColorBilinear</span><span class="hljs-params">(<span class="hljs-type">float</span> u, <span class="hljs-type">float</span> v)</span> </span>&#123;<br><span class="hljs-keyword">if</span> (u &gt; <span class="hljs-number">1</span>) u = u - (<span class="hljs-type">int</span>)u;<br><span class="hljs-keyword">if</span> (u &lt; <span class="hljs-number">0</span>) u = u - (<span class="hljs-type">int</span>)u + <span class="hljs-number">1</span>;<br><span class="hljs-keyword">if</span> (v &gt; <span class="hljs-number">1</span>) v = v - (<span class="hljs-type">int</span>)v;<br><span class="hljs-keyword">if</span> (v &lt; <span class="hljs-number">0</span>) v = v - (<span class="hljs-type">int</span>)v + <span class="hljs-number">1</span>;<br><br><span class="hljs-type">float</span> u_img = u * width;<br><span class="hljs-type">float</span> v_img = (<span class="hljs-number">1</span> - v) * height;<br><br><span class="hljs-type">int</span> u_min = (<span class="hljs-type">int</span>)std::<span class="hljs-built_in">floor</span>(u_img);<br><span class="hljs-type">int</span> u_max = (<span class="hljs-type">int</span>)std::<span class="hljs-built_in">min</span>((<span class="hljs-type">float</span>)width, std::<span class="hljs-built_in">ceil</span>(u_img));<br><span class="hljs-type">int</span> v_min = (<span class="hljs-type">int</span>)std::<span class="hljs-built_in">floor</span>(v_img);<br><span class="hljs-type">int</span> v_max = (<span class="hljs-type">int</span>)std::<span class="hljs-built_in">min</span>((<span class="hljs-type">float</span>)height, std::<span class="hljs-built_in">ceil</span>(v_img));<br><br><span class="hljs-keyword">auto</span> u00 = image_data.<span class="hljs-built_in">at</span>&lt;cv::Vec3b&gt;(v_min, u_min);<br><span class="hljs-keyword">auto</span> u01 = image_data.<span class="hljs-built_in">at</span>&lt;cv::Vec3b&gt;(v_max, u_min);<br><span class="hljs-keyword">auto</span> u10 = image_data.<span class="hljs-built_in">at</span>&lt;cv::Vec3b&gt;(v_min, u_max);<br><span class="hljs-keyword">auto</span> u11 = image_data.<span class="hljs-built_in">at</span>&lt;cv::Vec3b&gt;(v_max, u_max);<br><br><span class="hljs-type">float</span> s = (u_img - u_min) / (u_max - u_min);<br><span class="hljs-type">float</span> t = (v_img - v_min) / (v_max - v_min);<br><br><span class="hljs-keyword">auto</span> u0 = (<span class="hljs-number">1</span> - s) * u00 + s * u10;<br><span class="hljs-keyword">auto</span> u1 = (<span class="hljs-number">1</span> - s) * u01 + s * u11;<br><span class="hljs-keyword">auto</span> p = (<span class="hljs-number">1</span> - t) * u0 + t * u1;<br><br><span class="hljs-keyword">return</span> Eigen::<span class="hljs-built_in">Vector3f</span>(p[<span class="hljs-number">0</span>], p[<span class="hljs-number">1</span>], p[<span class="hljs-number">2</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¸ƒæ—-å†¯"><a href="#å¸ƒæ—-å†¯" class="headerlink" title="å¸ƒæ—-å†¯"></a>å¸ƒæ—-å†¯</h2><p><img src="/img/Phong/phong.png"><br>å…¬å¼ä¸­çš„ k ä»£è¡¨æè´¨å¯¹å…‰çš„åå°„å¼ºåº¦ï¼Œå½“åˆ†åˆ«å¤„ç† k ä¸­ RBG ä¸‰é€šé“æ—¶å³å¯è¡¨ç¤ºä¸åŒé¢œè‰²ï¼Œå½“å°†è¯»å–åˆ°çš„è´´å›¾é¢œè‰²åº”ç”¨äº k æ—¶å³å¯æ˜¾ç¤ºè´´å›¾ã€‚<br>é«˜å…‰å…¬å¼ä¸­çš„ p ä»£è¡¨é«˜å…‰çš„é›†ä¸­ç¨‹åº¦ï¼Œç”±äº cos å‡½æ•°è¶‹å‘ 0 çš„é€Ÿåº¦è¿‡æ…¢ï¼Œå› æ­¤ä½¿ç”¨ cos çš„ p æ¬¡æ–¹ä½¿é«˜å…‰æ›´åŠ é›†ä¸­ã€‚p çš„å€¼ä¹Ÿå¯ä»¥å­˜åœ¨ä¸€å¼ è´´å›¾ä¸­ã€‚<br>I &#x2F; r2 ç”¨äºæ¨¡æ‹Ÿå…‰çº¿çš„è¡°å‡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">Eigen::Vector3f <span class="hljs-title">texture_fragment_shader</span><span class="hljs-params">(<span class="hljs-type">const</span> fragment_shader_payload&amp; payload)</span> </span>&#123;<br>Eigen::Vector3f texture_color = Eigen::Vector3f::<span class="hljs-built_in">Identity</span>();<br><span class="hljs-type">bool</span> isBilinear = <span class="hljs-literal">true</span>;<br><span class="hljs-keyword">if</span> (payload.texture) &#123;<br><span class="hljs-keyword">if</span> (isBilinear) &#123;<br>texture_color = payload.texture-&gt;<span class="hljs-built_in">getColorBilinear</span>(<br>payload.tex_coords.<span class="hljs-built_in">x</span>(), payload.tex_coords.<span class="hljs-built_in">y</span>());<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>texture_color = payload.texture-&gt;<span class="hljs-built_in">getColor</span>(<br>payload.tex_coords.<span class="hljs-built_in">x</span>(), payload.tex_coords.<span class="hljs-built_in">y</span>());<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// åå°„ç³»æ•°</span><br>Eigen::Vector3f kd = texture_color / <span class="hljs-number">255.f</span>;<br>Eigen::Vector3f ks = Eigen::<span class="hljs-built_in">Vector3f</span>(<span class="hljs-number">0.7937f</span>, <span class="hljs-number">0.7937f</span>, <span class="hljs-number">0.7937f</span>);<br>Eigen::Vector3f ka = Eigen::<span class="hljs-built_in">Vector3f</span>(<span class="hljs-number">0.01f</span>, <span class="hljs-number">0.01f</span>, <span class="hljs-number">0.01f</span>);<br><br><span class="hljs-comment">// å…‰æº</span><br><span class="hljs-keyword">auto</span> l1 = light&#123; &#123;<span class="hljs-number">20</span>, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>&#125;, &#123;<span class="hljs-number">500</span>, <span class="hljs-number">500</span>, <span class="hljs-number">500</span>&#125; &#125;;<br><span class="hljs-keyword">auto</span> l2 = light&#123; &#123;<span class="hljs-number">-20</span>, <span class="hljs-number">20</span>, <span class="hljs-number">0</span>&#125;, &#123;<span class="hljs-number">500</span>, <span class="hljs-number">500</span>, <span class="hljs-number">500</span>&#125; &#125;;<br><br><span class="hljs-type">float</span> p = <span class="hljs-number">200.0f</span>;<span class="hljs-comment">// å¹‚ç³»æ•°</span><br>std::vector&lt;light&gt; lights = &#123; l1, l2 &#125;;<span class="hljs-comment">// æ‰“åŒ…å…‰æº</span><br>Eigen::Vector3f amb_light_intensity&#123; <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span> &#125;;<span class="hljs-comment">// ç¯å¢ƒå…‰å¼ºåº¦</span><br>Eigen::Vector3f eye_pos&#123; <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span> &#125;;<span class="hljs-comment">// ç›¸æœºä½ç½®</span><br><br><span class="hljs-comment">// ç”¨äºè®¡ç®—çš„å‘é‡</span><br>Eigen::Vector3f point = payload.view_pos;<br>Eigen::Vector3f normal = payload.normal;<br>Eigen::Vector3f viewVector = eye_pos - point;<br><br>Eigen::Vector3f result_color = &#123; <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> &#125;;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; light : lights) &#123;<br>Eigen::Vector3f lightVector = light.position - point;<br><span class="hljs-type">float</span> r2 = lightVector.<span class="hljs-built_in">dot</span>(lightVector);<br><br><span class="hljs-comment">// æ¼«åå°„</span><br>Eigen::Vector3f ld = kd.<span class="hljs-built_in">cwiseProduct</span>(light.intensity) / r2 *<br>std::<span class="hljs-built_in">max</span>(<span class="hljs-number">0.f</span>, normal.<span class="hljs-built_in">dot</span>(lightVector.<span class="hljs-built_in">normalized</span>()));<br>result_color += ld;<br><br><span class="hljs-comment">// é«˜å…‰</span><br>Eigen::Vector3f vpl = viewVector.<span class="hljs-built_in">normalized</span>() + lightVector.<span class="hljs-built_in">normalized</span>();<br>Eigen::Vector3f h = vpl / vpl.<span class="hljs-built_in">norm</span>();<span class="hljs-comment">//åŠç¨‹å‘é‡</span><br>Eigen::Vector3f ls = ks.<span class="hljs-built_in">cwiseProduct</span>(light.intensity) / r2 *<br><span class="hljs-built_in">pow</span>(std::<span class="hljs-built_in">max</span>(<span class="hljs-number">0.f</span>, normal.<span class="hljs-built_in">dot</span>(h)), p);<br>result_color += ls;<br>&#125;<br><span class="hljs-comment">// ç¯å¢ƒå…‰</span><br>Eigen::Vector3f la = ka.<span class="hljs-built_in">cwiseProduct</span>(amb_light_intensity);<br>result_color += la;<br><br><span class="hljs-keyword">return</span> result_color * <span class="hljs-number">255.f</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»“æœ-1"><a href="#ç»“æœ-1" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p><img src="/img/GAMES101/01.png"></p><h1 id="Whitted-Style-å…‰çº¿è¿½è¸ª"><a href="#Whitted-Style-å…‰çº¿è¿½è¸ª" class="headerlink" title="Whitted-Style å…‰çº¿è¿½è¸ª"></a>Whitted-Style å…‰çº¿è¿½è¸ª</h1><p>&emsp;&emsp;Whitted_Style å…‰çº¿è¿½è¸ªçš„éƒ¨åˆ†å®ç°ï¼ŒåŒ…æ‹¬å°„çº¿ä¸ç”±é‡å¿ƒåæ ‡è¡¨å¼çš„ä¸‰è§’å½¢ç›¸äº¤ã€å°„çº¿ä¸è½´å¯¹é½åŒ…å›´ç›’çš„ç›¸äº¤ã€åŒ…å›´ç›’çš„æ ‘å½¢åŠ é€Ÿç»“æ„ã€‚</p><h2 id="Moller-Trumbore-å°„çº¿ä¸å¹³é¢ï¼ˆé‡å¿ƒåæ ‡ï¼‰"><a href="#Moller-Trumbore-å°„çº¿ä¸å¹³é¢ï¼ˆé‡å¿ƒåæ ‡ï¼‰" class="headerlink" title="MÃ¶ller-Trumbore å°„çº¿ä¸å¹³é¢ï¼ˆé‡å¿ƒåæ ‡ï¼‰"></a>MÃ¶ller-Trumbore å°„çº¿ä¸å¹³é¢ï¼ˆé‡å¿ƒåæ ‡ï¼‰</h2><p>å…‰çº¿çš„å®šä¹‰ï¼š</p><ul><li>$\vec{O}+t\vec{D}$</li></ul><p>å¹³é¢çš„å®šä¹‰ï¼š</p><ul><li>$(1-b_1-b_2)\vec{P}_0+b_1\vec{P}_1+b_2\vec{P}_2$</li></ul><p>æ±‚å°„çº¿ä¸å¹³é¢çš„äº¤ç‚¹å³è”ç«‹ä¸¤è¡¨è¾¾å¼æ±‚è§£ï¼Œå·²çŸ¥ xyz ä¸‰åˆ†é‡ä¸Šçš„ä¸‰å¯¹è¡¨è¾¾å¼ï¼Œæ±‚æœªçŸ¥é‡ï¼štã€$b_1$ã€$b_2$ã€‚<br><img src="/img/GAMES101/moller.png"></p><div class="note note-secondary">            <p>å¯¹äºç”¨é‡å¿ƒåæ ‡è¡¨ç¤ºçš„ä¸‰è§’å½¢ï¼Œä¸‰å€¼ä¹‹å’Œä¸º 1 å³å¯è¡¨ç¤ºå½“å‰å¹³é¢ä¸Šçš„ä»»ä¸€ç‚¹ï¼Œè‹¥åŒæ—¶ä¸‰å€¼å‡å¤§äº 1 åˆ™è¡¨ç¤ºè¯¥ä¸‰è§’å½¢å†…éƒ¨çš„ä¸€ç‚¹ã€‚</p>          </div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">rayTriangleIntersect</span><span class="hljs-params">(<span class="hljs-type">const</span> Vector3f&amp; v0, <span class="hljs-type">const</span> Vector3f&amp; v1, <span class="hljs-type">const</span> Vector3f&amp; v2,</span></span><br><span class="hljs-params"><span class="hljs-function"><span class="hljs-type">const</span> Vector3f&amp; orig, <span class="hljs-type">const</span> Vector3f&amp; dir)</span> </span>&#123;<br><br>Vector3f e1 = v1 - v0;<br>Vector3f e2 = v2 - v0;<br>Vector3f s = orig - v0;<br>Vector3f s1 = <span class="hljs-built_in">crossProduct</span>(dir, e2);<br>Vector3f s2 = <span class="hljs-built_in">crossProduct</span>(s, e1);<br><br><span class="hljs-type">float</span> factor = <span class="hljs-built_in">dotProduct</span>(s1, e1);<br><span class="hljs-type">float</span> t = <span class="hljs-built_in">dotProduct</span>(s2, e2) / factor;<br><span class="hljs-type">float</span> b1 = <span class="hljs-built_in">dotProduct</span>(s1, s) / factor;<br><span class="hljs-type">float</span> b2 = <span class="hljs-built_in">dotProduct</span>(s2, dir) / factor;<br><br><span class="hljs-keyword">if</span> (t &gt;= <span class="hljs-number">0</span> &amp;&amp; b1 &gt;= <span class="hljs-number">0</span> &amp;&amp; b2 &gt;= <span class="hljs-number">0</span> &amp;&amp; (<span class="hljs-number">1</span> - b1 - b2) &gt;= <span class="hljs-number">0</span>)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å°„çº¿ä¸å¹³é¢ï¼ˆç‚¹æ³•å¼ï¼‰"><a href="#å°„çº¿ä¸å¹³é¢ï¼ˆç‚¹æ³•å¼ï¼‰" class="headerlink" title="å°„çº¿ä¸å¹³é¢ï¼ˆç‚¹æ³•å¼ï¼‰"></a>å°„çº¿ä¸å¹³é¢ï¼ˆç‚¹æ³•å¼ï¼‰</h2><p>å¹³é¢çš„å®šä¹‰ï¼š</p><ul><li>$(\vec{P}-\vec{P^,})\cdot \vec{N}$</li></ul><p>ç‚¹ $P^,$ ä¸æ³•å‘é‡ N ç»„æˆä¸€å¹³é¢ï¼ŒP ä¸ºé¢ä¸Šä»»ä¸€ç‚¹ã€‚<br>å°†å°„çº¿ä»£å…¥ P å¾—</p><ul><li>$t&#x3D;\frac{(\vec{P^,}-\vec{O})\cdot \vec{N}}{\vec{D}\cdot \vec{N}}$</li></ul><h2 id="å°„çº¿ä¸è½´å¯¹é½åŒ…å›´ç›’"><a href="#å°„çº¿ä¸è½´å¯¹é½åŒ…å›´ç›’" class="headerlink" title="å°„çº¿ä¸è½´å¯¹é½åŒ…å›´ç›’"></a>å°„çº¿ä¸è½´å¯¹é½åŒ…å›´ç›’</h2><p>åŒ…å›´ç›’çš„å®šä¹‰ï¼špMax ä¸ pMin ä¸¤ä¸ªç‚¹æ‰€ä»£è¡¨çš„ä¸‰å¯¹é¢ã€‚<br>å°„çº¿ä¸è½´å¯¹é½å¹³é¢çš„ç›¸äº¤ï¼ˆä¾‹å¦‚xè½´ï¼‰ï¼š</p><ul><li>$t&#x3D;\frac{\vec{P^,_x}-\vec{O_x}}{\vec{D_x}}$</li></ul><p>å¯¹äºæ¯ä¸€å¯¹å¹³é¢ï¼Œå°„çº¿å­˜åœ¨ä¸€å¯¹ä¸ä»–ä»¬ç›¸äº¤çš„ $t_{min}$ ä¸ $t_{max}$<br>å°„çº¿è¿›å…¥åŒ…å›´ç›’ï¼šå°„çº¿è¿›å…¥æ‰€æœ‰ä¸‰å¯¹é¢ï¼›å°„çº¿ç¦»å¼€åŒ…å›´ç›’ï¼šå°„çº¿ç¦»å¼€ä»»ä¸€é¢ã€‚</p><ul><li>$t_{enter}&#x3D;max(t_{min})$ã€$t_{exit}&#x3D;min(t_{max})$</li></ul><p>å°„çº¿ä¸åŒ…å›´ç›’æœ‰ä¸€æ®µç›¸äº¤ï¼š$t_{enter}&lt;t_{exit}$</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;limits&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">bool</span> <span class="hljs-title">Bounds3::IntersectP</span><span class="hljs-params">(<span class="hljs-type">const</span> Ray&amp; ray, <span class="hljs-type">const</span> Vector3f&amp; invDir,</span></span><br><span class="hljs-params"><span class="hljs-function"><span class="hljs-type">const</span> std::array&lt;<span class="hljs-type">bool</span>, <span class="hljs-number">3</span>&gt;&amp; dirIsNeg)</span> <span class="hljs-type">const</span> </span>&#123;<br><br><span class="hljs-comment">/* invDir: ray direction(x,y,z), invDir=(1.0/x,1.0/y,1.0/z),</span><br><span class="hljs-comment">   use this because Multiply is faster that Division */</span><br><span class="hljs-comment">/* dirIsNeg: ray direction(x,y,z), dirIsNeg=[int(x&gt;0),int(y&gt;0),int(z&gt;0)],</span><br><span class="hljs-comment">   use this to simplify your logic */</span><br><br><span class="hljs-type">float</span> tEnter = std::numeric_limits&lt;<span class="hljs-type">float</span>&gt;::<span class="hljs-built_in">lowest</span>();<br><span class="hljs-type">float</span> tExit = std::numeric_limits&lt;<span class="hljs-type">float</span>&gt;::<span class="hljs-built_in">max</span>();<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br><span class="hljs-type">float</span> tMin = (pMin[i] - ray.origin[i]) * invDir[i];<br><span class="hljs-type">float</span> tMax = (pMax[i] - ray.origin[i]) * invDir[i];<br><span class="hljs-comment">/* å¦‚æœå…‰çº¿æ²¿è´Ÿæ–¹å‘ä¼ æ’­ï¼Œå…‰çº¿ä¼šå…ˆæ’ä¸ŠpMaxçš„å¯¹åº”çš„ç»´åº¦å¾—åˆ°tMaxï¼Œ</span><br><span class="hljs-comment">   è€Œæ­¤tåº”æ˜¯å…‰çº¿è¿›å…¥åŒ…å›´ç›’æ—¶çš„tMinã€‚å‡ºåŒ…å›´ç›’æ—¶åŒç†ã€‚*/</span><br><span class="hljs-keyword">if</span> (dirIsNeg[i]) &#123;<br>std::<span class="hljs-built_in">swap</span>(tMin, tMax);<br>&#125;<br><span class="hljs-keyword">if</span> (tMin &gt; tEnter) &#123;<br>tEnter = tMin;<br>&#125;<br><span class="hljs-keyword">if</span> (tMax &lt; tExit) &#123;<br>tExit = tMax;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> (tEnter &lt; tExit &amp;&amp; tExit &gt;= <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="BVH-çš„åˆ›å»º"><a href="#BVH-çš„åˆ›å»º" class="headerlink" title="BVH çš„åˆ›å»º"></a>BVH çš„åˆ›å»º</h2><p>è½´å¯¹é½åŒ…å›´ç›’çš„åŠ é€Ÿç»“æ„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">BVHBuildNode* <span class="hljs-title">BVHAccel::recursiveBuild</span><span class="hljs-params">(std::vector&lt;Object*&gt; objects)</span> </span>&#123;<br>BVHBuildNode* node = <span class="hljs-keyword">new</span> <span class="hljs-built_in">BVHBuildNode</span>();<br><br>Bounds3 bounds;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; objects.<span class="hljs-built_in">size</span>(); ++i)<br>bounds = <span class="hljs-built_in">Union</span>(bounds, objects[i]-&gt;<span class="hljs-built_in">getBounds</span>());<br><span class="hljs-keyword">if</span> (objects.<span class="hljs-built_in">size</span>() == <span class="hljs-number">1</span>) &#123;<br><span class="hljs-comment">// åˆ›å»ºå¶èŠ‚ç‚¹</span><br>node-&gt;bounds = objects[<span class="hljs-number">0</span>]-&gt;<span class="hljs-built_in">getBounds</span>();<br>node-&gt;object = objects[<span class="hljs-number">0</span>];<br>node-&gt;left = <span class="hljs-literal">nullptr</span>;<br>node-&gt;right = <span class="hljs-literal">nullptr</span>;<br><span class="hljs-keyword">return</span> node;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (objects.<span class="hljs-built_in">size</span>() == <span class="hljs-number">2</span>) &#123;<br>node-&gt;left = <span class="hljs-built_in">recursiveBuild</span>(std::vector&#123;objects[<span class="hljs-number">0</span>]&#125;);<br>node-&gt;right = <span class="hljs-built_in">recursiveBuild</span>(std::vector&#123;objects[<span class="hljs-number">1</span>]&#125;);<br><br>node-&gt;bounds = <span class="hljs-built_in">Union</span>(node-&gt;left-&gt;bounds, node-&gt;right-&gt;bounds);<br><span class="hljs-keyword">return</span> node;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>Bounds3 centroidBounds;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; objects.<span class="hljs-built_in">size</span>(); ++i)<br>centroidBounds = <span class="hljs-built_in">Union</span>(centroidBounds, objects[i]-&gt;<span class="hljs-built_in">getBounds</span>().<span class="hljs-built_in">Centroid</span>());<br><span class="hljs-comment">// è¿”å›åŒ…å›´ç›’å¤§è‡´çš„å½¢çŠ¶ä»¥å†³å®šæ¥ä¸‹æ¥ä»¥å“ªä¸ªè½´åˆ†å‰²åŒ…å›´ç›’</span><br><span class="hljs-type">int</span> dim = centroidBounds.<span class="hljs-built_in">maxExtent</span>();<br><span class="hljs-keyword">switch</span> (dim) &#123;<br><span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>std::<span class="hljs-built_in">sort</span>(objects.<span class="hljs-built_in">begin</span>(), objects.<span class="hljs-built_in">end</span>(), [](<span class="hljs-keyword">auto</span> f1, <span class="hljs-keyword">auto</span> f2) &#123;<br><span class="hljs-keyword">return</span> f1-&gt;<span class="hljs-built_in">getBounds</span>().<span class="hljs-built_in">Centroid</span>().x &lt;<br>f2-&gt;<span class="hljs-built_in">getBounds</span>().<span class="hljs-built_in">Centroid</span>().x;<br>&#125;);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>std::<span class="hljs-built_in">sort</span>(objects.<span class="hljs-built_in">begin</span>(), objects.<span class="hljs-built_in">end</span>(), [](<span class="hljs-keyword">auto</span> f1, <span class="hljs-keyword">auto</span> f2) &#123;<br><span class="hljs-keyword">return</span> f1-&gt;<span class="hljs-built_in">getBounds</span>().<span class="hljs-built_in">Centroid</span>().y &lt;<br>f2-&gt;<span class="hljs-built_in">getBounds</span>().<span class="hljs-built_in">Centroid</span>().y;<br>&#125;);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>std::<span class="hljs-built_in">sort</span>(objects.<span class="hljs-built_in">begin</span>(), objects.<span class="hljs-built_in">end</span>(), [](<span class="hljs-keyword">auto</span> f1, <span class="hljs-keyword">auto</span> f2) &#123;<br><span class="hljs-keyword">return</span> f1-&gt;<span class="hljs-built_in">getBounds</span>().<span class="hljs-built_in">Centroid</span>().z &lt;<br>f2-&gt;<span class="hljs-built_in">getBounds</span>().<span class="hljs-built_in">Centroid</span>().z;<br>&#125;);<br><span class="hljs-keyword">break</span>;<br>&#125;<br><br><span class="hljs-keyword">auto</span> beginning = objects.<span class="hljs-built_in">begin</span>();<br><span class="hljs-keyword">auto</span> middling = objects.<span class="hljs-built_in">begin</span>() + (objects.<span class="hljs-built_in">size</span>() / <span class="hljs-number">2</span>);<br><span class="hljs-keyword">auto</span> ending = objects.<span class="hljs-built_in">end</span>();<br><br><span class="hljs-keyword">auto</span> leftshapes = std::<span class="hljs-built_in">vector</span>&lt;Object*&gt;(beginning, middling);<br><span class="hljs-keyword">auto</span> rightshapes = std::<span class="hljs-built_in">vector</span>&lt;Object*&gt;(middling, ending);<br><br><span class="hljs-built_in">assert</span>(objects.<span class="hljs-built_in">size</span>() == (leftshapes.<span class="hljs-built_in">size</span>() + rightshapes.<span class="hljs-built_in">size</span>()));<br><br>node-&gt;left = <span class="hljs-built_in">recursiveBuild</span>(leftshapes);<br>node-&gt;right = <span class="hljs-built_in">recursiveBuild</span>(rightshapes);<br><br>node-&gt;bounds = <span class="hljs-built_in">Union</span>(node-&gt;left-&gt;bounds, node-&gt;right-&gt;bounds);<br>&#125;<br><br><span class="hljs-keyword">return</span> node;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="BVH-çš„åˆ›å»ºï¼ˆASHï¼‰"><a href="#BVH-çš„åˆ›å»ºï¼ˆASHï¼‰" class="headerlink" title="BVH çš„åˆ›å»ºï¼ˆASHï¼‰"></a>BVH çš„åˆ›å»ºï¼ˆASHï¼‰</h2><p>è¡¨é¢ç§¯å¯å‘å¼ç®—æ³•åŸºäºä¸¤ä¸ªå‡è®¾ï¼šå¦‚æœåŒ…å›´ç›’çš„è¡¨é¢ç§¯è¶Šå¤§ï¼Œé‚£ä¹ˆå®ƒè¢«å°„çº¿å‡»ä¸­çš„å¯èƒ½æ€§ä¹Ÿå°±è¶Šå¤§ã€‚åŒ…å›´ç›’å†…çš„ç‰©ä½“æ•°é‡è¶Šå¤šï¼Œéå†å®ƒçš„å¼€é”€å°±è¶Šå¤§ã€‚æ¯”è¾ƒæ‰€æœ‰åˆ’åˆ†æ–¹æ¡ˆçš„é¢„è®¡å¼€é”€å¹¶é€‰æ‹©æœ€ä¼˜çš„æ–¹æ¡ˆã€‚<br>å¼€é”€ï¼š<code>float cost = 1 + (countA * A.SurfaceArea() + countB * B.SurfaceArea()) / nArea;</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-function">BVHBuildNode* <span class="hljs-title">BVHAccel::recursiveBuild</span><span class="hljs-params">(std::vector&lt;Object*&gt; objects)</span> </span>&#123;<br>BVHBuildNode* node = <span class="hljs-keyword">new</span> <span class="hljs-built_in">BVHBuildNode</span>();<br><br>Bounds3 bounds;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; objects.<span class="hljs-built_in">size</span>(); ++i) &#123;<br>bounds = <span class="hljs-built_in">Union</span>(bounds, objects[i]-&gt;<span class="hljs-built_in">getBounds</span>());<br>&#125;<br><span class="hljs-keyword">if</span> (objects.<span class="hljs-built_in">size</span>() == <span class="hljs-number">1</span>) &#123;<br><span class="hljs-comment">// åˆ›å»ºå¶èŠ‚ç‚¹</span><br>node-&gt;bounds = objects[<span class="hljs-number">0</span>]-&gt;<span class="hljs-built_in">getBounds</span>();<br>node-&gt;object = objects[<span class="hljs-number">0</span>];<br>node-&gt;left = <span class="hljs-literal">nullptr</span>;<br>node-&gt;right = <span class="hljs-literal">nullptr</span>;<br><span class="hljs-keyword">return</span> node;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (objects.<span class="hljs-built_in">size</span>() == <span class="hljs-number">2</span>) &#123;<br>node-&gt;left = <span class="hljs-built_in">recursiveBuild</span>(std::vector&#123;objects[<span class="hljs-number">0</span>]&#125;);<br>node-&gt;right = <span class="hljs-built_in">recursiveBuild</span>(std::vector&#123;objects[<span class="hljs-number">1</span>]&#125;);<br><br>node-&gt;bounds = <span class="hljs-built_in">Union</span>(node-&gt;left-&gt;bounds, node-&gt;right-&gt;bounds);<br><span class="hljs-keyword">return</span> node;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>Bounds3 centroidBounds;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; objects.<span class="hljs-built_in">size</span>(); ++i) &#123;<br>centroidBounds = <span class="hljs-built_in">Union</span>(centroidBounds,objects[i]-&gt;<span class="hljs-built_in">getBounds</span>().<span class="hljs-built_in">Centroid</span>());<br>&#125;<br>std::vector&lt;Object*&gt; leftshapes;<br>std::vector&lt;Object*&gt; rightshapes;<br><br>Bounds3 nBounds;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; objects.<span class="hljs-built_in">size</span>(); ++i) &#123;<br>nBounds = <span class="hljs-built_in">Union</span>(nBounds, objects[i]-&gt;<span class="hljs-built_in">getBounds</span>());<br>&#125;<br><span class="hljs-type">float</span> nArea = centroidBounds.<span class="hljs-built_in">SurfaceArea</span>();<br><br><span class="hljs-type">int</span> minCostCoor = <span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> mincostIndex = <span class="hljs-number">0</span>;<br><span class="hljs-type">float</span> minCost = std::numeric_limits&lt;<span class="hljs-type">float</span>&gt;::<span class="hljs-built_in">infinity</span>();<br>std::map&lt;<span class="hljs-type">int</span>, std::map&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt;&gt; indexMap;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br><span class="hljs-type">int</span> bucketCount = <span class="hljs-number">12</span>;<br>std::vector&lt;Bounds3&gt; boundsBuckets;<br>std::vector&lt;<span class="hljs-type">int</span>&gt; countBucket;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; bucketCount; j++) &#123;<br>boundsBuckets.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">Bounds3</span>());<br>countBucket.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br>std::map&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt; objMap;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; objects.<span class="hljs-built_in">size</span>(); j++) &#123;<br><span class="hljs-type">int</span> bid = bucketCount * centroidBounds.<span class="hljs-built_in">Offset</span>(<br>objects[j]-&gt;<span class="hljs-built_in">getBounds</span>().<span class="hljs-built_in">Centroid</span>())[i];<br><br><span class="hljs-keyword">if</span> (bid &gt; bucketCount - <span class="hljs-number">1</span>) &#123;<br>bid = bucketCount - <span class="hljs-number">1</span>;<br>&#125;<br>Bounds3 b = boundsBuckets[bid];<br>b = <span class="hljs-built_in">Union</span>(b, objects[j]-&gt;<span class="hljs-built_in">getBounds</span>().<span class="hljs-built_in">Centroid</span>());<br>boundsBuckets[bid] = b;<br>countBucket[bid] = countBucket[bid] + <span class="hljs-number">1</span>;<br>objMap.<span class="hljs-built_in">insert</span>(std::<span class="hljs-built_in">make_pair</span>(j, bid));<br>&#125;<br><br>indexMap.<span class="hljs-built_in">insert</span>(std::<span class="hljs-built_in">make_pair</span>(i, objMap));<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt; boundsBuckets.<span class="hljs-built_in">size</span>(); j++) &#123;<br>Bounds3 A;<br>Bounds3 B;<br><span class="hljs-type">int</span> countA = <span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> countB = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt; j; k++) &#123;<br>A = <span class="hljs-built_in">Union</span>(A, boundsBuckets[k]);<br>countA += countBucket[k];<br>&#125;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k = j; k &lt; boundsBuckets.<span class="hljs-built_in">size</span>(); k++) &#123;<br>B = <span class="hljs-built_in">Union</span>(B, boundsBuckets[k]);<br>countB += countBucket[k];<br>&#125;<br><br><span class="hljs-type">float</span> cost = <span class="hljs-number">1</span> + (countA * A.<span class="hljs-built_in">SurfaceArea</span>() +<br>countB * B.<span class="hljs-built_in">SurfaceArea</span>()) / nArea;<br><br><span class="hljs-keyword">if</span> (cost &lt; minCost) &#123;<br>minCost = cost;<br>mincostIndex = j;<br>minCostCoor = i;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; objects.<span class="hljs-built_in">size</span>(); i++) &#123;<br><span class="hljs-keyword">if</span> (indexMap[minCostCoor][i] &lt; mincostIndex) &#123;<br>leftshapes.<span class="hljs-built_in">push_back</span>(objects[i]);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>rightshapes.<span class="hljs-built_in">push_back</span>(objects[i]);<br>&#125;<br>&#125;<br><br><span class="hljs-built_in">assert</span>(objects.<span class="hljs-built_in">size</span>() == (leftshapes.<span class="hljs-built_in">size</span>() + rightshapes.<span class="hljs-built_in">size</span>()));<br><br>node-&gt;left = <span class="hljs-built_in">recursiveBuild</span>(leftshapes);<br>node-&gt;right = <span class="hljs-built_in">recursiveBuild</span>(rightshapes);<br><br>node-&gt;bounds = <span class="hljs-built_in">Union</span>(node-&gt;left-&gt;bounds, node-&gt;right-&gt;bounds);<br>&#125;<br><br><span class="hljs-keyword">return</span> node;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="BVH-çš„éå†"><a href="#BVH-çš„éå†" class="headerlink" title="BVH çš„éå†"></a>BVH çš„éå†</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">Intersection <span class="hljs-title">BVHAccel::getIntersection</span><span class="hljs-params">(BVHBuildNode* node, <span class="hljs-type">const</span> Ray&amp; ray)</span> <span class="hljs-type">const</span> </span>&#123;<br>Intersection inter;<br><br><span class="hljs-type">float</span> x = ray.direction.x;<br><span class="hljs-type">float</span> y = ray.direction.y;<br><span class="hljs-type">float</span> z = ray.direction.z;<br>std::array&lt;<span class="hljs-type">bool</span>, 3&gt; dirsIsNeg&#123;x &lt; <span class="hljs-number">0</span>,y &lt; <span class="hljs-number">0</span>,z &lt; <span class="hljs-number">0</span>&#125;;<br><span class="hljs-comment">// ä¸æ­¤èŠ‚ç‚¹çš„åŒ…å›´ç›’ä¸ç›¸äº¤</span><br><span class="hljs-keyword">if</span> (node-&gt;bounds.<span class="hljs-built_in">IntersectP</span>(ray, ray.direction_inv, dirsIsNeg) == <span class="hljs-literal">false</span>) &#123;<br><span class="hljs-keyword">return</span> inter;<br>&#125;<br><span class="hljs-comment">// éå†åˆ°å¶èŠ‚ç‚¹</span><br><span class="hljs-keyword">if</span> (node-&gt;left == <span class="hljs-literal">nullptr</span> &amp;&amp; node-&gt;right == <span class="hljs-literal">nullptr</span>)     &#123;<br>inter = node-&gt;object-&gt;<span class="hljs-built_in">getIntersection</span>(ray);<br><span class="hljs-keyword">return</span> inter;<br>&#125;<br>Intersection hitL = <span class="hljs-built_in">getIntersection</span>(node-&gt;left, ray);<br>Intersection hitR = <span class="hljs-built_in">getIntersection</span>(node-&gt;right, ray);<br><br><span class="hljs-keyword">if</span> (hitL.distance &lt; hitR.distance) &#123;<br><span class="hljs-keyword">return</span> hitL;<br>&#125;<br><br><span class="hljs-keyword">return</span> hitR;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»“æœ-2"><a href="#ç»“æœ-2" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p><img src="/img/GAMES101/01.png"></p><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p><a href="https://blog.csdn.net/qq_36242312/article/details/115495482">å‚è€ƒ</a></p><h1 id="è’™ç‰¹å¡æ´›è·¯å¾„è¿½è¸ª"><a href="#è’™ç‰¹å¡æ´›è·¯å¾„è¿½è¸ª" class="headerlink" title="è’™ç‰¹å¡æ´›è·¯å¾„è¿½è¸ª"></a>è’™ç‰¹å¡æ´›è·¯å¾„è¿½è¸ª</h1><p>&emsp;&emsp;æˆ‘ä»¬åœ¨ä¸Šä¸€ç« ä¸­å¾—åˆ°äº†é‡è¦çš„æ¸²æŸ“æ–¹ç¨‹ï¼Œåœ¨è¿™ä¸€ç« ä¸­å°†ä½¿ç”¨è’™ç‰¹å¡æ´›ç®—æ³•å®ç°æ–¹ç¨‹ä¸­çš„ç§¯åˆ†ï¼Œå¹¶ç”¨ä¿„ç½—æ–¯è½®ç›˜èµŒå®ç°é—´æ¥å…‰ç…§ä¸­å¯¹æ¸²æŸ“æ–¹ç¨‹çš„é€’å½’è°ƒç”¨ã€‚</p><h2 id="è’™ç‰¹å¡æ´›"><a href="#è’™ç‰¹å¡æ´›" class="headerlink" title="è’™ç‰¹å¡æ´›"></a>è’™ç‰¹å¡æ´›</h2><p>æŒ‰ä¸€å®šåˆ†å¸ƒå¯¹åŸå‡½æ•°è¿›è¡Œéšæœºé‡‡æ ·ï¼Œåˆ©ç”¨æ¦‚ç‡åˆ†å¸ƒå‡½æ•°è¿›è¡ŒåŠ æƒå¹³å‡ã€‚</p><ul><li>$\int f(x){\rm d}x&#x3D;\frac{1}{N}\sum^{N}_{i&#x3D;1}\frac{f(X_i)}{p^,(X_i)}$&emsp;$X_i$~$p^,(x)$</li><li>$L_o(p,\omega_o)\approx \frac{1}{N}\sum^{N}_{i&#x3D;1}\frac{L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)(n\cdot \omega_i)}{p^,(\omega_i)}$<br><img src="/img/GAMES101/monte.png" alt="è’™ç‰¹å¡æ´›"><br>å°†å®šç§¯åˆ†æ±‚è§£è½¬åŒ–ä¸ºå¯¹éšæœºå˜é‡æ±‚å¹³å‡ã€‚<br>å½“æˆ‘ä»¬å¯¹åŠçƒè¿›è¡Œå‡åŒ€é‡‡æ ·æ—¶ï¼š$p^,(\omega_i)&#x3D;\frac{\pi}{2}$</li></ul><h2 id="è·¯å¾„è¿½è¸ª"><a href="#è·¯å¾„è¿½è¸ª" class="headerlink" title="è·¯å¾„è¿½è¸ª"></a>è·¯å¾„è¿½è¸ª</h2><p>è‹¥è®¡ç®—æ¯æ ¹å…‰çº¿åå°„å‡ºçš„Nè·Ÿå…‰çº¿ï¼Œé€’å½’æ¬¡æ•°å‘ˆæŒ‡æ•°çº§ä¸Šæ¶¨ï¼Œå¼€é”€éš¾ä»¥æ¥å—ã€‚<br><strong>è§£å†³æ–¹æ³•</strong>ï¼šå¯¹ä¸€ä¸ªåƒç´ å†…å¤šæ¬¡å‘å°„å‡ºä¸€æ ¹å…‰çº¿ï¼Œæ¯æ¬¡åå°„åªäº§ç”Ÿä¸€æ ¹å…‰çº¿ï¼Œç»“æœæ±‚å¹³å‡ã€‚æ­¤æ—¶ä¸Šæ–¹çš„N &#x3D; 1ã€‚</p><h2 id="ä¿„ç½—æ–¯è½®ç›˜èµŒ"><a href="#ä¿„ç½—æ–¯è½®ç›˜èµŒ" class="headerlink" title="ä¿„ç½—æ–¯è½®ç›˜èµŒ"></a>ä¿„ç½—æ–¯è½®ç›˜èµŒ</h2><p>æ¥ä¸‹æ¥è§£å†³é€’å½’å¦‚ä½•è¿”å›çš„é—®é¢˜ã€‚åœ¨çœŸå®ä¸–ç•Œä¸­çš„å…‰çº¿å¯èƒ½ä¼šç»è¿‡æ— æ•°æ¬¡å¼¹å°„æ‰è¿›å…¥äººçœ¼ï¼Œä½†åœ¨æœ‰é™çš„è®¡ç®—æ—¶é—´å†…è¿™å‡ ä¹æ˜¯æ— æ³•æ¨¡æ‹Ÿçš„ã€‚<br><strong>è§£å†³æ–¹æ³•</strong>ï¼šä»¥æœŸæœ›ä»£æ›¿æ— é™æ¬¡é€’å½’é€¼è¿‘çš„ç»“æœã€‚è®¾ä¸€å°æ•° p(0,1)ï¼Œæ¯æ¬¡é€’å½’å†…ä»¥æ¦‚ç‡ (p - 1) ç›´æ¥è¿”å› 0ï¼Œä»¥æ¦‚ç‡ p è¿›å…¥ä¸‹ä¸€å±‚é€’å½’ï¼Œå¹¶å¯¹ç»“æœé™¤ä»¥ pã€‚æ­¤æ—¶é€’å½’çš„æœŸæœ›ä¸ºï¼š</p><ul><li>$E&#x3D;P*(L_o&#x2F;P)+(1-P)*0&#x3D;L_o$<div class="note note-secondary">            <p>é€’å½’çš„æœŸæœ›å€¼ç¡®å®æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯æ ¹æ®å®ç°çš„ä¸åŒï¼Œæˆ–è€…å—åˆ¶äºæ˜¾ç¤ºå™¨è‰²åŸŸï¼Œè¶…è¿‡ 255 çš„å€¼å¯èƒ½è¢«æˆªæ–­è‡³ 255ï¼Œå¯¼è‡´ç»“æœçœ‹èµ·æ¥åæš—ã€‚</p>          </div></li></ul><h2 id="æœ€åä¸€ä¸ªé—®é¢˜"><a href="#æœ€åä¸€ä¸ªé—®é¢˜" class="headerlink" title="æœ€åä¸€ä¸ªé—®é¢˜"></a>æœ€åä¸€ä¸ªé—®é¢˜</h2><p>åœ¨ç›®å‰çš„ç®—æ³•ä¸­ï¼Œä»è§†ç‚¹å‘å°„å‡ºçš„ä¸€æ ¹å…‰çº¿è‹¥ç›´åˆ°æœ€ç»ˆéƒ½æ²¡æœ‰å‡»ä¸­å‘å…‰ç‰©ä½“ä¾¿ä¸ä¼šè¿”å›ä»»ä½• Radianceã€‚è¿™æ ·åœ¨åœºæ™¯ä¸­å…‰æºè¡¨é¢ç§¯éå¸¸å°çš„æƒ…å†µä¸‹ä¾¿å¾ˆéš¾äº§ç”Ÿæœ‰æ•ˆçš„é€’å½’ï¼Œå› ä¸ºå¯¹åŠçƒå†…æ–¹å‘éšæœºé‡‡æ ·éš¾ä»¥ç²¾ç¡®é‡‡æ ·åˆ°å‘å…‰ç‰©ä½“ã€‚<br><strong>è§£å†³æ–¹æ³•</strong>ï¼šæ¯å±‚é€’å½’å†…å°†ç›´æ¥å…‰ç…§ä¸é—´æ¥å…‰ç…§çš„è´¡çŒ®åˆ†ç¦»å¼€ï¼Œå¹¶ç›´æ¥å¯¹å…‰æºè¿›è¡Œé‡‡æ ·ã€‚è¿™æ—¶éœ€è¦å°†å…‰æºæ–¹å‘$\omega$è½¬æ¢ä¸ºå…‰æºåœ¨å•ä½çƒé¢ä¸Šå¯¹åº”çš„é¢ç§¯ Aï¼Œç„¶åå¯¹ A åšç§¯åˆ†ï¼Œæ­¤æ—¶çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸º $\frac{1}{A}$<br><img src="/img/GAMES101/wa.png"></p><ul><li>$d\omega&#x3D;\frac{\cos \theta^,dA}{|x^,-x|^2}$</li></ul><p><em>å¯ä»¥ç†è§£ä¸º $\cos \theta^,$ è´Ÿè´£æŠŠå…‰æºçš„é¢ç§¯è½¬è¿‡æ¥åšä¸ºä¸€ä¸ªé”¥ä½“çš„åº•éƒ¨ï¼Œå†æ ¹æ®ç›¸ä¼¼ä¸‰è§’å½¢åŸç†å°†é¢ç§¯ç¼©æ”¾åˆ°å•ä½çƒé¢ä¸Šã€‚</em><br>å…‰æºå¯¹å•ä½é¢ç§¯çš„è´¡çŒ®ä¸ºï¼š</p><ul><li>$L_o(x,\omega_o)&#x3D;\int_ALi(x,\omega_i)f_r(x,\omega_i,\omega_o)\frac{\cos \theta \cos \theta^,}{|x^,-x|^2}{\rm d}A$</li></ul><h2 id="ä¼ªä»£ç "><a href="#ä¼ªä»£ç " class="headerlink" title="ä¼ªä»£ç "></a>ä¼ªä»£ç </h2><p>Shad(p, wo) {<br>&emsp;&emsp;å¯¹å…‰æºé‡‡æ · ï¼ˆpdf_light &#x3D; 1 &#x2F; Aï¼‰<br>&emsp;&emsp;if (pç‚¹ä¸å…‰æºé—´æ— é®æŒ¡)<br>&emsp;&emsp;&emsp;&emsp;L_dir &#x3D; Li * f_r * cos$\theta$ * cos$\theta^,$ &#x2F; $|x^,-p|^2$ &#x2F; pdf_light<br>&emsp;&emsp;ä¿„ç½—æ–¯è½®ç›˜èµŒ P_RR<br>&emsp;&emsp;å¯¹åŠçƒé‡‡æ ·ï¼ˆpdf_hemi &#x3D; 1 &#x2F; 2$\pi$ï¼‰<br>&emsp;&emsp;è¿½è¸ªå…‰çº¿ r(p, wi)<br>&emsp;&emsp;if (r å‡»ä¸­éå‘å…‰ç‰©ä½“ q)<br>&emsp;&emsp;&emsp;&emsp;L_indir &#x3D; Shad(q, -wi) * f_r * $\cos \theta$ &#x2F; pdf_hemi &#x2F; P_RR<br>&emsp;&emsp;return L_dir + L_indir<br>}</p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">Vector3f <span class="hljs-title">Scene::castRay</span><span class="hljs-params">(<span class="hljs-type">const</span> Ray&amp; ray, <span class="hljs-type">int</span> depth)</span> <span class="hljs-type">const</span> </span>&#123;<br>Intersection inter = <span class="hljs-built_in">intersect</span>(ray);<br><br><span class="hljs-keyword">if</span> (inter.happened) &#123;<br><span class="hljs-keyword">if</span> (inter.m-&gt;<span class="hljs-built_in">hasEmission</span>()) &#123;<br><span class="hljs-comment">// å¦‚æœè§†çº¿å¯ä»¥ç›´æ¥æ•æ‰å…‰æº</span><br><span class="hljs-keyword">if</span> (depth == <span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">return</span> inter.m-&gt;<span class="hljs-built_in">getEmission</span>();<br>&#125;<br><span class="hljs-comment">/* ä»»ä½• Secondary Ray å‡»ä¸­å…‰æºæ—¶ä¸è¿”å›äº®åº¦ï¼Œ</span><br><span class="hljs-comment">   å…‰æºæä¾›çš„äº®åº¦ç”±æ¯ä¸ªéå…‰æºäº¤ç‚¹å¯¹å…‰æºé‡‡æ ·å¾—åˆ° */</span><br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">Vector3f</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>&#125;<br>&#125;<br><br><span class="hljs-function">Vector3f <span class="hljs-title">L_dir</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span></span>;<br><span class="hljs-function">Vector3f <span class="hljs-title">L_indir</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span></span>;<br><br>Intersection lightInter;<br><span class="hljs-type">float</span> pdf_light = <span class="hljs-number">0.f</span>;<br><span class="hljs-built_in">sampleLight</span>(lightInter, pdf_light);<br><br><span class="hljs-comment">// ç‰©ä½“è¡¨é¢å•ä½æ³•å‘é‡</span><br>Vector3f N = inter.normal;<br><span class="hljs-comment">// å…‰æºè¡¨é¢å•ä½æ³•å‘é‡</span><br>Vector3f NN = lightInter.normal;<br><br>Vector3f objPos = inter.coords;<br>Vector3f lightPos = lightInter.coords;<br><br>Vector3f objectToLight = lightPos - objPos;<br><span class="hljs-comment">// objectToLightDierction</span><br>Vector3f o2lDir = objectToLight.<span class="hljs-built_in">normalized</span>();<br><span class="hljs-comment">// objectToLightIntersection</span><br>Intersection o2lInter = <span class="hljs-built_in">intersect</span>(<span class="hljs-built_in">Ray</span>(objPos, o2lDir));<br><br><span class="hljs-comment">// å¦‚æœåå°„å‡»ä¸­å…‰æº</span><br><span class="hljs-keyword">if</span> (o2lInter.happened &amp;&amp; o2lInter.m-&gt;<span class="hljs-built_in">hasEmission</span>()) &#123;<br><span class="hljs-comment">// (o2lInter.coords - lightPos).norm() &lt; 1e-2</span><br>Vector3f f_r = inter.m-&gt;<span class="hljs-built_in">eval</span>(ray.direction, o2lDir, N);<br>L_dir = lightInter.emit * f_r *<br><span class="hljs-built_in">dotProduct</span>(o2lDir, N) * <span class="hljs-built_in">dotProduct</span>(-o2lDir, NN) /<br><span class="hljs-built_in">dotProduct</span>(objectToLight, objectToLight) / pdf_light;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">get_random_float</span>() &gt; RussianRoulette) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">Vector3f</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>&#125;<br><br>Vector3f nextDir = inter.m-&gt;<span class="hljs-built_in">sample</span>(ray.direction, N).<span class="hljs-built_in">normalized</span>();<br><span class="hljs-function">Ray <span class="hljs-title">nextRay</span><span class="hljs-params">(objPos, nextDir)</span></span>;<br>Intersection nextInter = <span class="hljs-built_in">intersect</span>(nextRay);<br><span class="hljs-keyword">if</span> (nextInter.happened &amp;&amp; !nextInter.m-&gt;<span class="hljs-built_in">hasEmission</span>()) &#123;<br><span class="hljs-type">float</span> pdf_hemi = inter.m-&gt;<span class="hljs-built_in">pdf</span>(ray.direction, nextDir, N);<br>Vector3f f_r = inter.m-&gt;<span class="hljs-built_in">eval</span>(ray.direction, nextDir, N);<br>L_indir = <span class="hljs-built_in">castRay</span>(nextRay, depth + <span class="hljs-number">1</span>) * f_r * <span class="hljs-built_in">dotProduct</span>(nextDir, N) /<br>pdf_hemi / RussianRoulette;<br>&#125;<br><br><span class="hljs-keyword">return</span> L_dir + L_indir;<br>&#125;<br><br><span class="hljs-keyword">return</span> <span class="hljs-built_in">Vector3f</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»“æœ-3"><a href="#ç»“æœ-3" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p><img src="/img/GAMES101/01.png"></p><h1 id="å¾®è¡¨é¢æ¨¡å‹"><a href="#å¾®è¡¨é¢æ¨¡å‹" class="headerlink" title="å¾®è¡¨é¢æ¨¡å‹"></a>å¾®è¡¨é¢æ¨¡å‹</h1><p>&emsp;&emsp;æ‰€æœ‰çš„ PBR æŠ€æœ¯éƒ½åŸºäºå¾®è¡¨é¢ç†è®ºã€‚è¿™é¡¹ç†è®ºè®¤ä¸ºï¼Œè¾¾åˆ°å¾®è§‚å°ºåº¦ä¹‹åä»»ä½•è¡¨é¢éƒ½å¯ä»¥ç”¨è¢«ç§°ä¸ºå¾®è¡¨é¢ (Microfacets) çš„ç»†å°é•œé¢æ¥è¿›è¡Œæç»˜ã€‚åœ¨å¾®è§‚å°ºåº¦ä¸‹ï¼Œæ²¡æœ‰ä»»ä½•è¡¨é¢æ˜¯å®Œå…¨å…‰æ»‘çš„ã€‚ç„¶è€Œç”±äºè¿™äº›å¾®è¡¨é¢å·²ç»å¾®å°åˆ°æ— æ³•é€åƒç´ çš„ç»§ç»­å¯¹å…¶è¿›è¡ŒåŒºåˆ†ï¼Œå› æ­¤æˆ‘ä»¬åªæœ‰å‡è®¾ä¸€ä¸ªç²—ç³™åº¦ (Roughness) å‚æ•°ï¼Œç„¶åç”¨ç»Ÿè®¡å­¦çš„æ–¹æ³•æ¥æ¦‚ç•¥çš„ä¼°ç®—å¾®è¡¨é¢çš„ç²—ç³™ç¨‹åº¦ã€‚</p><h2 id="BRDF"><a href="#BRDF" class="headerlink" title="BRDF"></a>BRDF</h2><p><strong>æ€§è´¨</strong><br>éè´Ÿã€çº¿æ€§ã€å¯é€†ã€èƒ½é‡å®ˆæ’ã€å„å‘åŒæ€§ã€å„å‘å¼‚æ€§</p><ul><li>$f(i,o)&#x3D;\frac{F(i,h)G(i,o,h)D(h)}{4(n,i)(n,o)}$</li></ul><p>Fï¼šè²æ¶…å°”æ–¹ç¨‹ï¼Œå®šä¹‰ä¸åŒè¡¨é¢è§’ä¸‹ï¼Œè¡¨é¢æ‰€åå°„å…‰çº¿å æ¯”ã€‚<br>Dï¼šæ³•çº¿çš„åˆ†å¸ƒã€‚<br>Gï¼šå½“ i æˆ– o å‡ ä¹å¹³è¡Œäºè¡¨é¢æ—¶ï¼Œå¾®è§‚ä¸‹å‡¹å‡¸ä¸å¹³çš„è¡¨é¢ä¼šå‘ç”Ÿè‡ªé®æŒ¡ã€‚</p><h2 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>è¿™é‡Œå‚è€ƒ <a href="https://learnopengl-cn.github.io/07%20PBR/01%20Theory/">LearnOpenGL</a> ç»™å‡ºçš„å®ç°ã€‚<br>å¹¶ä¸”åªè€ƒè™‘ PBR æè´¨ä¸­çš„é‡‘å±åº¦ä¸ç²—ç³™åº¦ã€‚</p><p><img src="/img/GAMES101/fm.png" alt="ä»ä¸‹å¾€ä¸Šçƒä½“çš„é‡‘å±æ€§ä»0.0å˜åˆ°1.0ï¼Œ ä»å·¦åˆ°å³çƒä½“çš„ç²—ç³™åº¦ä»0.0å˜åˆ°1.0ã€‚"></p><h3 id="è²æ¶…å°”æ–¹ç¨‹çš„è¿‘ä¼¼"><a href="#è²æ¶…å°”æ–¹ç¨‹çš„è¿‘ä¼¼" class="headerlink" title="è²æ¶…å°”æ–¹ç¨‹çš„è¿‘ä¼¼"></a>è²æ¶…å°”æ–¹ç¨‹çš„è¿‘ä¼¼</h3><p>è¿™é‡Œåœ¨ 0.04 - ALBEDO (0.96) é—´ç”¨é‡‘å±åº¦åšæ’å€¼ï¼Œ0.04 ä¸ºåŸºç¡€åå°„ç‡ï¼Œ0.96 æ¥è¿‘äºé“çš„åå°„ç‡ã€‚<br>å¯ä»¥ç®€å•åœ°è®¤ä¸ºå¯¼ä½“çš„åå°„ç‡å¤§äºç»ç¼˜ä½“ï¼Œå¹¶ä¸”å¯¹äºå¯¼ä½“è¡¨é¢ï¼Œä½¿ç”¨å®ƒä»¬çš„æŠ˜å°„æŒ‡æ•°è®¡ç®—åŸºç¡€æŠ˜å°„ç‡å¹¶ä¸èƒ½å¾—å‡ºæ­£ç¡®çš„ç»“æœã€‚æ‰€ä»¥æˆ‘ä»¬é¢„å…ˆè®¡ç®—å‡ºå¹³é¢çš„åå°„ç‡ï¼Œç„¶ååŸºäºç›¸åº”è§‚å¯Ÿè§’çš„ Fresnel-Schlick è¿‘ä¼¼å¯¹è¿™ä¸ªå€¼è¿›è¡Œæ’å€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å¯¹é‡‘å±å’Œéé‡‘å±æè´¨ä½¿ç”¨åŒä¸€ä¸ªå…¬å¼äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> ALBEDO 0.96f</span><br><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">FresnelSchlick</span><span class="hljs-params">(<span class="hljs-type">const</span> Vector3f&amp; H, <span class="hljs-type">const</span> Vector3f&amp; V, <span class="hljs-type">const</span> <span class="hljs-type">float</span>&amp; metalness)</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-type">float</span> inter = <span class="hljs-number">0.04f</span> * (<span class="hljs-number">1</span> - metalness) + ALBEDO * metalness;<br>    <span class="hljs-type">float</span> cosTheta = std::<span class="hljs-built_in">max</span>(<span class="hljs-built_in">dotProduct</span>(H, V), <span class="hljs-number">0.f</span>);<br><br>    <span class="hljs-keyword">return</span> inter + (<span class="hljs-number">1.f</span> - inter) * <span class="hljs-built_in">pow</span>(<span class="hljs-number">1.f</span> - cosTheta, <span class="hljs-number">5.f</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ³•çº¿åˆ†å¸ƒæ¨¡å‹"><a href="#æ³•çº¿åˆ†å¸ƒæ¨¡å‹" class="headerlink" title="æ³•çº¿åˆ†å¸ƒæ¨¡å‹"></a>æ³•çº¿åˆ†å¸ƒæ¨¡å‹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è¡¨ç¤ºæ³•çº¿åˆ†å¸ƒæ–¹å‘çš„æ­£æ€åˆ†å¸ƒå‡½æ•°</span><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">DistributionGGX</span><span class="hljs-params">(Vector3f N, Vector3f H, <span class="hljs-type">float</span> roughness)</span> </span>&#123;<br>    <span class="hljs-type">float</span> a = roughness * roughness;<br>    <span class="hljs-type">float</span> a2 = a * a;<br>    <span class="hljs-type">float</span> NdotH = std::<span class="hljs-built_in">max</span>(<span class="hljs-built_in">dotProduct</span>(N, H), <span class="hljs-number">0.f</span>);<br>    <span class="hljs-type">float</span> NdotH2 = NdotH * NdotH;<br><br>    <span class="hljs-type">float</span> nom = a2;<br>    <span class="hljs-type">float</span> denom = (NdotH2 * (a2 - <span class="hljs-number">1.f</span>) + <span class="hljs-number">1.f</span>);<br>    denom = M_PI * denom * denom;<br><br>    <span class="hljs-keyword">return</span> nom / std::<span class="hljs-built_in">max</span>(denom, <span class="hljs-number">1e-5f</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å‡ ä½•å‡½æ•°"><a href="#å‡ ä½•å‡½æ•°" class="headerlink" title="å‡ ä½•å‡½æ•°"></a>å‡ ä½•å‡½æ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">GeometrySchlickGGX</span><span class="hljs-params">(<span class="hljs-type">float</span> NdotV, <span class="hljs-type">float</span> roughness)</span> </span>&#123;<br>    <span class="hljs-type">float</span> r = (roughness + <span class="hljs-number">1.f</span>);<br>    <span class="hljs-type">float</span> k = (r * r) / <span class="hljs-number">8.f</span>;<br><br>    <span class="hljs-type">float</span> nom = NdotV;<br>    <span class="hljs-type">float</span> denom = NdotV * (<span class="hljs-number">1.f</span> - k) + k;<br><br>    <span class="hljs-keyword">return</span> nom / std::<span class="hljs-built_in">max</span>(denom, <span class="hljs-number">1e-5f</span>);<br>&#125;<br><span class="hljs-comment">// ä»ç»Ÿè®¡å­¦ä¸Šè¿‘ä¼¼çš„æ±‚å¾—å¾®å¹³é¢é—´ç›¸äº’é®è”½çš„æ¯”ç‡</span><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">GeometrySmith</span><span class="hljs-params">(Vector3f N, Vector3f V, Vector3f L, <span class="hljs-type">float</span> roughness)</span> </span>&#123;<br>    <span class="hljs-type">float</span> NdotV = std::<span class="hljs-built_in">max</span>(<span class="hljs-built_in">dotProduct</span>(N, V), <span class="hljs-number">0.f</span>);<br>    <span class="hljs-type">float</span> NdotL = std::<span class="hljs-built_in">max</span>(<span class="hljs-built_in">dotProduct</span>(N, L), <span class="hljs-number">0.f</span>);<br>    <span class="hljs-type">float</span> ggx2 = <span class="hljs-built_in">GeometrySchlickGGX</span>(NdotV, roughness);<br>    <span class="hljs-type">float</span> ggx1 = <span class="hljs-built_in">GeometrySchlickGGX</span>(NdotL, roughness);<br><br>    <span class="hljs-keyword">return</span> ggx1 * ggx2;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="BRDF-1"><a href="#BRDF-1" class="headerlink" title="BRDF"></a>BRDF</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> ALBEDO 0.96f</span><br><br><span class="hljs-function">Vector3f <span class="hljs-title">Material::eval</span><span class="hljs-params">(<span class="hljs-type">const</span> Vector3f &amp;wi, <span class="hljs-type">const</span> Vector3f &amp;wo, <span class="hljs-type">const</span> Vector3f &amp;N)</span></span>&#123;<br>    <span class="hljs-keyword">switch</span>(m_type)&#123;<br>        <span class="hljs-keyword">case</span> DIFFUSE:<br>        &#123;<br>            <span class="hljs-type">float</span> cosalpha = <span class="hljs-built_in">dotProduct</span>(N, wo);<br>            <span class="hljs-keyword">if</span> (cosalpha &gt; <span class="hljs-number">0.f</span>) &#123;<br>                Vector3f diffuse = Kd / M_PI;<br>                <span class="hljs-keyword">return</span> diffuse;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-built_in">Vector3f</span>(<span class="hljs-number">0.f</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">case</span> Microfacet:<br>        &#123;<br>            <span class="hljs-type">float</span> cosalpha = <span class="hljs-built_in">dotProduct</span>(N, wo);<br>            <span class="hljs-keyword">if</span> (cosalpha &gt; <span class="hljs-number">0.f</span>) &#123;<br>                <span class="hljs-type">float</span> roughness = <span class="hljs-number">0.9f</span>;<br>                <span class="hljs-type">float</span> metallic = <span class="hljs-number">0.9f</span>;<br><br>                Vector3f V = -wi;<br>                Vector3f L = wo;<br>                Vector3f H = <span class="hljs-built_in">normalize</span>(V + L);<br><br>                <span class="hljs-type">float</span> F = Material::<span class="hljs-built_in">FresnelSchlick</span>(H, V, metallic);<br>                <span class="hljs-type">float</span> G = Material::<span class="hljs-built_in">GeometrySmith</span>(N, V, L, roughness);<br>                <span class="hljs-type">float</span> D = Material::<span class="hljs-built_in">DistributionGGX</span>(N, H, roughness);<br><br>                Vector3f nominator = F * G * D;<br>                <span class="hljs-type">float</span> denominator = <span class="hljs-number">4</span> * std::<span class="hljs-built_in">max</span>(<span class="hljs-built_in">dotProduct</span>(N, V), <span class="hljs-number">0.f</span>) * <br>                    std::<span class="hljs-built_in">max</span>(<span class="hljs-built_in">dotProduct</span>(N, L), <span class="hljs-number">0.f</span>);<br>                Vector3f specular = nominator / std::<span class="hljs-built_in">max</span>(denominator, <span class="hljs-number">1e-5f</span>);<br>                <br>                Vector3f kS = F;<br>                Vector3f kD = <span class="hljs-built_in">Vector3f</span>(<span class="hljs-number">1.f</span>) - kS;<br>                kD = kD * <span class="hljs-built_in">Vector3f</span>(<span class="hljs-number">1.f</span> - metallic);<br><br>                Vector3f diffuse = ALBEDO / M_PI;<br><br>                <span class="hljs-comment">/* åº”å½“æ³¨æ„ï¼šè¿™é‡Œçš„å®ç°ï¼ˆå¾®è¡¨é¢ç»“åˆ diffuseï¼‰æ˜¯ LearnOpenGL æä¾›çš„æ¨¡å‹ï¼Œ</span><br><span class="hljs-comment">                   ä½†æ˜¯é—«è€å¸ˆåœ¨ GAMES202 ä¸­æŒ‡å‡ºè¿™æ˜¯é”™è¯¯ä¸”æ²¡æœ‰ç‰©ç†ä¾æ®çš„ã€‚*/</span><br>                <span class="hljs-keyword">return</span> kD * diffuse + specular;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br><br>                <span class="hljs-keyword">return</span> <span class="hljs-built_in">Vector3f</span>(<span class="hljs-number">0.f</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»“æœ-4"><a href="#ç»“æœ-4" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES101/r1m9.png" alt="r1m9"></div><div class="group-image-wrap"><img src="/img/GAMES101/r5m9.png" alt="r5m9"></div><div class="group-image-wrap"><img src="/img/GAMES101/r9m9.png" alt="r9m9"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES101/r1m5.png" alt="r1m5"></div><div class="group-image-wrap"><img src="/img/GAMES101/r5m5.png" alt="r5m5"></div><div class="group-image-wrap"><img src="/img/GAMES101/r9m5.png" alt="r9m5"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/GAMES101/r1m1.png" alt="r1m1"></div><div class="group-image-wrap"><img src="/img/GAMES101/r5m1.png" alt="r5m1"></div><div class="group-image-wrap"><img src="/img/GAMES101/r9m1.png" alt="r9m1"></div></div></div><h2 id="ç›¸å…³é“¾æ¥-1"><a href="#ç›¸å…³é“¾æ¥-1" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p><a href="https://learnopengl-cn.github.io/07%20PBR/02%20Lighting/">LearnOpenGL</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Math</tag>
      
      <tag>Rendering</tag>
      
      <tag>AntiAliasing</tag>
      
      <tag>Rasterization</tag>
      
      <tag>RayTracing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Archiveã€‘èƒŒåŒ…ï¼Œå¡è‚‰ï¼Œé•œå¤´æŠ–åŠ¨ï¼Œæœ‰é™çŠ¶æ€æœº</title>
    <link href="/2021/08/29/Unity/"/>
    <url>/2021/08/29/Unity/</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒåŒ…ç³»ç»Ÿ"><a href="#èƒŒåŒ…ç³»ç»Ÿ" class="headerlink" title="èƒŒåŒ…ç³»ç»Ÿ"></a>èƒŒåŒ…ç³»ç»Ÿ</h2><p>&emsp;&emsp;èƒŒåŒ… GUI çš„å®ç°ã€ScriptableObjectã€æ•°æ®çš„å­˜å‚¨ä¸è¯»å–ã€‚</p><h2 id="å±‚çº§ç»“æ„"><a href="#å±‚çº§ç»“æ„" class="headerlink" title="å±‚çº§ç»“æ„"></a>å±‚çº§ç»“æ„</h2><p><img src="/img/Unity/jg.png"></p><ul><li><strong>Bag</strong> æŒ‚è½½ BagOnDrag è„šæœ¬</li><li><strong>Grid</strong> æŒ‚è½½ Grid Layout Group ç»„ä»¶ï¼Œä½¿å…¶å­ç‰©ä½“ï¼ˆSlotï¼‰æ•´é½åœ°æ’æ”¾</li><li><strong>Slot</strong> æŒ‚è½½ Slot è„šæœ¬ï¼Œæ›´æ”¹å…¶å­ç‰©ä½“ï¼ˆItemï¼‰ä»¥å®ç°æ‹–æ‹½</li><li><strong>Item</strong> æŒ‚è½½ ItemOnDrag è„šæœ¬å’Œ CanvasGroup ç»„ä»¶ï¼Œä»¥åŠä½œä¸º buttom ç”¨äºè§¦å‘ Slot ä¸­çš„ OnItemClicked()</li><li><strong>Image å’Œ Count</strong> è´Ÿè´£ç‰©å“å›¾ç‰‡å’Œæ•°é‡çš„æ˜¾ç¤º</li></ul><p><a href="https://docs.unity.cn/cn/2019.4/Manual/script-GridLayoutGroup.html">Grid Layout Group</a></p><h2 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h2><h3 id="ç‰©å“æ•°æ®"><a href="#ç‰©å“æ•°æ®" class="headerlink" title="ç‰©å“æ•°æ®"></a>ç‰©å“æ•°æ®</h3><p>ä»¥ ScriptableObject çš„æ–¹å¼å­˜å‚¨æ¯ä¸€ç§ç‰©å“çš„æ•°æ®ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cs">[<span class="hljs-meta">CreateAssetMenu(fileName = <span class="hljs-string">&quot;NewItem&quot;</span>,menuName = <span class="hljs-string">&quot;Inventory/New Item&quot;</span>)</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">InventoryItem</span> : <span class="hljs-title">ScriptableObject</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> itemName;<br>    <span class="hljs-keyword">public</span> Sprite itemSprite;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> itemCount = <span class="hljs-number">1</span>;<br>    [<span class="hljs-meta">TextArea</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> itemInfo;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="èƒŒåŒ…æ•°æ®"><a href="#èƒŒåŒ…æ•°æ®" class="headerlink" title="èƒŒåŒ…æ•°æ®"></a>èƒŒåŒ…æ•°æ®</h3><p>ä»¥ ScriptableObject çš„æ–¹å¼å­˜å‚¨æ¯ä¸ªèƒŒåŒ…çš„æ•°æ®,æ¯ä¸ªèƒŒåŒ…ç±»å†…ç»´æŠ¤ä¸€ä¸ª List ç”¨äºå­˜å‚¨å¤šä¸ªç‰©å“ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cs">[<span class="hljs-meta">CreateAssetMenu(fileName = <span class="hljs-string">&quot;NewBag&quot;</span>, menuName = <span class="hljs-string">&quot;Inventory/New Bag&quot;</span>)</span>]<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">InventoryBag</span> : <span class="hljs-title">ScriptableObject</span><br>&#123;<br>    <span class="hljs-keyword">public</span> List&lt;InventoryItem&gt; itemList = <span class="hljs-keyword">new</span> List&lt;InventoryItem&gt;();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ¡èµ·ç‰©å“"><a href="#æ¡èµ·ç‰©å“" class="headerlink" title="æ¡èµ·ç‰©å“"></a>æ¡èµ·ç‰©å“</h3><p>ItemOnWorld æŒ‚è½½åœ¨ç‰©å“å¯¹è±¡ä¸Šï¼Œéšæ—¶æ›´æ–°ä¸¤ä¸ª SO çš„æ•°æ®ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemOnWorld</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> InventoryItem inventoryItem;<br>    <span class="hljs-keyword">public</span> InventoryBag inventoryBag;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTriggerEnter2D</span>(<span class="hljs-params">Collider2D collision</span>)</span> &#123;<br>        <span class="hljs-keyword">if</span> (collision.CompareTag(<span class="hljs-string">&quot;Player&quot;</span>)) &#123;<br>            AddItemToBag();<br>            Destroy(gameObject);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">AddItemToBag</span>()</span> &#123;<br>        <span class="hljs-keyword">if</span> (inventoryBag.itemList.Contains(inventoryItem)) &#123;<br>            inventoryItem.itemCount++;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// èƒŒåŒ…å†…ä¸å­˜åœ¨æ­¤ç‰©å“</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; inventoryBag.itemList.Count; i++) &#123;<br>                <span class="hljs-comment">// é¡ºåºæ‰¾åˆ°èƒŒåŒ…å†…ç¬¬ä¸€ä¸ªç©ºä½™ä½ç½®</span><br>                <span class="hljs-keyword">if</span> (inventoryBag.itemList[i] == <span class="hljs-literal">null</span>) &#123;<br>                    inventoryBag.itemList[i] = inventoryItem;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                Debug.Log(<span class="hljs-string">&quot;Bag Over Flow!&quot;</span>);<br>            &#125;<br>        &#125;<br>        InventoryManager.UpdateGUI();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h2><h3 id="Manager"><a href="#Manager" class="headerlink" title="Manager"></a>Manager</h3><p>å•ä¾‹æ¨¡å¼çš„ InventoryManagerï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›æ›´æ–° GUI çš„æ¥å£ <strong>InventoryManager.UpdateGUI()</strong> ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">InventoryManager</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">static</span> InventoryManager instance;<br><br>    <span class="hljs-keyword">public</span> InventoryBag bag;<br>    <span class="hljs-keyword">public</span> GameObject grid;<br>    <span class="hljs-keyword">public</span> GameObject emptySlot;<span class="hljs-comment">// é¢„åˆ¶ä½“Slot</span><br>    <span class="hljs-keyword">public</span> Text itemInfo;<span class="hljs-comment">// æ˜¾ç¤ºåœ¨èƒŒåŒ…å·¦ä¸‹è§’çš„UI</span><br>    <span class="hljs-keyword">public</span> List&lt;GameObject&gt; slotList = <span class="hljs-keyword">new</span> List&lt;GameObject&gt;();<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>()</span> &#123;<br>        <span class="hljs-keyword">if</span> (instance != <span class="hljs-literal">null</span>) &#123;<br>            Destroy(gameObject);<br>        &#125;<br>        instance = <span class="hljs-keyword">this</span>;<br>        UpdateGUI();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateItemInfo</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> info</span>)</span> &#123;<br>        instance.itemInfo.text = info;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateGUI</span>()</span> &#123;<br>        <span class="hljs-comment">// å…ˆæ¸…ç©ºGridçš„å­ç‰©ä½“ä¸slotList[]</span><br>        instance.slotList.Clear();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; instance.grid.transform.childCount; i++) &#123;<br>            Destroy(instance.grid.transform.GetChild(i).gameObject);<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; instance.bag.itemList.Count; i++) &#123;<br>            <span class="hljs-comment">// å°†emptySlotç”Ÿæˆä¸ºgridçš„å­ç‰©ä½“ï¼Œç„¶ååŠ å…¥slotList[]</span><br>            instance.slotList.Add(Instantiate(<br>                instance.emptySlot, instance.grid.transform, <span class="hljs-literal">false</span>));<br><br>            <span class="hljs-comment">// ç”¨itemList[]åˆ·æ–°slotList[]</span><br>            instance.slotList[i].GetComponent&lt;Slot&gt;()<br>                .InitSlot(instance.bag.itemList[i]);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Slot"><a href="#Slot" class="headerlink" title="Slot"></a>Slot</h3><p>è´Ÿè´£ UpdateGUI() ä¸­é’ˆå¯¹å…·ä½“ Slot ä¸­ Item æ•°æ®çš„æ›´æ–°ï¼Œä»¥åŠè´Ÿè´£ bag ä¸­ç‰©å“æè¿°çš„æ›´æ–°ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Slot</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> GameObject slotItem;<br>    <span class="hljs-keyword">public</span> Image slotImage;<br>    <span class="hljs-keyword">public</span> Text slotCount;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> slotInfo;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnEnable</span>()</span> &#123;<br>        InventoryManager.UpdateItemInfo(<span class="hljs-string">&quot;&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnItemClicked</span>()</span> &#123;<br>        <span class="hljs-comment">// åœ¨ä½œItemä¸­ä»¥OnClickçš„å½¢å¼è°ƒç”¨</span><br>        InventoryManager.UpdateItemInfo(slotInfo);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InitSlot</span>(<span class="hljs-params">InventoryItem inventoryItem</span>)</span> &#123;<br>        <span class="hljs-comment">// å°†ä¼ å…¥çš„Itmeä¿¡æ¯å†™å…¥è¯¥Slotçš„å­ç‰©ä½“</span><br>        <span class="hljs-keyword">if</span> (inventoryItem == <span class="hljs-literal">null</span>) &#123;<br>            slotItem.SetActive(<span class="hljs-literal">false</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            slotImage.sprite = inventoryItem.itemSprite;<br>            slotCount.text = inventoryItem.itemCount.ToString();<br>            slotInfo = inventoryItem.itemInfo;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="èƒŒåŒ…å†…ç‰©å“çš„æ‹–æ‹½"><a href="#èƒŒåŒ…å†…ç‰©å“çš„æ‹–æ‹½" class="headerlink" title="èƒŒåŒ…å†…ç‰©å“çš„æ‹–æ‹½"></a>èƒŒåŒ…å†…ç‰©å“çš„æ‹–æ‹½</h3><p>å®ç° EventSystems ä¸­ä¸‰ä¸ªæ¥å£ä»¥å“åº”é¼ æ ‡çš„äº¤äº’ã€‚<br>æ›´æ”¹ Item çš„çˆ¶çº§å’Œ Item çš„ä½ç½®ä»¥å®ç°æ‹–æ‹½æ•ˆæœã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> UnityEngine.EventSystems;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ItemOnDrag</span><br>    : <span class="hljs-title">MonoBehaviour</span>, <span class="hljs-title">IBeginDragHandler</span>, <span class="hljs-title">IDragHandler</span>, <span class="hljs-title">IEndDragHandler</span><br>&#123;<br>    <span class="hljs-keyword">public</span> InventoryBag bag;<br><br>    <span class="hljs-keyword">private</span> Transform originalParent;<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> firstIndex, secondIndex;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnBeginDrag</span>(<span class="hljs-params">PointerEventData eventData</span>)</span> &#123;<br>        firstIndex = GetIndex(transform.parent);<br>        originalParent = transform.parent;<br>        <span class="hljs-comment">// å°†Itemç§»è‡³Canvaså­é›†ä»¥ä¸è‡³äºè¢«å…¶ä»–UIé®æŒ¡</span><br>        transform.SetParent(transform.parent.parent.parent.parent);<br>        transform.position = eventData.position;<br>        <span class="hljs-comment">// ä»¤æ‰€æ‹–æ‹½çš„Itemæœ¬èº«ä¸ä¼šé®æŒ¡é¼ æ ‡å°„çº¿</span><br>        GetComponent&lt;CanvasGroup&gt;().blocksRaycasts = <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnDrag</span>(<span class="hljs-params">PointerEventData eventData</span>)</span> &#123;<br>        transform.position = eventData.position;<br>        <span class="hljs-comment">// Debug.Log(eventData.pointerCurrentRaycast.gameObject.name);</span><br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnEndDrag</span>(<span class="hljs-params">PointerEventData eventData</span>)</span> &#123;<br>        GameObject crtObject = eventData.pointerCurrentRaycast.gameObject;<br>        <span class="hljs-keyword">if</span> (crtObject == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// æ‹–è‡³UIç•Œé¢ä¹‹å¤–ï¼ŒItemå¤ä½</span><br>            transform.SetParent(originalParent);<br>            transform.position = originalParent.transform.position;<br>            GetComponent&lt;CanvasGroup&gt;().blocksRaycasts = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (crtObject.name == <span class="hljs-string">&quot;Image&quot;</span> || crtObject.name == <span class="hljs-string">&quot;Count&quot;</span>) &#123;<br>            <span class="hljs-comment">// æ‹–è‡³å¦ä¸€Itemä¸Šï¼Œäº¤æ¢ä¸¤è€…</span><br>            Transform crtItem = crtObject.transform.parent;<br>            Transform crtSlot = crtItem.parent;<br>            secondIndex = GetIndex(crtSlot);<br><br>            transform.SetParent(crtSlot);<br>            transform.position = crtSlot.position;<br><br>            crtItem.SetParent(originalParent);<br>            crtItem.position = originalParent.position;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(crtObject.name == <span class="hljs-string">&quot;Slot(Clone)&quot;</span>) &#123;<br>            <span class="hljs-comment">// æ‹–è‡³ç©ºSlot</span><br>            secondIndex = GetIndex(crtObject.transform);<br>            transform.SetParent(crtObject.transform);<br>            transform.position = crtObject.transform.position;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// æ‹–è‡³å…¶ä»–UIä¸Šï¼ŒItemå¤ä½</span><br>            transform.SetParent(originalParent);<br>            transform.position = originalParent.transform.position;<br>            GetComponent&lt;CanvasGroup&gt;().blocksRaycasts = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        Debug.Log(<span class="hljs-string">&quot;firstIndex: &quot;</span> + firstIndex + <span class="hljs-string">&quot; &quot;</span> + <span class="hljs-string">&quot;secondIndex: &quot;</span> + secondIndex);<br>    <br>        <span class="hljs-comment">// æ›´æ–°itemList</span><br>        InventoryItem tmp = bag.itemList[firstIndex];<br>        bag.itemList[firstIndex] = bag.itemList[secondIndex];<br>        bag.itemList[secondIndex] = tmp;<br><br>        GetComponent&lt;CanvasGroup&gt;().blocksRaycasts = <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> <span class="hljs-title">GetIndex</span>(<span class="hljs-params">Transform currentSlot</span>)</span> &#123;<br>        <span class="hljs-comment">// è¿”å›slotåœ¨gridä¸­çš„é¡ºåº</span><br>        Transform grid = currentSlot.parent;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">int</span> i=<span class="hljs-number">0</span>;i&lt; grid.childCount; i++) &#123;<br>            <span class="hljs-keyword">if</span> (grid.GetChild(i) == currentSlot) &#123;<br>                <span class="hljs-keyword">return</span> i;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="èƒŒåŒ…çš„æ‹–æ‹½"><a href="#èƒŒåŒ…çš„æ‹–æ‹½" class="headerlink" title="èƒŒåŒ…çš„æ‹–æ‹½"></a>èƒŒåŒ…çš„æ‹–æ‹½</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BagOnDrag</span> : <span class="hljs-title">MonoBehaviour</span>, <span class="hljs-title">IDragHandler</span><br>&#123;<br>    <span class="hljs-keyword">private</span> RectTransform rectTransform;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>()</span> &#123;<br>        rectTransform = GetComponent&lt;RectTransform&gt;();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnDrag</span>(<span class="hljs-params">PointerEventData eventData</span>)</span> &#123;<br>        rectTransform.anchoredPosition += eventData.delta;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å­˜å‚¨-Scriptable-Object"><a href="#å­˜å‚¨-Scriptable-Object" class="headerlink" title="å­˜å‚¨ Scriptable Object"></a>å­˜å‚¨ Scriptable Object</h2><p><strong>å­˜å‚¨æ—¶</strong><br>Scriptable Object é€šè¿‡ JsonUtility.ToJson(so) è½¬æ¢ä¸º jsonã€‚<br>json é€šè¿‡ formatter.Serialize(file, json) å†™å…¥æ–‡ä»¶ã€‚</p><p><strong>è¯»å–æ—¶</strong><br>æ–‡ä»¶é€šè¿‡ formatter.Deserialize(file) è½¬æ¢ä¸º jsonã€‚<br>json é€šè¿‡ JsonUtility.FromJsonOverwrite(json, so) å†™å…¥ Scriptable Objectã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> System.IO;<br><span class="hljs-keyword">using</span> System.Runtime.Serialization.Formatters.Binary;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SaveLoadManager</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> InventoryBag inventoryBag;<br>    <span class="hljs-keyword">public</span> InventoryItem item1;<br>    <span class="hljs-keyword">public</span> InventoryItem item2;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> PATH;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>()</span> &#123;<br>        PATH = Application.persistentDataPath;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SaveGame</span>()</span> &#123;<br>        <span class="hljs-comment">// åœ¨bottomä¸­è¢«è°ƒç”¨</span><br>        Debug.Log(PATH);<br>        <span class="hljs-keyword">if</span> (!Directory.Exists(PATH + <span class="hljs-string">&quot;/SaveData&quot;</span>)) &#123;<br>            Directory.CreateDirectory(PATH + <span class="hljs-string">&quot;/SaveData&quot;</span>);<br>        &#125;<br><br>        SaveData(inventoryBag, <span class="hljs-keyword">nameof</span>(inventoryBag));<br>        SaveData(item1, <span class="hljs-keyword">nameof</span>(item1));<br>        SaveData(item2, <span class="hljs-keyword">nameof</span>(item2));<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SaveData</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">T so, <span class="hljs-built_in">string</span> name</span>)</span> &#123;<br>        BinaryFormatter formatter = <span class="hljs-keyword">new</span> BinaryFormatter();<br>        FileStream file = File.Create(PATH + <span class="hljs-string">&quot;/SaveData/&quot;</span> + name + <span class="hljs-string">&quot;.bin&quot;</span>);<br>        <span class="hljs-built_in">string</span> json = JsonUtility.ToJson(so);<br>        formatter.Serialize(file, json);<br>        file.Close();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LoadGame</span>()</span> &#123;<br>        <span class="hljs-comment">// åœ¨bottomä¸­è¢«è°ƒç”¨</span><br>        LodData(inventoryBag, <span class="hljs-keyword">nameof</span>(inventoryBag));<br>        LodData(item1, <span class="hljs-keyword">nameof</span>(item1));<br>        LodData(item2, <span class="hljs-keyword">nameof</span>(item2));<br><br>        InventoryManager.UpdateGUI();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LodData</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">T so, <span class="hljs-built_in">string</span> name</span>)</span> &#123;<br>        BinaryFormatter formatter = <span class="hljs-keyword">new</span> BinaryFormatter();<br>        <span class="hljs-keyword">if</span> (File.Exists(PATH + <span class="hljs-string">&quot;/SaveData/&quot;</span> + name + <span class="hljs-string">&quot;.bin&quot;</span>)) &#123;<br>            FileStream file =<br>                File.Open(PATH + <span class="hljs-string">&quot;/SaveData/&quot;</span> + name + <span class="hljs-string">&quot;.bin&quot;</span>, FileMode.Open);<br>            <span class="hljs-built_in">string</span> json = (<span class="hljs-built_in">string</span>)formatter.Deserialize(file);<br>            JsonUtility.FromJsonOverwrite(json, so);<br>            file.Close();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/ScriptableObject.html">Scriptable Object</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/CreateAssetMenuAttribute.html">Create Asset Menu Attribute</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/Object.Instantiate.html">Instantiate</a><br><a href="https://docs.unity.cn/cn/2019.4/Manual/SupportedEvents.html">Supported Events</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/RectTransform.html">Rect Transform</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/Application-persistentDataPath.html">persistentDataPath</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/Windows.Directory.html">Directory</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/JsonUtility.html">JsonUtility</a><br><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter?view=net-5.0">BinaryFormatter</a></p><h2 id="æ‰“å‡»æ„Ÿ"><a href="#æ‰“å‡»æ„Ÿ" class="headerlink" title="æ‰“å‡»æ„Ÿ"></a>æ‰“å‡»æ„Ÿ</h2><p>&emsp;&emsp;ä¸€èˆ¬æ¥è¯´ï¼Œæ‰“å‡»æ„Ÿç”±å¸§å†»ç»“ã€é•œå¤´æŠ–åŠ¨ä¸è¿åŠ¨ã€æ•Œäººçš„å—å‡»åé¦ˆï¼ˆåŠ¨ç”»ã€éŸ³æ•ˆã€å‡»é€€ç­‰ï¼‰ã€ç‰¹æ•ˆã€ç¯å¢ƒçš„åé¦ˆç­‰ç»„æˆã€‚<br><img src="/img/Unity/dhq.png" alt="åŠ¨ç”»å™¨"></p><h3 id="è¿å‡»"><a href="#è¿å‡»" class="headerlink" title="è¿å‡»"></a>è¿å‡»</h3><div class="note note-secondary">            <p>&emsp;&emsp;æ”»å‡»ç»“æŸæ–¹æ³•å¯ä»¥ä¸åœ¨æ”»å‡»åŠ¨ç”»çš„æœ€åä¸€å¸§è°ƒç”¨ï¼Œè€Œæ˜¯æå‰å‡ å¸§ã€‚è¿™æ˜¯å› ä¸ºè¿å‡»å¾€å¾€å­˜åœ¨é¢„è¾“å…¥ï¼Œè¿™æ ·åšå¯ä»¥æé«˜è¿è´¯æ€§ï¼Œæå‡æ‰‹æ„Ÿã€‚</p>          </div><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">private</span> Coroutine tmpCoroutine = <span class="hljs-literal">null</span>;<span class="hljs-comment">// ä»…åœ¨ Attack ä¸­ä½¿ç”¨</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Attack</span>()</span> &#123;<br>    <span class="hljs-keyword">if</span> (!animator.GetBool(isAttackID) &amp;&amp; !isHurt &amp;&amp; !isDash &amp;&amp; !isParryStance) &#123;<br>        <span class="hljs-comment">// å¯æ”»å‡»çš„çŠ¶æ€</span><br>        <span class="hljs-keyword">if</span> (uponGround) &#123;<br>            <span class="hljs-comment">// åœ°é¢æ”»å‡»</span><br><br>            <span class="hljs-keyword">if</span> (Input.GetMouseButton(<span class="hljs-number">0</span>)) &#123;<br>                <span class="hljs-comment">// å·¦é”®è½»æ”»å‡»</span><br>                <span class="hljs-keyword">if</span> (tmpCoroutine != <span class="hljs-literal">null</span>) &#123;<br>                    StopCoroutine(tmpCoroutine);<br>                &#125;<br>                <span class="hljs-comment">/* å…³é—­åç¨‹ç¡®ä¿è¿™æ®µæ—¶é—´å†… isAttack ä¸ä¼šè¢«è®¾ä¸º false</span><br><span class="hljs-comment">                   å¯åŠ¨åç¨‹å€’è®¡æ—¶ä½¿ isAttack ä¸º false */</span><br>                tmpCoroutine = StartCoroutine(WaitForAttackOver(<span class="hljs-number">4f</span> / <span class="hljs-number">14f</span>));<br><br>                body.velocity = Vector2.zero;<br>                isAttack = <span class="hljs-literal">true</span>;<br>                <span class="hljs-comment">// æ¯æ¬¡è½»æ”»å‡»æ—¶è®¡æ—¶å™¨é‡ç½®ä¸ºæœ€å¤§å€¼</span><br>                timer = interval;<br>                combo++;<br>                <span class="hljs-keyword">if</span> (combo &gt; finalMaxCombo) &#123;<br>                    <span class="hljs-comment">// combo ä¸º 1 æ—¶æ’­æ”¾ä¸€æ®µæ”»å‡»åŠ¨ç”»ï¼Œä¸º 2 æ—¶æ’­æ”¾äºŒæ®µæ”»å‡»åŠ¨ç”»</span><br>                    combo = <span class="hljs-number">1</span>;<br>                &#125;<br><br>                animator.SetBool(isAttackID, <span class="hljs-literal">true</span>);<br>                animator.SetTrigger(lightAttackID);<br>                body.MovePosition(frontPoint.position);<br>                animator.SetInteger(comboID, combo);<br>                attackName = <span class="hljs-string">&quot;Light&quot;</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (Input.GetMouseButton(<span class="hljs-number">1</span>)) &#123;<br>                <span class="hljs-comment">// å³é”®é‡æ”»å‡»</span><br>                <span class="hljs-keyword">if</span> (tmpCoroutine != <span class="hljs-literal">null</span>) &#123;<br>                    StopCoroutine(tmpCoroutine);<br>                &#125;<br>                tmpCoroutine = StartCoroutine(WaitForAttackOver(<span class="hljs-number">6f</span> / <span class="hljs-number">14f</span>));<br><br>                body.velocity = Vector2.zero;<br>                isAttack = <span class="hljs-literal">true</span>;<br>                animator.SetBool(isAttackID, <span class="hljs-literal">true</span>);<br>                animator.SetTrigger(haveyAttackID);<br>                attackName = <span class="hljs-string">&quot;Heavy&quot;</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// ç©ºä¸­æ”»å‡»</span><br><br>            <span class="hljs-keyword">if</span> (Input.GetMouseButton(<span class="hljs-number">0</span>)) &#123;<br>                <span class="hljs-comment">// ç©ºä¸­æ™®é€šæ”»å‡»</span><br>                animator.SetBool(isAttackID, <span class="hljs-literal">true</span>);<br>                animator.SetTrigger(lightAttackID);<br>                attackName = <span class="hljs-string">&quot;Light&quot;</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (Input.GetMouseButton(<span class="hljs-number">1</span>)) &#123;<br>                <span class="hljs-comment">// ä¸‹è½æ”»å‡»</span><br>                <span class="hljs-keyword">if</span> (tmpCoroutine != <span class="hljs-literal">null</span>) &#123;<br>                    StopCoroutine(tmpCoroutine);<br>                &#125;<br>                tmpCoroutine = StartCoroutine(WaitForAttackOver(<span class="hljs-number">6f</span> / <span class="hljs-number">14f</span>));<br><br>                body.velocity = Vector2.zero;<br>                isAttack = <span class="hljs-literal">true</span>;<br>                isSlam = <span class="hljs-literal">true</span>;<br>                animator.SetBool(isAttackID, <span class="hljs-literal">true</span>);<br>                animator.SetTrigger(haveyAttackID);<br>                attackName = <span class="hljs-string">&quot;Slam&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (timer &gt;= <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// å€’è®¡æ—¶ç»“æŸåé‡ç½® combo æ•°</span><br>        timer -= Time.deltaTime;<br>        <span class="hljs-keyword">if</span> (timer &lt;= <span class="hljs-number">0</span>) &#123;<br>            combo = <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// åœ¨Attack()ä¸­è¢«è°ƒç”¨</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> IEnumerator <span class="hljs-title">WaitForAttackOver</span>(<span class="hljs-params"><span class="hljs-built_in">float</span> time</span>)</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title">WaitForSeconds</span>(<span class="hljs-params">time</span>)</span>;<br>    isAttack = <span class="hljs-literal">false</span>;<br>    isSlam = <span class="hljs-literal">false</span>;<br>    <span class="hljs-comment">// ç¡®ä¿å³ä½¿æ”»å‡»åŠ¨ç”»è¢«æ‰“æ–­ï¼Œanimator ä¸­çš„ isAttack ä¹Ÿä¼šæ­£ç¡®åœ°è¢«é‡ç½®</span><br>    animator.SetBool(isAttackID, <span class="hljs-literal">false</span>);<br>&#125;<br><br><span class="hljs-comment">// åœ¨æ¯ä¸ªæ”»å‡»åŠ¨ç”»å¿«ç»“æŸæ—¶è°ƒç”¨</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AttackOver</span>()</span> &#123;<br>    animator.SetBool(isAttackID, <span class="hljs-literal">false</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¸§å†»ç»“"><a href="#å¸§å†»ç»“" class="headerlink" title="å¸§å†»ç»“"></a>å¸§å†»ç»“</h3><div class="note note-secondary">            <p>å¸§å†»ç»“ç»“æŸåå¯ä»¥é€‚å½“æå‡3-5å€çš„åŠ¨ç”»é€Ÿåº¦ä»¥è¡¥å¿ç¼ºå¤±çš„æ—¶é—´ã€‚</p>          </div><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AttackSense</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AttackSense instance;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> isShake;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>()</span> &#123;<br>        instance = <span class="hljs-keyword">this</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">FrameFreeze</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> pauseFrame</span>)</span> &#123;<br>        StartCoroutine(PauseOnAttack(pauseFrame));<br>    &#125;<br>    <span class="hljs-function">IEnumerator <span class="hljs-title">PauseOnAttack</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> pauseFrame</span>)</span> &#123;<br>        <span class="hljs-built_in">float</span> pauseTime = pauseFrame / <span class="hljs-number">60f</span>;<br>        Time.timeScale = <span class="hljs-number">0</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title">WaitForSecondsRealtime</span>(<span class="hljs-params">pauseTime</span>)</span>;<br>        Time.timeScale = <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é•œå¤´æŠ–åŠ¨"><a href="#é•œå¤´æŠ–åŠ¨" class="headerlink" title="é•œå¤´æŠ–åŠ¨"></a>é•œå¤´æŠ–åŠ¨</h3><p>ä¸ºç›¸æœºæ·»åŠ <br><img src="/img/Unity/dd1.png"><br>ä¸ºç©å®¶çš„æ”»å‡»ç¢°æ’ä½“æ·»åŠ ï¼Œå¹¶è°ƒæ•´å¯¹åº”çš„å‚æ•°<br><img src="/img/Unity/dd2.png"></p><h3 id="åé¦ˆ"><a href="#åé¦ˆ" class="headerlink" title="åé¦ˆ"></a>åé¦ˆ</h3><p>æ•Œäººçš„åé¦ˆä¼šåœ¨æœ‰é™çŠ¶æ€æœºä¸­è¿›è¡Œå…·ä½“çš„å®ç°ã€‚</p><h2 id="æœ‰é™çŠ¶æ€æœº"><a href="#æœ‰é™çŠ¶æ€æœº" class="headerlink" title="æœ‰é™çŠ¶æ€æœº"></a>æœ‰é™çŠ¶æ€æœº</h2><p>&emsp;&emsp;æœ‰é™çŠ¶æ€æœºæ˜¯ä¸€ä¸ªå…·æœ‰æœ‰é™æ•°é‡çŠ¶æ€çš„æ¨¡å‹ï¼Œå¹¶ä¸”åŒæ—¶åªèƒ½å¤„äºä¸€ç§çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡å¤–éƒ¨è¾“å…¥ç­‰æ–¹å¼è§¦å‘çŠ¶æ€ä¹‹é—´çš„åˆ‡æ¢ã€‚è¿™é‡Œå®ç°ä¸€ä¸ªç®€æ˜“çš„æ•Œäºº AIã€‚</p><h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><p>æ‰€æœ‰çš„çŠ¶æ€ç±»éƒ½ç»§æ‰¿è¿™ä¸ªæ¥å£ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IState</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnEnter</span>()</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnUpdate</span>()</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnFixedUpdate</span>()</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnExit</span>()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="FSM"><a href="#FSM" class="headerlink" title="FSM"></a>FSM</h3><p>æŒ‚è½½åœ¨æ•Œäººèº«ä¸Šï¼Œè¿™é‡Œçœç•¥ä¸€äº›ç»„ä»¶çš„å®šä¹‰ä¸è·å–ã€‚ä¸€äº›å¯¹æ‰€æœ‰çŠ¶æ€é€šç”¨çš„æ–¹æ³•ä¹Ÿå¯ä»¥å†™åœ¨è¿™é‡Œã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-comment">// å…ˆåˆ›å»ºä¸€ä¸ªæšä¸¾ç±»å­˜å‚¨æ‰€æœ‰çŠ¶æ€ï¼Œä½œä¸ºå­—å…¸ä¸­çš„é”®</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> StateType &#123;<br>    Idle, Run, Attack, Hurt, Throw, SpecialAttack<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FSM</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">private</span> IState crtState = <span class="hljs-literal">null</span>;<span class="hljs-comment">// å½“å‰çŠ¶æ€</span><br>    <span class="hljs-keyword">private</span> Dictionary&lt;StateType, IState&gt; stateLise =<br>        <span class="hljs-keyword">new</span> Dictionary&lt;StateType, IState&gt;();<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>()</span> &#123;<br>        <span class="hljs-comment">// æ³¨å†ŒçŠ¶æ€å¹¶å°† FSM è‡ªèº«ä¼ å…¥çŠ¶æ€</span><br>        stateLise.Add(StateType.Idle, <span class="hljs-keyword">new</span> IdleState(<span class="hljs-keyword">this</span>));<br>        stateLise.Add(StateType.Run, <span class="hljs-keyword">new</span> RunState(<span class="hljs-keyword">this</span>));<br>        stateLise.Add(StateType.Attack, <span class="hljs-keyword">new</span> AttackState(<span class="hljs-keyword">this</span>));<br>        stateLise.Add(StateType.Hurt, <span class="hljs-keyword">new</span> HurtState(<span class="hljs-keyword">this</span>));<br>        stateLise.Add(StateType.Throw, <span class="hljs-keyword">new</span> ThrowState(<span class="hljs-keyword">this</span>));<br>        stateLise.Add(StateType.SpecialAttack, <span class="hljs-keyword">new</span> SpecialAttackState(<span class="hljs-keyword">this</span>));<br><br>        ChangeState(StateType.Idle);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>()</span> &#123;<br>        crtState.OnUpdate();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">FixedUpdate</span>()</span> &#123;<br>        crtState.OnFixedUpdate();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ChangeState</span>(<span class="hljs-params">StateType type</span>)</span> &#123;<br>        <span class="hljs-keyword">if</span> (crtState != <span class="hljs-literal">null</span>) &#123;<br>            crtState.OnExit();<br>        &#125;<br>        crtState = stateLise[type];<br>        crtState.OnEnter();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="çŠ¶æ€ç±»"><a href="#çŠ¶æ€ç±»" class="headerlink" title="çŠ¶æ€ç±»"></a>çŠ¶æ€ç±»</h3><p><em>ä»¥æ™®é€šæ”»å‡»çŠ¶æ€ä¸ºä¾‹ã€‚</em><br>åŠ¨ç”»åœ¨å…·ä½“çš„çŠ¶æ€ç±»ä¸­è¿›è¡Œæ§åˆ¶ï¼ŒåŠ¨ç”»ä¸­åŒ…å«äº†å½•åˆ¶å¥½çš„æ”»å‡»ç¢°æ’å™¨ï¼ˆTriggerï¼‰çš„å¯ç”¨ä¸å˜å½¢ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AttackState</span> : <span class="hljs-title">IState</span> &#123;<br>    <span class="hljs-keyword">private</span> FSM fsm;<br>    <span class="hljs-keyword">private</span> AnimatorStateInfo animeInfo;<br>    <span class="hljs-comment">// åœ¨æ„é€ å‡½æ•°ä¸­è·å– fsm</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AttackState</span>(<span class="hljs-params">FSM fsmIn</span>)</span> &#123;<br>        <span class="hljs-keyword">this</span>.fsm = fsmIn;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnEnter</span>()</span> &#123;<br>        fsm.body.velocity = Vector2.zero;<br>        fsm.animator.Play(<span class="hljs-string">&quot;Rogue_Attack&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnUpdate</span>()</span> &#123;<br>        animeInfo = fsm.animator.GetCurrentAnimatorStateInfo(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (animeInfo.normalizedTime &gt;= <span class="hljs-number">0.99f</span>) &#123;<br>            fsm.ChangeState(StateType.Idle);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnFixedUpdate</span>()</span> &#123;<br>        <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnExit</span>()</span> &#123;<br>        fsm.idleStartTime = Time.time;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¯¹è±¡æ± "><a href="#å¯¹è±¡æ± " class="headerlink" title="å¯¹è±¡æ± "></a>å¯¹è±¡æ± </h2><p>&emsp;&emsp;å¯¹äºéœ€è¦å¤§é‡æˆ–è€…å¤šæ¬¡åå¤å®ä¾‹åŒ–ï¼Œä¸”éœ€è¦é”€æ¯çš„ç‰©ä½“ï¼ˆæ¯”å¦‚å­å¼¹ã€æ®‹å½±ç­‰ï¼‰ï¼Œé¢‘ç¹åœ°åˆ›å»ºä¸é”€æ¯ç‰©ä½“å¯¹äºæ€§èƒ½çš„å¼€é”€è¿‡å¤§ã€‚</p><p>&emsp;&emsp;æ•…ä½¿ç”¨å¯¹è±¡æ± ï¼Œæå‰ç”Ÿæˆä¸€å®šæ•°é‡çš„ç©ºç‰©ä½“ï¼Œåœ¨éœ€è¦æ—¶å–ä¸€è¿›è¡Œå¯ç”¨ä¸èµ‹å€¼ï¼Œä¸€æ®µæ—¶é—´åè¿›è¡Œå›æ”¶ï¼Œä¸€å®šç¨‹åº¦ä¸Šå‡å°‘äº†åŠ¨æ€åŠ è½½æ€§èƒ½çš„æ¶ˆè€—ã€‚</p><p>&emsp;&emsp;è¿™é‡Œå®ç°ä¸€ä¸ªè§’è‰²å†²é”‹äº§ç”Ÿæ®‹å½±çš„æ•ˆæœã€‚</p><h3 id="é¢„åˆ¶ä½“"><a href="#é¢„åˆ¶ä½“" class="headerlink" title="é¢„åˆ¶ä½“"></a>é¢„åˆ¶ä½“</h3><p><img src="/img/Unity/image.png" alt="ç©ºç‰©ä½“é¢„åˆ¶ä½“"></p><h3 id="å¯¹è±¡æ± å®ç°"><a href="#å¯¹è±¡æ± å®ç°" class="headerlink" title="å¯¹è±¡æ± å®ç°"></a>å¯¹è±¡æ± å®ç°</h3><p>ç”±ä¸€å•ä¾‹æ§åˆ¶ç©ºç‰©ä½“çš„é¢„ç”Ÿæˆã€å¯ç”¨å’Œå›æ”¶ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AfterimagePool</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AfterimagePool instance;<br>    <span class="hljs-keyword">public</span> GameObject imagePrefab;<br><br>    <span class="hljs-keyword">private</span> Queue&lt;GameObject&gt; pool = <span class="hljs-keyword">new</span> Queue&lt;GameObject&gt;();<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>()</span> &#123;<br>        <span class="hljs-keyword">if</span>(instance == <span class="hljs-literal">null</span>) &#123;<br>            instance = <span class="hljs-keyword">this</span>;<br>        &#125;<br>        FillPoll(<span class="hljs-number">10</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// åœ¨å¯¹è±¡è‡ªèº«è„šæœ¬ä¸­è°ƒç”¨</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ReturnToPool</span>(<span class="hljs-params">GameObject objectIn</span>)</span> &#123;<br>        objectIn.SetActive(<span class="hljs-literal">false</span>);<br>        pool.Enqueue(objectIn);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">FillPoll</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> num</span>)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; num; i++) &#123;<br>            GameObject newImage = Instantiate(imagePrefab);<br>            newImage.transform.SetParent(transform);<br>            ReturnToPool(newImage);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// Player ä¸ºå†²åˆºçŠ¶æ€æ—¶ä¼šåœ¨ FixedUpdate ä¸­åå¤è°ƒç”¨</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TakeFromPool</span>()</span> &#123;<br>        <span class="hljs-keyword">if</span> (pool.Count &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// å¯¹è±¡æ± ä¸å¤Ÿç”¨æ—¶å¤šç”Ÿæˆå‡ ä¸ªé¢„åˆ¶ä»¶</span><br>            FillPoll(<span class="hljs-number">5</span>);<br>        &#125;<br>        GameObject crtImage = pool.Dequeue();<br>        crtImage.SetActive(<span class="hljs-literal">true</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¯ç”¨ç‰©ä½“"><a href="#å¯ç”¨ç‰©ä½“" class="headerlink" title="å¯ç”¨ç‰©ä½“"></a>å¯ç”¨ç‰©ä½“</h3><p>åœ¨ OnEnable() ä¸­å°† Player æ­¤åˆ»çš„ Spriteã€ä½ç½®ç­‰ä¿¡æ¯èµ‹ç»™ç©ºç‰©ä½“ï¼Œç„¶åä¸æ–­å‡å°å…¶ Alpha å€¼ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Afterimage</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> activeTime;<br>    [<span class="hljs-meta">Range(0f, 1f)</span>]<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> startAlpha;<br><br>    <span class="hljs-keyword">private</span> Transform player;<br>    <span class="hljs-keyword">private</span> SpriteRenderer thisSR, playerSR;<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> alpha, startTime;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnEnable</span>()</span> &#123;<br>        player = GameObject.FindGameObjectWithTag(<span class="hljs-string">&quot;Player&quot;</span>).transform;<br>        thisSR = GetComponent&lt;SpriteRenderer&gt;();<br>        playerSR = player.GetComponent&lt;SpriteRenderer&gt;();<br><br>        alpha = startAlpha;<br>        startTime = Time.time;<br><br>        thisSR.sprite = playerSR.sprite;<br>        transform.position = player.position;<br>        transform.localScale = player.localScale;<br>        transform.rotation = player.rotation;<br>        StartCoroutine(DecreaseAlpha());<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>()</span> &#123;<br>        thisSR.color = <span class="hljs-keyword">new</span> Color(<span class="hljs-number">0.5f</span>, <span class="hljs-number">0.5f</span>, <span class="hljs-number">1</span>, alpha);<br>        <span class="hljs-keyword">if</span> (Time.time - startTime &gt;= activeTime) &#123;<br>            AfterimagePool.instance.ReturnToPool(gameObject);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> IEnumerator <span class="hljs-title">DecreaseAlpha</span>()</span> &#123;<br>        <span class="hljs-keyword">while</span> (alpha &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// alpha éœ€è¦åœ¨ activeTime ç§’å†…ä» startAlpha å‡ä¸º 0</span><br>            alpha -= (startAlpha / (activeTime * <span class="hljs-number">50</span>));<br>            <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title">WaitForFixedUpdate</span>()</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><p>å•ä¾‹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªé™æ€çš„å®ä¾‹ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªå®ä¾‹è°ƒç”¨æ–¹æ³•ï¼Œè€Œæ— éœ€å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ã€‚</p><h3 id="ç®€å•å®ç°"><a href="#ç®€å•å®ç°" class="headerlink" title="ç®€å•å®ç°"></a>ç®€å•å®ç°</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ExampleManager</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExampleManager instance;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>()</span>&#123;<br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>            instance = <span class="hljs-keyword">this</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ExampleFun</span>()</span>&#123;<br>        DO SOMETHING;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¤–éƒ¨è°ƒç”¨æ—¶åªéœ€å†™ä½œ</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cs">ExampleManager.instance.ExampleFun();<br></code></pre></td></tr></table></figure><h3 id="å¦ä¸€ç§åšæ³•"><a href="#å¦ä¸€ç§åšæ³•" class="headerlink" title="å¦ä¸€ç§åšæ³•"></a>å¦ä¸€ç§åšæ³•</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ExampleManager</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ExampleManager instance;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExampleManager Instance &#123;<br>        <span class="hljs-keyword">get</span> &#123;<br>            <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>                instance = FindObjectOfType&lt;ExampleManager&gt;();<br>            &#125;<br>            <span class="hljs-keyword">return</span> instance;<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ExampleFun</span>()</span>&#123;<br>        DO SOMETHING;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¤–éƒ¨è°ƒç”¨æ—¶å†™ä½œ</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cs">ExampleManager.Instance.ExampleFun();<br></code></pre></td></tr></table></figure><h3 id="æ›´ä¼˜é›…çš„åšæ³•"><a href="#æ›´ä¼˜é›…çš„åšæ³•" class="headerlink" title="æ›´ä¼˜é›…çš„åšæ³•"></a>æ›´ä¼˜é›…çš„åšæ³•</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ExampleManager</span>&lt;<span class="hljs-title">T</span>&gt; : <span class="hljs-title">MonoBehaviour</span> <span class="hljs-keyword">where</span> <span class="hljs-title">T</span> : <span class="hljs-title">ExampleManager</span>&lt;<span class="hljs-title">T</span>&gt;<br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> T instance;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExampleManager Instance &#123;<br>        <span class="hljs-keyword">get</span> &#123;<br>            <span class="hljs-keyword">return</span> instance;<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>()</span>&#123;<br>        id(instance == <span class="hljs-literal">null</span>)&#123;<br>            instance = (T)<span class="hljs-keyword">this</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> IsInit&#123;<br>        <span class="hljs-keyword">get</span>&#123;<br>            <span class="hljs-keyword">return</span> (instance != <span class="hljs-literal">null</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnDestory</span>()</span>&#123;<br>        <span class="hljs-keyword">if</span>(instance == <span class="hljs-keyword">this</span>)&#123;<br>            instance = <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥åä»»ä½•æ–°çš„å•ä¾‹ç±»åªç”¨ç»§æ‰¿è¿™ä¸ªæ³›å‹ç±»å³å¯ã€‚</p><h3 id="æˆ‘çš„-SoundManager"><a href="#æˆ‘çš„-SoundManager" class="headerlink" title="æˆ‘çš„ SoundManager"></a>æˆ‘çš„ SoundManager</h3><h4 id="éŸ³æ•ˆ"><a href="#éŸ³æ•ˆ" class="headerlink" title="éŸ³æ•ˆ"></a>éŸ³æ•ˆ</h4><ul><li>é¦–å…ˆéœ€è¦ä¸€ä¸ªæŒ‚è½½ Manager çš„ Object</li><li>ä¸Šä¸€ä¸ªåœºæ™¯çš„ Manager å®ä¾‹éœ€è¦å¸¦åˆ°ä¸‹ä¸€ä¸ªåœºæ™¯ä¸­å»ï¼Œæ•…ä½¿ç”¨ DontDestroyOnLoad(gameObject)</li><li>è°ƒè¯•æ—¶è‹¥ä¸ä»ç¬¬ä¸€ä¸ªåœºæ™¯è¿›å…¥åˆ™ä¸å­˜åœ¨è¯¥ Objectï¼Œååˆ†ä¸ä¾¿</li><li>è‹¥æ¯ä¸ªåœºæ™¯éƒ½æ”¾ç½®è¯¥ bjectï¼Œå¤§é‡ä¸ä¼šé”€æ¯çš„ Object ä¼šå¸¦ç€å…¶ä¸ŠæŒ‚è½½çš„çš„ Manager å †ç§¯èµ·æ¥</li><li>æ•…åœ¨ Awake ä¸­åšåˆ¤æ–­é”€æ¯ä»»ä½•æ–°åŠ è½½çš„ Object<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SFXMananger</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SFXMananger instance;<br><br>    [<span class="hljs-meta">SerializeField</span>]<br>    <span class="hljs-keyword">private</span> AudioClip hurtAudio, collectAudio, enemyDestoryAudio;<br>    <span class="hljs-keyword">private</span> AudioSource audioSource;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span>()</span> &#123;<br>        audioSource = GetComponent&lt;AudioSource&gt;();<br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>            instance = <span class="hljs-keyword">this</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (instance != <span class="hljs-keyword">this</span>) &#123;<br>            Destroy(gameObject);<br>        &#125;<br>        DontDestroyOnLoad(gameObject);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">HurtAudio</span>()</span> &#123;<br>        audioSource.clip = hurtAudio;<br>        audioSource.Play();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CollectAudio</span>()</span> &#123;<br>        audioSource.clip = collectAudio;<br>        audioSource.Play();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnemyDestoryAudio</span>()</span> &#123;<br>        audioSource.clip = enemyDestoryAudio;<br>        audioSource.Play();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="bgm"><a href="#bgm" class="headerlink" title="bgm"></a>bgm</h4><p>åœ¨æ»¡è¶³ä¸éŸ³æ•ˆç›¸åŒçš„æ¡ä»¶ä¹‹ä¸Šï¼Œåå¤åŠ è½½åŒä¸€åœºæ™¯æ—¶ï¼Œæˆ‘ä¸å¸Œæœ› bgm ä»å¤´å¼€å§‹æ’­æ”¾ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BGMManager</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BGMManager instance;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> sceneIndex;<br><br>    [<span class="hljs-meta">SerializeField</span>]<br>    <span class="hljs-keyword">private</span> AudioClip openingBGM, scene1BGM, scene2BGM, scene3BGM, endingBGM, defautBGM;<br>    <span class="hljs-keyword">private</span>  AudioSource audioSource;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Awake</span> ()</span> &#123;<br>        audioSource = GetComponent&lt;AudioSource&gt;();<br>        <span class="hljs-built_in">int</span> crtIndex = SceneManager.GetActiveScene().buildIndex;<br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// åªæœ‰é¦–ä¸ª Manager åŠ è½½æ—¶ä¼šè¿›å…¥è¿™ä¸ªåˆ†æ”¯</span><br>            instance = <span class="hljs-keyword">this</span>;<br>            sceneIndex = crtIndex;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (instance != <span class="hljs-keyword">this</span>) &#123;<br>            Destroy(gameObject);<br>            <span class="hljs-keyword">if</span> (sceneIndex != crtIndex) &#123;<br>                <span class="hljs-comment">// æ ¹æ®å…³å¡ç¼–å·åˆ‡æ¢ bgmï¼Œé‡æ–°åŠ è½½åŒä¸€å…³æ—¶åˆ™ä¸éœ€è¦åˆ‡æ¢</span><br>                instance.SwitchBGM(crtIndex);<br>                sceneIndex = crtIndex;<br>            &#125;<br>        &#125;<br>        DontDestroyOnLoad(gameObject);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SwitchBGM</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> i</span>)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (i) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>                audioSource.clip = openingBGM;<br>                audioSource.Play();<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                audioSource.clip = scene1BGM;<br>                audioSource.Play();<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>                audioSource.clip = scene2BGM;<br>                audioSource.Play();<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>                audioSource.clip = scene3BGM;<br>                audioSource.Play();<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>                audioSource.clip = endingBGM;<br>                audioSource.Play();<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-literal">default</span>:<br>                audioSource.clip = defautBGM;<br>                audioSource.Play();<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h2><p>&emsp;&emsp;åç¨‹å°±åƒä¸€ä¸ªå‡½æ•°ï¼Œèƒ½å¤Ÿæš‚åœæ‰§è¡Œå¹¶å°†æ§åˆ¶æƒè¿”è¿˜ç»™ Unity ä¸€æ®µæ—¶é—´ï¼Œå¯ä»¥æ˜¯ç­‰å¾…ä¸€å¸§ï¼Œå¯ä»¥æ˜¯ç­‰å¾…å‡ ç§’ï¼Œä¹Ÿå¯ä»¥æ˜¯ç­‰å¾…å¦ä¸€ä¸ªåç¨‹ã€‚å½“éœ€è¦ä¸€ä¸ªå‡½æ•°çš„å†…å®¹ï¼ˆå¦‚ä¸€ä¸ªå¾ªç¯ï¼‰ä¸éœ€è¦åœ¨å•å¸§å†…æ‰§è¡Œå®Œæˆæ—¶å¾€å¾€ä¼šä½¿ç”¨åç¨‹ã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function">IEnumerator <span class="hljs-title">Fun</span>()</span>&#123;<br>    DO SOMETHING;<br>    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<span class="hljs-comment">// æš‚åœæ‰§è¡Œå¹¶åœ¨ä¸‹ä¸€å¸§æ¢å¤çš„ç‚¹</span><br>    <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title">WaitForSeconds</span>(<span class="hljs-params"><span class="hljs-number">.1</span>f</span>)</span>;<span class="hljs-comment">// æš‚åœæ‰§è¡Œå¹¶ç­‰å¾… 0.1s åæ¢å¤çš„ç‚¹</span><br>    <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-title">StartCoroutine</span>(<span class="hljs-params">Fun2(</span>))</span>;<span class="hljs-comment">// æš‚åœæ‰§è¡Œå¹¶ç­‰å¾… Fun2() è¿”è¿˜æ§åˆ¶æƒ</span><br>&#125;<br><br>StartCoroutine(Fun());<br></code></pre></td></tr></table></figure><h3 id="æˆ‘çš„ä¸»èœå•"><a href="#æˆ‘çš„ä¸»èœå•" class="headerlink" title="æˆ‘çš„ä¸»èœå•"></a>æˆ‘çš„ä¸»èœå•</h3><p>é—´éš”dtç§’ä¾æ¬¡æ¿€æ´»æ‰€æœ‰ UIã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MainMenu</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> GameObject titleUI, startUI, endUI;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span> &#123;<br>        StartCoroutine(Delayed(<span class="hljs-number">0.65f</span>, titleUI, startUI, endUI));<br>    &#125;<br>    <span class="hljs-function">IEnumerator <span class="hljs-title">Delayed</span>(<span class="hljs-params"><span class="hljs-built_in">float</span> dt, <span class="hljs-keyword">params</span> GameObject[] list</span>)</span> &#123;<br>        <span class="hljs-keyword">foreach</span> (GameObject obj <span class="hljs-keyword">in</span> list) &#123;<br>            <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title">WaitForSeconds</span>(<span class="hljs-params">dt</span>)</span>;<br>            obj.SetActive(<span class="hljs-literal">true</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç›¸å…³é“¾æ¥-1"><a href="#ç›¸å…³é“¾æ¥-1" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/Bounds.html">Bounds</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/Rigidbody2D.MovePosition.html">MovePosition</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/Animator.html">Animator</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/AnimatorStateInfo.html">AnimatorStateInfo</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/SpriteRenderer.html">SpriteRenderer</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/SceneManagement.SceneManager.html">SceneManager</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/SceneManagement.Scene.html">Scene</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/Object.DontDestroyOnLoad.html">DontDestroyOnLoad</a><br><a href="https://docs.unity.cn/cn/2019.4/Manual/Coroutines.html">Coroutines</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/YieldInstruction.html">YieldInstruction</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>AI</tag>
      
      <tag>C#</tag>
      
      <tag>Unity</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Archiveã€‘Sunny Land, a platformmer game</title>
    <link href="/2021/08/19/SunnyLand/"/>
    <url>/2021/08/19/SunnyLand/</url>
    
    <content type="html"><![CDATA[<h2 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h2><ul><li>ä½¿ç”¨ Unity åˆ¶ä½œçš„ 2D å¹³å°è·³è·ƒæ¸¸æˆ</li><li>å‹ç¼©åŒ…å¤§å°ï¼š46MB</li><li>å¹³å°ï¼šWin</li><li>åªæœ‰ä¸‰å…³ï¼Œæ ¹æ®æ¸¸æˆç»éªŒçš„ä¸åŒï¼Œå®Œæ•´çš„æ¸¸æˆæ—¶é•¿ä¼šåœ¨ 10min-60min ä¹‹é—´</li><li><a href="https://pan.baidu.com/s/13p5wTAWneAB5FFj7NqWDCw">ç™¾åº¦ç½‘ç›˜</a> æå–ç : twwx</li><li><a href="https://wwr.lanzoui.com/iIc6zstlg8h">è“å¥äº‘</a></li></ul><h2 id="ä¸€è§ˆ"><a href="#ä¸€è§ˆ" class="headerlink" title="ä¸€è§ˆ"></a>ä¸€è§ˆ</h2><p><img src="/img/SunnyLand/yl1.png"><br><img src="/img/SunnyLand/yl3.png"></p><h2 id="å…³äºå…³å¡è®¾è®¡"><a href="#å…³äºå…³å¡è®¾è®¡" class="headerlink" title="å…³äºå…³å¡è®¾è®¡"></a>å…³äºå…³å¡è®¾è®¡</h2><div class="note note-secondary">            <p>å¦‚æœæ‚¨è¿˜æœªè¿›è¡Œè¿‡æ¸¸æˆï¼Œå¼ºçƒˆå»ºè®®ä½“éªŒè¿‡åå†ç»§ç»­é˜…è¯»ï¼Œä»¥å…ç ´åæ‚¨çš„æ¸¸æˆä½“éªŒã€‚</p>          </div><p>æ—ç”°å®ä¸€æ›¾æåˆ°è¿‡ä»»å¤©å ‚çš„å…³å¡è®¾è®¡å…¬å¼ï¼š<strong>ä»‹ç»ã€ç»ƒä¹ ã€æŒæ¡ã€å†³æˆ˜</strong>ã€‚æˆ‘å¯¹æ­¤çš„ç†è§£æ˜¯ï¼š</p><ol><li><strong>ä»‹ç»</strong>  åœ¨å®‰å…¨çš„ç¯å¢ƒä¸‹å‘ç©å®¶ä»‹ç»ä¸€ä¸ªæ–°æœºåˆ¶ã€‚</li><li><strong>ç»ƒä¹ ä¸æŒæ¡</strong>  é€æ¸æé«˜éš¾åº¦ï¼Œå°è¯•å°†æ–°æœºåˆ¶ä¸æ—§æœºåˆ¶ç›¸ç»“åˆã€‚</li><li><strong>å†³æˆ˜</strong>  ç©å®¶å¯¹æœºåˆ¶æŒæ¡ç¨‹åº¦çš„ç»¼åˆè€ƒéªŒï¼ŒåŒæ—¶åŒ…å«ä¸€å®šçš„ä»ªå¼æ€§ä»¥å¸¦æ¥æˆå°±æ„Ÿã€‚</li></ol><p>åŒæ—¶ï¼Œå¯¹äºä»‹ç»éƒ¨åˆ†ï¼Œæˆ‘æ›´å€¾å‘äºä»¥æ½œç§»é»˜åŒ–çš„æ–¹å¼ï¼Œä»¥éæ–‡å­—çš„å½¢å¼æ•™ä¼šç©å®¶ä¸€ä¸ªæœºåˆ¶ã€‚</p><h3 id="ä»¥ç¬¬ä¸€å…³ä¸ºä¾‹"><a href="#ä»¥ç¬¬ä¸€å…³ä¸ºä¾‹" class="headerlink" title="ä»¥ç¬¬ä¸€å…³ä¸ºä¾‹"></a>ä»¥ç¬¬ä¸€å…³ä¸ºä¾‹</h3><p>&emsp;&emsp; <strong>å›¾1.1ä¸­</strong> ï¼Œä¸‰æ¬¡èµ·è·³ç‚¹çš„é—´éš”æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚ç©å®¶åœ¨ç†Ÿæ‚‰è¿™ä¸ªèŠ‚å¥åï¼Œç¬¬ä¸‰æ¬¡èµ·è·³åä¸€å®šä¼šè¸©åˆ°é’è›™èº«ä¸Šå°†é’è›™æ¶ˆç­.è¿™é‡Œä»‹ç»çš„ä¾¿æ˜¯ä¸‹è½å¯ä»¥æ¶ˆç­æ•Œäººçš„æœºåˆ¶ã€‚</p><ul><li><em>è¿™é‡Œå€Ÿé‰´äº†ç©ºæ´éª‘å£«çš„æ–°æ‰‹æ•™ç¨‹ã€‚</em></li></ul><p>&emsp;&emsp; <strong>å›¾1.2</strong> é’è›™ä¹‹åç´§æ¥ç€æ”¾ç½®äº†ä¸€ä¸ªä¸èƒ½ä»¥æ™®é€šæ–¹å¼è·å¾—çš„é’»çŸ³ï¼Œè¿™é‡Œéœ€è¦åˆ©ç”¨æ¶ˆç­é’è›™ä¹‹åé‡ç½®è·³è·ƒæ¬¡æ•°çš„æœºåˆ¶è¿›è¡ŒäºŒæ®µè·³ã€‚</p><ul><li><em>å½“ç„¶è¿™æ˜¯ä¸ªä¸è®²ç†çš„è®¾è®¡ï¼Œç†æƒ³æƒ…å†µæ˜¯ç”±ç»éªŒä¸°å¯Œç©å®¶ä¸‹æ„è¯†æŒ‰å‡ºäºŒæ®µè·³å¹¶æ”¶è·ä¸€ç‚¹å°æƒŠå–œï¼Œç„¶è€Œå®é™…æµ‹è¯•æ—¶å‘ç°å¤šæ•°ç©å®¶ä¼šåœ¨å¤šæ¬¡é‡å¼€å…³å¡åæ‰æ„è¯†åˆ°è¿™ä¸ªæœºåˆ¶ã€‚å›å¤´æœ‰æƒ³æ³•äº†å†ä¼˜åŒ–ç½¢ã€‚</em></li></ul><p>&emsp;&emsp; <strong>å›¾1.3</strong> ä¸­è®¾ç½®ä¹‹å‰ä¸¤å€å®½çš„è·³è·ƒè·ç¦»å¹¶åœ¨æ­£ä¸­å¤®æ”¾ç½®æ¨±æ¡ƒï¼Œè¿™é‡Œä»‹ç»çš„æ˜¯æ‹¾å–æ¨±æ¡ƒå¯ä»¥å¢åŠ è·³è·ƒæ¬¡æ•°çš„æœºåˆ¶</p><p>&emsp;&emsp; <strong>å›¾1.4</strong> ä¾¿æ˜¯å¯¹ç©å®¶çš„æœ€ç»ˆè€ƒéªŒï¼Œå…¼å…·éš¾åº¦ä¸çˆ½å¿«ï¼ˆ</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/SunnyLand/s11.png" alt="1.1"></div><div class="group-image-wrap"><img src="/img/SunnyLand/s12.png" alt="1.2"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/SunnyLand/s13.png" alt="1.3"></div><div class="group-image-wrap"><img src="/img/SunnyLand/s14.png" alt="1.4"></div></div></div><p><strong>æ€»ç»“ä¸€ä¸‹</strong><br>&emsp;&emsp;å…³å¡è®¾è®¡è¿‡äºä¾èµ–ç©å®¶å…ˆå‰çš„æ¸¸æˆç»éªŒäº†ã€‚<br>&emsp;&emsp;æµ‹è¯•æ—¶æœ‰äººèƒ½åœ¨ååˆ†é’Ÿå†…é€šå…³å¹¶ä¸”æŒ–æ˜å‡ºä¸€äº›æˆ‘ä¹Ÿæ²¡æœ‰æ„è¯†åˆ°çš„æœºåˆ¶ï¼Œä½†åŒæ—¶æ›´å¤šçš„äººä¼šåæ§½éš¾åº¦è¿‡é«˜æœ‰ç‚¹æŠ˜ç£¨ã€‚å¦‚ä½•æ‰¾åˆ°å…¶ä¸­çš„å¹³è¡¡ç‚¹æ˜¯è¿˜éœ€è¦è€ƒè™‘çš„äº‹ã€‚</p><h2 id="å…³äºæœºåˆ¶"><a href="#å…³äºæœºåˆ¶" class="headerlink" title="å…³äºæœºåˆ¶"></a>å…³äºæœºåˆ¶</h2><p><strong>æ˜æ–‡ä»‹ç»è¿‡çš„æœºåˆ¶</strong></p><ul><li>Aã€Dç§»åŠ¨</li><li>ç©ºæ ¼è·³è·ƒ</li><li>Ré‡æ–°å¼€å§‹å½“å‰å…³å¡</li></ul><p><strong>éœ€è¦ç©å®¶æ‚Ÿå‡ºæ¥çš„æœºåˆ¶</strong></p><ul><li>æ‹¾å–æ¨±æ¡ƒå¢åŠ ä¸€æ¬¡è·³è·ƒæ¬¡æ•°</li><li>æ¶ˆç­æ•Œäººé‡ç½®è·³è·ƒæ¬¡æ•°</li><li>è§¦åœ°é‡ç½®è·³è·ƒæ¬¡æ•°</li><li>éè§¦åœ°çŠ¶æ€æ— æ³•èµ·è·³</li></ul><p><strong>å…¶ä»–ï¼ˆæ²¡ä»€ä¹ˆç”¨ï¼‰çš„æœºåˆ¶</strong></p><ul><li>Sä¸‹è¹²</li><li>Nä¸‹ä¸€å…³</li><li>å°ç‹ç‹¸ä¼šè¢«ç§»åŠ¨æ¿å‹æ­»</li><li>ä¸€å¤„éšè—</li></ul><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p><img src="/img/SunnyLand/ed.png"></p><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p><a href="https://www.bilibili.com/video/BV1tq4y1M78n">æ¼”ç¤ºè§†é¢‘</a><br><a href="https://github.com/Hinageshi01/2DPlatformProject">GitHub</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>C#</tag>
      
      <tag>Unity</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Archiveã€‘Make Your First Game</title>
    <link href="/2021/08/12/MakeYourFirstGame/"/>
    <url>/2021/08/12/MakeYourFirstGame/</url>
    
    <content type="html"><![CDATA[<h2 id="è§’è‰²æ§åˆ¶ï¼ŒåŒ…æ‹¬ç§»åŠ¨ä¸å¤šæ®µè·³"><a href="#è§’è‰²æ§åˆ¶ï¼ŒåŒ…æ‹¬ç§»åŠ¨ä¸å¤šæ®µè·³" class="headerlink" title="è§’è‰²æ§åˆ¶ï¼ŒåŒ…æ‹¬ç§»åŠ¨ä¸å¤šæ®µè·³"></a>è§’è‰²æ§åˆ¶ï¼ŒåŒ…æ‹¬ç§»åŠ¨ä¸å¤šæ®µè·³</h2><h3 id="æœå‘"><a href="#æœå‘" class="headerlink" title="æœå‘"></a>æœå‘</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-built_in">float</span> forward = Input.GetAxisRaw(<span class="hljs-string">&quot;Horizontal&quot;</span>);<span class="hljs-comment">// è¿”å›-1,0,1</span><br><span class="hljs-keyword">if</span> (forward != <span class="hljs-number">0</span>) &#123;<br> transform.localScale = <span class="hljs-keyword">new</span> Vector3(forward, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç§»åŠ¨"><a href="#ç§»åŠ¨" class="headerlink" title="ç§»åŠ¨"></a>ç§»åŠ¨</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> speed;<br><span class="hljs-keyword">private</span> Rigidbody2D body;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span>&#123;<br> body = GetComponent&lt;Rigidbody2D&gt;();<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FixedUpDate</span>()</span>&#123;<br> <span class="hljs-built_in">float</span> horizontalMove = Input.GetAxis(<span class="hljs-string">&quot;Horizontal&quot;</span>);<br> body.velocity =<br>        <span class="hljs-keyword">new</span> Vector2(horizontalMove * speed * Time.fixedDeltaTime, body.velocity.y);<br> <span class="hljs-comment">// Input.GetAxis()è¿”å›-1fè‡³1fçš„æµ®ç‚¹ï¼Œè¿™ä¹ˆåšä¼šä½¿è§’è‰²ç§»åŠ¨äº§ç”Ÿâ€œè„šæ»‘â€çš„ç°è±¡</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è·³è·ƒ"><a href="#è·³è·ƒ" class="headerlink" title="è·³è·ƒ"></a>è·³è·ƒ</h3><p>ä»¥è·³è·ƒä½œä¸ºæ ¸å¿ƒç©æ³•ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> jumpForce;<br><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> finalJumpCount;<span class="hljs-comment">// ç”¨äºé‡ç½®jumpCount</span><br><span class="hljs-keyword">public</span> Transform footPoint;<span class="hljs-comment">// ç”¨äºæ£€æµ‹è„šæ˜¯å¦ä¸åœ°é¢æ¥è§¦</span><br><span class="hljs-keyword">public</span> LayerMask ground;<span class="hljs-comment">// ä»£è¡¨åœ°é¢Layer</span><br><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> jumpCount;<span class="hljs-comment">// ä»£è¡¨ç©å®¶å½“å‰å¯è·³è·ƒçš„æ¬¡æ•°</span><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> jumpPressed = <span class="hljs-literal">false</span>, isJumped = <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> time = <span class="hljs-number">-1f</span>;<span class="hljs-comment">// ç”¨äºç¡®ä¿jumpPressedéšæ—¶å¤„äºæ­£ç¡®çŠ¶æ€çš„è®¡æ—¶å™¨</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>()</span> &#123;<br>    <span class="hljs-comment">// åœ¨Updateä¸­ç¡®ä¿èƒ½æ•æ„Ÿåœ°æ¥æ”¶åˆ°èµ·è·³è¯·æ±‚ï¼Œå†å»FixedUpDateä¸­è¿›è¡ŒRigidbodyç›¸å…³çš„è¿ç®—</span><br>    <span class="hljs-keyword">if</span> (Input.GetButtonDown(<span class="hljs-string">&quot;Jump&quot;</span>) &amp;&amp; jumpCount &gt; <span class="hljs-number">0</span>) &#123;<br>        jumpPressed = <span class="hljs-literal">true</span>;<br>        time = Time.time + <span class="hljs-number">0.05f</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (time &gt;= <span class="hljs-number">0</span> &amp;&amp; time &lt; Time.time) &#123;<br>        <span class="hljs-comment">// ç»è¿‡ä¸€ä¸ªçŸ­æš‚çš„è®¡æ—¶åé‡ç½®jumpPressed</span><br>        jumpPressed = <span class="hljs-literal">false</span>;<br>        time = <span class="hljs-number">-1f</span>;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FixedUpdate</span>()</span>&#123;<br>    <span class="hljs-keyword">if</span> (Physics2D.OverlapCircle(footPoint.position, <span class="hljs-number">0.1f</span>, ground)) &#123;<br>        <span class="hljs-comment">// è½åœ°æ—¶é‡ç½®è·³è·ƒç›¸å…³çš„å‚æ•°ï¼Œè€Œä¸”è¦é¿å…åˆšèµ·è·³æ—¶OverlapCircleæ£€æµ‹åˆ°åœ°é¢</span><br>        jumpCount = finalJumpCount;<br>        isJumped = <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (jumpPressed) &#123;<br>        <span class="hljs-comment">// è·³è·ƒ</span><br>        <span class="hljs-keyword">if</span> (Physics2D.OverlapCircle(footPoint.position, <span class="hljs-number">0.3f</span>, ground)) &#123;<br>            <span class="hljs-comment">// åœ°é¢èµ·è·³</span><br>            body.velocity = <span class="hljs-keyword">new</span> Vector2(body.velocity.x, jumpForce);<br>            jumpCount--;<br>            jumpPressed = <span class="hljs-literal">false</span>;<br>            isJumped = <span class="hljs-literal">true</span>;<span class="hljs-comment">// ä»£è¡¨ç»è¿‡è·³è·ƒç¦»å¼€åœ°é¢</span><br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isJumped) &#123;<br>            <span class="hljs-comment">// ç©ºä¸­èµ·è·³</span><br>            body.velocity = <span class="hljs-keyword">new</span> Vector2(body.velocity.x, jumpForce);<br>            jumpCount--;<br>            jumpPressed = <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-comment">// å‰©ä½™æƒ…å†µä¸ºä¸ç»è·³è·ƒç¦»å¼€åœ°é¢ä¸”æ²¡æœ‰æ¶ˆç­æ•Œäºº/åƒåˆ°æ¨±æ¡ƒæ—¶è¯·æ±‚è·³è·ƒï¼Œä¸äºˆèµ·è·³</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç©å®¶ä¸æ”¶é›†ç‰©çš„äº¤äº’ï¼Œä¸æ•Œäººçš„äº¤äº’ã€‚"><a href="#ç©å®¶ä¸æ”¶é›†ç‰©çš„äº¤äº’ï¼Œä¸æ•Œäººçš„äº¤äº’ã€‚" class="headerlink" title="ç©å®¶ä¸æ”¶é›†ç‰©çš„äº¤äº’ï¼Œä¸æ•Œäººçš„äº¤äº’ã€‚"></a>ç©å®¶ä¸æ”¶é›†ç‰©çš„äº¤äº’ï¼Œä¸æ•Œäººçš„äº¤äº’ã€‚</h2><h3 id="æ”¶é›†å“ã€ç®€å•çš„UI"><a href="#æ”¶é›†å“ã€ç®€å•çš„UI" class="headerlink" title="æ”¶é›†å“ã€ç®€å•çš„UI"></a>æ”¶é›†å“ã€ç®€å•çš„UI</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">using</span> UnityEngine.UI;<br><br><span class="hljs-keyword">public</span> Text diamondCount;<br><span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> diamond = <span class="hljs-number">0</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTriggerEnter2D</span>(<span class="hljs-params">Collider2D collision</span>)</span> &#123;<br>    <span class="hljs-keyword">if</span> (collision.CompareTag(<span class="hljs-string">&quot;Cherry&quot;</span>)) &#123;<br>        Destroy(collision.gameObject);<br>        jumpCount++;<br>        isJumped = <span class="hljs-literal">true</span>;<br>        <span class="hljs-comment">// æ— è®ºæ€æ ·ç¦»å¼€åœ°é¢ï¼Œåƒåˆ°æ¨±æ¡ƒåè§£é”è·³è·ƒæ¡ä»¶</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (collision.CompareTag(<span class="hljs-string">&quot;Diamond&quot;</span>)) &#123;;<br>        Destroy(collision.gameObject);<br>        diamond++;<br>        diamondCount.text = diamond.ToString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ•Œäºº"><a href="#æ•Œäºº" class="headerlink" title="æ•Œäºº"></a>æ•Œäºº</h3><h4 id="çˆ¶ç±»"><a href="#çˆ¶ç±»" class="headerlink" title="çˆ¶ç±»"></a>çˆ¶ç±»</h4><p>é¦–å…ˆåˆ›å»ºæ‰€æœ‰æ•Œäººç±»çš„çˆ¶ç±» Enemyï¼Œå…¶ä¸­æ’­æ”¾æ­»äº¡åŠ¨ç”»å’Œæ‘§æ¯å¯¹è±¡çš„æ–¹æ³•å¯¹æ‰€æœ‰æ•Œäººæ¥è¯´éƒ½æ˜¯é€šç”¨çš„ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Enemy</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">protected</span> Animator animator;<br>    <span class="hljs-keyword">protected</span> Rigidbody2D rb;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> deathID;<br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span> &#123;<br>        animator = GetComponent&lt;Animator&gt;();<br>        rb = GetComponent&lt;Rigidbody2D&gt;();<br>        deathID = Animator.StringToHash(<span class="hljs-string">&quot;Death&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Death</span>()</span> &#123;<br>        GetComponent&lt;Collider2D&gt;().enabled = <span class="hljs-literal">false</span>;<br>        rb.constraints = RigidbodyConstraints2D.FreezeAll;<br>        <span class="hljs-comment">// æ²¿æ‰€æœ‰è½´å†»ç»“æ—‹è½¬å’Œç§»åŠ¨ï¼Œä¿è¯Enemyä¸è‡³äºä¸€è¾¹è¢«ç©å®¶ä¸€è„šè¸¹é£ä¸€è¾¹æ’­æ”¾æ­»äº¡åŠ¨ç”»</span><br>        animator.SetTrigger(deathID);<br>    &#125;<br><br>    <span class="hljs-comment">// åœ¨DeathåŠ¨ç”»çš„ç»“å°¾è°ƒç”¨</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Disappear</span>()</span> &#123;<br>        Destroy(gameObject);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Frogç±»"><a href="#Frogç±»" class="headerlink" title="Frogç±»"></a>Frogç±»</h4><p>Frog éœ€è¦åœ¨ä¸€å®šèŒƒå›´å†…ä»¥è·³è·ƒçš„æ–¹å¼ç§»åŠ¨ï¼Œè¿™ä¸ªåæ ‡ç”±ä»–çš„ä¸¤ä¸ªå­ç‰©ä½“ leftPoint å’Œ rightPoint æä¾›ã€‚ä½¿ç”¨åŠ¨ç”»äº‹ä»¶æ–¹ä¾¿åœ°ä½¿å‡½æ•°åœ¨æ­£ç¡®çš„æ—¶æœºè¢«è°ƒç”¨ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EnemyFrog</span> : <span class="hljs-title">Enemy</span><br>&#123;<br>    <span class="hljs-keyword">public</span> Transform leftPoint, rightPoint;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> speed;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> jumpForce;<br>    <span class="hljs-keyword">public</span> LayerMask ground;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> forwardLeft;<br><br>    <span class="hljs-keyword">private</span> Rigidbody2D body;<br>    <span class="hljs-keyword">private</span> Collider2D collisionBox;<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> leftX, rightX;<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> jumpingID, fallingID;<br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span> &#123;<br>        <span class="hljs-keyword">base</span>.Start();<br>        body = GetComponent&lt;Rigidbody2D&gt;();<br>        collisionBox = GetComponent&lt;Collider2D&gt;();<br>        leftX = leftPoint.position.x;<br>        rightX = rightPoint.position.x;<br>        Destroy(leftPoint.gameObject);<br>        Destroy(rightPoint.gameObject);<br>        <span class="hljs-comment">// è·å–ç§»åŠ¨èŒƒå›´åæ ‡åå³å¯æ‘§æ¯æ ‡å¿—å¯¹è±¡</span><br>        jumpingID = Animator.StringToHash(<span class="hljs-string">&quot;Jumping&quot;</span>);<br>        fallingID = Animator.StringToHash(<span class="hljs-string">&quot;Falling&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>()</span> &#123;<br>        <span class="hljs-keyword">if</span> (animator.GetBool(jumpingID) &amp;&amp; body.velocity.y &lt;= <span class="hljs-number">0</span>) &#123;<br>            animator.SetBool(jumpingID, <span class="hljs-literal">false</span>);<br>            animator.SetBool(fallingID, <span class="hljs-literal">true</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (animator.GetBool(fallingID) &amp;&amp; collisionBox.IsTouchingLayers(ground)) &#123;<br>            animator.SetBool(fallingID, <span class="hljs-literal">false</span>);<br>            body.velocity = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">movement</span>()</span> &#123;<span class="hljs-comment">// åœ¨IdelåŠ¨ç”»çš„ç»“å°¾è°ƒç”¨</span><br>        <span class="hljs-keyword">if</span> (forwardLeft) &#123;<span class="hljs-comment">// æœå·¦</span><br>            <span class="hljs-keyword">if</span> (transform.position.x &lt;= leftX) &#123;<span class="hljs-comment">// éœ€è¦è½¬èº«</span><br>                forwardLeft = <span class="hljs-literal">false</span>;<br>                transform.localScale = <span class="hljs-keyword">new</span> Vector3(<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>            &#125;<br>            body.velocity = <span class="hljs-keyword">new</span> Vector2(-transform.localScale.x * speed, jumpForce);<br>            animator.SetBool(jumpingID, <span class="hljs-literal">true</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// æœå³</span><br>            <span class="hljs-keyword">if</span> (transform.position.x &gt;= rightX) &#123;<span class="hljs-comment">// éœ€è¦è½¬èº«</span><br>                forwardLeft = <span class="hljs-literal">true</span>;<br>                transform.localScale = <span class="hljs-keyword">new</span> Vector3(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>            &#125;<br>            body.velocity = <span class="hljs-keyword">new</span> Vector2(-transform.localScale.x * speed, jumpForce);<br>            animator.SetBool(jumpingID, <span class="hljs-literal">true</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="PlayerControllerç±»"><a href="#PlayerControllerç±»" class="headerlink" title="PlayerControllerç±»"></a>PlayerControllerç±»</h4><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnCollisionEnter2D</span>(<span class="hljs-params">Collision2D collision</span>)</span> &#123;<br>    <span class="hljs-keyword">if</span> (collision.gameObject.CompareTag(<span class="hljs-string">&quot;Enemy&quot;</span>)) &#123;<span class="hljs-comment">// è§¦æ•Œ</span><br>        <span class="hljs-keyword">if</span> (animator.GetBool(fallingID) &amp;&amp;<br>            transform.position.y - collision.transform.position.y &gt; <span class="hljs-number">0.35f</span>) &#123;<br><br>            <span class="hljs-comment">// ä¿è¯è§¦æ•Œæ—¶ä¸¤è€…å¤„äºä¸€ä¸ªç›¸å¯¹å‚ç›´çš„ä½ç½®</span><br>            Enemy enemy = collision.gameObject.GetComponent&lt;Enemy&gt;();<br>            enemy.Death();<br>            body.velocity = <span class="hljs-keyword">new</span> Vector2(body.velocity.x, jumpForce);<br>            jumpCount = finalJumpCount;<br>            isJumped = <span class="hljs-literal">true</span>;<br>            <span class="hljs-comment">// æ— è®ºæ€æ ·ç¦»å¼€åœ°é¢ï¼Œæ¶ˆç­æ•Œäººåè§£é”è·³è·ƒæ¡ä»¶</span><br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// å—ä¼¤</span><br>            isHurt = <span class="hljs-literal">true</span>;<span class="hljs-comment">// ç”¨äºåˆ‡æ¢åŠ¨ç”»ä»¥åŠå±è”½å—ä¼¤çŠ¶æ€ä¸‹ç§»åŠ¨ç›¸å…³çš„è¾“å…¥</span><br>            <span class="hljs-keyword">if</span> (transform.position.x &lt;= collision.transform.position.x) &#123;<span class="hljs-comment">// å³ä¾§è§¦æ•Œ</span><br>                body.velocity = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">-10f</span>, body.velocity.y + jumpForce * <span class="hljs-number">0.7f</span>);<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">// å·¦ä¾§æ¥æ•Œ</span><br>                body.velocity = <span class="hljs-keyword">new</span> Vector2(<span class="hljs-number">10f</span>, body.velocity.y + jumpForce * <span class="hljs-number">0.7f</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¯¹è¯æ¡†ã€è¿åŠ¨é€è§†ã€èœå•ä¸­è°ƒèŠ‚éŸ³é‡ã€‚"><a href="#å¯¹è¯æ¡†ã€è¿åŠ¨é€è§†ã€èœå•ä¸­è°ƒèŠ‚éŸ³é‡ã€‚" class="headerlink" title="å¯¹è¯æ¡†ã€è¿åŠ¨é€è§†ã€èœå•ä¸­è°ƒèŠ‚éŸ³é‡ã€‚"></a>å¯¹è¯æ¡†ã€è¿åŠ¨é€è§†ã€èœå•ä¸­è°ƒèŠ‚éŸ³é‡ã€‚</h2><h3 id="å¯¹è¯æ¡†æç¤º"><a href="#å¯¹è¯æ¡†æç¤º" class="headerlink" title="å¯¹è¯æ¡†æç¤º"></a>å¯¹è¯æ¡†æç¤º</h3><p>å¯¹è¯æ¡†çš„æ¸å…¥æ¸å‡ºå’Œç§»åŠ¨ç”±å½•åˆ¶åŠ¨ç”»å®ç°ï¼Œé€šç”¨çš„ Dialog ç±»æŒ‚è½½åœ¨ä¸€ä¸ª Trigger ä¸Šï¼Œè´Ÿè´£åŠ¨ç”»çš„åˆ‡æ¢ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dialog</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> GameObject dialog;<br><br>    <span class="hljs-keyword">private</span> Animator animator;<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> enterID,exitID;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span> &#123;<br>        animator = dialog.GetComponent&lt;Animator&gt;();<br>        enterID = Animator.StringToHash(<span class="hljs-string">&quot;Enter&quot;</span>);<br>        exitID = Animator.StringToHash(<span class="hljs-string">&quot;Exit&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTriggerStay2D</span>(<span class="hljs-params">Collider2D collision</span>)</span> &#123;<br>        <span class="hljs-keyword">if</span> (collision.CompareTag(<span class="hljs-string">&quot;Player&quot;</span>) &amp;&amp; !dialog.activeSelf) &#123;<br>            dialog.SetActive(<span class="hljs-literal">true</span>);<br>            animator.SetBool(enterID, <span class="hljs-literal">true</span>);<br>            animator.SetBool(exitID, <span class="hljs-literal">false</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTriggerExit2D</span>(<span class="hljs-params">Collider2D collision</span>)</span> &#123;<br>        <span class="hljs-keyword">if</span> (collision.CompareTag(<span class="hljs-string">&quot;Player&quot;</span>)) &#123;<br>            animator.SetBool(enterID, <span class="hljs-literal">false</span>);<br>            animator.SetBool(exitID, <span class="hljs-literal">true</span>);<br>            Invoke(<span class="hljs-string">&quot;setActiceFalse&quot;</span>, <span class="hljs-number">0.1f</span>);<span class="hljs-comment">//ç­‰å¾…é€€å‡ºåŠ¨ç”»ç»“æŸ</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setActiceFalse</span>()</span> &#123;<br>        dialog.SetActive(<span class="hljs-literal">false</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¿åŠ¨é€è§†"><a href="#è¿åŠ¨é€è§†" class="headerlink" title="è¿åŠ¨é€è§†"></a>è¿åŠ¨é€è§†</h3><p>å°†è¿™ä¸ªè„šæœ¬æŒ‚è½½åœ¨æŸä¸€å±‚èƒŒæ™¯ä¸Šã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Parallax</span> : <span class="hljs-title">MonoBehaviour</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">new</span> Transform camera;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> moveRate;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> lockY;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> bgStartX, bgStartY;<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> cmStartX, cmStartY;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span>&#123;<br>        bgStartX = transform.position.x;<br>        bgStartY = transform.position.y;<br><br>        cmStartX = camera.position.x;<br>        cmStartY = camera.position.y;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>()</span>&#123;<br>        <span class="hljs-built_in">float</span> difX = camera.position.x - cmStartX;<br>        <span class="hljs-built_in">float</span> difY = camera.position.y - cmStartY;<br><br>        <span class="hljs-keyword">if</span> (lockY) &#123;<br>            transform.position = <span class="hljs-keyword">new</span> Vector2(bgStartX + difX * moveRate,<br>                transform.position.y);<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            transform.position =<br>                <span class="hljs-keyword">new</span> Vector2(bgStartX + difX, bgStartY + difY) * moveRate;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="éŸ³é‡è°ƒèŠ‚"><a href="#éŸ³é‡è°ƒèŠ‚" class="headerlink" title="éŸ³é‡è°ƒèŠ‚"></a>éŸ³é‡è°ƒèŠ‚</h3><p>å°†æ‰€æœ‰ Source è¾“å‡ºåˆ°ä¸€ä¸ª Mixer å†…ï¼Œè‹¥æƒ³æ›´æ–° Mixer çš„å±æ€§ï¼ˆæ¯”å¦‚éŸ³é‡ï¼‰ï¼Œéœ€å…ˆå°†éŸ³é¢‘ç»„æ£€è§†é¢æ¿ä¸­çš„å±æ€§æš´éœ²å‡ºæ¥å† Setã€‚å†å°†è¯¥å‡½æ•°äº¤ç”±ä¸€ SliderUI è°ƒç”¨ï¼ŒåŠ¨æ€åœ°ä¼ å…¥å€¼å³å¯ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetAudioVolume</span>(<span class="hljs-params"><span class="hljs-built_in">float</span> volume</span>)</span> &#123;<br>    audioMixer.SetFloat(<span class="hljs-string">&quot;MainVolume&quot;</span>, volume);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p><a href="https://space.bilibili.com/370283072/channel/seriesdetail?sid=212003">M_Studio</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/Input.html">Input</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/Rigidbody2D.html">Rigidbody2D</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/Physics2D.html">Physics2D</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/RigidbodyConstraints2D.html">RigidbodyConstraints2D</a><br><a href="https://docs.unity.cn/cn/2019.4/ScriptReference/Time-timeScale.html">timeScale</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>AI</tag>
      
      <tag>C#</tag>
      
      <tag>Unity</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Archiveã€‘Soul Forging, a Minecraft mod</title>
    <link href="/2021/08/07/SoulForging/"/>
    <url>/2021/08/07/SoulForging/</url>
    
    <content type="html"><![CDATA[<div class="note note-secondary">            <p>æœ¬æ¨¡ç»„æ‰€ä½¿ç”¨çš„ Forge ç‰ˆæœ¬ä¸º 1.12.2-14.23.5.2847</p>          </div><h2 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h2><p><strong>æ¬¢è¿ä½¿ç”¨SoulForgingï¼</strong><br>&emsp;&emsp;è¿™æ˜¯ä¸€ä¸ªå…³äºçµé­‚å’Œé‡‘å±çš„æ¨¡ç»„ï¼Œæ–°çš„æ­¦å™¨ï¼Œæ–°çš„ç›”ç”²ï¼Œæ–°çš„é™„é­”ï¼Œæ–°çš„é£Ÿç‰©ï¼Œæ–°çš„æ‘æ°‘ï¼Œæ–°çš„æ•Œäººç­‰å¾…ç€ä½ çš„æ¢ç´¢â€¦â€¦</p><ul><li>ä»¥â€œä½¿åŸç‰ˆç”¨å¤„æœ€å°çš„é‡‘å‘æŒ¥ä½œç”¨â€ä¸ºåˆ‡å…¥ç‚¹</li><li>æ·»åŠ æ–°çš„é‡‘å±é”­â€œèµ‹é­‚é‡‘â€ï¼Œæ•°å€¼é«˜äºé’»çŸ³ä¸”æ‹¥æœ‰ä¸é‡‘ç›¸åŒçš„é™„é­”å“è´¨</li><li>ä¸ºå¤§éƒ¨åˆ†å®ä½“æ·»åŠ æ–°çš„æ‰è½ç‰©</li><li><a href="http://school-works.test.upcdn.net/SoulForging-1.1.0.jar">cdn</a></li><li><a href="https://wwr.lanzoui.com/iZ9sSstof7i">è“å¥äº‘</a> å¯†ç : f4k8</li></ul><h2 id="ä¸€è§ˆ"><a href="#ä¸€è§ˆ" class="headerlink" title="ä¸€è§ˆ"></a>ä¸€è§ˆ</h2><p><img src="/img/SoulForging/yl.png"></p><h2 id="åˆæˆè§„åˆ™ä¸çƒ§ç‚¼è§„åˆ™"><a href="#åˆæˆè§„åˆ™ä¸çƒ§ç‚¼è§„åˆ™" class="headerlink" title="åˆæˆè§„åˆ™ä¸çƒ§ç‚¼è§„åˆ™"></a>åˆæˆè§„åˆ™ä¸çƒ§ç‚¼è§„åˆ™</h2><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/SoulForging/zz_lhk.png"></div><div class="group-image-wrap"><img src="/img/SoulForging/zz_jj.png"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/SoulForging/zz_dhl.png"></div><div class="group-image-wrap"><img src="/img/SoulForging/zz_fhj.png"></div></div></div><h2 id="éƒ¨åˆ†ç‰©å“æ•ˆæœ"><a href="#éƒ¨åˆ†ç‰©å“æ•ˆæœ" class="headerlink" title="éƒ¨åˆ†ç‰©å“æ•ˆæœ"></a>éƒ¨åˆ†ç‰©å“æ•ˆæœ</h2><p><img src="/img/SoulForging/xg_jj.png" alt="çµé­‚ç»“æ™¶å¯ä»¥å½“ä½œéª¨ç²‰ä½¿ç”¨"><br><img src="/img/SoulForging/xg_wg.png" alt="ç”šè‡³èƒ½å¢åŠ ç»éªŒï¼Œå¦‚æ­¤ç¾å‘³ï¼"></p><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p><a href="https://www.mcmod.cn/class/4409.html">mcç™¾ç§‘</a><br><a href="https://github.com/Hinageshi01/SoulForging">GitHub</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Forge</tag>
      
      <tag>Java</tag>
      
      <tag>mod</tag>
      
      <tag>Minecraft</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å›¾å½¢/å¼•æ“/æ¸²æŸ“ç›¸å…³é¢ç»</title>
    <link href="/1970/02/01/Audition/"/>
    <url>/1970/02/01/Audition/</url>
    
    <content type="html"><![CDATA[<h2 id="ç½‘æ˜“äº’å¨±ï¼šæ¸¸æˆå¼•æ“ç ”å‘å·¥ç¨‹å¸ˆ"><a href="#ç½‘æ˜“äº’å¨±ï¼šæ¸¸æˆå¼•æ“ç ”å‘å·¥ç¨‹å¸ˆ" class="headerlink" title="ç½‘æ˜“äº’å¨±ï¼šæ¸¸æˆå¼•æ“ç ”å‘å·¥ç¨‹å¸ˆ"></a>ç½‘æ˜“äº’å¨±ï¼šæ¸¸æˆå¼•æ“ç ”å‘å·¥ç¨‹å¸ˆ</h2><h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><ul><li>class ä¸ struct æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>äº†è§£è¿‡å†…å­˜å¯¹é½å—ï¼Œä¸ºä»€ä¹ˆè¦å¯¹é½ï¼Œä¸å¯¹é½ä¼šæ€æ ·ï¼Ÿ<br><a href="https://blog.csdn.net/u014608280/article/details/79910820">struct å†…å­˜å¯¹é½</a><br><a href="http://www.cppblog.com/deercoder/archive/2011/03/13/141747.html">__declspec(align(#)) çš„ç”¨æ³•å’Œå¤§å°è®¡ç®—</a></li><li><code>  struct TA &#123;   char a;   int b;   char c;   &#125;;   struct TB &#123;   char a;   char b;   int c;   &#125;;</code><br>è¿™ä¸¤ä¸ªç»“æ„ä½“çš„å¤§å°ä¸€æ ·å—ï¼Ÿ</li><li>C++ 11 æ˜¯ä»€ä¹ˆï¼ŒC++ 11 æœ‰ä»€ä¹ˆæ–°ç‰¹æ€§ï¼Œè¯´ä¸€ä¸‹ä½ å¯¹ C++ 11 çš„ç†è§£ã€‚<br><a href="https://blog.csdn.net/jiange_zh/article/details/79356417">C++11 å¸¸ç”¨æ–°ç‰¹æ€§å¿«é€Ÿä¸€è§ˆ</a></li><li>C++ çš„å¤šæ€æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</li><li>è™šå‡½æ•°æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨è™šå‡½æ•°ï¼Œè™šå‡½æ•°æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œè™šå‡½æ•°è¡¨åœ¨å“ªï¼Œè™šå‡½æ•°æŒ‡é’ˆåœ¨å“ªï¼Ÿ<br><a href="https://blog.csdn.net/weixin_40237626/article/details/82313339">è™šå‡½æ•°å®ç°åŸç†</a><br><a href="https://blog.csdn.net/xiejingfa/article/details/50454819">C++ è™šå‡½æ•°å®ç°åŸç†</a></li></ul><h3 id="å›¾å½¢å­¦"><a href="#å›¾å½¢å­¦" class="headerlink" title="å›¾å½¢å­¦"></a>å›¾å½¢å­¦</h3><ul><li>ç®€è¿°ä¸€ä¸‹æ¸²æŸ“ç®¡çº¿ã€‚</li><li>äº†è§£è¿‡çº¿æ€§é¢œè‰²ç©ºé—´å—ï¼Ÿ<br><a href="https://zhuanlan.zhihu.com/p/35894054">GPU Gems 3 Chapter 24</a><br><a href="https://www.cnblogs.com/guanzz/p/7416821.html">Gamma ä¸çº¿æ€§é¢œè‰²ç©ºé—´</a><br><a href="https://www.zhihu.com/question/27467127/answer/37602200">è‰²å½©æ ¡æ­£ä¸­çš„ gamma å€¼æ˜¯ä»€ä¹ˆï¼Ÿ</a><br><a href="https://www.zhihu.com/question/20084968">ä»€ä¹ˆæ˜¯çº¿æ€§</a><br><a href="https://64.github.io/tonemapping/">Tone Mapping</a><br><a href="https://blog.csdn.net/candycat1992/article/details/46228771/">æˆ‘ç†è§£çš„ä¼½é©¬æ ¡æ­£</a><br><a href="https://zhuanlan.zhihu.com/p/271011254">ä¼½é©¬è¿˜æ˜¯çº¿æ€§ï¼Ÿç”¨ä¸€å¼ å›¾ç†ç†åœ¨U3Dä¸­è¯¥å¦‚ä½•è®¾ç½®ã€‚</a><br><a href="https://zhuanlan.zhihu.com/p/21983679">Tone mapping è¿›åŒ–è®º</a></li><li>è¯» glslï¼Œè´´å›¾é‡‡æ ·ã€æ€§èƒ½ä¼˜åŒ–ã€é«˜ç²¾åº¦æµ®ç‚¹ã€‚</li><li>äº†è§£è¿‡å¸‚é¢ä¸Šæ¸¸æˆä¸­çš„æ¸²æŸ“æŠ€æœ¯å—ï¼Ÿ</li></ul><h2 id="æœç‹ç•…æ¸¸ï¼šå¼•æ“å¼€å‘"><a href="#æœç‹ç•…æ¸¸ï¼šå¼•æ“å¼€å‘" class="headerlink" title="æœç‹ç•…æ¸¸ï¼šå¼•æ“å¼€å‘"></a>æœç‹ç•…æ¸¸ï¼šå¼•æ“å¼€å‘</h2><ul><li>èƒŒé¢å‰”é™¤æ€ä¹ˆåšçš„ï¼Ÿ</li><li>æ·±åº¦æµ‹è¯•å‘ç”Ÿåœ¨é‚£ä¸ªé˜¶æ®µï¼Œäº†è§£è¿‡ Early-Z å—ï¼Ÿ</li><li>æ¨å¯¼ä¸€ä¸‹ view çŸ©é˜µã€‚</li><li>å¸ƒæ—å†¯æ¨¡å‹ä¸å†¯æ¨¡å‹å“ªä¸ªå¿«ï¼Ÿ<br><a href="https://hinageshi01.github.io/2021/10/20/CGbasics/#phong">å†¯ä¸å¸ƒæ—å†¯</a></li><li>åšè¿‡ IBL å—ï¼Ÿ</li><li>äº†è§£è¿‡å„ç±»æ¸²æŸ“ä¼˜åŒ–å—ï¼Ÿ<br><a href="https://zhuanlan.zhihu.com/p/68158277">å½“æˆ‘ä»¬è°ˆä¼˜åŒ–æ—¶ï¼Œæˆ‘ä»¬è°ˆäº›ä»€ä¹ˆ</a><br><a href="https://zhuanlan.zhihu.com/p/61358167">GPU å¹¶è¡Œæ¶æ„åŠæ¸²æŸ“ä¼˜åŒ–</a><br><a href="https://www.cnblogs.com/nafio/p/14101561.html">early-zã€z-cullingã€hi-zã€z-perpass åˆ°åº•æ˜¯ä»€ä¹ˆ</a><br><a href="https://zhuanlan.zhihu.com/p/135444145">å»¶è¿Ÿæ¸²æŸ“ä¸ MSAA çš„é‚£äº›äº‹</a></li></ul><h2 id="è…¾è®¯ï¼šæ¸¸æˆå®¢æˆ·ç«¯å¼€å‘"><a href="#è…¾è®¯ï¼šæ¸¸æˆå®¢æˆ·ç«¯å¼€å‘" class="headerlink" title="è…¾è®¯ï¼šæ¸¸æˆå®¢æˆ·ç«¯å¼€å‘"></a>è…¾è®¯ï¼šæ¸¸æˆå®¢æˆ·ç«¯å¼€å‘</h2><ul><li>100 å±‚é«˜æ¥¼æ‰”ä¸¤ä¸ªæ°´æ™¶çƒï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œå¯ä»¥å¿«é€Ÿç¡®å®šæ°´æ™¶çƒä¼šæ‘”ç¢çš„ä¸´ç•Œå€¼ã€‚<br><a href="http://blog.sina.com.cn/s/blog_6c813dbd0101bh98.html#commonComment">100 å±‚æ¥¼æ‰”ä¸¤ä¸ªé¸¡è›‹çš„é—®é¢˜</a></li><li>æµ®ç‚¹æ•°æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿ</li><li>STLåº“ä¸­ sort åº•å±‚å®ç°ã€pow åº•å±‚å®ç°?<br><a href="https://feihu.me/blog/2014/sgi-std-sort/">std::sort æºç å‰–æ</a></li><li>å¿«æ’å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Œæœ‰æ›´å¿«çš„å—ï¼Œæ•°å­¦ä¸Šæ€ä¹ˆè¯æ˜ä½¿ç”¨æ¯”è¾ƒè¿›è¡Œæ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸å°äº O(nLog(n))ï¼Ÿ<br><a href="https://blog.csdn.net/developer1024/article/details/79770240">ç®—æ³•ï¼šæ’åºç®—æ³•ä¹‹æ¡¶æ’åº</a><br><a href="https://blog.csdn.net/micx0124/article/details/9852289">æ’åºçš„æœ€ä½æ—¶é—´å¤æ‚åº¦ä¸ºä»€ä¹ˆæ˜¯ O(nlogn)</a><br><a href="https://www.zhihu.com/question/22393997">å¦‚ä½•è¯æ˜å¿«é€Ÿæ’åºæ³•çš„å¹³å‡å¤æ‚åº¦ä¸º O(nlogn)ï¼Ÿ</a></li><li>ä¸¤ä¸ªè¿›ç¨‹å¤„ç†ä¸€ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªå†™å…¥ä¸€ä¸ªåˆ é™¤ï¼Œæ€ä¹ˆä¸å†²çªï¼Œæ€ä¹ˆå¿«ï¼Ÿ</li><li>å“ˆå¸Œå†²çªäº†æ€ä¹ˆåŠ<br><a href="https://blog.csdn.net/wangwei249/article/details/70172811">å“ˆå¸Œè¡¨åŠå¤„ç†å†²çªçš„æ–¹æ³•</a></li><li>æ¨¡å‹æè¾¹å‡ ç§åšæ³•ï¼Œä½¿ç”¨æ³•çº¿å¤–æ‰©æ—¶å‡ æ¬¡æ¸²æŸ“ï¼Ÿ<br><a href="https://www.bilibili.com/video/BV1YK4y1T7yY?p=11">GAMES202 Lecture 11</a><br>ä¸¤æ¬¡æ¸²æŸ“ï¼Œä¸€æ¬¡å…³é—­æ·±åº¦å†™å…¥ç”»è½®å»“ï¼Œç¬¬äºŒæ¬¡æ­£å¸¸ç”»æ¨¡å‹ã€‚</li><li>å·¥å‚æ¨¡å¼ä¸æŠ½è±¡å·¥å‚åŒºåˆ«ï¼Ÿ<br><a href="https://www.zhihu.com/question/20367734">æŠ½è±¡å·¥å‚æ¨¡å¼å’Œå·¥å‚æ¨¡å¼çš„åŒºåˆ«ï¼Ÿ</a></li><li>Unity çš„åç¨‹ç”¨è¿‡å—ï¼Ÿ</li></ul><h2 id="å¿«æ‰‹ï¼šæ¸¸æˆå›¾å½¢å¼€å‘"><a href="#å¿«æ‰‹ï¼šæ¸¸æˆå›¾å½¢å¼€å‘" class="headerlink" title="å¿«æ‰‹ï¼šæ¸¸æˆå›¾å½¢å¼€å‘"></a>å¿«æ‰‹ï¼šæ¸¸æˆå›¾å½¢å¼€å‘</h2><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><ul><li>åè½¬ä»ä½ç½® left åˆ°ä½ç½® right çš„é“¾è¡¨èŠ‚ç‚¹<br><a href="https://leetcode-cn.com/problems/reverse-linked-list-ii/">LeetCode 92. åè½¬é“¾è¡¨ II</a></li><li>è¾“å‡ºæœ€é•¿çš„ä¸é‡å¤è¿ç»­å­ä¸²çš„é•¿åº¦<br><a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/">LeetCode 3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></li></ul><h3 id="C-1"><a href="#C-1" class="headerlink" title="C++"></a>C++</h3><ul><li>ä»€ä¹ˆæ˜¯çº¯è™šå‡½æ•°ï¼Ÿ</li><li>override ä¸ overload æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>å †ä¸æ ˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<br><a href="https://www.cnblogs.com/hahawgp/archive/2013/04/08/3008737.html">c++ ä¸­åœ¨å †å’Œæ ˆä¸­ç”³è¯·ç©ºé—´çš„å·®åˆ«</a></li><li>map ä¸ set</li></ul><h3 id="å›¾å½¢å­¦-1"><a href="#å›¾å½¢å­¦-1" class="headerlink" title="å›¾å½¢å­¦"></a>å›¾å½¢å­¦</h3><ul><li>æ­£äº¤æŠ•å½±å’Œé€è§†æŠ•å½±çš„çŸ©é˜µæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>æ³•çº¿è´´å›¾æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œä¸ºä»€ä¹ˆæ³•çº¿è´´å›¾åè“è‰²ï¼ŒTBN çŸ©é˜µæ€ä¹ˆæ¨å¯¼ï¼Ÿ<br><a href="https://hinageshi01.github.io/2021/10/20/CGbasics/#%E5%88%87%E7%BA%BF%E7%A9%BA%E9%97%B4%E4%B8%8E%E6%B3%95%E7%BA%BF%E8%B4%B4%E5%9B%BE">åˆ‡çº¿ç©ºé—´ä¸æ³•çº¿è´´å›¾</a></li><li>äº†è§£è¿‡æŠ—é”¯é½¿å—ï¼ŒTAA å’Œ FXAA æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ<br><a href="https://www.bilibili.com/video/BV1kY411P7QM">GAMES104 Lecture 7</a><br><a href="https://www.bilibili.com/video/BV1YK4y1T7yY?p=14">GAMES202 Lecture 14</a></li><li>stencil äº†è§£è¿‡å—ï¼Ÿ</li><li>pbr æè´¨å…¬å¼åŒ…å«å“ªå‡ é¡¹ï¼Œåˆ†åˆ«æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œé‡‘å±åº¦å½±å“çš„æ˜¯å“ªä¸€é¡¹ï¼Ÿ<br><a href="https://www.bilibili.com/video/BV1YK4y1T7yY?p=10">GAMES202 Lecture 10 &amp; 11</a><br><a href="https://learnopengl-cn.github.io/07%20PBR/01%20Theory/">LearnOpenGL</a></li><li>é˜´å½±æ€ä¹ˆåšï¼Œè½¯é˜´å½±æ€ä¹ˆåšï¼Œç€è‰²ç‚¹æ˜¯æ€ä¹ˆå¯¹åº”åˆ° ShadowMap ä¸Šçš„ï¼Œå¹³è¡Œå…‰é˜´å½±æ€ä¹ˆåšï¼Ÿ<br><a href="https://www.bilibili.com/video/BV1YK4y1T7yY?p=3">GAMES202 Lecture 1</a></li><li>glsl å†™ä¸€ä¸ªå¸ƒæ—å†¯</li></ul><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><ul><li>æœ€å°ç”Ÿæˆæ ‘<br><a href="https://www.bilibili.com/video/BV1pT4y1v7Pm">ã€nekoã€‘æœ€å°ç”Ÿæˆæ ‘ã€ç®—æ³•ç¼–ç¨‹#9ã€‘</a></li><li>è¿›ç¨‹ä¸çº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«<br><a href="https://www.zhihu.com/question/25532384/answer/81152571">çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</a></li><li>è™šæ‹Ÿå†…å­˜<br><a href="https://zhuanlan.zhihu.com/p/96098896">å¦‚ä½•ç†è§£è™šæ‹Ÿå†…å­˜</a></li><li>TCP&#x2F;IPï¼Œä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</li><li>çº¢é»‘æ ‘ä¸å¹³è¡¡äºŒå‰æ ‘æœ‰ä»€ä¹ˆåŒºåˆ«</li><li>CPU æ¶æ„</li><li>CPU è°ƒåº¦æœºåˆ¶</li></ul><h2 id="å‰‘å¿ƒäº’å¨±ï¼šæ¸²æŸ“å¼•æ“å¼€å‘å·¥ç¨‹å¸ˆ"><a href="#å‰‘å¿ƒäº’å¨±ï¼šæ¸²æŸ“å¼•æ“å¼€å‘å·¥ç¨‹å¸ˆ" class="headerlink" title="å‰‘å¿ƒäº’å¨±ï¼šæ¸²æŸ“å¼•æ“å¼€å‘å·¥ç¨‹å¸ˆ"></a>å‰‘å¿ƒäº’å¨±ï¼šæ¸²æŸ“å¼•æ“å¼€å‘å·¥ç¨‹å¸ˆ</h2><h3 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><ul><li>ç±»ä¼¼ <a href="https://leetcode-cn.com/problems/invert-binary-tree/">LeetCode 226. ç¿»è½¬äºŒå‰æ ‘</a></li><li>ç±»ä¼¼ <a href="https://leetcode-cn.com/problems/last-moment-before-all-ants-fall-out-of-a-plank/">LeetCode 1503. æ‰€æœ‰èš‚èšæ‰ä¸‹æ¥å‰çš„æœ€åä¸€åˆ»</a><br>å…³é”®åœ¨äºä¸¤åªèš‚èšç¢°æ’çš„æ—¶å€™ä¼šå®Œå…¨äº¤æ¢é€Ÿåº¦ï¼Œå°±åƒä»–ä»¬äº’ä¸å½±å“åœ°ç©¿è¿‡å»äº†ä¸€æ ·ã€‚</li></ul><h3 id="C-2"><a href="#C-2" class="headerlink" title="C++"></a>C++</h3><ul><li>å­—ç¬¦ä¸²é•¿åº¦ï¼Ÿ<br>æœ‰ä¸ª â€˜\0â€™ï¼Œè¦åŠ ä¸€ã€‚</li><li>ç»™å‡ºä¸€æ®µä»£ç <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Foo</span><span class="hljs-params">()</span></span>&#123;<br>  <span class="hljs-type">static</span> <span class="hljs-type">char</span> *pBuffer = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[<span class="hljs-number">128</span>];<br>&#125;<br></code></pre></td></tr></table></figure>pBuffer å­˜å‚¨åœ¨ä»€ä¹ˆå†…å­˜åŒºåŸŸï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°è¢«æ‰§è¡Œå¤šæ¬¡ä¼šæ€ä¹ˆæ ·ï¼Ÿ<br><a href="https://blog.csdn.net/chenlycly/article/details/120958761">å®ä¾‹è¯¦è§£ C++ ç¨‹åºçš„äº”å¤§å†…å­˜åˆ†åŒº</a><br><a href="https://blog.csdn.net/chen1083376511/article/details/54930191">åŠ¨æ€å­˜å‚¨åŒºã€é™æ€å­˜å‚¨åŒºã€å †å’Œæ ˆçš„åŒºåˆ«</a><br><a href="https://www.bilibili.com/video/BV1Ny4y1D7EE">ã€Chernoã€‘Local Static in C++</a></li><li>çˆ¶ç±»è™šå‡½æ•° Aï¼Œå­ç±»åŒåéè™šå‡½æ•°ï¼ˆåº”è¯¥æŒ‡çš„æ˜¯åŒåä¸åŒå‚çš„å‡½æ•°ï¼‰ï¼Œå­ç±»ä¸­è™šå‡½æ•°è¡¨ä¸­å­˜å‚¨çš„æ˜¯å“ªä¸ªå‡½æ•°æŒ‡é’ˆï¼Ÿ<br><a href="https://hinageshi01.github.io/2022/01/24/CppPrimer13-16/#156-%E7%BB%A7%E6%89%BF%E4%B8%AD%E7%9A%84%E7%B1%BB%E4%BD%9C%E7%94%A8%E5%9F%9F">è™šå‡½æ•°ä¸ä½œç”¨åŸŸ</a></li><li>ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨è™šå‡½æ•°ï¼Œçˆ¶ç±»çš„ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°ä¼šæ€ä¹ˆæ ·ï¼Ÿ<br><a href="https://blog.csdn.net/starlee/article/details/619827">C++ ä¸­è™šææ„å‡½æ•°çš„ä½œç”¨</a><br><a href="https://www.bilibili.com/video/BV1dK411w7Gg">ã€68ã€‘ã€Cherno C++ã€‘ã€ä¸­å­—ã€‘C++çš„è™šææ„å‡½æ•°</a><br>æŒ‡å‘å­ç±»çš„çˆ¶ç±»ç±»å‹æŒ‡é’ˆæ— æ³•è°ƒç”¨å­ç±»çš„è™šæ„å‡½æ•°ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚</li><li>new å’Œ malloc æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè‡ªç”±å­˜å‚¨åŒºæ˜¯ä»€ä¹ˆï¼Ÿ<br><a href="https://isocpp.org/wiki/faq/freestore-mgmt#new-malloc-diff">ã€ISOCPPã€‘What is the difference between new and malloc()?</a><br><a href="https://www.cnblogs.com/QG-whz/p/5140930.htmls">ç»†è¯´ new ä¸ malloc çš„ 10 ç‚¹åŒºåˆ«</a><br><a href="https://www.cnblogs.com/QG-whz/p/5060894.html">C++ è‡ªç”±å­˜å‚¨åŒºæ˜¯å¦ç­‰ä»·äºå †ï¼Ÿ</a><blockquote><p>å †æ˜¯ C è¯­è¨€å’Œæ“ä½œç³»ç»Ÿçš„æ¦‚å¿µï¼Œè‡ªç”±å­˜å‚¨åŒºæ˜¯ C++ ä¸­é€šè¿‡ new åŠ¨æ€åˆ†é…å¯¹è±¡çš„æŠ½è±¡æ¦‚å¿µã€‚åŸºæœ¬ä¸Šï¼Œæ‰€æœ‰ C++ ç¼–è¯‘å™¨é¢„è®¾ä¼šä½¿ç”¨å¯¹å»å®ç°è‡ªç”±å­˜å‚¨åŒºã€‚ä½†ç¨‹åºå‘˜ä¹Ÿå¯ä»¥é€šè¿‡é‡è½½æ“ä½œç¬¦æ”¹ç”¨å…¶ä»–æ–¹å¼å®ç°è‡ªç”±å­˜å‚¨åŒºã€‚<br>â€“ã€Šæ¸¸æˆå¼•æ“æ¶æ„ã€‹</p></blockquote></li><li>å†…å­˜æ± äº†è§£è¿‡å—ï¼Ÿ<br><a href="https://zhuanlan.zhihu.com/p/434087002">ç®€å•è®²è§£ C++ å†…å­˜æ± åŸç†ä¸å®ç°</a></li><li>å¼•ç”¨å’ŒæŒ‡é’ˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå¼•ç”¨å å†…å­˜ç©ºé—´å—ï¼Ÿ<br><a href="https://www.cnblogs.com/heyonggang/archive/2012/12/13/2815730.html">C++ ä¸­æŒ‡é’ˆå’Œå¼•ç”¨çš„åŒºåˆ«</a><br><a href="https://www.cnblogs.com/ronny/p/3662556.html">ä½ çœŸçš„äº†è§£å¼•ç”¨å—</a></li><li>ç»“æ„ä½“ä¸ºä»€ä¹ˆè¦å¯¹é½ï¼Œä»€ä¹ˆè§„åˆ™ï¼Œ#pragma pack() çš„åº”ç”¨åœºåˆï¼Ÿ<br><a href="https://www.jianshu.com/p/90a6eef329ec">#pragma pack æŒ‡ä»¤è¯¦è§£</a><br>å…³äºåº”ç”¨åœºåˆï¼Œç½‘ä¸Šçš„æ–‡ç« æ¸…ä¸€è‰²åœ°è¡¨ç¤ºï¼š<blockquote><p>åœ¨ç½‘ç»œåè®®ç¼–ç¨‹ä¸­ï¼Œç»å¸¸ä¼šå¤„ç†ä¸åŒåè®®çš„æ•°æ®æŠ¥æ–‡ã€‚ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡æŒ‡é’ˆåç§»çš„æ–¹æ³•æ¥å¾—åˆ°å„ç§ä¿¡æ¯ï¼Œä½†è¿™æ ·åšä¸ä»…ç¼–ç¨‹å¤æ‚ï¼Œè€Œä¸”ä¸€æ—¦åè®®æœ‰å˜åŒ–ï¼Œç¨‹åºä¿®æ”¹èµ·æ¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚åœ¨äº†è§£äº†ç¼–è¯‘å™¨å¯¹ç»“æ„ç©ºé—´çš„åˆ†é…åŸåˆ™ä¹‹åï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹æ€§å®šä¹‰è‡ªå·±çš„åè®®ç»“æ„ï¼Œé€šè¿‡è®¿é—®ç»“æ„çš„æˆå‘˜æ¥è·å–å„ç§ä¿¡æ¯ã€‚è¿™æ ·åšï¼Œä¸ä»…ç®€åŒ–äº†ç¼–ç¨‹ï¼Œè€Œä¸”å³ä½¿åè®®å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€ä¿®æ”¹åè®®ç»“æ„çš„å®šä¹‰å³å¯ï¼Œå…¶å®ƒç¨‹åºæ— éœ€ä¿®æ”¹ï¼Œçœæ—¶çœåŠ›ã€‚</p></blockquote></li><li>æ¨¡æ¿ä¼˜ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿ<br><a href="https://blog.csdn.net/tonychan129/article/details/21346713">ä½¿ç”¨ c++ æ¨¡æ¿çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</a><br><a href="https://blog.csdn.net/lijiayu2015/article/details/52650790">c++ æ¨¡æ¿ç±»å£°æ˜å’Œå®šä¹‰éƒ½æ”¾åœ¨ .h æ–‡ä»¶çš„åŸå› </a><br><a href="https://zhuanlan.zhihu.com/p/147623943">æ¨¡æ¿ç±»åœ¨ .h ä¸­å®šä¹‰ï¼Œåœ¨ .cpp ä¸­å®ç°</a></li><li>çº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œçº¢é»‘æ ‘ä»€ä¹ˆæƒ…å†µæ¯”å¹³è¡¡äºŒå‰æ ‘å¿«ï¼Œä»€ä¹ˆæƒ…å†µæ…¢ï¼Ÿ<br>æ’å…¥åˆ é™¤å¿«ï¼ŒæŸ¥æ‰¾æ…¢</li><li>é˜Ÿåˆ—æ€ä¹ˆå®ç°ï¼Ÿ<br>æ•°ç»„åŒæŒ‡é’ˆã€åŒå‘é“¾è¡¨</li><li>delete[] æ˜¯æ€ä¹ˆçŸ¥é“æ•°ç»„é•¿åº¦çš„ï¼Ÿ<br><a href="https://isocpp.org/wiki/faq/compiler-dependencies#num-elems-in-new-array-overalloc">ã€ISOCPPã€‘over-allocation</a><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">char</span>* tmp = (<span class="hljs-type">char</span>*) <span class="hljs-keyword">operator</span> <span class="hljs-keyword">new</span>[] (WORDSIZE + n * <span class="hljs-built_in">sizeof</span>(Fred));<br>Fred* p = (Fred*) (tmp + WORDSIZE);<br>*(<span class="hljs-type">size_t</span>*)tmp = n;<br><span class="hljs-keyword">try</span>&#123;<br>  <span class="hljs-comment">// åˆ†é…</span><br>&#125;<br><span class="hljs-built_in">catch</span>(...)&#123; ... &#125;<br></code></pre></td></tr></table></figure><a href="https://isocpp.org/wiki/faq/compiler-dependencies#num-elems-in-new-array-assocarray">ã€ISOCPPã€‘associative array</a><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Fred* p = (Fred*) <span class="hljs-keyword">operator</span> <span class="hljs-keyword">new</span>[] (n * <span class="hljs-built_in">sizeof</span>(Fred));<br><span class="hljs-keyword">try</span>&#123;<br>  <span class="hljs-comment">// åˆ†é…</span><br>&#125;<br><span class="hljs-built_in">catch</span>(...)&#123; ... &#125;<br><span class="hljs-comment">// arrayLengthAssociation is the imaginary name of a hidden, </span><br><span class="hljs-comment">// global associative array that maps from void* to size_t</span><br><span class="hljs-comment">// they maby use an AVL tree</span><br>arrayLengthAssociation.<span class="hljs-built_in">insert</span>(p, n);<br></code></pre></td></tr></table></figure></li><li>å¯¹ new[] å‡ºæ¥çš„æ•°ç»„åš delete ä¼šæ€æ ·ã€‚<br><a href="https://isocpp.org/wiki/faq/freestore-mgmt#delete-array">ã€ISOCPPã€‘What if I forget the [] when deleteing an array allocated via new T[n]?</a><blockquote><p>All life comes to a catastrophic end.</p></blockquote><a href="https://isocpp.org/wiki/faq/freestore-mgmt#delete-array-built-ins">ã€ISOCPPã€‘Can I drop the [] when deleteing an array of some built-in type (char, int, etc)?</a><blockquote><p>But the above code is wrong, and it can cause a disaster at runtime. In particular, the code thatâ€™s called for delete p is operator delete(void*), but the code thatâ€™s called for delete[] p is operator delete<a href="void*"></a>. The default behavior for the latter is to call the former, but users are allowed to replace the latter with a different behavior (in which case they would normally also replace the corresponding new code in operator new<a href="size_t"></a>). If they replaced the delete[] code so it wasnâ€™t compatible with the delete code, and you called the wrong one (i.e., if you said delete p rather than delete[] p), you could end up with a disaster at runtime.</p></blockquote>æˆ‘å¹¶æ²¡æœ‰å®Œå…¨ç†è§£åœ¨è¿™æ ·çš„æç«¯æƒ…å†µä¸­å…·ä½“ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œè¿™é‡Œä»…è®°å½•ä¸€äº›æµ‹è¯•ç»“æœã€‚<br>åœ¨ VS2020 çš„æµ‹è¯•ä¸­ï¼Œå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹æ•°ç»„æ¥è¯´ï¼Œè¿™ä¹ˆæ“ä½œå¹¶ä¸ä¼šå¼•èµ·å†…å­˜æ³„æ¼ã€‚<br>å¯¹äºè‡ªå®šä¹‰çš„æ•°æ®ç±»å‹æ•°ç»„ï¼Œä¸€æ—¦ä¸ºå…¶å®šä¹‰äº†ææ„å‡½æ•°ï¼Œä¾¿ä¼šæŠ¥é”™ï¼š<code>Critical error detected c0000374</code>ã€‚<br>è‹¥æ²¡æœ‰å®šä¹‰ææ„å‡½æ•°ï¼Œåˆåœ¨å¯¹è±¡æ„é€ è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å†…å­˜åˆ†é…ï¼Œä¾¿ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚</li><li>new å‡ºæ¥çš„å†…å­˜å¯ä»¥è¢« free å—?<br><a href="https://isocpp.org/wiki/faq/freestore-mgmt#mixing-malloc-and-delete">ã€ISOCPPã€‘Can I free() pointers allocated with new? Can I delete pointers allocated with malloc()?</a><blockquote><p>There is no guarantee that the mechanism used by new and delete to acquire and release raw memory is compatible with malloc() and free(). If mixing styles works on your system, you were simply â€œluckyâ€ â€“ for now.</p></blockquote></li><li>è™šå‡½æ•°åœ¨è™šå‡½æ•°è¡¨ä¸­æ˜¯æ€ä¹ˆåŒ¹é…çš„ï¼Ÿ<br><a href="https://www.cnblogs.com/Allen-rg/p/6927319.html">è™šå‡½æ•°åº•å±‚åŸç†</a></li><li>ç¼–è¯‘å‡ ä¸ªé˜¶æ®µï¼Ÿ<br><a href="https://blog.csdn.net/wwxy1995/article/details/107869010">C&#x2F;C++ ç¨‹åºç¼–è¯‘çš„å››ä¸ªé˜¶æ®µ</a></li><li>map å’Œ unorder_map åŒºåˆ«ï¼Ÿ<br><a href="https://zhuanlan.zhihu.com/p/210458185">map å’Œ unordered_map çš„åŒºåˆ«</a></li></ul><h3 id="å…¶ä»–-1"><a href="#å…¶ä»–-1" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><ul><li>æœ€å–œæ¬¢å“ªæ¬¾æ¸¸æˆï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li><li>æˆ‘çœ‹ä½  2077 å’Œå·«å¸ˆä¸‰éƒ½ç©è¿‡ï¼Œä½ è§‰å¾— 2077 ç›¸æ¯”äºå·«å¸ˆä¸‰æœ‰å“ªäº›æŠ€æœ¯ä¸Šçš„è¿›æ­¥ï¼Ÿ</li><li>æ¸¸æˆä¸­å®æ—¶å…‰è¿½æ˜¯æ€ä¹ˆåº”ç”¨çš„ï¼Ÿ</li><li>UE5 æ¼”ç¤ºè§†é¢‘çœ‹è¿‡å§ï¼Œä½ è§‰å¾—å°±ç”»é¢æ¥è¯´è¿˜æœ‰å“ªäº›èƒ½å¤Ÿæå‡çš„åœ°æ–¹ï¼Œä¸ºä»€ä¹ˆäººç‰©ç›¸å¯¹äºåœºæ™¯çœ‹èµ·æ¥é‚£ä¹ˆä¸çœŸå®ï¼Ÿ</li><li>ä½ è§‰å¾—åœ¨æ¸¸æˆç”»é¢ä¸­å“ªéƒ¨åˆ†æœ€å®¹æ˜“è®©äººä¸€çœ¼å¯Ÿè§‰åˆ°ç”»é¢çš„ä¸çœŸå®ï¼Ÿ</li><li>mc ç©äº†å¤šä¹…ï¼Œä½ è§‰å¾—è¿™ä¸ªæ¸¸æˆå¼€å‘è¿‡ç¨‹ä¸­ä¼šæœ‰å“ªäº›æŠ€æœ¯éš¾ç‚¹ï¼Œä»–æ˜¯æ€ä¹ˆå‘ˆç°å‡ºè¿™ä¹ˆå¤§çš„ä¸€ä¸ªä¸–ç•Œçš„ï¼Œä¸–ç•Œä¸­çš„æ–¹å—æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Œå®ä½“ä¹‹é—´çš„ç¢°æ’æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</li><li>ä½ ä¹‹å‰çš„è¿™ä¸ªé¡¹ç›®ï¼ˆä¸€ä¸ª 2D å¹³å°è·³è·ƒæ¸¸æˆï¼‰ä½ ç°åœ¨è§‰å¾—æœ‰ä»€ä¹ˆèƒ½æ”¹è¿›çš„åœ°æ–¹ï¼Ÿ</li></ul><h2 id="Bilibiliï¼šæ¸¸æˆå¼•æ“å¼€å‘å·¥ç¨‹å¸ˆ"><a href="#Bilibiliï¼šæ¸¸æˆå¼•æ“å¼€å‘å·¥ç¨‹å¸ˆ" class="headerlink" title="Bilibiliï¼šæ¸¸æˆå¼•æ“å¼€å‘å·¥ç¨‹å¸ˆ"></a>Bilibiliï¼šæ¸¸æˆå¼•æ“å¼€å‘å·¥ç¨‹å¸ˆ</h2><h3 id="å›¾å½¢å­¦-2"><a href="#å›¾å½¢å­¦-2" class="headerlink" title="å›¾å½¢å­¦"></a>å›¾å½¢å­¦</h3><ul><li>å»¶è¿Ÿæ¸²æŸ“ä¼˜ç¼ºç‚¹ï¼Ÿ<br><a href="https://zhuanlan.zhihu.com/p/28489928">å»¶è¿Ÿæ¸²æŸ“ï¼ˆDeferred Renderingï¼‰çš„å‰ç”Ÿä»Šä¸–</a><br><a href="https://zhuanlan.zhihu.com/p/54694743">æ¸¸æˆå¼•æ“ä¸­çš„å…‰ç…§ç®—æ³•</a><br><a href="https://zhuanlan.zhihu.com/p/85615283">Forward+ Shading</a><br><a href="https://www.zhihu.com/question/366668747">å»¶è¿Ÿæ¸²æŸ“ä¸ºä»€ä¹ˆä¸æ”¯æŒ MSAAï¼Ÿ</a><br><a href="https://www.zhihu.com/question/20236638/answer/44821615">FXAAã€FSAA ä¸ MSAA æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><li>ECS äº†è§£è¿‡å—ï¼Ÿ<br><a href="https://www.bilibili.com/video/BV1YY4y1p74P">GAMES104 Lecture 3</a></li><li>PBR ç›¸å¯¹äºä¼ ç»Ÿç»éªŒæ¨¡å‹ä¼˜ç¼ºç‚¹ï¼Ÿ<br><a href="https://www.bilibili.com/video/BV1J3411n7WT">GAMES104 Lecture 5</a><br><a href="https://game.academy.163.com/live?id=ga-1645069913225">E æ˜Ÿè®¡åˆ’ å…‰ç…§ç»¼è¿°</a></li><li>å±å¹•ç©ºé—´é˜´å½±äº†è§£è¿‡å—ï¼Ÿ<br><a href="https://blog.csdn.net/wodownload2/article/details/105202706">unity å±å¹•ç©ºé—´é˜´å½±</a></li><li>çº§è”é˜´å½±äº†è§£è¿‡å—ï¼Ÿ<br><a href="https://zhuanlan.zhihu.com/p/53689987">Cascaded Shadow Maps(CSM) å®æ—¶é˜´å½±çš„åŸç†ä¸å®ç°</a><br><a href="https://zhuanlan.zhihu.com/p/45673049">Unity å®æ—¶é˜´å½±å®ç°â€”â€”Cascaded Shadow Mapping</a></li><li>HDR äº†è§£è¿‡å—ï¼Ÿ<br><a href="https://www.bilibili.com/video/BV1VA41137Wp?p=2">ç™¾äººè®¡åˆ’ å›¾å½¢ 2.7 LDR ä¸ HDR</a><br><a href="https://zhuanlan.zhihu.com/p/79203830">Tone Mapping ä¸ Gamma Correction</a><br><a href="https://www.bilibili.com/video/BV1kY411P7QM">GAMES104 Lecture 7</a></li><li>mesh shader äº†è§£è¿‡å—ï¼Ÿ<br><a href="https://www.bilibili.com/video/BV1au411y7Fq">GAMES104 Lecture 6</a><br><a href="https://www.geeks3d.com/20200519/introduction-to-mesh-shaders-opengl-and-vulkan/">Quick Introduction to Mesh Shaders (OpenGL and Vulkan)</a><br><a href="https://www.zhihu.com/question/462023152/answer/1913213813">UE5 çš„ nanite å’Œ DX12U çš„ meshshader æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</a></li><li>å…‰çº¿è¿½è¸ªæ˜¯æ€ä¹ˆåšçš„ï¼Œç¦»çº¿å…‰è¿½æœ‰å“ªäº›åŠ é€Ÿç­–ç•¥ï¼Œå®æ—¶å…‰è¿½æœ‰å“ªäº›åŠ é€Ÿç­–ç•¥ï¼Ÿ<br>è¿™é‡Œè®²è®²æ¦‚å¿µå°±ç»™è¿‡äº†ï¼Œå±•å¼€è®²æˆ‘ä¸ä¼šä¹Ÿè®²ä¸å®Œã€‚</li><li>æµ‹è¯•åˆ†ä¸ºå“ªå‡ ä¸ªéƒ¨åˆ†ï¼Œä»€ä¹ˆé¡ºåºï¼Ÿ<br><a href="https://www.zhihu.com/question/384124671/answer/1121946801">æ·±åº¦æµ‹è¯•&#x2F;æ¨¡ç‰ˆæµ‹è¯•&#x2F;é€æ˜åº¦æµ‹è¯•å…ˆåé¡ºåºæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</a><br><a href="https://zhuanlan.zhihu.com/p/263566318">ç”¨ä¸€ç¯‡æ–‡ç« ç†è§£åŠé€æ˜æ¸²æŸ“ã€é€æ˜åº¦æµ‹è¯•å’Œæ··åˆã€æå‰æ·±åº¦æµ‹è¯•å¹¶å½»åº•ç†æ¸…æ¸²æŸ“é¡ºåºã€‚</a></li><li>æœ‰å“ªäº›é™ä½ DrawCall çš„æ‰‹æ®µï¼Œå‰”é™¤åˆ†ä¸ºå“ªå‡ ä¸ªéƒ¨åˆ†ï¼Œæ€ä¹ˆåšçš„ï¼Ÿ<br><a href="https://zhuanlan.zhihu.com/p/66407205">å‰”é™¤ï¼šä»è½¯ä»¶åˆ°ç¡¬ä»¶</a><br><a href="https://zhuanlan.zhihu.com/p/74936111">ã€æ¸¸æˆåœºæ™¯å‰”é™¤ã€‘å‰”é™¤ç®—æ³•ç»¼è¿°</a><br><a href="https://game.academy.163.com/live?id=ga-1645069975411">E æ˜Ÿè®¡åˆ’ Lecture 6</a></li><li>ç§»åŠ¨ç«¯çš„ TBDR äº†è§£è¿‡å—ï¼Œæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ<br><a href="https://zhuanlan.zhihu.com/p/259760974">IMR, TBR, TBDR è¿˜æœ‰ GPU æ¶æ„æ–¹é¢çš„ä¸€äº›ç†è§£</a><br><a href="https://zhuanlan.zhihu.com/p/112120206">ç§»åŠ¨è®¾å¤‡ GPU æ¶æ„çŸ¥è¯†æ±‡æ€»</a></li><li>Forward+ äº†è§£è¿‡å—ï¼Ÿ</li><li>ç”¨ Unity å†™è¿‡ Shader å—ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©å­¦ä¹  OpenGLï¼Ÿ<br>é¢è¯•å®˜å»ºè®®å¯ä»¥å°è¯•ä¸€ä¸‹æ–°ä¸€ç‚¹çš„å›¾å½¢ APIï¼Œæ¯”å¦‚ Vulkanã€DX12</li><li>Eigen è¿™ä¸ªåº“çš„æ•ˆç‡éå¸¸é«˜ï¼Œä½ è§‰å¾—æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ<br><a href="https://www.zhihu.com/question/28571059">Eigen çš„é€Ÿåº¦ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</a><br><a href="https://eigen.tuxfamily.org/dox/TopicLazyEvaluation.html">Lazy Evaluation and Aliasing</a><br><a href="https://eigen.tuxfamily.org/dox/TopicInsideEigenExample.html">What happens inside Eigen, on a simple example</a></li><li>ä½ è§‰å¾— C++11 ä¸­æœ€é‡è¦çš„ç‰¹æ€§æœ‰å“ªäº›ï¼Ÿ<br>é¢è¯•å®˜åˆç®€å•ä»‹ç»äº†ä¸€äº›ç°ä»£ C++ çš„ç‰¹æ€§ï¼šrangã€å‡½æ•°å¼ç¼–ç¨‹ã€æ‰§è¡Œç­–ç•¥</li></ul><h3 id="å…¶ä»–-2"><a href="#å…¶ä»–-2" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><ul><li>å¿«æ’ä¼˜ç¼ºç‚¹ï¼Œç¨³å®šå—ï¼Œæ—¶é—´å¤æ‚åº¦ï¼Œç©ºé—´å¤æ‚åº¦ï¼Œæœ€åä»€ä¹ˆæƒ…å†µï¼Ÿ</li><li>å †æ’åºä¼˜ç¼ºç‚¹ï¼Ÿ</li><li>è¿™äº›æ’åºç®—æ³•æ€ä¹ˆé€‰æ‹©ï¼Ÿ<br><a href="https://blog.csdn.net/likefrank/article/details/2974949">å„ç§æ’åºç®—æ³•çš„æ€»ç»“å’Œæ¯”è¾ƒ</a></li><li>è£…ç®±å¼€é”€ä½“ç°åœ¨å“ªé‡Œï¼Ÿ</li><li>mapã€unordered_map ä¸­æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</li><li>æœ‰å“ªäº› hash ç®—æ³•ï¼Ÿ</li></ul><h2 id="å…‰çº¿äº‘ï¼šå›¾å½¢ç®—æ³•å·¥ç¨‹å¸ˆ"><a href="#å…‰çº¿äº‘ï¼šå›¾å½¢ç®—æ³•å·¥ç¨‹å¸ˆ" class="headerlink" title="å…‰çº¿äº‘ï¼šå›¾å½¢ç®—æ³•å·¥ç¨‹å¸ˆ"></a>å…‰çº¿äº‘ï¼šå›¾å½¢ç®—æ³•å·¥ç¨‹å¸ˆ</h2><h3 id="å›¾å½¢å­¦-3"><a href="#å›¾å½¢å­¦-3" class="headerlink" title="å›¾å½¢å­¦"></a>å›¾å½¢å­¦</h3><ul><li>å…‰æ …åŒ–æœ‰å“ªäº›åšæ³•</li><li>VSM</li><li>å¹³é¢åå°„</li><li>VBOã€EBOã€VAO</li><li>PBR æœ‰å“ªäº›è´´å›¾<br>Albedoã€Normalã€Metallicã€Roughnessã€AO</li></ul><h3 id="C-3"><a href="#C-3" class="headerlink" title="C++"></a>C++</h3><ul><li>STL åº•å±‚</li><li>C++ å¼‚å¸¸</li><li>å¤šçº¿ç¨‹</li><li>æ­»é”æ€ä¹ˆå¤„ç†<br><a href="https://blog.csdn.net/wljliujuan/article/details/79614019">æ­»é”ï¼Œæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ä»¥åŠå¤„ç†ç­–ç•¥</a></li><li>å“ªäº›æ•°æ®æ˜¯ä¸€ä¸ªçº¿ç¨‹ç§æœ‰çš„</li><li>çº¢é»‘æ ‘åº•å±‚<br><a href="http://data.biancheng.net/view/85.html">çº¢é»‘æ ‘ç®—æ³•å’Œåº”ç”¨</a></li><li>æ„é€ å‡½æ•°ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯è™šå‡½æ•°<br>å¯¹è±¡æœªåˆ›å»ºæ—¶ä¸å­˜åœ¨è™šå‡½æ•°è¡¨æŒ‡é’ˆã€‚</li><li>æ™ºèƒ½æŒ‡é’ˆ</li><li>æ¨¡æ¿ç±»</li></ul><h2 id="ç½‘é¾™ï¼šç¨‹åºç ”ç©¶å‘˜"><a href="#ç½‘é¾™ï¼šç¨‹åºç ”ç©¶å‘˜" class="headerlink" title="ç½‘é¾™ï¼šç¨‹åºç ”ç©¶å‘˜"></a>ç½‘é¾™ï¼šç¨‹åºç ”ç©¶å‘˜</h2><h3 id="å›¾å½¢"><a href="#å›¾å½¢" class="headerlink" title="å›¾å½¢"></a>å›¾å½¢</h3><ul><li>æ·±åº¦æµ‹è¯•åœ¨ä»€ä¹ˆç©ºé—´</li><li>ä¸‰è§’å½¢å†…æ€ä¹ˆè¿›è¡Œæ’å€¼ï¼Œé‡å¿ƒåæ ‡æ€ä¹ˆæ±‚</li><li>PBR å…¬å¼ä»€ä¹ˆæ„ä¹‰ï¼Œæ€ä¹ˆæ¨å¯¼</li><li>æ³•å‘é‡ä¹˜ä»¥å˜æ¢å‘é‡é€†çŸ©é˜µçš„è½¬ç½®</li></ul><h3 id="C-4"><a href="#C-4" class="headerlink" title="C++"></a>C++</h3><ul><li>forward å’Œ move çš„åŒºåˆ«</li><li>çº¿ç¨‹ move</li><li>function å’Œ lambda çš„åŒºåˆ«</li><li>weak_ptr æ€ä¹ˆä¿è¯æœ‰æ•ˆ</li><li>unic_ptr æ€ä¹ˆå®ç°</li><li>obj æ–‡ä»¶å·¦å³æ‰‹åæ ‡ç³»</li></ul><h3 id="å…¶ä»–-3"><a href="#å…¶ä»–-3" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><ul><li>Unity åœºæ™¯èµ„æºç®¡ç†</li><li>Mä¹˜N å¤§å°çš„çŸ©é˜µï¼Œæ¯ä¸ªå…ƒç´ çš„å€¼éƒ½æ˜¯ Xä¹˜Y çš„ç»“æœï¼Œæ€ä¹ˆæ‰¾åˆ°ç¬¬ K å°çš„å…ƒç´ ã€‚</li><li>ä¸‰ç»´ç©ºé—´ä¸­æœ‰ä¸€ä¸ªåœ†åœˆï¼Œå·²çŸ¥åœ†ä¸Šä¸¤ç‚¹ Aã€B ä»¥åŠè¿‡ A ç‚¹çš„åˆ‡çº¿ï¼Œå¦‚ä½•ç”¨çº¿æ€§ä»£æ•°çš„æ–¹å¼æ±‚åœ†å¿ƒä½ç½®ã€‚</li></ul><h2 id="é‡Šå„ï¼šæ¸¸æˆå¼•æ“å¼€å‘"><a href="#é‡Šå„ï¼šæ¸¸æˆå¼•æ“å¼€å‘" class="headerlink" title="é‡Šå„ï¼šæ¸¸æˆå¼•æ“å¼€å‘"></a>é‡Šå„ï¼šæ¸¸æˆå¼•æ“å¼€å‘</h2><h3 id="C-5"><a href="#C-5" class="headerlink" title="C++"></a>C++</h3><ul><li>const å¯¹è±¡å¯ä»¥è§¦å‘ç§»åŠ¨å‡½æ•°å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li><li>è¢« move äº†çš„å¯¹è±¡è¿˜èƒ½ç»§ç»­ä½¿ç”¨å—ï¼Ÿ</li></ul><h3 id="å›¾å½¢-1"><a href="#å›¾å½¢-1" class="headerlink" title="å›¾å½¢"></a>å›¾å½¢</h3><ul><li>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒé‡ç¼“å†²ï¼Ÿ</li><li>æ¨¡å‹æ•°æ®ä» CPU åˆ° GPUï¼Œå†åˆ°æœ€åçš„ç”»é¢ï¼Œä¼šç»å†å“ªäº›ç©ºé—´è½¬æ¢ï¼Ÿ</li><li>ä½¿ç”¨ NDC ç©ºé—´çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>shader åœ¨ä½ çš„ç†è§£é‡Œæ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ</li><li>ä¸ºä»€ä¹ˆåœ¨ shader ä¸­è®¡ç®—ä¼šæ¯”åœ¨ cpu è®¡ç®—å¿«ï¼Ÿ</li><li>å†™ shader éœ€è¦æ³¨æ„äº›ä»€ä¹ˆï¼Ÿ</li><li>ä¸ºä»€ä¹ˆè¦é¿å…åˆ†æ”¯ï¼Œåˆ†æ”¯çš„å¼€é”€åœ¨äºä»€ä¹ˆï¼Ÿ</li><li>CPU ä¼ é€’ç»™ shader æ•°æ®è¦æ³¨æ„äº›ä»€ä¹ˆï¼Ÿ</li><li>GPU Driven æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ä¸ºä»€ä¹ˆç»å¸¸ç”¨è´´å›¾å»å­˜å‚¨æ•°æ®ï¼Ÿ</li><li>äº†è§£è¿‡ç°ä»£åŒ–çš„å›¾å½¢apiè®¾è®¡å—ï¼Ÿ</li><li>FrameGraph å®šä¹‰äº†å“ªäº› Stage å»åˆ’åˆ†ä¸€ä¸ª Pass çš„æµç¨‹ï¼Ÿ</li><li>FrameGraph å®šä¹‰äº†å“ªäº›èµ„æºç±»å‹ï¼Œæ¥æ›´å¥½çš„ç®¡ç†åŠ¨æ€èµ„æºï¼Œæˆ–è€…è¯´èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/1970/01/01/HelloWorld/"/>
    <url>/1970/01/01/HelloWorld/</url>
    
    <content type="html"><![CDATA[<h1 id="Markdown-Test"><a href="#Markdown-Test" class="headerlink" title="Markdown Test"></a>Markdown Test</h1><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p><code>std::string str;</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Hello CPP&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h2><p>$\dot{z}&#x3D;b$</p><p>$$<br>L_o(x, \omega_o) &#x3D; L_e(x, \omega_o) + \int_\Omega f_r(x, \omega_i, \omega_o)L_i(x, \omega_i)(\omega_i\cdot n)d\omega_i<br>$$</p><h2 id="è„šæ³¨"><a href="#è„šæ³¨" class="headerlink" title="è„šæ³¨"></a>è„šæ³¨</h2><p>è¿™æ˜¯ä¸€å¥è¯<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="è¿™æ˜¯å¯¹åº”çš„è„šæ³¨">[1]</span></a></sup></p><h2 id="ä¾¿ç­¾"><a href="#ä¾¿ç­¾" class="headerlink" title="ä¾¿ç­¾"></a>ä¾¿ç­¾</h2><div class="note note-primary">            <p>æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-secondary">            <p>æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-success">            <p>æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-danger">            <p>æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-warning">            <p>æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-info">            <p>æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><div class="note note-light">            <p>æ–‡å­— æˆ–è€… <code>markdown</code> å‡å¯</p>          </div><h2 id="è¡Œå†…æ ‡ç­¾"><a href="#è¡Œå†…æ ‡ç­¾" class="headerlink" title="è¡Œå†…æ ‡ç­¾"></a>è¡Œå†…æ ‡ç­¾</h2><span class="label label-primary">text</span><h2 id="æŠ˜å å¿«"><a href="#æŠ˜å å¿«" class="headerlink" title="æŠ˜å å¿«"></a>æŠ˜å å¿«</h2>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-b5714680" role="button" aria-expanded="false" aria-controls="collapse-b5714680">        <div class="fold-arrow">â–¶</div>title      </div>      <div class="fold-collapse collapse" id="collapse-b5714680">        <div class="fold-content">          <p>éœ€è¦æŠ˜å çš„ä¸€æ®µå†…å®¹ï¼Œæ”¯æŒ markdown</p>        </div>      </div>    </div><h2 id="å¤é€‰æ¡†"><a href="#å¤é€‰æ¡†" class="headerlink" title="å¤é€‰æ¡†"></a>å¤é€‰æ¡†</h2><div>            <input type="checkbox"  checked="checked">text          </div><div>            <input type="checkbox"  >text          </div><h2 id="æŒ‰é’®"><a href="#æŒ‰é’®" class="headerlink" title="æŒ‰é’®"></a>æŒ‰é’®</h2><a class="btn" href="https://roeas.github.io/2024/07/12/HelloWorld/"  title="title" target="_blank">text</a><h2 id="å›¾ç»„"><a href="#å›¾ç»„" class="headerlink" title="å›¾ç»„"></a>å›¾ç»„</h2><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/img/hina.png"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/hina.png"></div><div class="group-image-wrap"><img src="/img/hina.png"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/img/hina.png"></div><div class="group-image-wrap"><img src="/img/hina.png"></div><div class="group-image-wrap"><img src="/img/hina.png"></div></div></div><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>è¿™æ˜¯å¯¹åº”çš„è„šæ³¨<a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
